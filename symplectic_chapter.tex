
In this chapter, we will give a relational account of stabilizer codes (also known as mixed stabilizer circuits) using linear and affine symplectic geometry.
Unlike the previous section where the state spaces were finite sets, here the objects of study are symplectic vector space.  Symplectic vector spaces capture the possible configurations of position and momentum, along with a symplectic form which determines their commutation. The morphisms of study  are categories of (affine) (co)isotropic relations: capturing the nondeterministic evolution of the mechanical system in a way that preserves the commutation relation between position and momentum.

In Section \ref{sec:sym}, we give an overview of the theory of linear Lagrangian relations using the language of graphical linear algebra. In Section \ref{sec:univ}, we give generators for Lagrangian relations; showing that for prime fields, Lagrangian relations can be presented as a CPM construction over linear relations with respect to the orthogonal complement.
In Section \ref{sec:aff} we show that only one more generator is needed to obtain {\em affine} Lagrangian relations.  In the case of odd prime fields, we show in Theorem \ref{theorem:spekkens} that affine Lagrangian relations are quopit stabilizer circuits, modulo invertible scalars.  This gives  a graphical calculus which extends the previous work on Spekkens'  qubit toy model \cite{backensspek}, and the qutrit stabilizer ZX-calculus \cite{qutrit}.  We also discuss the relation to electrical circuits.
In Section \ref{sec:coisot} we add discarding to (affine) Lagrangian relations.  We show that this gives a semantics for stabilizer codes.  By splitting decoherence maps, we get another category of affine/linear relations.  We show that this gives semantics for state preparation and measurement of stabilizer codes, as well as electrical circuits with controlled voltage and current sources.  In Section \ref{sec:qec}, we discuss how the connection to error correction.

\section{Linear symplectic geometry}
\label{sec:sym}

In this section, we give an brief overview of finite-dimensional linear symplectic geometry, as well as categories of linear coisotropic/isotropic and Lagrangian relations.

See \cite{Weinstein2017} or  \cite{weinsteinsymplectic} for generalizations of to the infinite-dimensional linear and the nonlinear settings, respectively.

\begin{definition}
  Given a field  $k$ and a $k$-vector space $V$, a {\bf symplectic form} on $V$ is a bilinear map $\omega:V\times V\to k$ which is:
\begin{description}
 \item[Alternating:] $\forall v \in V$, $\omega(v,v)=0$.
 \item[Non-degenerate:] if $\exists v \in V: \forall w \in V: \omega(v,w)=0$, then $v=0$.
\end{description}
  A {\bf symplectic vector space} is a vector space equipped with a symplectic form. A (linear) {\bf symplectomorphism} is a linear isomorphism between symplectic vector spaces that preserves the symplectic form.
\end{definition}


\begin{lemma}[Darboux's theorem]
\label{lemma:sform}
Every vector space $k^{2n}$ with a chosen basis is equipped with a symplectic form,given by the following block matrix:
$$
\omega:=
\begin{bmatrix}
0_n & I_n\\
-I_n & 0_n
\end{bmatrix}
$$
so that $\omega(v,w) := v \omega w^T$.

Moreover, every finite dimensional symplectic vector space over $k$ is symplectomorphic to one of the form $k^{2n}$ with such a symplectic form.
\end{lemma}


\begin{definition}

Let $W \subseteq V$ be a linear subspace of a symplectic space $V$.
The {\bf symplectic dual} of the subspace $W$ is defined to be
$
W^\omega:= \{v \in V : \forall w \in W, \omega(v,w)=0 \}
$.
A linear subspace  $W$ of a symplectic vector space $V$ is {\bf isotropic} when $W^\omega \supseteq W$, {\bf coisotropic} when $W^\omega \subseteq W$ and {\bf Lagrangian} when $W^\omega=W$.
\end{definition}

Notice that the symplectic complement reverses the order of inclusion, so that coisotropic subspaces are turned into isotropic subspaces and vice versa.  In particular, we can see how this acts on the dimension of these subspaces:


\begin{lemma}
Given a symplectic vector space $k^{2n}$, an isotropic vector space has dimension less than or equal to $n$; and a coisotropic subspace has dimension greater or equal to $n$.  Therefore, a Lagrangian subspace has dimension $n$
\end{lemma}


\begin{definition}
A {\bf symplectic basis} for a $n-m$ dimensional isotropic subspace $W \subseteq k^2n$ of dimension $n-m$ is a basis $\{b_0,\ldots, b_{n-m-1}\}$ such that for all $b_i$ and $b_j$, $\omega(b_i,b_j)$.
\end{definition}

Every isotropic subspace admits a (non-unique) symplectic basis.  Take an isotropic subspace $W \subseteq k^{2n}$ of dimension $n-m$.  We will denote such a basis by the block matrix $[Z|X]$ where $Z$ and $X$ are  $n-k\times n$ matrices.  The rows of this matrix are the basis elements and the two gradings reflect the grading of the symplectic vector space.


All of these subspaces generalize the notion of symplectomorphism:

\begin{lemma}
Every symplectomorphism $f:V\to V$ induces a Lagrangian subspace $\Gamma_f:=\{ (fv, v) | v \in V \}$.
\end{lemma}



In linear mechanical systems, symplectic vector spaces over $\R$ are interpreted as  the phase space: ie the space of all allowable configurations of position and momentum.  The Lagrangian subspaces are interpreted as the initial configurations of the mechanical system. The symplectic form measures the volume between points, in the phase space; where symplectomorphisms are the time-reversible, volume preserving transformations of the phase space.

The following  categories of isotropic/coisotropic/Lagrangian relations generalizes symplectomorphisms in a way that allows nondeterministic evolution:

\begin{definition}
Given a field $k$, the prop of {\bf Lagrangian relations},  $\Lag\Rel_k$ has morphisms $n\to m$ being Lagrangian subspaces of the symplectic vector space $k^{n+m} \oplus k^{n+m}$ with respect to the symplectic form given above.  Composition is given by relational composition. The tensor product is given by the direct sum, where the $Z$ and $X$ gradients are grouped together as follows:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (616) at (272, 0) {$V$};
		\node [style=none] (617) at (271.75, 1) {};
		\node [style=none] (618) at (272.25, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=60] (616) to (618.center);
		\draw [in=-90, out=120] (616) to (617.center);
	\end{pgfonlayer}
\end{tikzpicture}
\oplus
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (616) at (272, 0) {$W$};
		\node [style=none] (617) at (271.75, 1) {};
		\node [style=none] (618) at (272.25, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=60] (616) to (618.center);
		\draw [in=-90, out=120] (616) to (617.center);
	\end{pgfonlayer}
\end{tikzpicture}
:=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (99) at (192.5, -3.5) {$V$};
		\node [style=none] (100) at (192.5, -2.25) {};
		\node [style=none] (101) at (193.5, -2.25) {};
		\node [style=map] (102) at (193.5, -3.5) {$W$};
		\node [style=none] (103) at (192.5, -2.25) {};
		\node [style=none] (104) at (193.5, -2.25) {};
		\node [style=otimes] (105) at (192.5, -2.25) {};
		\node [style=none] (106) at (192.5, -1.75) {};
		\node [style=none] (107) at (193.5, -1.75) {};
		\node [style=none] (108) at (192.5, -1.75) {};
		\node [style=none] (109) at (193.5, -1.75) {};
		\node [style=otimes] (110) at (193.5, -2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-150, out=45, looseness=0.75] (99) to (101.center);
		\draw [in=-135, out=120] (99) to (100.center);
		\draw [in=-45, out=60] (102) to (104.center);
		\draw [in=-30, out=135, looseness=0.75] (102) to (103.center);
		\draw (109.center) to (104.center);
		\draw (103.center) to (108.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

The props of {\bf isotropic relations} and {\bf coisotropic relations}, $\Isot\Rel_{k}$ and $\Co\Isot\Rel_{k}$ are defined in the obvious analogous ways.
\end{definition}


Such structures appear in the literature in the nonlinear setting as ``canonical relations,'' first appearing in \cite{Guillemin} (although composition is only partially defined in this more general setting).  However, this construction is  apparenly originally attributed to the, at that time, unpublished work of Weinsten, thus, it is also called the ``Weinstein sympectic category''.


%For the purposes of this paper, because it is so much easier to work in a prop, we will draw string diagram in the skeleton of $\Lag\Rel_k$ whose objects are all of the form $k^{2n}$ equipped with the symplectic form of Lemma \ref{lemma:sform}.

%Where we are grouping the $X$ gradings together on the left and the $Z$ gradings together on the right. Note that this means the embedding of $\Lag\Rel_k$ into $\LinRel_k$ preserves the monoidal product only up to isomorphism. More precisely, we have the following fact.

It is easy to see that there is an embedding of these categories into $\LinRel_k$:

\begin{lemma}
\label{lemma:strong}
The forgetful functors fom Lagrangian/isotropic/cosisotropic relations to linear relations  are faithful, strong symmetric monoidal.
\end{lemma}



Due to the above lemma, we will regard $\Lag\Rel_k$, $\Isot\Rel_k$, $\Co\Isot\Rel_k$ as symmetric monoidal subcategories of $\LinRel_k$.
As such, we can ask what the generators of $\Lag\Rel_k$, $\Isot\Rel_k$ and $\Co\Isot\Rel_k$ look like in terms of string diagrams of linear relations. We first describe what it means to be a Lagrangian relation in pictures.  In Section \ref{sec:coisot}, we will return to the question of (co)isotropic relations.

Concretely, the symplectic dual of a linear subspace $W \subseteq V$ is:
\begin{align*}
W^\omega :&= \{(v_1,v_2) \in V : \forall (w_1,w_2) \in W, \omega((v_1,v_2),(w_1,w_2))=0 \}\\
                    &= \{(v_1,v_2) \in V : \forall (w_1,w_2) \in W,  \langle (v_2,-v_1) ,(w_1,w_2)\rangle =0 \}\\
                    &= \{(v_2,-v_1) \in V : \forall (w_1,w_2) \in W,  \langle (v_1,v_2) ,(w_1,w_2)\rangle =0 \}
\end{align*}

Therefore, the condition asking that $W=W^\omega$ is graphically:

\begin{equation}
\label{eq:lag}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (0.75, -1) {$W$};
		\node [style=none] (1) at (0.5, 0) {};
		\node [style=none] (2) at (1, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (0.75, -1.75) {$W^\perp$};
		\node [style=none] (1) at (0.5, -1) {};
		\node [style=none] (2) at (1, -1) {};
		\node [style=none] (3) at (1, 0) {};
		\node [style=none] (4) at (0.5, 0) {};
		\node [style=s] (5) at (1, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-90, out=90] (2.center) to (4.center);
		\draw [in=-270, out=-90] (3.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{equation}


The category of Lagrangian relations is compact closed.  Given a relation $V$ between symplectic vector spaces, we can curry it into a state $\lfloor V \rfloor$; and similarily, we can uncurry a states back into processes:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (0.75, -1.75) {$V$};
		\node [style=none] (1) at (0.5, -1) {};
		\node [style=none] (2) at (1, -1) {};
		\node [style=none] (3) at (0.5, -2.5) {};
		\node [style=none] (4) at (1, -2.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-60, out=90] (4.center) to (0);
		\draw [in=90, out=-120] (0) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
\xmapsto{\lfloor{\_}\rfloor }
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (0.75, -1.75) {$V$};
		\node [style=none] (1) at (0, -1) {};
		\node [style=none] (2) at (1.25, -1) {};
		\node [style=none] (4) at (1.25, -2.5) {};
		\node [style=X] (5) at (0, -3) {};
		\node [style=Z] (6) at (0.75, -3) {};
		\node [style=none] (7) at (0.75, -1) {};
		\node [style=none] (8) at (-0.5, -1) {};
		\node [style=none] (9) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-45, out=90] (4.center) to (0);
		\draw [in=-90, out=135, looseness=0.75] (5) to (8.center);
		\draw [in=30, out=-90] (4.center) to (6);
		\draw [in=90, out=-90] (7.center) to (9.center);
		\draw [in=150, out=-90] (9.center) to (6);
		\draw [in=45, out=-135] (0) to (5);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{1cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (1.5, -2) {$W$};
		\node [style=none] (1) at (1.25, -1) {};
		\node [style=none] (2) at (2.25, -1) {};
		\node [style=none] (6) at (1.75, -1) {};
		\node [style=none] (7) at (0.75, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=105, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=120, out=-90] (7.center) to (0);
		\draw [in=-90, out=75] (0) to (6.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (1.75, -2.25) {$W$};
		\node [style=none] (1) at (1, -0.75) {};
		\node [style=none] (2) at (2, -0.75) {};
		\node [style=none] (6) at (1.5, -1.25) {};
		\node [style=none] (7) at (0.75, -1.25) {};
		\node [style=Z] (8) at (1.5, -1.25) {};
		\node [style=X] (9) at (0.75, -1.25) {};
		\node [style=none] (10) at (0.25, -2.5) {};
		\node [style=none] (11) at (1, -2.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=105, out=-90, looseness=1.25] (1.center) to (0);
		\draw [in=-90, out=45, looseness=0.75] (0) to (2.center);
		\draw [in=135, out=-30] (7.center) to (0);
		\draw [in=-45, out=75] (0) to (6.center);
		\draw [in=-135, out=90] (10.center) to (9);
		\draw [in=-135, out=90] (11.center) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
$$
It is easy to see that these two constructions are inverse to each other.
This allows us to derive a graphical criteria for abitrary Lagrangian relations, generalizing Equation \ref{eq:lag}:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (0.75, -1.75) {$V$};
		\node [style=none] (1) at (0, -0.75) {};
		\node [style=none] (2) at (1.25, -0.75) {};
		\node [style=none] (4) at (1.25, -2.5) {};
		\node [style=X] (5) at (0, -3) {};
		\node [style=Z] (6) at (0.75, -3) {};
		\node [style=none] (7) at (0.75, -0.75) {};
		\node [style=none] (8) at (-0.5, -0.75) {};
		\node [style=none] (9) at (0, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-45, out=90] (4.center) to (0);
		\draw [in=-90, out=135, looseness=0.75] (5) to (8.center);
		\draw [in=30, out=-90] (4.center) to (6);
		\draw [in=90, out=-90] (7.center) to (9.center);
		\draw [in=150, out=-90] (9.center) to (6);
		\draw [in=45, out=-135] (0) to (5);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (43) at (13.5, -1.75) {$V^\perp$};
		\node [style=none] (44) at (12.75, -0.75) {};
		\node [style=none] (45) at (14, -0.75) {};
		\node [style=none] (46) at (14, -2.5) {};
		\node [style=Z] (47) at (12.75, -3) {};
		\node [style=X] (48) at (13.5, -3) {};
		\node [style=none] (49) at (13.5, -0.75) {};
		\node [style=none] (50) at (12.25, -0.75) {};
		\node [style=none] (51) at (12.75, -2) {};
		\node [style=none] (52) at (13.5, 0.75) {};
		\node [style=none] (53) at (14, 0.75) {};
		\node [style=none] (54) at (12.25, 0.75) {};
		\node [style=none] (55) at (12.75, 0.75) {};
		\node [style=s] (56) at (14, -0.75) {};
		\node [style=s] (57) at (13.5, -0.75) {};
		\node [style=none] (58) at (13.25, -3.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (44.center) to (43);
		\draw [in=-90, out=60] (43) to (45.center);
		\draw [in=-45, out=90] (46.center) to (43);
		\draw [in=-90, out=135, looseness=0.75] (47) to (50.center);
		\draw [in=30, out=-90] (46.center) to (48);
		\draw [in=90, out=-90] (49.center) to (51.center);
		\draw [in=150, out=-90] (51.center) to (48);
		\draw [in=45, out=-135] (43) to (47);
		\draw [in=270, out=90] (45.center) to (55.center);
		\draw [in=270, out=90] (49.center) to (54.center);
		\draw [in=270, out=90] (44.center) to (53.center);
		\draw [in=270, out=90] (50.center) to (52.center);
	\end{pgfonlayer}
\end{tikzpicture}
\iff
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (2, -2) {$V$};
		\node [style=none] (1) at (1.75, -1.25) {};
		\node [style=none] (2) at (2.25, -1.25) {};
		\node [style=none] (3) at (1.75, -2.75) {};
		\node [style=none] (4) at (2.25, -2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-60, out=90] (4.center) to (0);
		\draw [in=90, out=-120] (0) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (2.5, -1.75) {$V$};
		\node [style=none] (1) at (2, -0.5) {};
		\node [style=none] (2) at (3, -0.5) {};
		\node [style=none] (3) at (3, -2.5) {};
		\node [style=X] (4) at (1.75, -3) {};
		\node [style=Z] (5) at (2.5, -3) {};
		\node [style=none] (6) at (2.5, -0.75) {};
		\node [style=none] (7) at (1.5, -0.75) {};
		\node [style=none] (8) at (1.75, -2) {};
		\node [style=X] (9) at (1.5, -0.75) {};
		\node [style=Z] (10) at (2.5, -0.75) {};
		\node [style=none] (11) at (0.5, -3.25) {};
		\node [style=none] (12) at (1, -3.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-45, out=90] (3.center) to (0);
		\draw [in=-45, out=150] (4) to (7.center);
		\draw [in=30, out=-90] (3.center) to (5);
		\draw [in=90, out=-45, looseness=1.25] (6.center) to (8.center);
		\draw [in=150, out=-90] (8.center) to (5);
		\draw [in=45, out=-135] (0) to (4);
		\draw [in=90, out=-150] (10) to (12.center);
		\draw [in=90, out=-120] (9) to (11.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (59) at (17, -1.75) {$V^\perp$};
		\node [style=none] (60) at (16.25, -0.75) {};
		\node [style=none] (61) at (17.5, -0.75) {};
		\node [style=none] (62) at (17.5, -2.5) {};
		\node [style=Z] (63) at (16.25, -3) {};
		\node [style=X] (64) at (17, -3) {};
		\node [style=none] (65) at (17, -0.75) {};
		\node [style=none] (66) at (15.75, -0.75) {};
		\node [style=none] (67) at (16.25, -2) {};
		\node [style=none] (68) at (16.5, 0.75) {};
		\node [style=none] (69) at (17.5, 1) {};
		\node [style=none] (70) at (15.5, 0.75) {};
		\node [style=none] (71) at (16, 1) {};
		\node [style=s] (72) at (17.5, -0.75) {};
		\node [style=s] (73) at (17, -0.75) {};
		\node [style=X] (74) at (15.5, 0.75) {};
		\node [style=Z] (75) at (16.5, 0.75) {};
		\node [style=none] (76) at (15, -3.25) {};
		\node [style=none] (77) at (15.5, -3.25) {};
		\node [style=none] (78) at (16.5, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (60.center) to (59);
		\draw [in=-90, out=60] (59) to (61.center);
		\draw [in=-45, out=90] (62.center) to (59);
		\draw [in=-90, out=135, looseness=0.75] (63) to (66.center);
		\draw [in=30, out=-90] (62.center) to (64);
		\draw [in=90, out=-90] (65.center) to (67.center);
		\draw [in=150, out=-90] (67.center) to (64);
		\draw [in=45, out=-135] (59) to (63);
		\draw [in=-90, out=90, looseness=1.25] (61.center) to (71.center);
		\draw [in=-60, out=90] (65.center) to (70.center);
		\draw [in=270, out=90] (60.center) to (69.center);
		\draw [in=-45, out=90, looseness=1.25] (66.center) to (68.center);
		\draw [in=-135, out=90, looseness=0.50] (76.center) to (74);
		\draw [in=-150, out=90] (77.center) to (75);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (4.5, -1.75) {$V^\perp$};
		\node [style=none] (1) at (4, -1) {};
		\node [style=none] (2) at (5, -1) {};
		\node [style=none] (3) at (5, -2.5) {};
		\node [style=X] (4) at (4.75, -3) {};
		\node [style=none] (5) at (3.75, -2.25) {};
		\node [style=none] (6) at (5, 0) {};
		\node [style=none] (7) at (4, 0) {};
		\node [style=s] (8) at (5, -1) {};
		\node [style=none] (9) at (3.25, -3.25) {};
		\node [style=none] (10) at (4, -3.25) {};
		\node [style=Z] (11) at (3.75, -2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-45, out=90] (3.center) to (0);
		\draw [in=30, out=-90] (3.center) to (4);
		\draw [in=165, out=-15, looseness=1.25] (5.center) to (4);
		\draw [in=-90, out=90, looseness=1.25] (2.center) to (7.center);
		\draw [in=270, out=90] (1.center) to (6.center);
		\draw [in=240, out=90] (10.center) to (0);
		\draw [in=90, out=-150] (11) to (9.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (2, -2) {$V^\perp$};
		\node [style=none] (1) at (1.75, -1.25) {};
		\node [style=none] (2) at (2.25, -1.25) {};
		\node [style=none] (3) at (1.75, -2.75) {};
		\node [style=none] (4) at (2.25, -2.75) {};
		\node [style=none] (5) at (2.25, -0.5) {};
		\node [style=none] (6) at (1.75, -0.5) {};
		\node [style=none] (7) at (2.25, -3.5) {};
		\node [style=none] (8) at (1.75, -3.5) {};
		\node [style=s] (9) at (2.25, -1.25) {};
		\node [style=s] (10) at (2.25, -2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=120, out=-90] (1.center) to (0);
		\draw [in=-90, out=60] (0) to (2.center);
		\draw [in=-60, out=90] (4.center) to (0);
		\draw [in=90, out=-120] (0) to (3.center);
		\draw [in=90, out=-90] (6.center) to (2.center);
		\draw [in=270, out=90] (1.center) to (5.center);
		\draw [in=270, out=90] (7.center) to (3.center);
		\draw [in=270, out=90] (8.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
For this reason, we will depict Lagrangian relations as processes, where the input wires are on the bottom and output wires on on the top.

There is a graphical interpretation of the orthogonal complement:

\begin{lemma}[{\cite{ortho}}]
Given a field $k$, the orthogonal complement extends to a symmetric monoidal involution $(-)^\perp:\LinRel_k\to \LinRel_k$.

The orthogonal complement corresponds to the colour swapping functor $\ih_k\to \ih_k;$

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (17) at (2.5, 0.5) {};
		\node [style=none] (18) at (3.5, 0.5) {};
		\node [style=Z] (19) at (3, 1.25) {};
		\node [style=none] (20) at (3, 0.75) {$\cdots$};
		\node [style=none] (21) at (3, 1.75) {$\cdots$};
		\node [style=none] (22) at (3.5, 2) {};
		\node [style=none] (23) at (3, 1.25) {};
		\node [style=none] (24) at (2.5, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=simple, in=-56, out=90] (18.center) to (19);
		\draw [style=simple, in=90, out=-124] (19) to (17.center);
		\draw [style=simple, in=56, out=-90] (22.center) to (23.center);
		\draw [style=simple, in=-90, out=124] (23.center) to (24.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (17) at (2.5, 0.5) {};
		\node [style=none] (18) at (3.5, 0.5) {};
		\node [style=X] (19) at (3, 1.25) {};
		\node [style=none] (20) at (3, 0.75) {$\cdots$};
		\node [style=none] (21) at (3, 1.75) {$\cdots$};
		\node [style=none] (22) at (3.5, 2) {};
		\node [style=none] (23) at (3, 1.25) {};
		\node [style=none] (24) at (2.5, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=simple, in=-56, out=90] (18.center) to (19);
		\draw [style=simple, in=90, out=-124] (19) to (17.center);
		\draw [style=simple, in=56, out=-90] (22.center) to (23.center);
		\draw [style=simple, in=-90, out=124] (23.center) to (24.center);
	\end{pgfonlayer}
\end{tikzpicture}\ , \hspace*{.2cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (17) at (2.5, 0.5) {};
		\node [style=none] (18) at (3.5, 0.5) {};
		\node [style=X] (19) at (3, 1.25) {};
		\node [style=none] (20) at (3, 0.75) {$\cdots$};
		\node [style=none] (21) at (3, 1.75) {$\cdots$};
		\node [style=none] (22) at (3.5, 2) {};
		\node [style=none] (23) at (3, 1.25) {};
		\node [style=none] (24) at (2.5, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=simple, in=-56, out=90] (18.center) to (19);
		\draw [style=simple, in=90, out=-124] (19) to (17.center);
		\draw [style=simple, in=56, out=-90] (22.center) to (23.center);
		\draw [style=simple, in=-90, out=124] (23.center) to (24.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (17) at (2.5, 0.5) {};
		\node [style=none] (18) at (3.5, 0.5) {};
		\node [style=Z] (19) at (3, 1.25) {};
		\node [style=none] (20) at (3, 0.75) {$\cdots$};
		\node [style=none] (21) at (3, 1.75) {$\cdots$};
		\node [style=none] (22) at (3.5, 2) {};
		\node [style=none] (23) at (3, 1.25) {};
		\node [style=none] (24) at (2.5, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=simple, in=-56, out=90] (18.center) to (19);
		\draw [style=simple, in=90, out=-124] (19) to (17.center);
		\draw [style=simple, in=56, out=-90] (22.center) to (23.center);
		\draw [style=simple, in=-90, out=124] (23.center) to (24.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ , \hspace*{.2cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=scalar] (54) at (15, -2.5) {$a$};
		\node [style=none] (55) at (15, -2) {};
		\node [style=none] (56) at (15, -3) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (56.center) to (54);
		\draw (54) to (55.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=scalarop] (54) at (15, -2.5) {$a$};
		\node [style=none] (55) at (15, -2) {};
		\node [style=none] (56) at (15, -3) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (56.center) to (54);
		\draw (54) to (55.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\end{lemma}

This graphical characterization of the orthogonal complement  can be derived by a simple induction proof (which is not actually provided in \cite{ortho}).  However, a fully graphical proof remains open.




There is a functor in the other direction:

\begin{lemma}
There is a faithful, strong symmetric monoidal functor $L:\LinRel_k\to\Lag\Rel_k$, given by doubling with respect to the orthogonal complement:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (-3, -1) {$V$};
		\node [style=none] (1) at (-3, -0.25) {};
		\node [style=none] (2) at (-3, -1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (0);
		\draw (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (0.5, -1) {$V^\perp$};
		\node [style=none] (1) at (0.5, -0.25) {};
		\node [style=none] (2) at (0.5, -1.75) {};
		\node [style=map] (3) at (1.5, -1) {$V$};
		\node [style=none] (4) at (1.5, -0.25) {};
		\node [style=none] (5) at (1.5, -1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (0);
		\draw (0) to (2.center);
		\draw (4.center) to (3);
		\draw (3) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
%
%$$
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (0) at (-3, -1) {$V^\perp$};
%		\node [style=none] (1) at (-3, -0.25) {};
%		\node [style=none] (2) at (-3, -1.75) {};
%		\node [style=map] (3) at (-2.25, -1) {$V$};
%		\node [style=none] (4) at (-2.25, -0.25) {};
%		\node [style=none] (5) at (-2.25, -1.75) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (1.center) to (0);
%		\draw (0) to (2.center);
%		\draw (4.center) to (3);
%		\draw (3) to (5.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (0) at (-3, -1) {$V$};
%		\node [style=none] (1) at (-3, -0.25) {};
%		\node [style=none] (2) at (-3, -1.75) {};
%		\node [style=map] (3) at (-2.25, -1) {$V^\perp$};
%		\node [style=none] (4) at (-2.25, -0.25) {};
%		\node [style=none] (5) at (-2.25, -1.75) {};
%		\node [style=none] (6) at (-2.25, 0.75) {};
%		\node [style=none] (7) at (-3, 0.75) {};
%		\node [style=none] (8) at (-2.25, -2.75) {};
%		\node [style=none] (9) at (-3, -2.75) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (1.center) to (0);
%		\draw (0) to (2.center);
%		\draw (4.center) to (3);
%		\draw (3) to (5.center);
%		\draw [in=270, out=90] (1.center) to (6.center);
%		\draw [in=270, out=90] (4.center) to (7.center);
%		\draw [in=270, out=90] (8.center) to (2.center);
%		\draw [in=270, out=90] (9.center) to (5.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (0) at (0.5, -1) {$V$};
%		\node [style=none] (1) at (0.5, 0.25) {};
%		\node [style=none] (2) at (0.5, -1.75) {};
%		\node [style=map] (3) at (1.25, -1) {$V^\perp$};
%		\node [style=none] (4) at (1.25, 0.25) {};
%		\node [style=none] (5) at (1.25, -1.75) {};
%		\node [style=none] (6) at (1.25, 1.25) {};
%		\node [style=none] (7) at (0.5, 1.25) {};
%		\node [style=none] (8) at (1.25, -2.75) {};
%		\node [style=none] (9) at (0.5, -2.75) {};
%		\node [style=s] (10) at (1.25, 0.25) {};
%		\node [style=s] (11) at (1.25, -0.25) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (1.center) to (0);
%		\draw (0) to (2.center);
%		\draw (4.center) to (3);
%		\draw (3) to (5.center);
%		\draw [in=270, out=90] (1.center) to (6.center);
%		\draw [in=270, out=90] (4.center) to (7.center);
%		\draw [in=270, out=90] (8.center) to (2.center);
%		\draw [in=270, out=90] (9.center) to (5.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (0) at (-3, -1) {$V$};
%		\node [style=none] (1) at (-3, -0.25) {};
%		\node [style=none] (2) at (-3, -1.75) {};
%		\node [style=map] (3) at (-2.25, -1) {$V^\perp$};
%		\node [style=none] (4) at (-2.25, -0.25) {};
%		\node [style=none] (5) at (-2.25, -1.75) {};
%		\node [style=none] (6) at (-2.25, 0.75) {};
%		\node [style=none] (7) at (-3, 0.75) {};
%		\node [style=none] (8) at (-2.25, -2.75) {};
%		\node [style=none] (9) at (-3, -2.75) {};
%		\node [style=s] (10) at (-2.25, -0.25) {};
%		\node [style=s] (11) at (-2.25, -1.75) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (1.center) to (0);
%		\draw (0) to (2.center);
%		\draw (4.center) to (3);
%		\draw (3) to (5.center);
%		\draw [in=270, out=90] (1.center) to (6.center);
%		\draw [in=270, out=90] (4.center) to (7.center);
%		\draw [in=270, out=90] (8.center) to (2.center);
%		\draw [in=270, out=90] (9.center) to (5.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%$$
\end{lemma}


To check this is a functor, all we have to show is that it produces Lagrangian relations. This follows immediately from the naturality of $-1$.
Indeed, because Lagrangian subspaces are isotropic and coisotropic, this extends to functors $\LinRel_k\to\Isot\Rel_k$ and $\LinRel_k\to\Co\Isot\Rel_k$.


This functor is symmetric monoidal and faithful but not full, as for example, the following Lagrangian relation is not in the image of $L$:
$$
\left(
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (127) at (71, 0.25) {};
		\node [style=none] (128) at (71, 1) {};
		\node [style=none] (129) at (71, -1) {};
		\node [style=Z] (130) at (72, -0.25) {};
		\node [style=none] (132) at (72, 1) {};
		\node [style=none] (133) at (72, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (129.center) to (127);
		\draw (127) to (128.center);
		\draw (133.center) to (130);
		\draw (130) to (132.center);
		\draw (130) to (127);
	\end{pgfonlayer}
\end{tikzpicture}\right)^\omega
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (134) at (74, -0.25) {};
		\node [style=Z] (137) at (73, 0.25) {};
		\node [style=none] (138) at (73, -1) {};
		\node [style=none] (139) at (73, 0.5) {};
		\node [style=s] (140) at (74, 0.5) {};
		\node [style=s] (141) at (74, -1) {};
		\node [style=none] (142) at (74, 1.5) {};
		\node [style=none] (143) at (73, 1.5) {};
		\node [style=none] (144) at (74, -2) {};
		\node [style=none] (145) at (73, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (139.center) to (137);
		\draw (137) to (138.center);
		\draw (137) to (134);
		\draw (141) to (134);
		\draw (134) to (140);
		\draw [in=270, out=90] (139.center) to (142.center);
		\draw [in=90, out=-90] (143.center) to (140);
		\draw [in=90, out=-90] (138.center) to (144.center);
		\draw [in=270, out=90] (145.center) to (141);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (146) at (75, -0.25) {};
		\node [style=Z] (147) at (76, 0.25) {};
		\node [style=none] (148) at (76, -1) {};
		\node [style=none] (149) at (76, 0.5) {};
		\node [style=s] (150) at (75, 0.5) {};
		\node [style=s] (151) at (75, -1) {};
		\node [style=none] (152) at (76, 1.5) {};
		\node [style=none] (153) at (75, 1.5) {};
		\node [style=none] (154) at (76, -2) {};
		\node [style=none] (155) at (75, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (149.center) to (147);
		\draw (147) to (148.center);
		\draw (147) to (146);
		\draw (151) to (146);
		\draw (146) to (150);
		\draw [in=270, out=90] (149.center) to (152.center);
		\draw [in=90, out=-90] (153.center) to (150);
		\draw [in=90, out=-90] (148.center) to (154.center);
		\draw [in=270, out=90] (155.center) to (151);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (156) at (77, -0.25) {};
		\node [style=Z] (157) at (78, 0.25) {};
		\node [style=none] (158) at (78, -1) {};
		\node [style=none] (159) at (78, 0.75) {};
		\node [style=none] (162) at (78, 1.5) {};
		\node [style=none] (163) at (77, 1.5) {};
		\node [style=none] (164) at (78, -2) {};
		\node [style=none] (165) at (77, -2) {};
		\node [style=s] (166) at (77.5, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (159.center) to (157);
		\draw (157) to (158.center);
		\draw [in=270, out=90] (159.center) to (162.center);
		\draw [in=90, out=-90] (158.center) to (164.center);
		\draw (163.center) to (156);
		\draw (156) to (165.center);
		\draw (156) to (166);
		\draw (166) to (157);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (127) at (71, 0.25) {};
		\node [style=none] (128) at (71, 1) {};
		\node [style=none] (129) at (71, -1) {};
		\node [style=Z] (130) at (72, -0.25) {};
		\node [style=none] (132) at (72, 1) {};
		\node [style=none] (133) at (72, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (129.center) to (127);
		\draw (127) to (128.center);
		\draw (133.center) to (130);
		\draw (130) to (132.center);
		\draw (130) to (127);
	\end{pgfonlayer}
\end{tikzpicture}
$$



Unlike $\LinRel_k$, these are no longer a bicategories of relations:

\begin{remark}
\label{rem:lagrelbicatrel}
$\Lag\Rel_k$ is not a bicategory of relations.  No matter which Frobenius algebra we chose, it is not laxly natural with respect to both the phase shifts and the Fourier transform of the phase shifts:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (-1.25, 0) {};
		\node [style=Z] (1) at (0.25, 0) {};
		\node [style=none] (2) at (-1.75, 1) {};
		\node [style=none] (3) at (-0.75, 1) {};
		\node [style=none] (4) at (-0.25, 1) {};
		\node [style=none] (5) at (0.75, 1) {};
		\node [style=X] (13) at (-1.25, -1) {};
		\node [style=Z] (14) at (0.25, -0.5) {};
		\node [style=X] (15) at (-1.25, -1.5) {};
		\node [style=Z] (16) at (0.25, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=150] (0) to (2.center);
		\draw [in=270, out=30] (0) to (3.center);
		\draw [bend right] (4.center) to (1);
		\draw [bend right] (1) to (5.center);
		\draw (15) to (13);
		\draw (13) to (0);
		\draw (13) to (14);
		\draw (14) to (1);
		\draw (14) to (16);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (51) at (2, -0.25) {};
		\node [style=Z] (52) at (3.5, 0.25) {};
		\node [style=none] (53) at (1.5, 0.75) {};
		\node [style=none] (54) at (2.5, 0.75) {};
		\node [style=none] (55) at (3, 1.25) {};
		\node [style=none] (56) at (4, 1.25) {};
		\node [style=none] (57) at (2.5, 1.25) {};
		\node [style=none] (58) at (1.5, 1.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=150] (51) to (53.center);
		\draw [in=270, out=30] (51) to (54.center);
		\draw [bend right] (55.center) to (52);
		\draw [bend right] (52) to (56.center);
		\draw (51) to (52);
		\draw (53.center) to (58.center);
		\draw (57.center) to (54.center);
	\end{pgfonlayer}
\end{tikzpicture}
\not\subseteq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (80) at (7.75, -0.75) {};
		\node [style=none] (81) at (7.25, 0.25) {};
		\node [style=none] (82) at (8.25, 0.25) {};
		\node [style=Z] (83) at (8.25, 0.75) {};
		\node [style=none] (84) at (7.25, 1.25) {};
		\node [style=none] (85) at (8.25, 1.25) {};
		\node [style=X] (86) at (9, 0.75) {};
		\node [style=none] (87) at (9, 0.75) {};
		\node [style=Z] (89) at (9.75, 0.75) {};
		\node [style=none] (90) at (9, 1.25) {};
		\node [style=none] (91) at (9.75, 1.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=150] (80) to (81.center);
		\draw [in=270, out=30] (80) to (82.center);
		\draw (82.center) to (83);
		\draw (83) to (85.center);
		\draw (81.center) to (84.center);
		\draw [in=90, out=-150] (83) to (80);
		\draw (89) to (91.center);
		\draw (87.center) to (90.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (59) at (11.25, -0.75) {};
		\node [style=none] (61) at (10.75, 0.25) {};
		\node [style=none] (62) at (11.75, 0.25) {};
		\node [style=Z] (68) at (11.75, 0.75) {};
		\node [style=none] (71) at (10.75, 1.25) {};
		\node [style=none] (72) at (11.75, 1.25) {};
		\node [style=X] (73) at (12.75, -0.75) {};
		\node [style=none] (74) at (12.25, 0.25) {};
		\node [style=none] (75) at (13.25, 0) {};
		\node [style=Z] (76) at (13.25, 0.75) {};
		\node [style=none] (77) at (12.25, 1.25) {};
		\node [style=none] (78) at (13.25, 1.25) {};
		\node [style=s] (79) at (13.25, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=150] (59) to (61.center);
		\draw [in=270, out=30] (59) to (62.center);
		\draw (62.center) to (68);
		\draw (68) to (72.center);
		\draw (61.center) to (71.center);
		\draw [in=90, out=-150] (68) to (59);
		\draw [in=-90, out=150] (73) to (74.center);
		\draw [in=270, out=30] (73) to (75.center);
		\draw (75.center) to (76);
		\draw (76) to (78.center);
		\draw (74.center) to (77.center);
		\draw [in=90, out=-150] (76) to (73);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (35) at (14.75, -0.5) {};
		\node [style=Z] (36) at (16.25, -0.5) {};
		\node [style=none] (37) at (14.25, 0.5) {};
		\node [style=none] (38) at (15.25, 0.5) {};
		\node [style=none] (39) at (15.75, 0.5) {};
		\node [style=none] (40) at (16.75, 0.5) {};
		\node [style=X] (41) at (14.75, -1.25) {};
		\node [style=Z] (42) at (16.25, -1.25) {};
		\node [style=X] (43) at (14.25, 0.5) {};
		\node [style=Z] (44) at (15.25, 1) {};
		\node [style=X] (45) at (15.75, 0.5) {};
		\node [style=Z] (46) at (16.75, 1) {};
		\node [style=none] (47) at (14.25, 1.5) {};
		\node [style=none] (48) at (15.25, 1.5) {};
		\node [style=none] (49) at (15.75, 1.5) {};
		\node [style=none] (50) at (16.75, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=150] (35) to (37.center);
		\draw [in=270, out=30] (35) to (38.center);
		\draw [bend right] (39.center) to (36);
		\draw [bend right] (36) to (40.center);
		\draw (43) to (44);
		\draw (45) to (46);
		\draw (38.center) to (44);
		\draw (44) to (48.center);
		\draw (49.center) to (45);
		\draw (40.center) to (46);
		\draw (46) to (50.center);
		\draw (47.center) to (43);
		\draw (41) to (35);
		\draw (36) to (42);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{remark}

\section{Generators for Lagrangian relations}
\label{sec:univ}

%
%Linear subspaces can be represented in terms of the row space of a matrix.
%In particular, an $n$-dimensional Lagrangian subspace is represented by a block diagonal matrix of the form $[X|Z]$ for $X,Z$ both $n\times n$ matrices.
%This correspondance is made one to one, when the symplectic form is required to vanish, so that $[X|Z] w [X|Z]^n =0$ as well as  $[X|Z]$  having dimension $n$.

In this section, we give a universal set of generators for $\Lag\Rel_k$; although, we do not directly give a complete set of identities.  Instead we defer to the completeness of the monoidal presentation of $\LinRel_k$.


Consider the following symplectomorphisms; the symplectic Fourier transform $F$,  the $a$-shift gate $S_a$ and the controlled-$a$ gate $C_a$:
$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0.5, 1) {};
		\node [style=none] (1) at (0.5, -0.25) {};
		\node [style=none] (2) at (1, -0.25) {};
		\node [style=none] (3) at (1, 1) {};
		\node [style=s] (4) at (1, 0.5) {};
		\node [style=none] (5) at (0.5, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4) to (3.center);
		\draw [in=90, out=-90] (4) to (1.center);
		\draw [in=-90, out=90] (2.center) to (5.center);
		\draw (5.center) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
=
\begin{bmatrix}
0   & 1 \\
-1  & 0
\end{bmatrix}
=:F
$$

$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, 1.25) {};
		\node [style=Z] (1) at (1.5, -0.25) {};
		\node [style=scalar] (2) at (1, 0.5) {$a$};
		\node [style=none] (3) at (0.5, 1.75) {};
		\node [style=none] (4) at (1.5, 1.75) {};
		\node [style=none] (5) at (1.5, -0.75) {};
		\node [style=none] (6) at (0.5, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (1);
		\draw (1) to (4.center);
		\draw [in=-90, out=135] (1) to (2);
		\draw [in=-45, out=90] (2) to (0);
		\draw (3.center) to (0);
		\draw (0) to (6.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
=
\begin{bmatrix}
1 &a\\
0 & 1
\end{bmatrix}=:S_a
$$

$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (430) at (219.75, 0) {};
		\node [style=X] (431) at (220.75, 1.5) {};
		\node [style=none] (432) at (219.75, 0) {};
		\node [style=none] (433) at (221.25, -0.75) {};
		\node [style=none] (434) at (219.25, 2.25) {};
		\node [style=none] (435) at (220.75, 2.25) {};
		\node [style=scalar] (436) at (220.25, 0.75) {$a$};
		\node [style=X] (437) at (217.5, 0) {};
		\node [style=Z] (438) at (218.5, 1.5) {};
		\node [style=none] (439) at (217.5, -0.75) {};
		\node [style=none] (440) at (219, -0.75) {};
		\node [style=none] (441) at (217.25, 2.25) {};
		\node [style=none] (442) at (218.5, 1.5) {};
		\node [style=scalarop] (443) at (218, 0.75) {$a$};
		\node [style=none] (445) at (219.75, -0.75) {};
		\node [style=none] (446) at (218.5, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-105, out=30] (430) to (436);
		\draw [in=-150, out=90] (436) to (431);
		\draw [in=90, out=-60] (431) to (433.center);
		\draw (431) to (435.center);
		\draw [in=135, out=-90, looseness=0.75] (434.center) to (430);
		\draw (439.center) to (437);
		\draw [in=-105, out=30] (437) to (443);
		\draw [in=-150, out=90] (443) to (438);
		\draw [in=90, out=-45, looseness=0.75] (438) to (440.center);
		\draw [in=120, out=-90] (441.center) to (437);
		\draw [in=270, out=90] (442.center) to (446.center);
		\draw [in=270, out=90] (445.center) to (432.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
=
\begin{bmatrix}
1 & -a & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & a & 1
\end{bmatrix}
=:C_a
%\begin{bmatrix}
%1 & -a & 0 & 0 \\
%0 & 1 & 0 & 0 \\
%0 & 0 & 1 & 0 \\
%0 & 0 & a & 0
%\end{bmatrix}
$$


%When composed with identities, these have having the following action on Lagrangian subspaces when applied to certain wires:

Use the notation $G^{(j)}$ to denote a gate $G$ being applied to wire $j$; and the notation $C_a^{(i,j)}$ to denote the controlled-$a$ gate controlling on wire $i$ targetting wire $j$.

Note the right action of these gates in terms of matrix multiplication of Lagrangian subspaces for any nonzero $a \in k$ (as observed in \cite[page 4]{aaronson}):

\begin{itemize}
\item
$F^{(i)}$ sets columns $x_i$ to $-z_i$ and $z_i$ to $x_i$.

\item
$S_a^{(i)}$ sets $z_i$ to $z_i+a\cdot x_i$.

%\item
%$M_a^{(i)}$ sets $x_i$ to $a\cdot x_i$ and $z_i$ to $a^{-1}\cdot x_i$.

\item
$C_a^{(i,j)}$ sets $x_j$ to $x_j- a \cdot x_i$ and $z_i$ to $z_i+a\cdot z_j$.

\end{itemize}

Using these symplectomorphisms regarded as Lagrangian relations, we have:


%
%
%
%\begin{align*}
%&\left[
%\begin{array}{*{7}c|*{7}c}
%x_{1,1} & \cdots & x_{1,a} & \cdots & x_{1,b} & \cdots & x_{1,n} &  z_{1,1} & \cdots & z_{1,a} & \cdots & z_{1,b} & \cdots & z_{1,n} \\-
%\vdots   & \ddots  & \vdots  & \ddots  & \vdots   &  \ddots & \vdots   & \vdots    & \ddots  & \vdots  & \ddots  & \vdots  & \ddots  & \vdots   \\
%x_{n,1} & \cdots & x_{n,a} & \cdots & x_{n,b} & \cdots & x_{n,n} &  z_{n,1} & \cdots & z_{n,a} & \cdots & z_{n,b} & \cdots & z_{n,n}
%\end{array}
%\right]\\
%&\mapsto\\
%&\left[
%\begin{array}{*{7}c|*{7}c}
%x_{1,1} & \cdots & x_{1,a} & \cdots & x_{1,b} - kx_{1,a} & \cdots & x_{1,n} &  z_{1,1} & \cdots & z_{1,a} +k z_{1,b} & \cdots & z_{1,b} & \cdots & z_{1,n} \\
%\vdots   & \ddots  & \vdots  & \ddots  & \vdots                    &  \ddots & \vdots   & \vdots    & \ddots  & \vdots                  & \ddots  & \vdots  & \ddots  & \vdots   \\
%x_{n,1} & \cdots & x_{n,a} & \cdots & x_{n,b} -kx_{n,a} & \cdots & x_{n,n} &  z_{n,1} & \cdots & z_{n,a} +k  z_{n,b}& \cdots & z_{n,b} & \cdots & z_{n,n}
%\end{array}
%\right]
%\end{align*}
%
%
%
%\begin{align*}
%&\left[
%\begin{array}{*{5}c|*{5}c}
%x_{1,1} & \cdots & x_{1,a}  & \cdots & x_{1,n} &  z_{1,1} & \cdots & z_{1,a} & \cdots  & z_{1,n} \\
%\vdots   & \ddots  & \vdots   &  \ddots & \vdots   & \vdots    & \ddots  & \vdots  & \ddots   & \vdots   \\  
%x_{n,1} & \cdots & x_{n,a} & \cdots & x_{n,n} &  z_{n,1} & \cdots & z_{n,a} & \cdots   & z_{n,n}
%\end{array}
%\right]\\
%&\mapsto\\
%&\left[
%\begin{array}{*{7}c|*{7}c}
%x_{1,1} & \cdots & x_{1,a-1} & -z_{1,a} &  x_{1,a+1}   & \cdots & x_{1,n} &  z_{1,1} & \cdots & z_{1,a-1} & x_{1,a} &  z_{1,a+1} & \cdots  & z_{1,n} \\
%\vdots   & \ddots  & \vdots      & \vdots   & \vdots           &  \ddots & \vdots   & \vdots    & \ddots  & \vdots      & \vdots    & \vdots        & \ddots   & \vdots   \\  
%x_{n,1} & \cdots & x_{n,a-1} & -z_{n,a} &  x_{n,a+1} & \cdots & x_{n,n} &  z_{n,1} & \cdots &  z_{n,a-1} & x_{n,a} &  z_{n,a+1} & \cdots   & z_{n,n}
%\end{array}
%\right]\\
%\end{align*}
%
%
%



\begin{theorem}
\label{theorem:generators}
For any field $k$ the maps in $L(\LinRel_k)$ as well as $F$ and $S_a$ for all $a \in k$ generate $\Lag\Rel_k$.
\end{theorem}

\begin{proof}
The following proof is very similar to that of  \cite[Lem. 6]{aaronson}.
Consider the matrix $[Z|X]$ of an arbitrary Lagrangian relation over field $k$ regarded as a state.
%
%$$
%[X | Z]
%=
%\left[
%\begin{array}{ccc|ccc}
%x_{1,1} & \cdots & x_{n,n} & z_{1,1} & \cdots & z_{1,n}\\
%\vdots    & \ddots & \vdots    & \vdots   & \ddots & \vdots \\
%x_{n,1} & \cdots & x_{n,n} & z_{n,1} & \cdots & z_{n,n}\\
%\end{array}
%\right]
%$$
We show how one can reduce $[Z|X]$ to the block matrix $[I|0]$ by right multiplication with the aforementioned symplectomorphisms.
To do so, we first reduce it to a matrix $[I|X']$.
This involves repeatedly applying Gaussian elimination and then applying the Fourier transform to wires when the pivot is in the $X$ block.
We are guaranteed to obtain a matrix $[I|X']$ because the dimension of Lagrangian subspace of $k^{2n}$ is $n$. Moreover, because  $[I|X']$ spans a Lagrangian subspace, we have: 

$$
0
=
\begin{bmatrix}
I | X'
\end{bmatrix}
\omega
\begin{bmatrix}
I | X'
\end{bmatrix}^T
$$
which holds if and only if 
$$
0=
\begin{bmatrix}
I | X'
\end{bmatrix}
\begin{bmatrix}
X' | -I 
\end{bmatrix}^T
=
{X'}^T-X'
$$

That is to say $X'$ is symmetric, meaning that $X'$ describes the adjacency matrix of a graph coloured by the elements of $k$.
In the language of stabilizer circuits, this is called a {\em graph state}.  In the case of prime fields, this observation was made in \cite[Equation 18]{gross}.  Graph states were originally discussed in \cite{hein2006entanglement}.

We prove that graph states can be reduced to the subspace $[I|0]$ by right multiplication of  symplectomorphisms.
The proof is by induction on the dimension of the subspace.
This base case is trivial.

Suppose we have a $(n+1)$-dimensional Lagrangian subspaces described by a graph state, then:


\begin{align*}
&\hspace*{-2cm}\left[
\begin{array}{*{5}c|*{6}c}
1         & 0        & 0         & \cdots & 0         & x_{1,1} & x_{1,2} & x_{1,3} & \cdots & x_{1,n}\\
0         & 1        & 0         & \cdots & 0         & x_{1,2} & x_{2,2} & x_{2,3} & \cdots & x_{2,n}\\
0         & 0        & 1         & \ddots & \vdots & x_{1,3} & x_{2,3} & x_{3,3} & \cdots & x_{3,n}\\
\vdots & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots    & \vdots    & \ddots &  \vdots \\
0         & 0         & \cdots & 0        & 1          & x_{1,n} & x_{2,n} & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]\\
\xmapsto{(F^{(1)})^{-1}}&
\left[
\begin{array}{*{5}c|*{6}c}
x_{1,1}         & 0        & 0         & \cdots & 0         & -1 & x_{1,2} & x_{1,3} & \cdots & x_{1,n}\\
x_{1,2}         & 1        & 0         & \cdots & 0         & 0 & x_{2,2} & x_{2,3} & \cdots & x_{2,n}\\
x_{1,3}         & 0        & 1         & \ddots & \vdots & 0 & x_{2,3} & x_{3,3} & \cdots & x_{3,n}\\
\vdots & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots    & \vdots    & \ddots &  \vdots \\
x_{1,n}         & 0         & \cdots & 0        & 1          & 0 & x_{2,n} & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]\\
\xmapsto{C_{x_{1,2}}^{(2,1)}}&
\left[
\begin{array}{*{5}c|*{6}c}
x_{1,1}-0           & 0         & 0         & \cdots & 0         & -1 & x_{1,2}-x_{1,2} & x_{1,3} & \cdots & x_{1,n}\\
x_{1,2}-x_{1,2} & 1         & 0         & \cdots & 0         & 0 & x_{2,2}-0            & x_{2,3} & \cdots & x_{2,n}\\
x_{1,3}-0           & 0         & 1         & \ddots & \vdots & 0 & x_{2,3}-0            & x_{3,3} & \cdots & x_{3,n}\\
\vdots                 & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots        & \vdots    & \ddots &  \vdots \\
x_{1,n}-0           & 0         & \cdots & 0        & 1          & 0 & x_{2,n}-0            & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]\\
=&
\left[
\begin{array}{*{5}c|*{6}c}
x_{1,1}             & 0         & 0         & \cdots & 0         & -1 & 0                         & x_{1,3} & \cdots & x_{1,n}\\
0                       & 1         & 0         & \cdots & 0         & 0 & x_{2,2}                & x_{2,3} & \cdots & x_{2,n}\\
x_{1,3}             & 0         & 1         & \ddots & \vdots & 0 & x_{2,3}                & x_{3,3} & \cdots & x_{3,n}\\
\vdots                & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots        & \vdots    & \ddots &  \vdots \\
x_{1,n}             & 0         & \cdots & 0        & 1          & 0 & x_{2,n}                & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]\\
\xmapsto{\prod_{i>1}^n C_{x_{1,i}}^{(i,1)}}&
\left[
\begin{array}{*{5}c|*{6}c}
x_{1,1}             & 0         & 0         & \cdots & 0         & -1 & 0                         & 0           & \cdots & 0\\
0                       & 1         & 0         & \cdots & 0         & 0 & x_{2,2}                & x_{2,3} & \cdots & x_{2,n}\\
0                       & 0         & 1         & \ddots & \vdots & 0 & x_{2,3}                & x_{3,3} & \cdots & x_{3,n}\\
\vdots               & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots        & \vdots    & \ddots &  \vdots \\
0                       & 0         & \cdots & 0        & 1          & 0 & x_{2,n}                & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]\\
\xmapsto{F^{(1)}}&
\left[
\begin{array}{*{5}c|*{6}c}
1                       & 0         & 0         & \cdots & 0         & x_{1,1} & 0                          & 0           & \cdots & 0\\
0                       & 1         & 0         & \cdots & 0         & 0           & x_{2,2}                & x_{2,3} & \cdots & x_{2,n}\\
0                       & 0         & 1         & \ddots & \vdots & 0           & x_{2,3}                & x_{3,3} & \cdots & x_{3,n}\\
\vdots               & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots                   & \vdots    & \ddots &  \vdots \\
0                       & 0         & \cdots & 0        & 1          & 0           & x_{2,n}                & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]\\
\xmapsto{S_{-x_{1,1}}^{(1)}  }&
\left[
\begin{array}{*{5}c|*{6}c}
1                       & 0         & 0         & \cdots & 0         & 0 & 0                          & 0           & \cdots & 0\\
0                       & 1         & 0         & \cdots & 0         & 0           & x_{2,2}                & x_{2,3} & \cdots & x_{2,n}\\
0                       & 0         & 1         & \ddots & \vdots & 0           & x_{2,3}                & x_{3,3} & \cdots & x_{3,n}\\
\vdots               & \vdots & \ddots & \ddots & 0         & \vdots   & \vdots                   & \vdots    & \ddots &  \vdots \\
0                       & 0         & \cdots & 0        & 1          & 0           & x_{2,n}                & x_{3,n} & \cdots & x_{n,n}\\
\end{array}
\right]
\end{align*}

Therefore all Lagrangian relations can be reduced to the subspace $[I|0]$ by right multiplication by symplectomorphisms.
In the $n$-dimensional case, this subspace is given by the circuit
$L(
\begin{tikzpicture}[scale=.5]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (6, 3) {};
		\node [style=none] (1) at (6, 3.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
^{\otimes n}$).

\end{proof} 


%
%This is proved by using these symplectomorphisms to reduce a Lagrangian relation by Guassian elimination to the state
%$L(
%\begin{tikzpicture}[scale=.5]
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=X] (0) at (6, 3) {};
%		\node [style=none] (1) at (6, 3.5) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (0) to (1.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%^{\otimes n}$).
%

By decomposing the Fourier transform we obtain a more symmetric, equivalent set of generators:

\begin{corollary}
\label{theorem:unbiased}
$\Lag\Rel_k$ is presented by $L(\LinRel_k)$ as well as the generators:
$$
d_a :=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (0, 0.75) {};
		\node [style=scalar] (1) at (0.5, 0) {$a$};
		\node [style=none] (2) at (0.5, -0.75) {};
		\node [style=none] (3) at (-0.5, 0) {};
		\node [style=none] (4) at (-0.5, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-30, out=90] (1) to (0);
		\draw [in=90, out=-150] (0) to (3.center);
		\draw (4.center) to (3.center);
		\draw (2.center) to (1);
	\end{pgfonlayer}
\end{tikzpicture}:1\to 0
$$
\end{corollary}


\begin{proof}
We show that $F$ and $S_a$ can be constructed using these generators. The $S_a$ gate and it's colour-reversed version $V_a$ can be obtained by composing a pure morphism with $d_{-a}$ and $d_{a}$, respectively:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (2.25, -1.25) {};
		\node [style=Z] (1) at (2.25, -0.75) {};
		\node [style=X] (2) at (0.5, -0.75) {};
		\node [style=none] (3) at (0.5, -1.25) {};
		\node [style=none] (4) at (0.5, 1.25) {};
		\node [style=none] (5) at (2.25, 1.25) {};
		\node [style=scalar] (6) at (1.75, 0) {$-a$};
		\node [style=none] (7) at (0, 0) {};
		\node [style=Z] (8) at (0.875, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (0.center);
		\draw (1) to (5.center);
		\draw (2) to (4.center);
		\draw (2) to (3.center);
		\draw [in=-90, out=165] (1) to (6);
		\draw [in=-90, out=165] (2) to (7.center);
		\draw [in=-15, out=90] (6) to (8);
		\draw [in=90, out=-165] (8) to (7.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (9) at (5.5, -1.25) {};
		\node [style=Z] (10) at (5.5, -0.75) {};
		\node [style=X] (11) at (3.75, -0.75) {};
		\node [style=none] (12) at (3.75, -1.25) {};
		\node [style=none] (13) at (3.75, 1.25) {};
		\node [style=none] (14) at (5.5, 1.25) {};
		\node [style=scalar] (15) at (5, 0) {$-a$};
		\node [style=Z] (16) at (4.625, 0.75) {};
		\node [style=X] (17) at (4.25, -0.25) {};
		\node [style=X] (18) at (3.4, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (10) to (9.center);
		\draw (10) to (14.center);
		\draw (11) to (13.center);
		\draw (11) to (12.center);
		\draw [in=-90, out=165] (10) to (15);
		\draw [in=-15, out=90] (15) to (16);
		\draw [in=-120, out=150, looseness=0.75] (11) to (18);
		\draw [in=150, out=-15, looseness=0.75] (18) to (17);
		\draw [in=-120, out=60] (17) to (16);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (19) at (8.75, -1.75) {};
		\node [style=Z] (20) at (8.75, -1.25) {};
		\node [style=X] (21) at (7, 0) {};
		\node [style=none] (22) at (7, -1.75) {};
		\node [style=none] (23) at (7, 1) {};
		\node [style=none] (24) at (8.75, 1) {};
		\node [style=scalar] (25) at (8.25, -0.7) {$-a$};
		\node [style=X] (26) at (7.75, 0.75) {};
		\node [style=s] (27) at (8.25, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (20) to (19.center);
		\draw (20) to (24.center);
		\draw (21) to (23.center);
		\draw (21) to (22.center);
		\draw [in=-90, out=150] (20) to (25);
		\draw [in=-150, out=30] (21) to (26);
		\draw (25) to (27);
		\draw [in=-15, out=90] (27) to (26);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (10) at (10.25, -1) {};
		\node [style=Z] (11) at (10.25, -0.5) {};
		\node [style=X] (12) at (9.25, 0.5) {};
		\node [style=none] (13) at (9.25, -1) {};
		\node [style=scalar] (14) at (9.75, 0) {$a$};
		\node [style=none] (15) at (9.25, 1) {};
		\node [style=none] (16) at (10.25, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (11) to (10.center);
		\draw [in=-90, out=165] (11) to (14);
		\draw [in=-15, out=90] (14) to (12);
		\draw (13.center) to (12);
		\draw (11) to (16.center);
		\draw (12) to (15.center);
	\end{pgfonlayer}
\end{tikzpicture}
= S_a
$$
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (28) at (12.5, -1.25) {};
		\node [style=X] (29) at (12.5, -0.75) {};
		\node [style=Z] (30) at (10.75, -0.75) {};
		\node [style=none] (31) at (10.75, -1.25) {};
		\node [style=none] (32) at (10.75, 1.25) {};
		\node [style=none] (33) at (12.5, 1.25) {};
		\node [style=scalar] (34) at (11.925, 0) {$a$};
		\node [style=none] (35) at (10.25, 0) {};
		\node [style=Z] (36) at (11.125, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (29) to (28.center);
		\draw (29) to (33.center);
		\draw (30) to (32.center);
		\draw (30) to (31.center);
		\draw [in=-90, out=150] (29) to (34);
		\draw [in=-90, out=150] (30) to (35.center);
		\draw [in=-15, out=90] (34) to (36);
		\draw [in=90, out=-165] (36) to (35.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (50) at (19.75, -1) {};
		\node [style=X] (51) at (19.75, -0.5) {};
		\node [style=Z] (52) at (18.75, 0.5) {};
		\node [style=none] (53) at (18.75, -1) {};
		\node [style=scalar] (54) at (19.25, 0) {$a$};
		\node [style=none] (55) at (18.75, 1) {};
		\node [style=none] (56) at (19.75, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (51) to (50.center);
		\draw [in=-90, out=165] (51) to (54);
		\draw [in=-15, out=90] (54) to (52);
		\draw (53.center) to (52);
		\draw (51) to (56.center);
		\draw (52) to (55.center);
	\end{pgfonlayer}
\end{tikzpicture}
 =: V_a
$$



We can then obtain $F$ as $S_1 \circ V_1 \circ S_1$, which can be proven as a variation of the familiar `3 CNOT' rule for quantum circuits (see e.g.~\cite[\S 3.2.1]{coecke2008interacting}):
\begin{align*}
S_1 \circ V_1 \circ S_1
&=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (3, 1.25) {};
		\node [style=X] (1) at (4, 1.75) {};
		\node [style=Z] (2) at (4, 2.5) {};
		\node [style=X] (3) at (3, 2) {};
		\node [style=Z] (4) at (3, 2.75) {};
		\node [style=X] (5) at (4, 3.25) {};
		\node [style=none] (6) at (3, 4.5) {};
		\node [style=none] (7) at (4, 4.5) {};
		\node [style=none] (8) at (3, 0) {};
		\node [style=none] (9) at (4, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (6.center) to (4);
		\draw (4) to (3);
		\draw (0) to (3);
		\draw (8.center) to (0);
		\draw (9.center) to (1);
		\draw (1) to (2);
		\draw (2) to (5);
		\draw (5) to (7.center);
		\draw (3) to (2);
		\draw (4) to (5);
		\draw (0) to (1);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (3, 1.25) {};
		\node [style=X] (1) at (4, 0.75) {};
		\node [style=Z] (2) at (4, 2.5) {};
		\node [style=X] (3) at (3, 2) {};
		\node [style=Z] (4) at (3, 3.75) {};
		\node [style=X] (5) at (4, 3.25) {};
		\node [style=none] (6) at (3, 4.5) {};
		\node [style=none] (7) at (4, 4.5) {};
		\node [style=none] (8) at (3, 0) {};
		\node [style=none] (9) at (4, 0) {};
		\node [style=s] (10) at (3.5, 3.5) {};
		\node [style=s] (11) at (3.5, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (6.center) to (4);
		\draw (4) to (3);
		\draw (0) to (3);
		\draw (8.center) to (0);
		\draw (9.center) to (1);
		\draw (1) to (2);
		\draw (2) to (5);
		\draw (5) to (7.center);
		\draw (3) to (2);
		\draw (1) to (11);
		\draw (11) to (0);
		\draw (5) to (10);
		\draw (10) to (4);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (28) at (6.5, 0) {};
		\node [style=Z] (31) at (5, 4) {};
		\node [style=none] (33) at (5, 4.5) {};
		\node [style=none] (34) at (6.5, 4.5) {};
		\node [style=none] (35) at (5, -0.5) {};
		\node [style=none] (36) at (6.5, -0.5) {};
		\node [style=s] (37) at (6, 0.5) {};
		\node [style=s] (38) at (5.5, 3.5) {};
		\node [style=X] (39) at (6, 2.25) {};
		\node [style=Z] (40) at (6, 3) {};
		\node [style=X] (41) at (6.5, 2.25) {};
		\node [style=Z] (42) at (6.5, 3) {};
		\node [style=X] (43) at (5, 1) {};
		\node [style=Z] (44) at (5, 1.75) {};
		\node [style=X] (45) at (5.5, 1) {};
		\node [style=Z] (46) at (5.5, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (33.center) to (31);
		\draw (36.center) to (28);
		\draw (28) to (37);
		\draw (31) to (38);
		\draw (40) to (41);
		\draw (41) to (42);
		\draw (40) to (39);
		\draw (39) to (42);
		\draw (44) to (45);
		\draw (45) to (46);
		\draw (44) to (43);
		\draw (43) to (46);
		\draw (34.center) to (42);
		\draw (40) to (38);
		\draw (46) to (39);
		\draw (41) to (28);
		\draw (37) to (45);
		\draw (35.center) to (43);
		\draw (31) to (44);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (67) at (11.5, 0) {};
		\node [style=Z] (68) at (10, 4.25) {};
		\node [style=none] (69) at (10, 4.75) {};
		\node [style=none] (70) at (11.5, 4.75) {};
		\node [style=none] (71) at (10, -0.5) {};
		\node [style=none] (72) at (11.5, -0.5) {};
		\node [style=s] (73) at (11, 0.5) {};
		\node [style=s] (74) at (10.5, 3.75) {};
		\node [style=Z] (75) at (11, 3.25) {};
		\node [style=X] (76) at (11.5, 2.5) {};
		\node [style=Z] (77) at (11.5, 3.25) {};
		\node [style=X] (78) at (10, 1) {};
		\node [style=Z] (79) at (10, 1.75) {};
		\node [style=X] (80) at (10.5, 1) {};
		\node [style=X] (81) at (10.5, 1.75) {};
		\node [style=Z] (82) at (10.5, 2.5) {};
		\node [style=X] (83) at (11, 1.75) {};
		\node [style=Z] (84) at (11, 2.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (69.center) to (68);
		\draw (72.center) to (67);
		\draw (67) to (73);
		\draw (68) to (74);
		\draw (75) to (76);
		\draw (76) to (77);
		\draw (79) to (80);
		\draw (79) to (78);
		\draw (70.center) to (77);
		\draw (75) to (74);
		\draw (76) to (67);
		\draw (73) to (80);
		\draw (71.center) to (78);
		\draw (68) to (79);
		\draw (82) to (83);
		\draw (83) to (84);
		\draw (82) to (81);
		\draw (81) to (84);
		\draw (78) to (81);
		\draw (80) to (83);
		\draw (84) to (77);
		\draw (75) to (82);
	\end{pgfonlayer}
\end{tikzpicture}\\
&=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (11, 0.75) {};
		\node [style=Z] (1) at (10.25, 4.75) {};
		\node [style=none] (2) at (10.25, 5.25) {};
		\node [style=none] (3) at (11, 5.25) {};
		\node [style=none] (4) at (10.25, 0.25) {};
		\node [style=none] (5) at (11, 0.25) {};
		\node [style=s] (6) at (11, 1.5) {};
		\node [style=s] (7) at (10.25, 4) {};
		\node [style=Z] (8) at (10.25, 3.25) {};
		\node [style=X] (9) at (11, 0.75) {};
		\node [style=Z] (10) at (11, 3.25) {};
		\node [style=X] (11) at (10.25, 2.25) {};
		\node [style=Z] (12) at (10.25, 4.75) {};
		\node [style=X] (13) at (11, 2.25) {};
		\node [style=X] (14) at (10.25, 2.25) {};
		\node [style=Z] (15) at (10.25, 3.25) {};
		\node [style=X] (16) at (11, 2.25) {};
		\node [style=Z] (17) at (11, 3.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (1);
		\draw (5.center) to (0);
		\draw (0) to (6);
		\draw (1) to (7);
		\draw [in=135, out=-60] (8) to (9);
		\draw [bend right, looseness=1.25] (9) to (10);
		\draw [in=120, out=-45] (12) to (13);
		\draw [bend right, looseness=1.25] (12) to (11);
		\draw (3.center) to (10);
		\draw (8) to (7);
		\draw (6) to (13);
		\draw (4.center) to (11);
		\draw [in=150, out=-30, looseness=0.75] (15) to (16);
		\draw (16) to (17);
		\draw (15) to (14);
		\draw (14) to (17);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (19.5, 1.25) {};
		\node [style=Z] (1) at (18, 4.25) {};
		\node [style=none] (2) at (18, 4.75) {};
		\node [style=none] (3) at (19.5, 4.75) {};
		\node [style=none] (4) at (18, 0.75) {};
		\node [style=none] (5) at (19.5, 0.75) {};
		\node [style=X] (6) at (19.5, 1.25) {};
		\node [style=Z] (7) at (19.5, 4.25) {};
		\node [style=X] (8) at (18, 1.25) {};
		\node [style=Z] (9) at (18, 4.25) {};
		\node [style=X] (10) at (19.5, 1.25) {};
		\node [style=X] (11) at (18, 1.25) {};
		\node [style=X] (12) at (19.5, 1.25) {};
		\node [style=Z] (13) at (19.5, 4.25) {};
		\node [style=s] (14) at (17.75, 3) {};
		\node [style=s] (15) at (18.75, 3) {};
		\node [style=s] (16) at (19.75, 3) {};
		\node [style=s] (17) at (18.25, 3) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (1);
		\draw (5.center) to (0);
		\draw [bend right=45] (6) to (7);
		\draw [in=120, out=-135, looseness=1.25] (9) to (8);
		\draw (3.center) to (7);
		\draw (4.center) to (8);
		\draw [in=-120, out=15, looseness=0.75] (11) to (13);
		\draw [in=90, out=-105] (9) to (14);
		\draw [in=90, out=-45, looseness=0.75] (9) to (15);
		\draw [in=90, out=-90] (14) to (11);
		\draw [in=-90, out=120, looseness=0.75] (6) to (15);
		\draw [in=-15, out=90] (12) to (9);
		\draw [in=-90, out=150, looseness=0.75] (12) to (17);
		\draw [in=285, out=90] (17) to (9);
		\draw [in=-90, out=75, looseness=0.75] (12) to (16);
		\draw [in=-75, out=90] (16) to (13);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (24, 4.5) {};
		\node [style=none] (1) at (23.5, 4) {};
		\node [style=none] (2) at (24, 2.75) {};
		\node [style=none] (3) at (23.5, 2.75) {};
		\node [style=s] (4) at (24, 4) {};
		\node [style=none] (5) at (23.5, 4.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=90, looseness=1.25] (2.center) to (1.center);
		\draw (1.center) to (5.center);
		\draw (0.center) to (4);
		\draw [in=90, out=-90, looseness=1.25] (4) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
F
\end{align*}
\end{proof}


A variant of this decomposition is given in \cite[p.6]{control}; although in the context of plain old linear relations instead of Lagrangian relations, so an antipode is missing in their case.  A similar observation was made in \cite[Equation 34]{ranchin2014depicting} in terms of qudit controlled-{\cal X} gates.

\begin{remark}
This characterization of the generators way almost found in \cite[Theorem 4.3.3]{coya}, although he does not attempt to find a universal set of generators.  In fact he is missing the generators $S_a$ and the doubled scalars.  One should also be careful because the diagram in the Theorem which is cited fails to commute.
\end{remark}

From Corollary \ref{theorem:unbiased}, we know that we can build any Lagrangian relation using pure Lagrangian relations and discard maps. Since the former is closed under composition and monoidal product, the following can be shown immediately from string diagram deformation.

\begin{corollary}[Phase purification]\label{cor:pure}
Any linear Lagrangian relation can be written in the following form, for $V$ a linear relation:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (37) at (17, 2) {};
		\node [style=scalar] (38) at (18.25, 1) {$a_1$};
		\node [style=none] (39) at (18.25, 0.25) {};
		\node [style=none] (40) at (15, 0.75) {};
		\node [style=none] (41) at (15, 0.25) {};
		\node [style=map, minimum width=2cm, minimum height=1cm] (42) at (15.75, -0.25) {$V^\perp$};
		\node [style=map, minimum width=2cm, minimum height=1cm] (43) at (19, -0.25) {$V$};
		\node [style=Z] (44) at (18.25, 2) {};
		\node [style=scalar] (45) at (19.25, 1) {$a_k$};
		\node [style=none] (46) at (19.25, 0.25) {};
		\node [style=none] (47) at (16, 0.75) {};
		\node [style=none] (48) at (16, 0.25) {};
		\node [style=none] (49) at (18.75, 0.5) {...};
		\node [style=none] (50) at (16.5, 0.25) {};
		\node [style=none] (51) at (16.5, 2.5) {};
		\node [style=none] (52) at (19.75, 0.25) {};
		\node [style=none] (53) at (19.75, 2.5) {};
		\node [style=none] (54) at (15.5, 0.5) {...};
		\node [style=none] (55) at (15.75, -1.25) {};
		\node [style=none] (56) at (15.75, -0.5) {};
		\node [style=none] (57) at (19, -1.25) {};
		\node [style=none] (58) at (19, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-30, out=90, looseness=0.75] (38) to (37);
		\draw [in=90, out=-165, looseness=0.50] (37) to (40.center);
		\draw (41.center) to (40.center);
		\draw (39.center) to (38);
		\draw [in=-30, out=90, looseness=0.75] (45) to (44);
		\draw [in=90, out=-165, looseness=0.50] (44) to (47.center);
		\draw (48.center) to (47.center);
		\draw (46.center) to (45);
		\draw [in=270, out=90] (50.center) to (51.center);
		\draw [in=270, out=90] (52.center) to (53.center);
		\draw [in=270, out=90] (55.center) to (56.center);
		\draw [in=270, out=90] (57.center) to (58.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{corollary}


%Recall that given a compact closed prop with an identity on objects conjugation functor, applying the CPM construction produces a compact closed prop.
%
%We have already shown that there is a doubling functor $\LinRel_k\to\Lag\Rel_k$, with respect to the orthogonal complement.  To get the $\CPM$ construction one has to add the "discard map" coming from the distinguished closed structure of $\LinRel_k$.  In the case when $k=\F_p$ or $k=\mathbb Q$, this produces  $\Lag\Rel_k$:

Recall that given a compact closed prop with an identity on objects monoidal conjugation functor, we can apply the CPM construction to obtain a compact closed prop.

The phase-purification is so-named because of the similarity to the purification of maps in the CPM-construction.  Indeed one might hope that $\Lag\Rel_k$ is isomorphic to $\CPM(\LinRel_k,\perp)$, however, in the example of phase-purification, we are tracing out both sides with respect to multiple compact closed structures:  one for each $a_j \in k$.  However prime fields are special:


\begin{corollary}
\label{cor}
Given $k=\F_p$ for $p$ prime or $k=\mathbb{Q}$:

$$\CPM(\LinRel_{k}, (-)^\perp) \cong \Lag\Rel_k$$
\end{corollary}
\begin{proof}
Remark that:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (95) at (27.35, 2) {};
		\node [style=scalar] (96) at (27.85, 1.5) {$n$};
		\node [style=none] (97) at (26.85, 1.5) {};
		\node [style=none] (98) at (26.85, 1) {};
		\node [style=none] (99) at (27.85, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-15, out=90] (96) to (95);
		\draw [in=-165, out=90] (97.center) to (95);
		\draw (98.center) to (97.center);
		\draw (99.center) to (96);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (100) at (29.85, 1.75) {};
		\node [style=Z] (101) at (30.85, 0.5) {};
		\node [style=none] (102) at (28.85, 0) {};
		\node [style=none] (103) at (30.85, 0) {};
		\node [style=none] (104) at (30.35, 1.25) {$\iddots$};
		\node [style=none] (105) at (30.5, 1) {$n$};
		\node [style=Z] (106) at (29.35, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=0, out=90, looseness=1.25] (101) to (100);
		\draw [in=-90, out=165, looseness=1.25] (101) to (100);
		\draw [in=-120, out=90] (102.center) to (106);
		\draw [in=105, out=-15] (106) to (100);
		\draw (103.center) to (101);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (125) at (34.5, 1) {};
		\node [style=X] (126) at (33, 1) {};
		\node [style=Z] (127) at (33.75, 1.75) {};
		\node [style=Z] (130) at (33.75, 3) {};
		\node [style=none] (131) at (33.75, 2.34) {$\vdots$};
		\node [style=none] (132) at (34, 2.25) {$n$};
		\node [style=none] (133) at (33, 0.25) {};
		\node [style=none] (134) at (34.5, 0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=345, out=120, looseness=0.75] (125) to (127);
		\draw [in=60, out=-165, looseness=0.75] (127) to (126);
		\draw [in=225, out=105] (126) to (130);
		\draw [in=75, out=-45] (130) to (125);
		\draw (133.center) to (126);
		\draw (134.center) to (125);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (59) at (24, -0.25) {};
		\node [style=X] (60) at (22.75, -0.25) {};
		\node [style=Z] (61) at (23.25, 0.75) {};
		\node [style=none] (62) at (22.75, -1) {};
		\node [style=none] (63) at (24, -1) {};
		\node [style=Z] (64) at (24, 1) {};
		\node [style=X] (65) at (22.75, 1) {};
		\node [style=Z] (66) at (23.25, 2) {};
		\node [style=Z] (67) at (24, 2.25) {};
		\node [style=X] (68) at (22.75, 2.25) {};
		\node [style=none] (69) at (23.25, 1.515) {$\vdots$};
		\node [style=none] (70) at (23.5, 1.425) {$n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-15, out=135] (59) to (61);
		\draw [in=150, out=-165, looseness=1.25] (61) to (60);
		\draw (62.center) to (60);
		\draw (63.center) to (59);
		\draw [in=-15, out=135] (64) to (66);
		\draw [in=135, out=-165, looseness=1.25] (66) to (65);
		\draw (60) to (65);
		\draw (65) to (68);
		\draw (67) to (64);
		\draw (64) to (59);
	\end{pgfonlayer}
\end{tikzpicture}
$$

Therefore, every map in $\Lag\Rel_{\F_p}$ can be produced by tracing out a map in $L(\LinRel_{\F_p})$.  For the rationals, observe that for every $n \in \N$:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (95) at (27.35, 2) {};
		\node [style=scalarop] (96) at (27.85, 1.5) {$n$};
		\node [style=none] (97) at (26.85, 1.5) {};
		\node [style=none] (98) at (26.85, 1) {};
		\node [style=none] (99) at (27.85, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-15, out=90] (96) to (95);
		\draw [in=-165, out=90] (97.center) to (95);
		\draw (98.center) to (97.center);
		\draw (99.center) to (96);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (100) at (29.85, 1.75) {};
		\node [style=X] (101) at (30.85, 0.5) {};
		\node [style=none] (102) at (28.85, 0) {};
		\node [style=none] (103) at (30.85, 0) {};
		\node [style=none] (104) at (30.35, 1.25) {$\iddots$};
		\node [style=none] (105) at (30.5, 1) {$n$};
		\node [style=Z] (106) at (29.35, 2.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=0, out=90, looseness=1.25] (101) to (100);
		\draw [in=-90, out=165, looseness=1.25] (101) to (100);
		\draw [in=-120, out=90] (102.center) to (106);
		\draw [in=105, out=-15] (106) to (100);
		\draw (103.center) to (101);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (125) at (34.5, 1) {};
		\node [style=Z] (126) at (33, 1) {};
		\node [style=Z] (127) at (33.75, 1.75) {};
		\node [style=Z] (130) at (33.75, 3) {};
		\node [style=none] (131) at (33.75, 2.34) {$\vdots$};
		\node [style=none] (132) at (34, 2.25) {$n$};
		\node [style=none] (133) at (33, 0.25) {};
		\node [style=none] (134) at (34.5, 0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=345, out=120, looseness=0.75] (125) to (127);
		\draw [in=60, out=-165, looseness=0.75] (127) to (126);
		\draw [in=225, out=105] (126) to (130);
		\draw [in=75, out=-45] (130) to (125);
		\draw (133.center) to (126);
		\draw (134.center) to (125);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (71) at (26.75, -0.25) {};
		\node [style=Z] (72) at (25.5, -0.25) {};
		\node [style=Z] (73) at (26, 0.75) {};
		\node [style=none] (74) at (25.5, -1) {};
		\node [style=none] (75) at (26.75, -1) {};
		\node [style=X] (76) at (26.75, 1) {};
		\node [style=Z] (77) at (25.5, 1) {};
		\node [style=Z] (78) at (26, 2) {};
		\node [style=X] (79) at (26.75, 2.25) {};
		\node [style=Z] (80) at (25.5, 2.25) {};
		\node [style=none] (81) at (26, 1.515) {$\vdots$};
		\node [style=none] (82) at (26.25, 1.425) {$n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-30, out=135] (71) to (73);
		\draw [in=135, out=-165] (73) to (72);
		\draw (74.center) to (72);
		\draw (75.center) to (71);
		\draw [in=-30, out=135] (76) to (78);
		\draw [in=135, out=-165] (78) to (77);
		\draw (72) to (77);
		\draw (77) to (80);
		\draw (79) to (76);
		\draw (76) to (71);
	\end{pgfonlayer}
\end{tikzpicture}
$$

So that given any rational $n/m$:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (95) at (27.35, 2.5) {};
		\node [style=scalar] (96) at (27.85, 1.65) {$n/m$};
		\node [style=none] (97) at (26.85, 1.5) {};
		\node [style=none] (98) at (26.85, 1) {};
		\node [style=none] (99) at (27.85, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-15, out=90] (96) to (95);
		\draw [in=-165, out=90] (97.center) to (95);
		\draw (98.center) to (97.center);
		\draw (99.center) to (96);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (208) at (54.25, 2.45) {};
		\node [style=scalar] (209) at (54.75, 1.75) {$n$};
		\node [style=none] (210) at (53.75, 1.75) {};
		\node [style=none] (211) at (53.75, 0.5) {};
		\node [style=none] (212) at (54.75, 0.5) {};
		\node [style=scalarop,fill=white] (213) at (54.75, 1) {$m$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-15, out=90] (209) to (208);
		\draw [in=-165, out=90] (210.center) to (208);
		\draw (211.center) to (210.center);
		\draw (212.center) to (209);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (97) at (62.5, 1) {};
		\node [style=X] (98) at (61.25, 1) {};
		\node [style=Z] (99) at (61.75, 1.75) {};
		\node [style=none] (100) at (61.25, 0) {};
		\node [style=none] (101) at (62.5, 0) {};
		\node [style=Z] (102) at (62.5, 2.25) {};
		\node [style=X] (103) at (61.25, 2.25) {};
		\node [style=Z] (104) at (61.75, 3) {};
		\node [style=Z] (105) at (62.5, 3.5) {};
		\node [style=X] (106) at (61.25, 3.5) {};
		\node [style=none] (107) at (61.75, 2.315) {$\vdots$};
		\node [style=none] (108) at (62, 2.225) {$n$};
		\node [style=scalarop, fill=white] (109) at (62.5, 0.5) {$m$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-30, out=150] (97) to (99);
		\draw [in=135, out=-165, looseness=1.25] (99) to (98);
		\draw (100.center) to (98);
		\draw (101.center) to (97);
		\draw [in=-15, out=135] (102) to (104);
		\draw [in=135, out=-165, looseness=1.25] (104) to (103);
		\draw (98) to (103);
		\draw (103) to (106);
		\draw (105) to (102);
		\draw (102) to (97);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (83) at (59.75, 0.75) {};
		\node [style=X] (84) at (58.25, 0.75) {};
		\node [style=Z] (85) at (58.75, 2) {};
		\node [style=none] (86) at (58.25, -0.25) {};
		\node [style=none] (87) at (59.75, -0.25) {};
		\node [style=Z] (88) at (59.75, 2.25) {};
		\node [style=X] (89) at (58.25, 2.25) {};
		\node [style=Z] (90) at (58.75, 3.5) {};
		\node [style=Z] (91) at (59.75, 3.75) {};
		\node [style=X] (92) at (58.25, 3.75) {};
		\node [style=none] (93) at (58.75, 2.59) {$\vdots$};
		\node [style=none] (94) at (59, 2.5) {$n$};
		\node [style=scalarop] (95) at (59.3, 1.5) {$m$};
		\node [style=scalarop] (96) at (59.3, 3) {$m$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-165, looseness=1.25] (85) to (84);
		\draw (86.center) to (84);
		\draw (87.center) to (83);
		\draw [in=135, out=-165, looseness=1.25] (90) to (89);
		\draw (84) to (89);
		\draw (89) to (92);
		\draw (91) to (88);
		\draw (88) to (83);
		\draw [in=-90, out=150] (88) to (96);
		\draw [in=-15, out=90] (96) to (90);
		\draw [in=-90, out=150] (83) to (95);
		\draw [in=90, out=-15] (85) to (95);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Thus, by applying the previous equation $m$ times, this can be rewritten into an circuit in the image of $L(\LinRel_{\mathbb Q})$ followed by $n\times m$ traces.
\end{proof}


\subsection{Passive linear electrical circuits as Lagrangian relations}

Symplectic geometry was motivated by the goal to formalize classical mechanics in a synthetic setting.  
Therefore, it is not a coincidence that in \cite{passive} they use linear Lagrangian relations to give a semantics for ``passive linear circuits''.  These are an idealized class of electrical circuits with linear behaviour.


To each idealized wire with no resistance, they associate the symplectic vector space $\R^{2}$.  Given an element $(z,x) \in (\R^+)^2$,  they interpret the $z$ as the current flowing through the wire and $x$ as the potential.  Recall that the voltage around a node in a circuit is is the outcoming potential minus the incoming potential.

%They remark that junctions of wires and resistors are Lagrangian relations.
They recall the following physical laws due to Ohm \cite{ohm} followed by Kirchhoff (where I can't find the original reference):

\begin{description}
\item[Ohm's law:]  The voltage around the node in a circuit is equal to the current multiplied by the resistance.

\item[Kirchhoff's current law:] The sum of currents flowing into a node is equal to the sum of currents flowing out of the node.
\end{description}
%Kirchhoffs voltage law: The sum of currents flowing into a circuit is equal to the sum of currents flowing out of the circuit.





This allows us to capture an (ideal) junction with no resistance with $n$ incoming wires and $m$ outcoming wires as a Lagrangian relation.  By Kirchhoff's current law, the sum of the $n$ ingoing wires is equal to the sum of the $m$ outgoing wires.  Moreover, by Ohm's law, because resistance is zero, the $n$ incoming and $m$ outgoing potentials are all made to be equal.  That is to say that the junction is interpreted as the following Lagrangian relation:

$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=dot] (4) at (21.5, 3.75) {};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {$m$};
		\node [style=none] (8) at (21.5, 2.75) {$n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=X] (4) at (21.5, 3.75) {};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {$m$};
		\node [style=none] (8) at (21.5, 2.75) {$n$};
		\node [style=none] (9) at (23, 5) {};
		\node [style=none] (10) at (24, 5) {};
		\node [style=none] (11) at (23, 2.5) {};
		\node [style=none] (12) at (24, 2.5) {};
		\node [style=Z] (13) at (23.5, 3.75) {};
		\node [style=none] (14) at (23.5, 4.5) {$\cdots$};
		\node [style=none] (15) at (23.5, 3) {$\cdots$};
		\node [style=none] (16) at (23.5, 4.75) {$m$};
		\node [style=none] (17) at (23.5, 2.75) {$n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
		\draw [in=150, out=-90, looseness=0.75] (9.center) to (13);
		\draw [in=90, out=-150, looseness=0.75] (13) to (11.center);
		\draw [in=-30, out=90, looseness=0.75] (12.center) to (13);
		\draw [in=-90, out=30, looseness=0.75] (13) to (10.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$



This also allows us to capture (linear) resistors as Lagrangian relations.  Given a linear resistor with resistance $r\in \R^{+}$, by Ohm's law the incoming current is equal to the outgoing current; and by By Kirchhoff's current law, the outgoing potential is equal to the current multiplied by $r$ plus the incoming potential:

$$
\left\llbracket
\tikz \draw (0,0) to[R=$r$] (0,2);
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (18) at (25, 3.5) {};
		\node [style=X] (19) at (26, 5) {};
		\node [style=none] (20) at (25, 5.5) {};
		\node [style=none] (21) at (26, 5.5) {};
		\node [style=none] (22) at (25, 3) {};
		\node [style=none] (23) at (26, 3) {};
		\node [style=scalar] (24) at (25.5, 4.25) {$r$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (22.center) to (18);
		\draw [in=-105, out=30] (18) to (24);
		\draw [in=-150, out=90] (24) to (19);
		\draw (19) to (21.center);
		\draw (19) to (23.center);
		\draw (18) to (20.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

In \cite{passive} they augment this semantics with time-dependent components.  The exposition of which necessitates recalling the following construction:


\begin{definition}
Given an integral domain $R$, the {\bf field of fractions} of  $R$ has:

\begin{itemize}
\item Elements given by pairs $(a,b) \in R \times R^*$ modulo the equivalence relation $(a,b)\sim (c,d)$ whenever $ad=bc$.  Denote the equivalence class of $(a,b)$ by $a/b$.

\item Addition is defined by $a/b+c/d = (ad+cb)/(bd)$.  The unit for addition is $0/1$.  The additive inverse of $a/b$ is $(-a)/b$.

\item Multiplication by $(a/b)(c/d) = (ac)/(b/d)$. The unit for multiplication is $1/1$. Given a nonzero element $c/d$, the inverse is $d/c$.
\end{itemize}

Because there is an obvious embedding of rings $a\mapsto (a/1)$, denote the equivalence class $a/1=a$.

The {\bf field of real rational functions} $\R(s)$ is the field of fractions of the polynomial ring $\R[s]$.
\end{definition}


In \cite{control}, they interpret ``linear constant-coefficient ordinary differential equations'' relating $n$ inputs to $m$ outputs as $\R(s)$-linear relations from $n$ to $m$.  The multiplication of the polynomial indeterminate $s$ is regarded as differentiation, and multiplication by $s^{-1}$ as integration.   Regarding these differential equations as being dependent on time, in \cite{passive}, they interpret inductors and capacitors as Lagrangian relations over $\R(s)$.  In some sense, the multiplication by the scalar $s$ is interpreted as a discrete step forward in time, and by $s^{-1}$ a discrete step backwards in time. 

A (linear) inductor with inductance $\ell \in \R^+$ is a component with one input and one output such that the voltage is equal to the rate of change of the current multiplied by $\ell$.  Applying Kirchhoff's current law Ohm's law we have that an inductor is interpreted as follows:

$$
\left\llbracket
\tikz \draw (0,0) to[L=$\ell$] (0,2);
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (25) at (28, 3.5) {};
		\node [style=Z] (26) at (27, 5) {};
		\node [style=none] (27) at (28, 5.5) {};
		\node [style=none] (28) at (27, 5.5) {};
		\node [style=none] (29) at (28, 3) {};
		\node [style=none] (30) at (27, 3) {};
		\node [style=scalar] (31) at (27.5, 4.25) {$\ell s$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (29.center) to (25);
		\draw [in=-75, out=150] (25) to (31);
		\draw [in=-30, out=90] (31) to (26);
		\draw (26) to (28.center);
		\draw (26) to (30.center);
		\draw (25) to (27.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$


Dually, a (linear) capacitor with capacitance $c \in \R^+$ is a component with one input and one output where the current is equal to the rate of change of the voltage multiplied by $c$.  The interpretation is given by:


$$
\left\llbracket
\tikz \draw (0,0) to[C=$c$] (0,2);
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (18) at (25, 3.5) {};
		\node [style=Z] (19) at (26, 5) {};
		\node [style=none] (20) at (25, 5.5) {};
		\node [style=none] (21) at (26, 5.5) {};
		\node [style=none] (22) at (25, 3) {};
		\node [style=none] (23) at (26, 3) {};
		\node [style=scalar] (24) at (25.5, 4.25) {$cs$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (22.center) to (18);
		\draw [in=-105, out=30] (18) to (24);
		\draw [in=-150, out=90] (24) to (19);
		\draw (19) to (21.center);
		\draw (19) to (23.center);
		\draw (18) to (20.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$


Recently, the fragment of electrical circuits generated by these idealized junctions and resistors has been given a complete equational theory \cite{amolak}.  A presentation of a more general class of circuits remains open, as we will discuss at the end of this chapter.

\section{Affine Lagrangian relations}
\label{sec:aff}

Affine Lagrangian relations are perhaps of more practical interest than linear Lagrangian relations.  As we will discuss in this section, these give a semantics for qudit stabilizer circuits as well as well as passive electrical circuits plus current and voltage sources.


\begin{definition}
An {\bf affine Lagrangian subspace} of a symplectic vector space $k^{2n}$ is an affine subspace of $k^{2n}$ with linear part $L$ and affine shift $a$, $L+a \subseteq k^{2n}$, where $L$ is a Lagrangian subspace.

Let $\Aff\Lag\Rel_k$ denote the prop category whose morphisms $n\to m$ are affine Lagrangian subspaces of $k^{2(n+m)}$ or the empty affine space.  The monoidal structure and composition is the same as for linear Lagrangian relations.
\end{definition}
Because the tensor product is defined in the same way as in $\Lag\Rel_k$, as in Lemma \ref{lemma:strong}, the forgetful functor  $\Aff\Lag\Rel_k\to \Aff\Rel_k$ is faithful, strong monoidal.



\begin{definition}
Let $\alr_k$ denote the monoidal subcategory of $\aih_k$ with objects $2n$, generated by the morphisms in the image of $\Lag\Rel_k\xrightarrow{E} \LinRel_k \cong \ih_k \to \aih_k$ as well as the following generator:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0, 0) {$1$};
		\node [style=Z] (1) at (0.5, 0) {};
		\node [style=none] (2) at (0, 0.75) {};
		\node [style=none] (3) at (0.5, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (2.center) to (0);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{definition}

\begin{lemma}
\label{lem:alr}
$\alr_k$ is a presentation of $\Aff\Lag\Rel_k$.
\end{lemma}
\begin{proof}
All the affine shifts can be produced from tensoring and composing these two maps on the right:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0, 0) {$1$};
		\node [style=Z] (1) at (0.5, 0) {};
		\node [style=none] (2) at (0, 0.75) {};
		\node [style=none] (3) at (0.5, 0.75) {};
		\node [style=none] (4) at (0.5, 1.5) {};
		\node [style=none] (5) at (0, 1.5) {};
		\node [style=s] (6) at (0.5, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (2.center) to (0);
		\draw [in=270, out=90] (3.center) to (5.center);
		\draw [in=270, out=90] (2.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, 0) {$1$};
		\node [style=Z] (1) at (0, 0) {};
		\node [style=none] (2) at (0.5, 0.75) {};
		\node [style=none] (3) at (0, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (2.center) to (0);
	\end{pgfonlayer}
\end{tikzpicture} \hspace*{.1cm} \in  \alr_k
\hspace*{.5cm}
\implies
\hspace*{.5cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (447) at (224.25, 0.75) {};
		\node [style=X] (448) at (222.75, 0.75) {};
		\node [style=none] (449) at (223.75, -0.25) {};
		\node [style=none] (450) at (222.25, -0.25) {};
		\node [style=none] (451) at (224.25, 1.5) {};
		\node [style=none] (452) at (222.75, 1.5) {};
		\node [style=X] (453) at (223.25, -1) {$1$};
		\node [style=Z] (454) at (224.75, -1) {};
		\node [style=scalar] (455) at (223.25, -0.25) {$a$};
		\node [style=scalarop] (456) at (224.75, -0.25) {$a$};
		\node [style=none] (457) at (223.75, -1.5) {};
		\node [style=none] (458) at (222.25, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-150] (447) to (449.center);
		\draw [in=-150, out=90] (450.center) to (448);
		\draw (447) to (451.center);
		\draw (448) to (452.center);
		\draw (457.center) to (449.center);
		\draw (458.center) to (450.center);
		\draw (453) to (455);
		\draw (454) to (456);
		\draw [in=-30, out=90] (456) to (447);
		\draw [in=-30, out=90] (455) to (448);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (17) at (5, 0) {$a$};
		\node [style=none] (18) at (5.5, -1.5) {};
		\node [style=none] (19) at (5, -1.5) {};
		\node [style=none] (20) at (5.5, 1.5) {};
		\node [style=none] (21) at (5, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (19.center) to (17);
		\draw (17) to (21.center);
		\draw (18.center) to (20.center);
	\end{pgfonlayer}
\end{tikzpicture},
\hspace*{.5cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (459) at (226.25, 0.75) {};
		\node [style=X] (460) at (227.75, 0.75) {};
		\node [style=none] (461) at (226.75, -0.25) {};
		\node [style=none] (462) at (228.25, -0.25) {};
		\node [style=none] (463) at (226.25, 1.5) {};
		\node [style=none] (464) at (227.75, 1.5) {};
		\node [style=X] (465) at (227.25, -1) {$1$};
		\node [style=Z] (466) at (225.75, -1) {};
		\node [style=scalar] (467) at (227.25, -0.25) {$a$};
		\node [style=scalarop] (468) at (225.75, -0.25) {$a$};
		\node [style=none] (469) at (226.75, -1.5) {};
		\node [style=none] (470) at (228.25, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-30] (459) to (461.center);
		\draw [in=-30, out=90] (462.center) to (460);
		\draw (459) to (463.center);
		\draw (460) to (464.center);
		\draw (469.center) to (461.center);
		\draw (470.center) to (462.center);
		\draw (465) to (467);
		\draw (466) to (468);
		\draw [in=-150, out=90] (468) to (459);
		\draw [in=-150, out=90] (467) to (460);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (1.5, 0) {$a$};
		\node [style=none] (1) at (1, -1.5) {};
		\node [style=none] (2) at (1.5, -1.5) {};
		\node [style=none] (3) at (1, 1.5) {};
		\node [style=none] (4) at (1.5, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (0);
		\draw (0) to (4.center);
		\draw (1.center) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{.1cm}\in\alr_k
$$
\end{proof}
Therefore, we are justified in using string diagrams for affine relations to reason about affine Lagrangian relations.

%We will restate the interpretations given in \cite{affine} of some components for electrical circuits in terms  affine relations  in terms of the generators for graphical calculus for Lagrangian relations.  This interpretation is also explored in \cite{passive,network}; albeit, not enjoying the graphical calculus for affine relations.

\subsection{Stabilizer circuits and Spekkens' toy model}
The connection between the stabilizer formalism and symplectic geometry has been known for quite a while, at least as early as the papers of Calderbank, Rains, Shor and Sloane
\cite{css,cssone} in the qubit case.
This developped in great detail in the quopit case by Gross \cite{gross}. However, its role in the stabilizer formalism is often underplayed, for example, it is not explicitly mentioned in Gottesman's highly influential PhD thesis \cite{gottesman}.  Perhaps a reason for this is that despite their dominance in the quantum computer literature, qubit stabilizer circuits do not conform so nicely to the symplectic geometric framework as do all other prime qudit dimensions

In this subsection, we with build on the work of Gross and show that, when $p$ is an odd prime, the prop of affine Lagrangian relations over $\F_p$  is isomorphic to quopit stabilizer circuits modulo invertible scalars.


To show this, we must first recall some very important results of Gross, relating the stabilizer formalism to symplectic geometry.  First we need the following convention to represent Weyl operators:

\begin{definition}
Given $a \in \F_p$ and $(z,x )\in \F_p^{2n}$, define the following operators:
$$
\chi(a) = e^{2\pi\cdot i \cdot a/p}, \hspace*{1cm} {\mathcal W}(z,x)=\chi(-zx^T/2)\bigotimes_{j=0}^{n-1}\mathcal{Z}_{(j)}^{z_j}\mathcal{X}_{(j)}^{x_j}
$$

\end{definition}


This makes the following result more easy to prove:

\begin{lemma}[{\cite[Theorem 3]{gross}}]
For every odd prime $p$ the prop  of affine symplectomorphisms over  $\F_p$ is isomorphic to the quopit Clifford groupoid modulo scalars.
\end{lemma}



\begin{proof}
We know that the Clifford group is defined as the normalizer of the Pauli group so that a Clifford operator is defined by its action on Weyl operators. Given an $n$ quopit Clifford operator $C$  and $(z,x)\in \F_p^{2n}$, there exists  an isomorphism $C_L:\F_p^{2n}\to \F_p^{2n}$ and a vector  $C_a\in \F_p^{2n}$ such that:

$$
C {\mathcal W}(z,x) C^\dag
=
\chi(C_a(z,x)){\mathcal W}(C_L(z,x))
$$


We seek to show that $C_L$ is the the symplectomorphism and $C_a$ is the affine shift.  $C_L$ is clearly linear.  To see that it is a symplectomorphism, first observe:

$$
\mathcal{Z}\mathcal{X}  = \chi(1)\mathcal{X} \mathcal{Z}
$$

Therefore, 


\begin{align*}
(\mathcal{Z}^{z_0}\mathcal{X}^{x_0})(\mathcal{Z}^{z_1}\mathcal{X}^{x_1} )
&=\chi(-x_0z_1) \mathcal{Z}^{z_0}\mathcal{Z}^{z_1}\mathcal{X}^{x_0}\mathcal{X}^{x_1}  \\
&=\chi(-x_0z_1)\mathcal{Z}^{z_1}  \mathcal{Z}^{z_0}\mathcal{X}^{x_1} \mathcal{X}^{x_0}  \\
&=\chi(z_0x_1-x_0z_1)(\mathcal{Z}^{z_1} \mathcal{X}^{x_1})(  \mathcal{Z}^{z_0}\mathcal{X}^{x_0} ) \\
&=\chi(\omega((z_0,x_0),(z_1,x_1)))(\mathcal{Z}^{z_1} \mathcal{X}^{x_1})(  \mathcal{Z}^{z_0}\mathcal{X}^{x_0} ) 
\end{align*}

So that Weyl operators commute with each other up to the symplectic form:

$$
{\mathcal W}(z,x) {\mathcal W}(z',x') = \chi(\omega(z,x),(z',x')) {\mathcal W}(z',x') {\mathcal W}(z,x) $$

Moreover, we can combine Weyl operators together as follows:

\begin{align*}
{\mathcal W}(z,x) {\mathcal W}(z',x')
&=\chi(\omega((z,x),(z',x'))/2){\mathcal W}(z+z',x+x') 
\end{align*}


Therefore:
\begin{align*}
&C\mathcal{W}(z,x)\mathcal{W}(z',x')C^\dag\\
&=C(\mathcal{W}(z,x) C^\dag C \mathcal{W}(z',x'))C^\dag\\
&=\chi(C_a(z,x)+C_a(z',x')) \mathcal{W}(C_L(z,x))\mathcal{W}(C_L(z',x')) \\
&=\chi(C_a(z,x)+C_a(z',x')+\omega(C_L(z,x)),C_L(z',x'))/2)  \mathcal{W}(C_L(z,x)+C_L(z',x')) \\
\end{align*}

Similarly:

\begin{align*}
&C\mathcal{W}(z,x)\mathcal{W}(z',x')C^\dag\\
&= \chi(\omega((z,x),(z',x'))/2) C \mathcal{W}(z+z',x+x') C^\dag\\
&= \chi(\omega((z,x),(z',x'))/2+C_a(z+z',x+x')) \mathcal{W}(C_{L}(z+z',x+x'))\\
&= \chi(\omega((z,x),(z',x'))/2+C_a(z,x)+ C_a(z',x')) \mathcal{W}(C_L(z,x)+C_L(z',x'))\\
\end{align*}


So that $\omega(C_L(z,x),C_L(z',x')) = \omega((z,x),(z',x'))$; meaning that $C_L$ is a symplectomorphism. Moreover for a Clifford operator $D$:

\begin{align*}
DC {\mathcal W}(z,x) C^\dag D^\dag
&=D\chi(C_a(z,x)){\mathcal W}(C_L(z,x))D^\dag\\
&=\chi(C_a(z,x)+D_a(C_L(z,x))){\mathcal W}(D_L(C_L(z,x)))\\
\end{align*}

So that $C_L$ and $C_a$ determine an affine transformation.

\end{proof}


The reason this fails for qubits is because one can not represent all Weyl operators in the following way:

$$
\chi(C_a(z,x)){\mathcal W}(z,x)
$$

 For example, the qubit phase shift gate $\mathcal{S}\mathcal{X} \mathcal{S}^{\dag} = i \mathcal{Z}\mathcal{X}$; however $i=e^{2\pi \cdot i/4}$, so there is no value of $a\in \F_2$ for which $\chi(a)=e^{2\pi\cdot i\cdot a/2} =e^{\pi\cdot i a} = i$.


%
%\begin{proof}
%As a matter of notation let
%$$
%\chi(a) = e^{2\pi\cdot i \cdot a/p}, \hspace*{1cm} {\mathcal W}(z,x)=\chi(-zx^T/2)\bigotimes_{j=0}^{n-1}\mathcal{Z}_{(j)}^{z_j}\mathcal{X}_{(j)}^{x_j}
%$$
%Where the subscript $(j)$ denotes that we are applying a gate on wire $(j)$ tensored on both sides with identities.
%
%
%We know that the Clifford group is defined as the normalizer of the Pauli group so that a Clifford operator is defined by its action on Weyl operators. Given an $n$ qudit Clifford operator $C$  and $(z,x)\in \F_p^{2n}$, there exists  an isomorphism $C_L:\F_p^{2n}\to \F_p^{2n}$ and a vector  $C_a\in \F_p^{2n}$ such that:
%
%$$
%{\mathcal W}(z,x) C {\mathcal W}(z,x)^\dag
%=
%\chi(C_a(z,x)){\mathcal W}(C_L(z,x))
%$$
%
%Note that for qubits the phase is not $\chi(C_a(z,x))$, so this is not true.  For example, the qubit phase shift gate $\mathcal{X}\mathcal{S}\mathcal{X} = i \cdot I_2$; however $i=e^{2\pi \cdot i/4}$, so there is no value of $a\in \F_2$ for which $\chi(a)=e^{2\pi\cdot i\cdot a/2} =e^{\pi\cdot i a} = i$.
%
%We seek to show that $C_L$ is the the symplectomorphism and $C_a$ is the affine shift.  $C_L$ is clearly linear.  To see that it is a symplectomorphism, first observe:
%
%$$
%\mathcal{Z}\mathcal{X}  = \chi(1)\mathcal{X} \mathcal{Z}
%$$
%
%Therefore, 
%
%
%\begin{align*}
%(\mathcal{Z}^{z_0}\mathcal{X}^{x_0})(\mathcal{Z}^{z_1}\mathcal{X}^{x_1} )
%&=\chi(-x_0z_1) \mathcal{Z}^{z_0}\mathcal{Z}^{z_1}\mathcal{X}^{x_0}\mathcal{X}^{x_1}  \\
%&=\chi(-x_0z_1)\mathcal{Z}^{z_1}  \mathcal{Z}^{z_0}\mathcal{X}^{x_1} \mathcal{X}^{x_0}  \\
%&=\chi(z_0x_1-x_0z_1)(\mathcal{Z}^{z_1} \mathcal{X}^{x_1})(  \mathcal{Z}^{z_0}\mathcal{X}^{x_0} ) \\
%&=\chi(\omega((z_0,x_0),(z_1,x_1)))(\mathcal{Z}^{z_1} \mathcal{X}^{x_1})(  \mathcal{Z}^{z_0}\mathcal{X}^{x_0} ) 
%\end{align*}
%
%So that:
%
%$$
%{\mathcal W}(z,x) {\mathcal W}(z',x') = \chi(\omega(z,x),(z',x')) {\mathcal W}(z',x') {\mathcal W}(z,x) $$
%
%
%Take $P=\mathcal{W}(z,x)$ and  $P'=\mathcal{W}(z',x')$.
%There are two ways to compute  $(P'P)C(P'P)^\dag$;  we could compute the conjugation of $C$ by $P'P$ via $C_a$ and $C_L$; or we could first compute the conjugation of $C$ by $P$ and then conjugate by $P'$.  In either case, to obtain a Weyl operator in normal form (so that tensors of  powers of $\cal Z$ are followed by tensors of powers of $\cal X$), we must commute the Weyl operators past each other.  This means that:
%
%$$
%\omega(C_L(z,x),C_L(z',x')) = C_L(\omega((z_0,x_0),(z_0',x_0')),\cdots, \omega((z_{n-1},x_{n-1}),(z_{n-1}',x_{n-1}')) )
%$$
%
%So that $C_L$ is a symplectomorphism.   Given another Clifford operator $D$:
%$$
%\chi(C_a(z,x)){\cal W}(C_L(z,x)) D {\cal W}(C_L(z,x))^\dag
%=
% \chi(C_a(z,x)+D_a(C_L(z,x)))    {\mathcal W}( D_L(C_L(z,x)))
%$$
%
%So that  $C_L$ and $C_a$ determine an affine transformation $(z,x) \mapsto C_L(z,x)+C_a$ with respect to composition of Clifford operators.
%Indeed, the affine symplectormorphisms $\F_p^{2n}\to \F_p^{2n}$ are the only functions which determine Clifford operators in this way.
%\end{proof}



Recall that, up to scalars, the $n$-quopit Clifford group is generated by the Pauli $\mathcal X$-gate, the $\mathcal{C}_\mathcal{X}$ gate, the Fourier transform $\mathcal F$ and the phase gate $\mathcal S$ and scaling gates $\mathcal{M}_a$ for all $a \in \F_p^*$.
In the odd prime case, these correspond to the affine symplectormorphisms:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (295) at (232.5, 0) {};
		\node [style=none] (296) at (232.5, 1) {};
		\node [style=none] (297) at (233, 1) {};
		\node [style=none] (298) at (233, 0) {};
		\node [style=X] (299) at (233, 0.5) {$1$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (298.center) to (299);
		\draw (299) to (297.center);
		\draw (296.center) to (295.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \leftrightarrow \mathcal{X},\hspace*{.2cm}
\begin{tikzpicture}[yscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (300) at (234.5, 1) {};
		\node [style=none] (301) at (234, -0.25) {};
		\node [style=none] (302) at (234.5, -0.25) {};
		\node [style=none] (303) at (234, 1) {};
		\node [style=none] (304) at (234, 0.5) {};
		\node [style=none] (305) at (234.5, 0.5) {};
		\node [style=s] (306) at (234.5, 0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (301.center) to (304.center);
		\draw [in=-90, out=90] (304.center) to (300.center);
		\draw [in=-270, out=-90] (303.center) to (305.center);
		\draw (302.center) to (305.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \leftrightarrow {\mathcal F},\hspace*{.2cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (307) at (235.5, 0) {};
		\node [style=none] (308) at (235.5, 1.25) {};
		\node [style=none] (309) at (236, 1.25) {};
		\node [style=none] (310) at (236, 0) {};
		\node [style=Z] (311) at (235.5, 0.5) {};
		\node [style=X] (312) at (236, 0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (308.center) to (311);
		\draw (311) to (307.center);
		\draw (311) to (312);
		\draw (309.center) to (312);
		\draw (312) to (310.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \leftrightarrow \ {\mathcal S},\hspace*{.2cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (313) at (237, 1) {};
		\node [style=Z] (314) at (237.5, 1.25) {};
		\node [style=X] (315) at (238.75, 1.25) {};
		\node [style=Z] (316) at (238.25, 1) {};
		\node [style=none] (317) at (237, 0.5) {};
		\node [style=none] (318) at (237.5, 0.5) {};
		\node [style=none] (319) at (238.25, 0.5) {};
		\node [style=none] (320) at (238.75, 0.5) {};
		\node [style=none] (321) at (238.25, 1.75) {};
		\node [style=none] (322) at (238.75, 1.75) {};
		\node [style=none] (323) at (237, 1.75) {};
		\node [style=none] (324) at (237.5, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (317.center) to (313);
		\draw (313) to (323.center);
		\draw (324.center) to (314);
		\draw (314) to (318.center);
		\draw (313) to (314);
		\draw (321.center) to (316);
		\draw (319.center) to (316);
		\draw (316) to (315);
		\draw (322.center) to (315);
		\draw (315) to (320.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \leftrightarrow \mathcal{C}_{\mathcal X},\hspace*{.2cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (329) at (239.75, 0.25) {};
		\node [style=none] (330) at (240.5, 0.25) {};
		\node [style=none] (335) at (239.75, 1.75) {};
		\node [style=none] (336) at (240.5, 1.75) {};
		\node [style=scalar] (337) at (240.5, 1) {$a$};
		\node [style=scalarop] (338) at (239.75, 1) {$a$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (330.center) to (337);
		\draw (337) to (336.center);
		\draw (335.center) to (338);
		\draw (329.center) to (338);
	\end{pgfonlayer}
\end{tikzpicture}
 \leftrightarrow \mathcal{M}_{a}
$$


The following result gets us even closer to where we need to be:

\begin{lemma}[{\cite[Lem. 8]{gross}}]
For every odd prime $p$ and $n \in \N$, there is a bijection between (nonempty) affine Lagrangian subspaces of $\F_p^{2n}$ and $n$-quopit stabilizer states modulo nonzero scalars.
\end{lemma}


\begin{proof}
Given any affine Lagrangian subspace $L+a\subseteq \F_p^{2n}$; then up to global phase there is a stabilizer state $C | 0\rangle^{\otimes n}$ determined by the rank 1 projector:
$$
C | 0\rangle^{\otimes n} \langle 0| ^{\otimes n}C^{\dag}:=\dfrac{1}{p^n}\sum_{v \in L}\chi(\omega(a,v)) {\cal W}(v)
$$
as for any $v' \in L$:
\begin{align*}
\chi(\omega(a,v')) {\cal W}(v') &\dfrac{1}{p^n}\sum_{v \in L}\chi(\omega(a,v)) {\cal W}(v) \chi(-\omega(a,v')) {\cal W}(v')^\dag\\
=&
 \dfrac{1}{p^n}\sum_{v \in L}\chi(\omega(a,v)+\omega(v,v')) {\cal W}(v)
{\cal W}(v') {\cal W}(v')^\dag\\
=&
 \dfrac{1}{p^n}\sum_{v \in L}\chi(\omega(a,v) ){\cal W}(v)
{\cal W}(v') {\cal W}(v')^\dag\\
=&
 \dfrac{1}{p^n}\sum_{v \in L}\chi(\omega(a,v)) {\cal W}(v)
\end{align*}

Moreover, every stabilizer state is of this form.  Recall that stabilizer groups are Abelian.
If two stabilizers $\chi(a){\cal W}(u)$ and $\chi(b){\cal W}(v)$ stabilize the same state, they must commute so that $\omega(u,v)=0$.
Moreover a stabilizer state is stabilized by exactly $p^n$ stabilizers,  making the space of stabilizers into an affine Lagrangian subspace of $\F_p$. 
\end{proof}

In other words, a symplectic basis for the affine Lagrangian subspace over $\F_p$ corresponds to the {\bf stabilizer tableau} for a pure quopit stabilizer state (ie a stabilizer tableau on $n$ qudits with dimension $n$).

Explicitly, the state $|0\rangle$ is identified with the following Afffine Lagrangian subspace:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (389) at (205, -2) {};
		\node [style=none] (390) at (205, -1.5) {};
		\node [style=Z] (391) at (204.5, -2) {};
		\node [style=none] (392) at (204.5, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (389) to (390.center);
		\draw (391) to (392.center);
	\end{pgfonlayer}
\end{tikzpicture}
 \leftrightarrow |0\rangle
$$


We seek to recast these results in a more compositional light; to prove that for odd prime $p$, $\Aff\Lag\Rel_{\F_p}$ is isomorphic to quopit stabilizer circuits, modulo scalars.  Let us give the latter category a name:


\begin{definition}
Let $\Stab_p$ denote the prop of quopit stabilizer circuits modulo nonzero scalars, regarded as a \dag-compact closed category with respect to the standard basis.
\end{definition}


%The following isomorphism is described in \cite{gross}, when restricted to the nonempty case.  This comes from the projective representation of the quopit Clifford group in terms of the affine symplectomorphisms over $\F_p^n$.  However, since there is only one empty relation and one zero matrix of every type, we get the following result immediately:



We extend this isomorphism of states to an isomorphism of props using a symplectic notion of Weyl groups and stabilizers:


\begin{definition}
Given a field $k$  the  $n$-fold symplectic Weyl operators are the symplectomorphisms of the following form,  for $\vec a, \vec b \in k^(2n)$:


$$
W(a,b):=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0, 1) {$\vec a$};
		\node [style=none] (1) at (0, 2) {};
		\node [style=none] (2) at (0, 0) {};
		\node [style=none] (3) at (1, 2) {};
		\node [style=none] (4) at (1, 0) {};
		\node [style=X] (5) at (1, 1) {$\vec b$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4.center) to (5.center);
		\draw (5.center) to (3.center);
		\draw (1.center) to (0.center);
		\draw (0.center) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$



The $n$-fold symplectic Weyl operators form the $n$-fold {\bf symplectic Weyl group}, $P_k^n$ under composition.  And altogether, they form a prop under tensor product and composition. 

Given some affine Lagrangian subspace $f$ of $\F_k^{2n}$, the {\bf symplectic stabilizer group} of $f$ is the subgroup  $S\subseteq P_k^n$ so that for all $a\in S$, $f; a =f$.
\end{definition}

Notice that unlike the qudit Pauli group, there is no phase-factor.

\begin{lemma}
Two states in $\Aff\Lag\Rel_k$ are equal if and only if they have the same symplectic stabilizer group.
\end{lemma}

\begin{proof}
Take a state $f:0\to n$ in $\Aff\Lag\Rel_k$.  Then $W(z,x)$ is a stabilizer of $f$ if and only if  $(z,x) \in f$; therefore two subspaces are equal if and only if they have the same elements if and only if they have the same stabilizers.
\end{proof}




\begin{theorem}
\label{theorem:spekkens}
When $p$ is an odd prime, the mapping $\Lag\Rel_{\F_p} \to \Stab_p$ defined on objects by:

$$
n\mapsto \ell^2(\F_p^n)
$$


And on maps:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (21) at (2, -2) {$f$};
		\node [style=none] (22) at (1.75, -1.25) {};
		\node [style=none] (23) at (2.25, -1.25) {};
		\node [style=none] (24) at (1.75, -2.75) {};
		\node [style=none] (25) at (2.25, -2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (21) to (22.center);
		\draw [in=90, out=-120] (21) to (24.center);
		\draw [in=-60, out=90] (25.center) to (21);
		\draw [in=-90, out=60] (21) to (23.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{cases}
{\bf 0} & \text{if $f=\emptyset$}\\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (7) at (12, 0) {$G\left(\lfloor f\rfloor\right)$};
		\node [style=none] (8) at (11.25, 1.5) {};
		\node [style=Z] (10) at (13, 1) {};
		\node [style=none] (12) at (13.5, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-90] (8.center) to (7);
		\draw [in=-150, out=60, looseness=0.75] (7) to (10);
		\draw [in=-45, out=90] (12.center) to (10);
	\end{pgfonlayer}
\end{tikzpicture} & \text{otherwise}
\end{cases}
$$
is a symmetric monoidal isomorphism, where $G$ is the bijection  between affine Lagrangian subspaces and stabilizer states modulo scalars. And $\bf 0$ is the unique stabilizer circuit of appropriate dimension which is multiplied by the scalar 0.
\end{theorem}

%
%%See Appendix \ref{proof:theorem:spekkens} for the proof.  
%The main difficulty in proving this is to show that $H$ is a functor.  This is shown by observing that stabilizer states with the same stabilizer group only differ by a global scalar.


\begin{proof}
We already know that there is a bijection between the states of both of these props. Because these props are both compact closed, it only remains to show that this isomorphism is monoidal and functorial.  It clearly is monoidal and preserves the identity; the nontrivial part is to show that it preserves composition.

Consider some composable pair in $\Aff\Lag\Rel_{\F_p}$:
$$
\F_p^n \xrightarrow{f} \F_p^m \xrightarrow{g} \F_p^\ell
$$
If the composite is empty, then the result follows immediately.  Suppose otherwise.


First, observe that in $\Stab_p$

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (111) at (197.5, -2) {};
		\node [style=none] (112) at (196.75, -2.75) {};
		\node [style=none] (113) at (198.25, -2.75) {};
		\node [style=none] (114) at (196.75, -3.5) {};
		\node [style=none] (115) at (198.25, -3.5) {};
		\node [style=map] (116) at (196.75, -2.75) {${\mathcal W}(a,b)$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (115.center) to (113.center);
		\draw [in=-15, out=90] (113.center) to (111);
		\draw [in=90, out=-165] (111) to (112.center);
		\draw (112.center) to (114.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (117) at (200, -2) {};
		\node [style=none] (118) at (199.25, -2.75) {};
		\node [style=none] (119) at (200.75, -2.75) {};
		\node [style=none] (120) at (199.25, -3.5) {};
		\node [style=none] (121) at (200.75, -3.5) {};
		\node [style=map] (122) at (199.25, -2.75) {${\cal Z}^a{\cal X}^b$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (121.center) to (119.center);
		\draw [in=-15, out=90] (119.center) to (117);
		\draw [in=90, out=-165] (117) to (118.center);
		\draw (118.center) to (120.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (123) at (202.5, -2) {};
		\node [style=none] (124) at (203.25, -2.75) {};
		\node [style=none] (125) at (201.75, -2.75) {};
		\node [style=none] (126) at (203.25, -3.5) {};
		\node [style=none] (127) at (201.75, -3.5) {};
		\node [style=map] (128) at (203.25, -2.75) {${\cal Z}^a{\cal X}^{-b}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (127.center) to (125.center);
		\draw [in=-165, out=90] (125.center) to (123);
		\draw [in=90, out=-15] (123) to (124.center);
		\draw (124.center) to (126.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (129) at (205, -2) {};
		\node [style=none] (130) at (205.75, -2.75) {};
		\node [style=none] (131) at (204.25, -2.75) {};
		\node [style=none] (132) at (205.75, -3.5) {};
		\node [style=none] (133) at (204.25, -3.5) {};
		\node [style=map] (134) at (205.75, -2.75) {$\mathcal W(a,-b)$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (133.center) to (131.center);
		\draw [in=-165, out=90] (131.center) to (129);
		\draw [in=90, out=-15] (129) to (130.center);
		\draw (130.center) to (132.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$


Moreover, in $\Aff\Lag\Rel_{\F_p}$

\begin{align*}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (271) at (226.75, -6) {};
		\node [style=Z] (272) at (227.75, -6) {};
		\node [style=none] (275) at (227.75, -7) {};
		\node [style=none] (276) at (228.5, -7) {};
		\node [style=none] (277) at (226, -8) {};
		\node [style=none] (278) at (226.75, -8) {};
		\node [style=none] (279) at (227.75, -8) {};
		\node [style=none] (280) at (228.5, -8) {};
		\node [style=none] (281) at (226, -7) {};
		\node [style=none] (282) at (226.75, -7) {};
		\node [style=map] (283) at (226.425, -7.25) {$W(a,b)$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-15] (271) to (275.center);
		\draw [in=-15, out=90] (276.center) to (272);
		\draw [in=-165, out=90] (282.center) to (272);
		\draw [in=90, out=-165] (271) to (281.center);
		\draw (281.center) to (277.center);
		\draw (278.center) to (282.center);
		\draw (275.center) to (279.center);
		\draw (280.center) to (276.center);
	\end{pgfonlayer}
\end{tikzpicture}
&=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (135) at (198, -6) {};
		\node [style=Z] (136) at (199, -6) {};
		\node [style=X] (137) at (197.25, -7) {$a$};
		\node [style=X] (138) at (198, -7) {$b$};
		\node [style=none] (139) at (199, -7) {};
		\node [style=none] (140) at (199.75, -7) {};
		\node [style=none] (141) at (197.25, -8) {};
		\node [style=none] (142) at (198, -8) {};
		\node [style=none] (143) at (199, -8) {};
		\node [style=none] (144) at (199.75, -8) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (141.center) to (137);
		\draw [in=-165, out=90] (137) to (135);
		\draw [in=-165, out=90] (138) to (136);
		\draw (142.center) to (138);
		\draw [in=90, out=-15] (135) to (139.center);
		\draw (139.center) to (143.center);
		\draw (144.center) to (140.center);
		\draw [in=-15, out=90] (140.center) to (136);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (145) at (201.25, -6) {};
		\node [style=Z] (146) at (202.25, -6) {};
		\node [style=X] (148) at (201.25, -7) {$b$};
		\node [style=none] (149) at (202.25, -7) {};
		\node [style=none] (150) at (203, -7) {};
		\node [style=none] (151) at (200.5, -8) {};
		\node [style=none] (152) at (201.25, -8) {};
		\node [style=none] (153) at (202.25, -8) {};
		\node [style=none] (154) at (203, -8) {};
		\node [style=X] (155) at (202.25, -7) {$a$};
		\node [style=none] (156) at (200.5, -7) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-165, out=90] (148) to (146);
		\draw (152.center) to (148);
		\draw [in=90, out=-15] (145) to (149.center);
		\draw (149.center) to (153.center);
		\draw (154.center) to (150.center);
		\draw [in=-15, out=90] (150.center) to (146);
		\draw (156.center) to (151.center);
		\draw [in=-165, out=90] (156.center) to (145);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (157) at (204.75, -6) {};
		\node [style=X] (159) at (204.75, -7) {$b$};
		\node [style=none] (160) at (205.75, -7) {};
		\node [style=none] (161) at (206.5, -7) {};
		\node [style=none] (162) at (204, -8) {};
		\node [style=none] (163) at (204.75, -8) {};
		\node [style=none] (164) at (205.75, -8) {};
		\node [style=none] (165) at (206.5, -8) {};
		\node [style=X] (166) at (205.75, -7) {$a$};
		\node [style=none] (167) at (204, -7) {};
		\node [style=X] (168) at (205.75, -6) {};
		\node [style=s] (169) at (206.5, -7) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (163.center) to (159);
		\draw [in=90, out=-15] (157) to (160.center);
		\draw (160.center) to (164.center);
		\draw (165.center) to (161.center);
		\draw (167.center) to (162.center);
		\draw [in=-165, out=90] (167.center) to (157);
		\draw [in=-165, out=90] (159) to (168);
		\draw [in=90, out=-15] (168) to (169);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (170) at (208.25, -6) {};
		\node [style=none] (172) at (209.25, -7) {};
		\node [style=none] (173) at (210, -7) {};
		\node [style=none] (174) at (207.5, -8) {};
		\node [style=none] (175) at (208.25, -8) {};
		\node [style=none] (176) at (209.25, -8) {};
		\node [style=none] (177) at (210, -8) {};
		\node [style=X] (178) at (209.25, -7) {$a$};
		\node [style=none] (179) at (207.5, -7) {};
		\node [style=X] (180) at (209.25, -6) {};
		\node [style=none] (182) at (208.25, -7) {};
		\node [style=s] (183) at (210, -7.5) {};
		\node [style=X] (184) at (210, -7) {$b$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-15] (170) to (172.center);
		\draw (172.center) to (176.center);
		\draw (177.center) to (173.center);
		\draw (179.center) to (174.center);
		\draw [in=-165, out=90] (179.center) to (170);
		\draw (175.center) to (182.center);
		\draw [in=-165, out=90] (182.center) to (180);
		\draw [in=-15, out=90] (184) to (180);
	\end{pgfonlayer}
\end{tikzpicture}\\
&=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (220) at (211.75, -6) {};
		\node [style=none] (221) at (212.75, -7) {};
		\node [style=none] (222) at (213.5, -7) {};
		\node [style=none] (223) at (211, -8) {};
		\node [style=none] (224) at (211.75, -8) {};
		\node [style=none] (225) at (212.75, -8) {};
		\node [style=none] (226) at (213.5, -8) {};
		\node [style=X] (227) at (212.75, -7) {$a$};
		\node [style=none] (228) at (211, -7) {};
		\node [style=X] (229) at (212.75, -6) {};
		\node [style=none] (230) at (211.75, -7) {};
		\node [style=s] (231) at (213.5, -6.8) {};
		\node [style=X] (232) at (213.5, -7.5) {$-b$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-15] (220) to (221.center);
		\draw (221.center) to (225.center);
		\draw (226.center) to (222.center);
		\draw (228.center) to (223.center);
		\draw [in=-165, out=90] (228.center) to (220);
		\draw (224.center) to (230.center);
		\draw [in=-165, out=90] (230.center) to (229);
		\draw [in=-15, out=90] (222.center) to (229);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (233) at (215.25, -6) {};
		\node [style=none] (234) at (216.25, -7) {};
		\node [style=none] (235) at (217, -7) {};
		\node [style=none] (236) at (214.5, -8) {};
		\node [style=none] (237) at (215.25, -8) {};
		\node [style=none] (238) at (216.25, -8) {};
		\node [style=none] (239) at (217, -8) {};
		\node [style=X] (240) at (216.25, -7) {$a$};
		\node [style=none] (241) at (214.5, -7) {};
		\node [style=none] (243) at (215.25, -7) {};
		\node [style=X] (245) at (217, -7) {$-b$};
		\node [style=Z] (246) at (216.25, -6) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-15] (233) to (234.center);
		\draw (234.center) to (238.center);
		\draw (239.center) to (235.center);
		\draw (241.center) to (236.center);
		\draw [in=-165, out=90] (241.center) to (233);
		\draw (237.center) to (243.center);
		\draw [in=-165, out=90] (243.center) to (246);
		\draw [in=90, out=-15] (246) to (235.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (284) at (230.25, -6) {};
		\node [style=Z] (285) at (231.25, -6) {};
		\node [style=none] (286) at (231.25, -7) {};
		\node [style=none] (287) at (232, -7) {};
		\node [style=none] (288) at (229.5, -8) {};
		\node [style=none] (289) at (230.25, -8) {};
		\node [style=none] (290) at (231.25, -8) {};
		\node [style=none] (291) at (232, -8) {};
		\node [style=none] (292) at (229.5, -7) {};
		\node [style=none] (293) at (230.25, -7) {};
		\node [style=map] (294) at (231.675, -7.25) {$W(a,-b)$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-15] (284) to (286.center);
		\draw [in=-15, out=90] (287.center) to (285);
		\draw [in=-165, out=90] (293.center) to (285);
		\draw [in=90, out=-165] (284) to (292.center);
		\draw (292.center) to (288.center);
		\draw (289.center) to (293.center);
		\draw (286.center) to (290.center);
		\draw (291.center) to (287.center);
	\end{pgfonlayer}
\end{tikzpicture}
\end{align*}

Therefore, the symplectic Weyl operators commute with the symplectic $Z$ spider in $\Aff\Lag\Rel_{\F_p}$ in the same way that the Weyl operators commute with the $Z$ spiders in $\Stab_p$.
%We also know that:
%$$
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (189) at (103, 0) {$\hat {f;g}$};
%		\node [style=none] (190) at (102.25, 1.5) {};
%		\node [style=none] (191) at (103.25, 1.5) {};
%		\node [style=none] (192) at (102.75, 1.5) {};
%		\node [style=none] (193) at (103.75, 1.5) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=135, out=-90] (190.center) to (189);
%		\draw [in=-90, out=75] (189) to (191.center);
%		\draw [in=-90, out=45] (189) to (193.center);
%		\draw [in=105, out=-90] (192.center) to (189);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (163) at (96.5, -2.25) {$f;g$};
%		\node [style=none] (164) at (96.75, -1.5) {};
%		\node [style=none] (165) at (95.75, -1.5) {};
%		\node [style=Z] (166) at (96.25, -3) {};
%		\node [style=X] (167) at (95.75, -3) {};
%		\node [style=none] (168) at (95.75, -2.25) {};
%		\node [style=none] (169) at (95.25, -2.25) {};
%		\node [style=none] (170) at (96.25, -1.5) {};
%		\node [style=none] (171) at (95.25, -1.5) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=-90, out=60] (163) to (164.center);
%		\draw [in=-90, out=120] (163) to (165.center);
%		\draw [in=-120, out=30] (167) to (163);
%		\draw [in=30, out=-60, looseness=1.25] (163) to (166);
%		\draw [in=-90, out=150] (166) to (168.center);
%		\draw [in=-90, out=135] (167) to (169.center);
%		\draw (169.center) to (171.center);
%		\draw [in=-90, out=90] (168.center) to (170.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (211) at (110.5, -2.25) {$g$};
%		\node [style=none] (212) at (110.75, -1.5) {};
%		\node [style=none] (213) at (109.75, -1.5) {};
%		\node [style=Z] (214) at (110.25, -3) {};
%		\node [style=X] (215) at (109.75, -3) {};
%		\node [style=none] (216) at (109.75, -2.25) {};
%		\node [style=none] (217) at (109.25, -2.25) {};
%		\node [style=none] (218) at (110.25, -1.5) {};
%		\node [style=none] (219) at (109.25, -1.5) {};
%		\node [style=map] (220) at (112.5, -2.25) {$f$};
%		\node [style=none] (221) at (112.75, -1.5) {};
%		\node [style=none] (222) at (111.75, -1.5) {};
%		\node [style=Z] (223) at (112.25, -3) {};
%		\node [style=X] (224) at (111.75, -3) {};
%		\node [style=none] (225) at (111.75, -2.25) {};
%		\node [style=none] (226) at (111.25, -2.25) {};
%		\node [style=none] (227) at (112.25, -1.5) {};
%		\node [style=none] (228) at (111.25, -1.5) {};
%		\node [style=Z] (229) at (111.5, -0.5) {};
%		\node [style=X] (230) at (110.5, -0.5) {};
%		\node [style=none] (231) at (110.5, 0.25) {};
%		\node [style=none] (232) at (111.5, 0.25) {};
%		\node [style=none] (233) at (109.25, 0.25) {};
%		\node [style=none] (234) at (112.75, 0.25) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=-90, out=60] (211) to (212.center);
%		\draw [in=-90, out=120] (211) to (213.center);
%		\draw [in=-120, out=30] (215) to (211);
%		\draw [in=30, out=-60, looseness=1.25] (211) to (214);
%		\draw [in=-90, out=150] (214) to (216.center);
%		\draw [in=-90, out=135] (215) to (217.center);
%		\draw (217.center) to (219.center);
%		\draw [in=-90, out=90] (216.center) to (218.center);
%		\draw [in=-90, out=60] (220) to (221.center);
%		\draw [in=-90, out=120] (220) to (222.center);
%		\draw [in=-120, out=30] (224) to (220);
%		\draw [in=30, out=-60, looseness=1.25] (220) to (223);
%		\draw [in=-90, out=150] (223) to (225.center);
%		\draw [in=-90, out=135] (224) to (226.center);
%		\draw (226.center) to (228.center);
%		\draw [in=-90, out=90] (225.center) to (227.center);
%		\draw [in=-30, out=90] (227.center) to (229);
%		\draw [in=90, out=-150] (229) to (212.center);
%		\draw [in=-30, out=90] (228.center) to (230);
%		\draw [in=90, out=-150] (230) to (213.center);
%		\draw (219.center) to (233.center);
%		\draw [in=-90, out=90] (218.center) to (232.center);
%		\draw [in=-90, out=90, looseness=0.75] (222.center) to (231.center);
%		\draw (221.center) to (234.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=map] (64) at (28.75, 0) {$\hat g$};
%		\node [style=none] (65) at (28, 1.25) {};
%		\node [style=X] (66) at (29.25, 1) {};
%		\node [style=Z] (67) at (29.75, 1) {};
%		\node [style=none] (68) at (28.75, 1.25) {};
%		\node [style=map] (69) at (30.25, 0) {$\hat f$};
%		\node [style=none] (70) at (30.25, 1.25) {};
%		\node [style=none] (71) at (31, 1.25) {};
%		\node [style=none] (72) at (30.25, 2.5) {};
%		\node [style=none] (73) at (28.75, 2.5) {};
%		\node [style=none] (74) at (31, 2.5) {};
%		\node [style=none] (75) at (28, 2.5) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=135, out=-90] (65.center) to (64);
%		\draw [in=-150, out=45] (64) to (67);
%		\draw [in=-165, out=105, looseness=1.25] (64) to (66);
%		\draw [in=-90, out=60] (64) to (68.center);
%		\draw [in=-30, out=60, looseness=1.25] (69) to (67);
%		\draw [in=135, out=-30] (66) to (69);
%		\draw [in=-90, out=120] (69) to (70.center);
%		\draw [in=45, out=-90] (71.center) to (69);
%		\draw (65.center) to (75.center);
%		\draw [in=270, out=90] (68.center) to (72.center);
%		\draw (71.center) to (74.center);
%		\draw [in=270, out=90] (70.center) to (73.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%$$
Therefore, the following two states in $\Stab_p$ have the same stabilizers
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (29) at (23, 0) {$G\left(\lfloor {f;g}\rfloor\right)$};
		\node [style=none] (30) at (22.25, 1.5) {};
		\node [style=none] (33) at (23.75, 1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-90] (30.center) to (29);
		\draw [in=-90, out=45] (29) to (33.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (21) at (175.25, -4.5) {$\lfloor g\rfloor$};
		\node [style=none] (22) at (174.5, -3.25) {};
		\node [style=X] (23) at (175.75, -3.5) {};
		\node [style=Z] (24) at (176.25, -3.5) {};
		\node [style=map] (25) at (176.75, -4.5) {$\lfloor f\rfloor$};
		\node [style=none] (26) at (177.5, -3.25) {};
		\node [style=none] (27) at (174.85, -2.5) {};
		\node [style=none] (28) at (177.1, -2.5) {};
		\node [style=none] (29) at (177.1, -2.5) {};
		\node [style=none] (30) at (174.85, -2.5) {};
		\node [style=none] (31) at (174.25, -2) {};
		\node [style=none] (32) at (177.75, -2) {};
		\node [style=none] (33) at (177.75, -5) {};
		\node [style=none] (34) at (174.25, -5) {};
		\node [style=none] (35) at (174.5, -4.75) {$G$};
		\node [style=none] (36) at (177.1, -1.5) {};
		\node [style=none] (37) at (174.85, -1.5) {};
		\node [style=otimes] (38) at (174.85, -2.5) {};
		\node [style=otimes] (39) at (177.1, -2.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-90] (22.center) to (21);
		\draw [in=-150, out=45] (21) to (24);
		\draw [in=-165, out=105, looseness=1.25] (21) to (23);
		\draw [in=-30, out=60, looseness=1.25] (25) to (24);
		\draw [in=135, out=-30] (23) to (25);
		\draw [in=45, out=-90] (26.center) to (25);
		\draw [in=-150, out=90] (22.center) to (30.center);
		\draw [in=-30, out=90] (26.center) to (29.center);
		\draw (32.center) to (31.center);
		\draw (31.center) to (34.center);
		\draw (34.center) to (33.center);
		\draw (33.center) to (32.center);
		\draw (37.center) to (30.center);
		\draw (36.center) to (29.center);
		\draw [in=75, out=-45] (30.center) to (21);
		\draw [in=105, out=-135] (29.center) to (25);
	\end{pgfonlayer}
\end{tikzpicture}\ ,
\hspace*{.5cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (40) at (179.75, -4) {$\lfloor g\rfloor$};
		\node [style=map] (44) at (181, -4) {$\lfloor f \rfloor$};
		\node [style=none] (46) at (179.35, -2.5) {};
		\node [style=none] (47) at (181.35, -2.5) {};
		\node [style=none] (48) at (181.35, -2.5) {};
		\node [style=none] (49) at (179.35, -2.5) {};
		\node [style=none] (50) at (178.75, -2) {};
		\node [style=none] (51) at (182, -2) {};
		\node [style=none] (52) at (182, -4.5) {};
		\node [style=none] (53) at (178.75, -4.5) {};
		\node [style=none] (54) at (179, -4.25) {$G$};
		\node [style=none] (55) at (181.35, -1.5) {};
		\node [style=none] (56) at (179.35, -1.5) {};
		\node [style=otimes] (57) at (179.35, -2.5) {};
		\node [style=otimes] (58) at (181.35, -2.5) {};
		\node [style=none] (59) at (180, -2.5) {};
		\node [style=none] (60) at (180.75, -2.5) {};
		\node [style=Z] (61) at (180.375, -1.5) {};
		\node [style=otimes] (62) at (180, -2.5) {};
		\node [style=otimes] (63) at (180.75, -2.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (51.center) to (50.center);
		\draw (50.center) to (53.center);
		\draw (53.center) to (52.center);
		\draw (52.center) to (51.center);
		\draw (56.center) to (49.center);
		\draw (55.center) to (48.center);
		\draw [in=75, out=-45] (49.center) to (40);
		\draw [in=105, out=-135] (48.center) to (44);
		\draw [bend right] (59.center) to (40);
		\draw [bend left] (60.center) to (44);
		\draw [bend right] (44) to (48.center);
		\draw [bend right] (49.center) to (40);
		\draw [in=-45, out=90] (60.center) to (61);
		\draw [in=90, out=-135] (61) to (59.center);
		\draw [bend left] (59.center) to (40);
		\draw [bend left] (44) to (60.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (64) at (204.5, 0) {$G\left(\lfloor g\rfloor \right)$};
		\node [style=none] (65) at (204, 1.25) {};
		\node [style=Z] (66) at (205.5, 1) {};
		\node [style=map] (67) at (206.5, 0) {$G\left(\lfloor f\rfloor\right)$};
		\node [style=none] (68) at (207, 1.25) {};
		\node [style=none] (69) at (207, 2.5) {};
		\node [style=none] (70) at (204, 2.5) {};
		\node [style=none] (71) at (206.25, 0) {};
		\node [style=none] (72) at (204.75, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-90] (65.center) to (64);
		\draw [in=45, out=-90] (68.center) to (67);
		\draw (65.center) to (70.center);
		\draw (68.center) to (69.center);
		\draw [in=-15, out=90] (71.center) to (66);
		\draw [in=90, out=-165] (66) to (72.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

And thus they are equal.
Therefore:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (295) at (233.75, 0) {$G\left(\lfloor {f;g}\rfloor \right)$};
		\node [style=none] (296) at (233, 1.5) {};
		\node [style=none] (297) at (234.5, 1) {};
		\node [style=Z] (298) at (234.5, 1) {};
		\node [style=none] (299) at (235, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=135, out=-90] (296.center) to (295);
		\draw [in=-135, out=45, looseness=0.75] (295) to (297.center);
		\draw [in=315, out=90, looseness=0.75] (299.center) to (298);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (259) at (222, 0) {$G\left(\lfloor g\rfloor \right)$};
		\node [style=map] (260) at (224, 0) {$G\left(\lfloor f\rfloor\right)$};
		\node [style=Z] (263) at (223, 1) {};
		\node [style=Z] (264) at (224.5, 1) {};
		\node [style=none] (265) at (223.75, 0) {};
		\node [style=none] (266) at (222.25, 0) {};
		\node [style=none] (267) at (221.75, 1) {};
		\node [style=none] (268) at (225, 0) {};
		\node [style=none] (269) at (225, -1) {};
		\node [style=none] (270) at (221.75, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (270.center) to (267.center);
		\draw [in=150, out=-90, looseness=0.75] (267.center) to (266.center);
		\draw [in=-150, out=30] (266.center) to (263);
		\draw [in=150, out=-30] (263) to (265.center);
		\draw [in=-150, out=30] (265.center) to (264);
		\draw [in=90, out=-30] (264) to (268.center);
		\draw (268.center) to (269.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{proof}





The novelty in interpreting stabilizer states in this categorical framework is that it reveals that the {\em relational composition} of tableaux is the composition of stabilizer circuits.


If we drop the affine shifts, we get a smaller fragment of stabilizer circuits:


\begin{corollary}
For odd prime $p$, $\Lag\Rel_{\F_p}$ is a presentation for Weyl-free quopit stabilizer circuits.
\end{corollary}

Bevcause of the reasons we mentioned earlier $\Aff\Lag\Rel_{\F_2}$ is not isomorphic to $\Stab_2$.  
However, only some generators cause this problem:

\begin{corollary}
\label{cor:nophase}
For any prime $p$, the image of $L(\LinRel_{\F_p}) \hookrightarrow \Aff\Lag\Rel_{\F_p}$ in addition to the symplectic Weyl operators can be interpreted in $\Stab_p$.
\end{corollary}

On the other hand $\Aff\Lag\Rel_{\F_2}$ has already been studied in other terms. Spekkens' first introduced his toy model as a noncontextual hidden variable alternative to qubit stabilizer quantum mechanics, satisfying the so-called ``knowledge-balance principle'' \cite{spekkens}.
Later, this was formalized in terms of symplectic geometry, where he showed that the pure states in the toy model are affine Lagrangian relations over $\F_2$ and the reversible evolution is given by affine symplectomorphisms: the knowledge balance principle corresponding to the preservation of the symplectic form \cite{spekkens2016quasi}.  Therefore:


\begin{corollary}
$\Aff\Lag\Rel_{\F_2}$ is a presentation for the pure states in Spekkens' qubit toy model.
\end{corollary}

In fact, this prop  already has a complete axiomatization in the literature in terms of ``the ZX-calculus'' for Spekkens' toy model \cite{backensspek}.  In fact, Spekkens' toy model has been worked out in all dimensions, thus subsuming the work of Gross for finite fields \cite{catani}. However, affine relations are only defined on fields (or at least principal ideal domains) not for example the rings $\Z/d\Z$ for $d$ not a prime.  Therefore, we can not give a relational account for nonprime dimensional stabilizer circuits/Spekkens' toy model.

There is another way to present $\Aff\Lag\Rel_{k}$ which makes it clear that $\Aff\Lag\Rel_{\F_p}$ can be regarded as a fragment of the ZX-calculus:

\begin{theorem}
$\Aff\Lag\Rel_{k}$ is generated by two spiders both decorated by the additive group of $k^2$ as well as scaling gates when $k$ is not a prime field:
$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=Z] (4) at (21.5, 3.75) {$a,b$};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {};
		\node [style=none] (8) at (21.5, 2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (9) at (231.75, 0.5) {};
		\node [style=none] (10) at (231.75, -3) {};
		\node [style=Z] (11) at (231, -2) {};
		\node [style=none] (12) at (231.32, -1.25) {$\cdots$};
		\node [style=none] (13) at (231, -2.5) {$\cdots$};
		\node [style=none] (14) at (230.75, 0.5) {};
		\node [style=none] (15) at (229.25, -3) {};
		\node [style=X] (16) at (230, -0.5) {$a$};
		\node [style=none] (17) at (230, 0) {$\cdots$};
		\node [style=none] (18) at (229.72, -1.25) {$\cdots$};
		\node [style=none] (19) at (230, -3) {};
		\node [style=none] (20) at (230.25, -3) {};
		\node [style=none] (21) at (229.25, 0.5) {};
		\node [style=none] (22) at (231, 0.5) {};
		\node [style=scalar] (23) at (230.5, -1.25) {$b$};
		\node [style=none] (24) at (230, 0.25) {};
		\node [style=none] (25) at (231, -2.75) {};
		\node [style=none] (26) at (229.7, -1.5) {};
		\node [style=none] (27) at (231.3, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-30, out=90] (10.center) to (11);
		\draw [in=-90, out=30, looseness=0.75] (11) to (9.center);
		\draw [in=90, out=-150] (16) to (15.center);
		\draw [in=-90, out=30] (16) to (14.center);
		\draw (19.center) to (16);
		\draw [in=-150, out=90] (20.center) to (11);
		\draw [in=-90, out=150] (16) to (21.center);
		\draw (11) to (22.center);
		\draw [in=-75, out=150] (11) to (23);
		\draw [in=330, out=90] (23) to (16);
	\end{pgfonlayer}
\end{tikzpicture},
\hspace*{.2cm}
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=X] (4) at (21.5, 3.75) {$a,b$};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {};
		\node [style=none] (8) at (21.5, 2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (232.75, 0.5) {};
		\node [style=none] (1) at (232.75, -3) {};
		\node [style=Z] (2) at (233.5, -2) {};
		\node [style=none] (3) at (233.25, -1.25) {$\cdots$};
		\node [style=none] (4) at (233.5, -2.5) {$\cdots$};
		\node [style=none] (5) at (233.75, 0.5) {};
		\node [style=none] (6) at (235.25, -3) {};
		\node [style=X] (7) at (234.5, -0.5) {$a$};
		\node [style=none] (8) at (234.5, 0) {$\cdots$};
		\node [style=none] (9) at (234.82, -1.25) {$\cdots$};
		\node [style=none] (10) at (234.5, -3) {};
		\node [style=none] (11) at (234.25, -3) {};
		\node [style=none] (12) at (235.25, 0.5) {};
		\node [style=none] (13) at (233.5, 0.5) {};
		\node [style=scalar] (14) at (234, -1.25) {$b$};
		\node [style=none] (15) at (233.25, -1) {};
		\node [style=none] (16) at (234.5, 0.25) {};
		\node [style=none] (17) at (233.5, -2.75) {};
		\node [style=none] (18) at (234.78, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-150, out=90] (1.center) to (2);
		\draw [in=-90, out=150, looseness=0.75] (2) to (0.center);
		\draw [in=90, out=-30] (7) to (6.center);
		\draw [in=-90, out=150] (7) to (5.center);
		\draw (10.center) to (7);
		\draw [in=-30, out=90] (11.center) to (2);
		\draw [in=-90, out=30] (7) to (12.center);
		\draw (2) to (13.center);
		\draw [in=-105, out=30] (2) to (14);
		\draw [in=-150, out=90] (14) to (7);
	\end{pgfonlayer}
\end{tikzpicture}
,
\hspace*{.2cm}
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (23, 4.5) {};
		\node [style=none] (1) at (23, 3) {};
		\node [style=scalar] (2) at (23, 3.75) {$a$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2);
		\draw (2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24.25, 4.5) {};
		\node [style=none] (4) at (24.25, 3) {};
		\node [style=scalarop] (5) at (24.25, 3.75) {$a$};
		\node [style=none] (6) at (25, 4.5) {};
		\node [style=none] (7) at (25, 3) {};
		\node [style=scalar] (8) at (25, 3.75) {$a$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4.center) to (5);
		\draw (5) to (3.center);
		\draw (7.center) to (8);
		\draw (8) to (6.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

Where we recall that Fourier transform derived from the decomposition we discussed in the previous section:
$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.25, -1) {};
		\node [style=map] (1) at (1.25, -1.5) {$\mathcal F$};
		\node [style=none] (2) at (1.25, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (1);
		\draw (1) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0.5, 1) {};
		\node [style=none] (1) at (0.5, -0.25) {};
		\node [style=none] (2) at (1, -0.25) {};
		\node [style=none] (3) at (1, 1) {};
		\node [style=s] (4) at (1, 0.5) {};
		\node [style=none] (5) at (0.5, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4) to (3.center);
		\draw [in=90, out=-90] (4) to (1.center);
		\draw [in=-90, out=90] (2.center) to (5.center);
		\draw (5.center) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (19.5, 1.25) {};
		\node [style=Z] (1) at (18, 4.25) {};
		\node [style=none] (2) at (18, 4.75) {};
		\node [style=none] (3) at (19.5, 4.75) {};
		\node [style=none] (4) at (18, 0.75) {};
		\node [style=none] (5) at (19.5, 0.75) {};
		\node [style=X] (6) at (19.5, 1.25) {};
		\node [style=Z] (7) at (19.5, 4.25) {};
		\node [style=X] (8) at (18, 1.25) {};
		\node [style=Z] (9) at (18, 4.25) {};
		\node [style=X] (10) at (19.5, 1.25) {};
		\node [style=X] (11) at (18, 1.25) {};
		\node [style=X] (12) at (19.5, 1.25) {};
		\node [style=Z] (13) at (19.5, 4.25) {};
		\node [style=s] (14) at (17.75, 3) {};
		\node [style=s] (15) at (18.75, 3) {};
		\node [style=s] (16) at (19.75, 3) {};
		\node [style=s] (17) at (18.25, 3) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (1);
		\draw (5.center) to (0);
		\draw [bend right=45] (6) to (7);
		\draw [in=135, out=-135, looseness=1.25] (9) to (8);
		\draw (3.center) to (7);
		\draw (4.center) to (8);
		\draw [in=-120, out=15, looseness=0.75] (11) to (13);
		\draw [in=90, out=-105] (9) to (14);
		\draw [in=90, out=-45, looseness=0.75] (9) to (15);
		\draw [in=90, out=-90] (14) to (11);
		\draw [in=-90, out=120, looseness=0.75] (6) to (15);
		\draw [in=-15, out=90] (12) to (9);
		\draw [in=-90, out=150, looseness=0.75] (12) to (17);
		\draw [in=285, out=90] (17) to (9);
		\draw [in=-90, out=75, looseness=0.75] (12) to (16);
		\draw [in=-75, out=90] (16) to (13);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 0.75) {};
		\node [style=none] (1) at (0.75, 0.75) {};
		\node [style=none] (2) at (0, 3.25) {};
		\node [style=none] (3) at (0.75, 3.25) {};
		\node [style=Z] (4) at (0.75, 1.25) {};
		\node [style=X] (5) at (0, 1.75) {};
		\node [style=Z] (6) at (0.75, 2.25) {};
		\node [style=X] (7) at (0, 2.75) {};
		\node [style=Z] (8) at (0, 2.25) {};
		\node [style=X] (9) at (0.75, 1.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4) to (5);
		\draw (6) to (7);
		\draw (8) to (9);
		\draw (1.center) to (4);
		\draw (4) to (9);
		\draw (9) to (6);
		\draw (6) to (3.center);
		\draw (2.center) to (7);
		\draw (7) to (8);
		\draw (8) to (5);
		\draw (5) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\left\llbracket
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.25, 0) {};
		\node [style=none] (1) at (1.25, -3.5) {};
		\node [style=Z] (2) at (1.25, -2.75) {$\hspace*{.05cm}0,1\hspace*{.05cm}$};
		\node [style=Z] (3) at (1.25, -0.75) {$\hspace*{.05cm}0,1\hspace*{.05cm}$};
		\node [style=X] (4) at (1.25, -1.75) {$\hspace*{.05cm}0,-1\hspace*{.05cm}$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2);
		\draw (2) to (4);
		\draw (4) to (3);
		\draw (3) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\right\rrbracket
$$

In the ZX-calculus literature, this decomposition of the Fourier transform is known as {\it Euler decomposition} \cite{duncan2009graph}.  To my knowledge, this way in which Hopf algebras are used to derive the Euler decomoposition was not previously known.  Although in the quantum literature, this same rule describes the ``external'' interaction of ${\cal C}_{\cal X}$ gates (as opposed to the ``internal'' interaction of phases).



%Transporting the complex conjugation along the isomorphism $\Aff\Lag\Rel_k \cong \Stab_p$ yields a conjugation functor $\Aff\Lag\Rel_k\to \Aff\Lag\Rel_k$ such that:

%In $\Stab_p$ the spiders are linear maps:
%
%$$
%\left\llbracket
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (0) at (21, 5) {};
%		\node [style=none] (1) at (22, 5) {};
%		\node [style=none] (2) at (21, 2.5) {};
%		\node [style=none] (3) at (22, 2.5) {};
%		\node [style=Z] (4) at (21.5, 3.75) {$\hspace*{.05cm}n,m\hspace*{.05cm}$};
%		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
%		\node [style=none] (6) at (21.5, 3) {$\cdots$};
%		\node [style=none] (7) at (21.5, 4.75) {};
%		\node [style=none] (8) at (21.5, 2.75) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
%		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
%		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
%		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%\right\rrbracket
%=
%\sum{}
%$$
%
%
%
%GIVE ACTION OF COMPLEX CONJUGATION
\end{theorem}






The spider fusion is pointwise:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.5, -0.5) {};
		\node [style=none] (1) at (0.5, -0.5) {};
		\node [style=none] (2) at (1, -0.5) {$\cdots$};
		\node [style=none] (3) at (0.5, -2.75) {};
		\node [style=Z] (4) at (1, -1.25) {$n,m$};
		\node [style=none] (5) at (2, -0.5) {};
		\node [style=none] (6) at (1.5, -2.75) {$\cdots$};
		\node [style=none] (7) at (1, -2.75) {};
		\node [style=Z] (8) at (1.5, -2) {$k,\ell$};
		\node [style=none] (9) at (2, -2.75) {};
		\node [style=none] (10) at (1.25, -1.5) {\reflectbox{$\ddots$}};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-124, out=90] (3.center) to (4);
		\draw [in=-90, out=56] (4) to (0.center);
		\draw [in=124, out=-90] (1.center) to (4);
		\draw [in=-124, out=90] (7.center) to (8);
		\draw [in=90, out=-56] (8) to (9.center);
		\draw [in=-90, out=56] (8) to (5.center);
		\draw [bend left=45, looseness=1.25] (8) to (4);
		\draw [bend left=45, looseness=1.25] (4) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (11) at (4, -0.5) {};
		\node [style=none] (12) at (3, -0.5) {};
		\node [style=none] (13) at (3.5, -0.5) {$\cdots$};
		\node [style=none] (14) at (2.5, -2) {};
		\node [style=none] (15) at (3.5, -1.25) {};
		\node [style=none] (16) at (4.5, -0.5) {};
		\node [style=none] (17) at (3.5, -2) {$\cdots$};
		\node [style=none] (18) at (3, -2) {};
		\node [style=Z] (19) at (3.5, -1.25) {$n+k,m+\ell$};
		\node [style=none] (20) at (4, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-150, out=90] (14.center) to (15);
		\draw [in=-90, out=56] (15) to (11.center);
		\draw [in=124, out=-90] (12.center) to (15);
		\draw [in=-124, out=90] (18.center) to (19);
		\draw [in=90, out=-56] (19) to (20.center);
		\draw [in=-90, out=30] (19) to (16.center);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{1cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.5, -0.5) {};
		\node [style=none] (1) at (0.5, -0.5) {};
		\node [style=none] (2) at (1, -0.5) {$\cdots$};
		\node [style=none] (3) at (0.5, -2.75) {};
		\node [style=X] (4) at (1, -1.25) {$n,m$};
		\node [style=none] (5) at (2, -0.5) {};
		\node [style=none] (6) at (1.5, -2.75) {$\cdots$};
		\node [style=none] (7) at (1, -2.75) {};
		\node [style=X] (8) at (1.5, -2) {$k,\ell$};
		\node [style=none] (9) at (2, -2.75) {};
		\node [style=none] (10) at (1.25, -1.5) {\reflectbox{$\ddots$}};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-124, out=90] (3.center) to (4);
		\draw [in=-90, out=56] (4) to (0.center);
		\draw [in=124, out=-90] (1.center) to (4);
		\draw [in=-124, out=90] (7.center) to (8);
		\draw [in=90, out=-56] (8) to (9.center);
		\draw [in=-90, out=56] (8) to (5.center);
		\draw [bend left=45, looseness=1.25] (8) to (4);
		\draw [bend left=45, looseness=1.25] (4) to (8);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (11) at (4, -0.5) {};
		\node [style=none] (12) at (3, -0.5) {};
		\node [style=none] (13) at (3.5, -0.5) {$\cdots$};
		\node [style=none] (14) at (2.5, -2) {};
		\node [style=none] (15) at (3.5, -1.25) {};
		\node [style=none] (16) at (4.5, -0.5) {};
		\node [style=none] (17) at (3.5, -2) {$\cdots$};
		\node [style=none] (18) at (3, -2) {};
		\node [style=X] (19) at (3.5, -1.25) {$n+k,m+\ell$};
		\node [style=none] (20) at (4, -2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-150, out=90] (14.center) to (15);
		\draw [in=-90, out=56] (15) to (11.center);
		\draw [in=124, out=-90] (12.center) to (15);
		\draw [in=-124, out=90] (18.center) to (19);
		\draw [in=90, out=-56] (19) to (20.center);
		\draw [in=-90, out=30] (19) to (16.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

Call the first component of the phase group the {\bf affine phase} and the second component the {\bf linear phase}.  The white spider corresponds to the $Z$-basis and the grey spider corresponds to the $X$-basis.



In Hilbert spaces, the spiders $\ell \to k$ are interpreted as follows:

\begin{align*}
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=none] (4) at (21.5, 3.75) {};
		\node [style=Z] (40) at (21.5, 3.75) {$n,m$};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {};
		\node [style=none] (8) at (21.5, 2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
= &
\sum_{a=0}^{p-1}  e^{\pi\cdot i /p (n\cdot a+m\cdot a^2)} |a, \ldots, a \rangle \langle a, \ldots, a|\\
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=none] (4) at (21.5, 3.75) {};
		\node [style=X] (40) at (21.5, 3.75) {$n,m$};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {};
		\node [style=none] (8) at (21.5, 2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
= &
\sum_{a=0}^{p-1}  e^{\pi\cdot i /p (n\cdot a+m\cdot a^2)} \mathcal{F}^{\otimes k}|a, \ldots, a \rangle \langle a, \ldots, a|(\mathcal{F}^\dag)^{\otimes \ell} \\
\end{align*}

Where we recall the interpretation of the scaling gate:

$$
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (23, 4.5) {};
		\node [style=none] (1) at (23, 3) {};
		\node [style=scalar] (2) at (23, 3.75) {$b$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2);
		\draw (2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \right\rrbracket
=
\sum_{a=0}^{p-1} |a\cdot b \rangle \langle a |
$$

This view of quopit stabilizer circuits in terms of the ZX-calculus, means that the phase groups for the $Z$ and $X$-spiders are the torus $(\Z/p\Z)^2$  as noted \cite[Page 166]{ranchin2016alternative}.  This is in contrast to the qubit case where the phase groups are $\Z/4\Z$; which \cite{coecke2011phase} point out as a crucial difference between Spekkens' toy model and qubit stabilizer theory.

However, the restricted class of circuits described in Corollary \ref{cor:nophase} is the fragment of the stabilizer ZX-calculus where in the qubit case, the phases are in the subgroup
$$\Z/2\Z\subseteq \Z/4\Z; \ a\mapsto 2a$$
In the quopit case, they are in the subgroup
$$\Z/p\Z \subseteq (\Z/p\Z)^2; \ a\mapsto (a,0)$$
The interpretation in $\Stab_p$ of the spiders decorated  by  subgroups both agree for the qubits and quopits.  Therefore can think of them both as affine Lagrangian spiders with trivial linear phases.


Up until now, we have also neglected to relate the symplectic picture to the \dag-structure of $\FHilb$:


\begin{definition}
There is a monoidal conjugation functor $\bar{(-)}:\Aff\Lag\Rel_k\to \Aff\Lag\Rel_k$ given by:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=none] (4) at (21.5, 3.75) {};
		\node [style=Z] (40) at (21.5, 3.75) {$n,m$};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {};
		\node [style=none] (8) at (21.5, 2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (20.75, 5) {};
		\node [style=none] (1) at (22.25, 5) {};
		\node [style=none] (2) at (20.75, 2.5) {};
		\node [style=none] (3) at (22.25, 2.5) {};
		\node [style=none] (4) at (21.5, 3.75) {};
		\node [style=none] (5) at (21.5, 4.75) {$\cdots$};
		\node [style=none] (6) at (21.5, 2.75) {$\cdots$};
		\node [style=Z] (9) at (21.5, 3.75) {$-n,-m $};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\ ,
\hspace*{1cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 5) {};
		\node [style=none] (1) at (22, 5) {};
		\node [style=none] (2) at (21, 2.5) {};
		\node [style=none] (3) at (22, 2.5) {};
		\node [style=none] (4) at (21.5, 3.75) {};
		\node [style=X] (40) at (21.5, 3.75) {$n,m$};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
		\node [style=none] (7) at (21.5, 4.75) {};
		\node [style=none] (8) at (21.5, 2.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (20.75, 5) {};
		\node [style=none] (1) at (22.25, 5) {};
		\node [style=none] (2) at (20.75, 2.5) {};
		\node [style=none] (3) at (22.25, 2.5) {};
		\node [style=none] (4) at (21.5, 3.75) {};
		\node [style=none] (5) at (21.5, 4.75) {$\cdots$};
		\node [style=none] (6) at (21.5, 2.75) {$\cdots$};
		\node [style=none] (9) at (21.5, 3.75) {};
		\node [style=X] (90) at (21.5, 3.75) {$n,-m$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\ ,
\hspace*{1cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (23, 4.5) {};
		\node [style=none] (1) at (23, 3) {};
		\node [style=scalar] (2) at (23, 3.75) {$a$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2);
		\draw (2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (23, 4.5) {};
		\node [style=none] (1) at (23, 3) {};
		\node [style=scalar] (2) at (23, 3.75) {$a$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (2);
		\draw (2) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{definition}

In the case of $k=\F_p$ for $p$ an odd prime, this is transported to the complex conjugation along $\Aff\Lag\Rel_{\F_p} \cong \Stab_p$:



\begin{lemma}
For odd prime $p$, $\Aff\Lag\Rel_{\F_p}$ and  $\Stab_p$ are isomorphic as \dag-compact closed categories.
\end{lemma}

The proof follows by checking the action of the complex conjugation on the generators.



\begin{remark}
 In \cite{network}, the relational semantics of electrical circuits is broaded even further to capture current and voltage sources as affine Lagrangian relations over $\R(s)$.  We can restate the interpretation of passive electrical circuits in our string diagrams. An idealized junction, a resistor with resistance $r$, a capacitor with capacitance $c$ and an inductor with inductance $\ell$ are interpreted as follows:

$$
\left\llbracket\ 
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 4.75) {};
		\node [style=none] (1) at (22, 4.75) {};
		\node [style=none] (2) at (21, 2.75) {};
		\node [style=none] (3) at (22, 2.75) {};
		\node [style=dot] (4) at (21.5, 3.75) {};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 4.75) {};
		\node [style=none] (1) at (22, 4.75) {};
		\node [style=none] (2) at (21, 2.75) {};
		\node [style=none] (3) at (22, 2.75) {};
		\node [style=Z] (4) at (21.5, 3.75) {};
		\node [style=none] (5) at (21.5, 4.5) {$\cdots$};
		\node [style=none] (6) at (21.5, 3) {$\cdots$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=150, out=-90, looseness=0.75] (0.center) to (4);
		\draw [in=90, out=-150, looseness=0.75] (4) to (2.center);
		\draw [in=-30, out=90, looseness=0.75] (3.center) to (4);
		\draw [in=-90, out=30, looseness=0.75] (4) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ ,\hspace*{.2cm}
\left\llbracket
\tikz \draw (0,0) to[R=$r$] (0,2);
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 4.75) {};
		\node [style=none] (2) at (21, 2.75) {};
		\node [style=X] (4) at (21, 3.75) {$0,r$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (4);
		\draw (4) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ ,\hspace*{.2cm}
\left\llbracket
\tikz \draw (0,0) to[C=$c$] (0,2);
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 4.75) {};
		\node [style=none] (2) at (21, 2.75) {};
		\node [style=X] (4) at (21, 3.75) {$0,cs$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (4);
		\draw (4) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\ ,\hspace*{.2cm}
\left\llbracket
\tikz \draw (0,0) to[L=$\ell$] (0,2);
\ \right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 4.75) {};
		\node [style=none] (2) at (21, 2.75) {};
		\node [style=Z] (4) at (21, 3.75) {$0,-1/(\ell s)$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (4);
		\draw (4) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

A voltage source is a component with a fixed voltage $v$,  imposes the affine Lagrangian relation:
$$
\left\{\
\left(
\begin{bmatrix}
z_0 \\ x_0
\end{bmatrix},
\begin{bmatrix}
z_1 \\ x_1
\end{bmatrix}
\right)
  \in \R(s)^{2(2)}\ |\ x_1-x_0=v, z_1=z_0 \ \right\}
$$

So that it is interpreted as the phased-spider:
$$
\left\llbracket
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 2) {};
		\node [style=isourceAMshape,rotate=90] (1) at (0, 1) {};
		\node [style=none] (2) at (0, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (1);
		\draw (1) to (0.center);
		\node [style=none] (3) at (-.7, 1) {$v$};
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{.3cm}
\right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (21, 4.75) {};
		\node [style=none] (2) at (21, 2.75) {};
		\node [style=X] (4) at (21, 3.75) {$v, 0$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (4);
		\draw (4) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

Similarly a current source has a fixed current $I$, imposing the affine Lagrangian relation:

$$
\left\{\
\left(
\begin{bmatrix}
z_0 \\ x_0
\end{bmatrix},
\begin{bmatrix}
z_1 \\ x_1
\end{bmatrix}
\right)
  \in \R(s)^{2(2)} \ |\ z_0=I=z_1\ \right\}
$$

So that it is interpreted as the following diagram:

$$
\left\llbracket
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0, 2) {};
		\node [style=vsourceAMshape,rotate=-90] (1) at (0, 1) {};
		\node [style=none] (2) at (0, 0) {};
		\node [style=none] (3) at (-.7, 1) {$I$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (1);
		\draw (1) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{.3cm}
\right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (13) at (26.5, 4.25) {$0,I$};
		\node [style=Z] (14) at (26.5, 2.75) {$0,1/I$};
		\node [style=none] (15) at (26.5, 5.2) {};
		\node [style=none] (16) at (26.5, 1.8) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (16.center) to (14);
		\draw (13) to (15.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\end{remark}


%
%
%Affine Lagrangian relations have been used as a semantics for certain classes of electrical circuits:
%\begin{example}
%\label{ex:circuits}
%TODO: MUCH MORE EXPOSITION, CITATIONS
%
%For any non-negative real $a$, wires, $a$-weighted resistors, inductors and capacitors have the following interpretations in $\Aff\Lag\Rel_{\mathbb{R}(x)}$:
%$$
%\left\llbracket
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (0) at (21, 4.25) {};
%		\node [style=none] (1) at (22, 4.25) {};
%		\node [style=none] (2) at (21, 2.75) {};
%		\node [style=none] (3) at (22, 2.75) {};
%		\node [style=dot] (4) at (21.5, 3.5) {};
%		\node [style=none] (5) at (21.5, 4) {$\cdots$};
%		\node [style=none] (6) at (21.5, 3) {$\cdots$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=150, out=-90] (0.center) to (4);
%		\draw [in=90, out=-150] (4) to (2.center);
%		\draw [in=-30, out=90] (3.center) to (4);
%		\draw [in=-90, out=30] (4) to (1.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%\right\rrbracket
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (501) at (237.5, 4.25) {};
%		\node [style=none] (502) at (238.5, 4.25) {};
%		\node [style=none] (503) at (237.5, 2.75) {};
%		\node [style=none] (504) at (238.5, 2.75) {};
%		\node [style=X] (505) at (238, 3.5) {};
%		\node [style=none] (506) at (238, 4) {$\cdots$};
%		\node [style=none] (507) at (238, 3) {$\cdots$};
%		\node [style=none] (508) at (236.25, 4.25) {};
%		\node [style=none] (509) at (237.25, 4.25) {};
%		\node [style=none] (510) at (236.25, 2.75) {};
%		\node [style=none] (511) at (237.25, 2.75) {};
%		\node [style=Z] (512) at (236.75, 3.5) {};
%		\node [style=none] (513) at (236.75, 4) {$\cdots$};
%		\node [style=none] (514) at (236.75, 3) {$\cdots$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=150, out=-90] (501.center) to (505);
%		\draw [in=90, out=-150] (505) to (503.center);
%		\draw [in=-30, out=90] (504.center) to (505);
%		\draw [in=-90, out=30] (505) to (502.center);
%		\draw [in=150, out=-90] (508.center) to (512);
%		\draw [in=90, out=-150] (512) to (510.center);
%		\draw [in=-30, out=90] (511.center) to (512);
%		\draw [in=-90, out=30] (512) to (509.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%\hspace*{.5cm}
%\left\llbracket
%\tikz \draw (0,0) to[R=$a$] (0,2);
%\hspace*{,3cm}
%\right\rrbracket
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=Z] (0) at (23, 3.75) {};
%		\node [style=X] (1) at (22, 5.25) {};
%		\node [style=scalar] (2) at (22.5, 4.5) {$a$};
%		\node [style=none] (3) at (22, 5.75) {};
%		\node [style=none] (4) at (23, 5.75) {};
%		\node [style=none] (5) at (23, 3.25) {};
%		\node [style=none] (6) at (22, 3.25) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=-90, out=135] (0) to (2);
%		\draw [in=315, out=90] (2) to (1);
%		\draw (1) to (3.center);
%		\draw (1) to (6.center);
%		\draw (5.center) to (0);
%		\draw (4.center) to (0);
%	\end{pgfonlayer}
%\end{tikzpicture}
%$$
%$$
%\left\llbracket
%\tikz \draw (0,0) to[L=$a$] (0,2);
%\right\rrbracket
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=Z] (0) at (23, 3.75) {};
%		\node [style=X] (1) at (22, 5.25) {};
%		\node [style=scalar] (2) at (22.5, 4.5) {$ax$};
%		\node [style=none] (3) at (22, 5.75) {};
%		\node [style=none] (4) at (23, 5.75) {};
%		\node [style=none] (5) at (23, 3.25) {};
%		\node [style=none] (6) at (22, 3.25) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=-90, out=135] (0) to (2);
%		\draw [in=315, out=90] (2) to (1);
%		\draw (1) to (3.center);
%		\draw (1) to (6.center);
%		\draw (5.center) to (0);
%		\draw (4.center) to (0);
%	\end{pgfonlayer}
%\end{tikzpicture}
%\hspace*{.5cm}
%\left\llbracket
%\tikz \draw (0,0) to[C=$a$] (0,2);
%\hspace*{,3cm}
%\right\rrbracket
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=Z] (0) at (23.25, 3.75) {};
%		\node [style=X] (1) at (21.75, 5.25) {};
%		\node [style=scalar] (2) at (22.5, 4.5) {$-ax$};
%		\node [style=none] (3) at (21.75, 5.75) {};
%		\node [style=none] (4) at (23.25, 5.75) {};
%		\node [style=none] (5) at (23.25, 3.25) {};
%		\node [style=none] (6) at (21.75, 3.25) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=-90, out=135] (0) to (2);
%		\draw [in=315, out=90] (2) to (1);
%		\draw (1) to (3.center);
%		\draw (1) to (6.center);
%		\draw (5.center) to (0);
%		\draw (4.center) to (0);
%	\end{pgfonlayer}
%\end{tikzpicture}
%$$
%Similarly for $a$-valued voltage and current sources (again, for $a$ a non-negative real number):
%$$
%\left\llbracket
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (0) at (0, 2) {};
%		\node [style=isourceAMshape,rotate=90] (1) at (0, 1) {};
%		\node [style=none] (2) at (0, 0) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (2.center) to (1);
%		\draw (1) to (0.center);
%		\node [style=none] (3) at (-.7, 1) {$a$};
%	\end{pgfonlayer}
%\end{tikzpicture}
%\hspace*{,3cm}
%\right\rrbracket
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=X] (1) at (22, 5.25) {};
%		\node [style=scalar] (2) at (22.5, 4.5) {$ax$};
%		\node [style=none] (3) at (22, 5.75) {};
%		\node [style=none] (4) at (23, 5.75) {};
%		\node [style=none] (5) at (23, 3.25) {};
%		\node [style=none] (6) at (22, 3.25) {};
%		\node [style=X] (7) at (22.5, 3.75) {$1$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw [in=315, out=90] (2) to (1);
%		\draw (1) to (3.center);
%		\draw (1) to (6.center);
%		\draw (7) to (2);
%		\draw (5.center) to (4.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=X] (32) at (129.25, -0.25) {$ax$};
%		\node [style=none] (33) at (129.25, 1) {};
%		\node [style=none] (34) at (129.75, 1) {};
%		\node [style=none] (35) at (129.75, -1.5) {};
%		\node [style=none] (36) at (129.25, -1.5) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (32) to (33.center);
%		\draw (32) to (36.center);
%		\draw (35.center) to (34.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%$$
%$$
%\left\llbracket
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (0) at (0, 2) {};
%		\node [style=vsourceAMshape,rotate=-90] (1) at (0, 1) {};
%		\node [style=none] (2) at (0, 0) {};
%		\node [style=none] (3) at (-.7, 1) {$a$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (2.center) to (1);
%		\draw (1) to (0.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%\hspace*{,3cm}
%\right\rrbracket
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (28) at (9, 1) {};
%		\node [style=none] (29) at (10, 1) {};
%		\node [style=none] (30) at (10, -1.5) {};
%		\node [style=none] (31) at (9, -1.5) {};
%		\node [style=Z] (32) at (9, 0.25) {};
%		\node [style=Z] (33) at (9, -0.75) {};
%		\node [style=X] (34) at (9.5, -1.25) {$1$};
%		\node [style=scalar] (35) at (9.5, -0.5) {$a$};
%		\node [style=Z] (36) at (10, 0.5) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (31.center) to (33);
%		\draw (32) to (28.center);
%		\draw (36) to (29.center);
%		\draw [in=90, out=-150] (36) to (35);
%		\draw (35) to (34);
%		\draw (30.center) to (36);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (37) at (11, 1) {};
%		\node [style=none] (38) at (12, 1) {};
%		\node [style=none] (39) at (12, -1.5) {};
%		\node [style=none] (40) at (11, -1.5) {};
%		\node [style=Z] (41) at (11, 0.25) {};
%		\node [style=Z] (42) at (11, -0.75) {};
%		\node [style=X] (43) at (11.5, -1.25) {$1$};
%		\node [style=Z] (45) at (12, -0.25) {};
%		\node [style=scalar] (46) at (12, 0.5) {$a$};
%		\node [style=scalarop] (47) at (12, -1) {$a$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (40.center) to (42);
%		\draw (41) to (37.center);
%		\draw (45) to (46);
%		\draw (46) to (38.center);
%		\draw [in=-150, out=90] (43) to (45);
%		\draw (39.center) to (47);
%		\draw (47) to (45);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (73) at (17, 0.75) {};
%		\node [style=none] (74) at (17.75, 0.75) {};
%		\node [style=none] (75) at (17.75, -2) {};
%		\node [style=none] (76) at (17, -2) {};
%		\node [style=Z] (77) at (17, 0.25) {};
%		\node [style=Z] (78) at (17, -0.5) {};
%		\node [style=X] (79) at (17.75, 0.25) {$a$};
%		\node [style=scalarop] (80) at (17.75, -1.5) {$a$};
%		\node [style=X] (83) at (17.75, -0.5) {$1$};
%		\node [style=s] (84) at (17.75, -1) {};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (76.center) to (78);
%		\draw (77) to (73.center);
%		\draw [in=-90, out=90] (75.center) to (80);
%		\draw (79) to (74.center);
%		\draw (84) to (83);
%		\draw [in=-90, out=90] (80) to (84);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (16) at (19.25, 1.25) {};
%		\node [style=none] (17) at (20.25, 1.25) {};
%		\node [style=none] (18) at (20.25, -1.5) {};
%		\node [style=none] (19) at (19.25, -1.5) {};
%		\node [style=Z] (20) at (19.25, 0.25) {};
%		\node [style=Z] (21) at (19.25, -0.5) {};
%		\node [style=X] (22) at (20.25, 0.25) {$1$};
%		\node [style=X] (23) at (20.25, -0.5) {$1$};
%		\node [style=scalarop] (24) at (20.25, -1) {$-a$};
%		\node [style=scalar] (25) at (19.25, -1) {$-a$};
%		\node [style=scalar] (26) at (20.25, 0.75) {$a$};
%		\node [style=scalarop] (27) at (19.25, 0.75) {$a$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (18.center) to (24);
%		\draw (24) to (23);
%		\draw (21) to (25);
%		\draw (19.center) to (25);
%		\draw (20) to (27);
%		\draw (27) to (16.center);
%		\draw (22) to (26);
%		\draw (26) to (17.center);
%	\end{pgfonlayer}
%\end{tikzpicture}
%=
%\begin{tikzpicture}
%	\begin{pgfonlayer}{nodelayer}
%		\node [style=none] (602) at (268.25, 1.75) {};
%		\node [style=none] (603) at (269, 1.75) {};
%		\node [style=none] (604) at (269, -1) {};
%		\node [style=none] (605) at (267.25, -1) {};
%		\node [style=Z] (606) at (268.25, 0.75) {};
%		\node [style=Z] (607) at (267.75, 0.25) {};
%		\node [style=X] (608) at (269, 0.75) {$1$};
%		\node [style=X] (609) at (269.5, 0.25) {};
%		\node [style=scalarop] (610) at (269, -0.5) {$-a$};
%		\node [style=scalar] (611) at (267.25, -0.5) {$-a$};
%		\node [style=scalar] (612) at (269, 1.25) {$a$};
%		\node [style=scalarop] (613) at (268.25, 1.25) {$a$};
%		\node [style=Z] (614) at (268.25, -0.5) {};
%		\node [style=X] (615) at (270, -0.5) {$1$};
%	\end{pgfonlayer}
%	\begin{pgfonlayer}{edgelayer}
%		\draw (604.center) to (610);
%		\draw [in=-150, out=90] (610) to (609);
%		\draw [in=90, out=-150] (607) to (611);
%		\draw (605.center) to (611);
%		\draw (606) to (613);
%		\draw (613) to (602.center);
%		\draw (608) to (612);
%		\draw (612) to (603.center);
%		\draw [in=-30, out=90] (615) to (609);
%		\draw [in=-30, out=90] (614) to (607);
%	\end{pgfonlayer}
%\end{tikzpicture}
%$$
%\end{example}
%Note that these generators do not generate the whole category of Lagrangian relations; for instance, the coefficients are required to be non-negative.




\section{Affine coisotropic relations and stabilizer codes}
\label{sec:coisotrel}
\label{sec:coisot}


In this section we show that by only requiring that the morphisms are affine {\em coisotropic} subspaces   (subspaces $V$ so that $V^\omega \subseteq V$) instead of affine Lagrangian subspaces (where $V^\omega= V$), we can capture the maximally mixed state/discarding; with which we can recover state preparation and measurement compositionally.


\begin{theorem}[Relational purification]~\\
The prop $\Isot\Rel_k$ of isotropic relations is generated by adding the doubled zero relation to the image of the forgetful functor $\Lag\Rel_k\to\LinRel_k$, ie. the following generator in $\LinRel_k$:
$
\begin{tikzpicture}[scale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, 0.5) {};
		\node [style=X] (1) at (1, 0.5) {};
		\node [style=none] (2) at (0.5, 0) {};
		\node [style=none] (3) at (1, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
$
\end{theorem}
\begin{proof}
This generator is an isotropic subspace of $(k^{2n},\omega)$ since:
$$
\left(
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, 0.5) {};
		\node [style=X] (1) at (1, 0.5) {};
		\node [style=none] (2) at (0.5, 0) {};
		\node [style=none] (3) at (1, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\right)^\omega
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (0.5, 0.5) {};
		\node [style=Z] (1) at (1, 0.5) {};
		\node [style=none] (2) at (0.5, 0) {};
		\node [style=none] (3) at (1, 0) {};
		\node [style=s] (4) at (1, 0) {};
		\node [style=none] (5) at (1, -0.75) {};
		\node [style=none] (7) at (0.5, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (0) to (2.center);
		\draw [in=270, out=90] (7.center) to (4.center);
		\draw [in=90, out=-90] (2.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (0.5, 0.5) {};
		\node [style=Z] (1) at (1, 0.5) {};
		\node [style=none] (2) at (0.5, 0) {};
		\node [style=none] (3) at (1, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
\supset
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, 0.5) {};
		\node [style=X] (1) at (1, 0.5) {};
		\node [style=none] (2) at (0.5, 0) {};
		\node [style=none] (3) at (1, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (3.center);
		\draw (0) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$



Suppose that we have an isotropic subspace $V$ of $(k^{2n},\omega)$ with dimension $n-1$. 

By applying Fourier transforms, we obtain a symplectomorphic subspace generated by a matrix whose pivots are all in the $Z$ block.  Therefore, we can row reduce this matrix to obtain one of the following form:

$$
\left[\begin{array}{cc|cc}
I_{n-1} & Z_B & X_A & X_B 
\end{array}\right]
$$

By applying controlled-{\cal X} gates from the first $n-1$ wires to the last wire, we obtain an isotropic subspace $V'\cong V$ generated by a matrix of the following form:


$$
\left[\begin{array}{cc|cc}
I_{n-1} & 0 & X_A' & X_B' 
\end{array}\right]
$$

Since all of the rows of this subspace are orthogonal with respect to the symplectic form, we have:

\begin{align*}
0 &=
\left[\begin{array}{cc|cc}
I_{n-1} & 0 & X_A' & X_B' 
\end{array}\right]
\omega
\left[\begin{array}{cc|cc}
I_{n-1} & 0 & X_A' & X_B' 
\end{array}\right]^T\\
&=
\left[\begin{array}{cc|cc}
I_{n-1} & 0 & X_A' & X_B' 
\end{array}\right]
\left[\begin{array}{cc|cc}
 -X_A' & -X_B'  & I_{n-1} & 0
\end{array}\right]^T\\
&=
I_{n-1}(-X_A')^T +  0( -X_B' )^T +X_A'I_{n-1} + X_B' 0 \\
&=
(-X_A')^T +X_A'
\end{align*}
So that  $X_A'=(X_A')^T$ is a symmetric matrix.

Therefore, the following matrix generates a graph state, and thus a Lagrangian subspace of $k^{2(n+1)}$:
$$
\left[\begin{array}{ccc|ccc}
I_{n-1} & 0    & 0 & X_A'       & X_B' & 0\\
0           & 1 & 0 & (X_B')^T & 0     & 1 \\
0           & 0    & 1  & 0            & 1 & 0
\end{array}\right]
$$
Let $W$ be the Lagrangian subspace generated by this matrix.  Then
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, 0.5) {};
		\node [style=X] (1) at (1.5, 0.5) {};
		\node [style=map] (8) at (0.75, -0.5) {$W$};
		\node [style=none] (9) at (1, 0.5) {};
		\node [style=none] (10) at (0, 0.5) {};
		\node [style=none] (11) at (0, 1) {};
		\node [style=none] (12) at (1, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [bend left, looseness=0.75] (8) to (10.center);
		\draw [bend left=15] (8) to (0);
		\draw [bend right=15] (8) to (9.center);
		\draw [bend right, looseness=0.75] (8) to (1);
		\draw (11.center) to (10.center);
		\draw (9.center) to (12.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (15) at (3.25, -0.5) {$V'$};
		\node [style=none] (16) at (3.5, 0.25) {};
		\node [style=none] (17) at (3, 0.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [bend left=15, looseness=0.75] (15) to (17.center);
		\draw [bend right=15, looseness=0.75] (15) to (16.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
This follows because composing $W$ with the cozero maps on the last wire of the $X$ and $Z$ blocks picks out the rows where the last entries of the  $Z$ and $X$ blocks are both postselected to be $0$; that is, those of the generator matrix of $V'$. Then by applying the inverse controlled-X and inverse Fourier transform to $V'$ we get back $V'$ again.  This yields a Lagrangian dilation of $V$.

Suppose that we have an isotropic subspace $V$ of $(k^{2n},\omega)$ with dimension $n-k$; by induction, $V$ can be purified to a  Lagrangian subspace of $k^{2(n+k)}$.
\end{proof}

Since the symplectic complement reverses the order of inclusion, it extends to an isomorphism $\Co\Isot\Rel_k\cong \Isot\Rel_k$ so that we get a dual purification result:


\begin{corollary}
The prop $\Co\Isot\Rel_k$ of affine coisotropic relations is generated by adding the doubled discard relation to the image of the embedding $\Lag\Rel_k\to\LinRel_k$, ie. the linear relation
$
\begin{tikzpicture}[yscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (0, 0) {};
		\node [style=Z] (1) at (0.5, 0) {};
		\node [style=none] (2) at (0, 0.5) {};
		\node [style=none] (3) at (0.5, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (3.center);
		\draw (0.center) to (2.center);
	\end{pgfonlayer}
\end{tikzpicture}
$

\end{corollary}


From the same argument in Lemma \ref{lem:alr} that yields $\Aff\Lag\Rel_k$ from $\Lag\Rel_k$:

\begin{lemma}
The props $\Aff\Isot\Rel_k$ and $\Aff\Co\Isot\Rel_k$ are generated by adding the generator $X$ to $\Isot\Rel_k$ and $\Co\Isot\Rel_k$ respectively seen as categories of affine relations with trivial affine shift.
\end{lemma}


\begin{remark}
\label{rem:xdisc}
Unlike in the linear case, these two props are not isomorphic, as the doubled discard and  doubled cozero maps interact differently with the $X$ gate.  For example:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (1.75, -0.75) {$1$};
		\node [style=Z] (3) at (1.75, 0) {};
		\node [style=Z] (4) at (0.75, 0) {};
		\node [style=none] (9) at (1.75, -1.5) {};
		\node [style=none] (10) at (0.75, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0) to (9.center);
		\draw (0) to (3);
		\draw (10.center) to (4);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (3) at (1.75, 0) {};
		\node [style=Z] (4) at (0.75, 0) {};
		\node [style=none] (9) at (1.75, -1.5) {};
		\node [style=none] (10) at (0.75, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (10.center) to (4);
		\draw (9.center) to (3);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{.5cm}
\text{but}
\hspace*{.5cm}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (1.75, -0.75) {$1$};
		\node [style=X] (3) at (1.75, 0) {};
		\node [style=X] (4) at (0.75, 0) {};
		\node [style=none] (9) at (1.75, -1.5) {};
		\node [style=none] (10) at (0.75, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0) to (9.center);
		\draw (0) to (3);
		\draw (10.center) to (4);
	\end{pgfonlayer}
\end{tikzpicture}
\neq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (3) at (1.75, 0) {};
		\node [style=X] (4) at (0.75, 0) {};
		\node [style=none] (9) at (1.75, -1.5) {};
		\node [style=none] (10) at (0.75, -1.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (10.center) to (4);
		\draw (9.center) to (3);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\end{remark}

We extend the notion of a symplectic stabilizer group to the mixed setting:

\begin{definition}
Given some state $f:0\to n$ in $\CPM(\Aff\Lag\Rel_k)$ the (mixed)  {\bf symplectic stabilizer group} of $f$ is the (not necessarily maximal) subgroup of the symplectic Weyl group group generated by the Weyl operators $a \in P_k^n$ so that:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (2.25, 3.25) {};
		\node [style=none] (1) at (3.75, 3.25) {};
		\node [style=map] (2) at (3, 2.25) {$f$};
		\node [style=map] (3) at (3.75, 3.25) {$a$};
		\node [style=none] (4) at (3.75, 3.75) {};
		\node [style=none] (5) at (2.25, 3.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=45] (2) to (1.center);
		\draw [in=-90, out=135] (2) to (0.center);
		\draw (0.center) to (5.center);
		\draw (3) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (4, 3.25) {$a$};
		\node [style=none] (1) at (2.5, 3.25) {};
		\node [style=Z] (2) at (3, 2.75) {};
		\node [style=map] (3) at (3.75, 2) {$g$};
		\node [style=map] (4) at (2.25, 2) {$\bar g$};
		\node [style=none] (5) at (2.5, 3.25) {};
		\node [style=none] (6) at (4, 3.75) {};
		\node [style=none] (7) at (2.5, 3.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [bend right] (3) to (2);
		\draw [in=120, out=180, looseness=1.50] (2) to (4);
		\draw [in=-90, out=60] (4) to (1.center);
		\draw [in=-90, out=60] (3) to (0);
		\draw (5.center) to (7.center);
		\draw (0) to (6.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (4, 3.25) {};
		\node [style=none] (1) at (2.5, 3.25) {};
		\node [style=Z] (2) at (3, 2.75) {};
		\node [style=map] (3) at (3.75, 2) {$g$};
		\node [style=map] (4) at (2.25, 2) {$\bar g$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [bend right] (3) to (2);
		\draw [in=120, out=180, looseness=1.50] (2) to (4);
		\draw [in=-90, out=60] (4) to (1.center);
		\draw [in=-90, out=60] (3) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (19) at (11.75, 3.25) {};
		\node [style=none] (20) at (10.25, 3.25) {};
		\node [style=map] (21) at (11, 2.25) {$f$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=135] (21) to (20.center);
		\draw [in=-90, out=45] (21) to (19.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$


\end{definition}


This is needed to prove the essential uniqueness of purification for $\CPM(\Aff\Lag\Rel_k)$, generalizing the case for stabilizers:

\begin{proposition}[Essential uniqueness of quantum purification]~\\
\label{prop:uniqueness}
States in $\CPM(\Aff\Lag\Rel_k)$ are uniquely determined by their stabilizer groups.
\end{proposition}
\begin{proof}

Take dilations of two parallel maps in $\CPM(\Aff\Lag\Rel_k)$:

$$
(m,f:0\to n+m) \hspace*{.2cm}  
\text{of} \hspace*{.2cm} \hat f:0\to m 
\hspace*{.5cm}
\text{and}
\hspace*{.5cm}
(\ell, g:0\to n+\ell)
\hspace*{.2cm}  \text{of} \hspace*{.2cm}
\hat g:0\to m
$$ 

Take  $\hat f$ and $\hat g$ to have the same stabilizer groups, and without loss of generality take $m\geq \ell$. 

Consider the unitary  $u:m\to m$  and isometry $v:\ell\to m$, which perform Gaussian elimination on the ancillary space $m$ and $\ell$ of $f$ and $g$.  Compose $u$ and $v$ on the ancillary spaces of $f$ and $g$, respectively; and then regard them as pure states.  These pure states both have the same stabilizer groups.  Therefore they span the same affine subspace:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (110) at (64.25, 2.25) {$f$};
		\node [style=none] (111) at (65, 4.25) {};
		\node [style=none] (112) at (64, 4.25) {};
		\node [style=map] (113) at (64.25, 3.25) {$u$};
		\node [style=none] (114) at (64.5, 4.25) {};
		\node [style=none] (115) at (63.5, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (111.center) to (110);
		\draw [in=-90, out=120] (110) to (112.center);
		\draw [in=-75, out=75] (110) to (113);
		\draw [in=-90, out=60] (113) to (114.center);
		\draw [in=-135, out=150, looseness=1.25] (110) to (113);
		\draw [in=105, out=-90] (115.center) to (113);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (116) at (66.75, 2.25) {$g$};
		\node [style=none] (117) at (67.5, 4.25) {};
		\node [style=none] (118) at (66.5, 4.25) {};
		\node [style=map] (119) at (66.75, 3.25) {$v$};
		\node [style=none] (120) at (67, 4.25) {};
		\node [style=none] (121) at (66, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (117.center) to (116);
		\draw [in=-90, out=120] (116) to (118.center);
		\draw [in=-75, out=75] (116) to (119);
		\draw [in=-90, out=60] (119) to (120.center);
		\draw [in=-135, out=150, looseness=1.25] (116) to (119);
		\draw [in=105, out=-90] (121.center) to (119);
	\end{pgfonlayer}
\end{tikzpicture}
$$


Therefore:


$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (3.75, 2.25) {$f$};
		\node [style=none] (1) at (4.75, 4.25) {};
		\node [style=none] (2) at (4, 4.25) {};
		\node [style=map] (3) at (2, 2.25) {$\bar f$};
		\node [style=Z] (4) at (3.5, 3.75) {};
		\node [style=X] (5) at (1.75, 3.75) {};
		\node [style=none] (6) at (4.75, 4.25) {};
		\node [style=none] (7) at (4, 4.25) {};
		\node [style=none] (8) at (3, 4.25) {};
		\node [style=none] (9) at (2.25, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (1.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw [in=-15, out=75, looseness=1.25] (0) to (4);
		\draw [in=-135, out=150, looseness=1.50] (3) to (5);
		\draw [in=-90, out=105] (3) to (9.center);
		\draw [in=-90, out=30, looseness=0.75] (3) to (8.center);
		\draw [in=-165, out=75] (3) to (4);
		\draw [in=-15, out=150, looseness=1.25] (0) to (5);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (7.75, 2.25) {$f$};
		\node [style=none] (1) at (9, 3.5) {};
		\node [style=none] (2) at (8.5, 3.5) {};
		\node [style=map] (3) at (6, 2.25) {$\bar f$};
		\node [style=Z] (4) at (8, 4.25) {};
		\node [style=X] (5) at (5.75, 4.25) {};
		\node [style=none] (6) at (6.75, 4.75) {};
		\node [style=none] (7) at (6.25, 4.75) {};
		\node [style=map] (8) at (8, 3.5) {$u$};
		\node [style=map] (9) at (5.5, 3.25) {$\bar u$};
		\node [style=none] (10) at (9, 4.75) {};
		\node [style=none] (11) at (8.5, 4.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (1.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw [in=-90, out=105] (3) to (7.center);
		\draw [in=-90, out=30, looseness=0.75] (3) to (6.center);
		\draw [in=-15, out=75, looseness=1.25] (3) to (9);
		\draw [bend right, looseness=0.75] (9) to (3);
		\draw [bend left=45] (9) to (5);
		\draw [in=180, out=60, looseness=0.75] (9) to (4);
		\draw [in=120, out=0, looseness=0.50] (5) to (8);
		\draw [bend left=15] (8) to (0);
		\draw [in=-150, out=135, looseness=1.25] (0) to (8);
		\draw [bend right] (8) to (4);
		\draw (2.center) to (11.center);
		\draw (1.center) to (10.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (7.75, 2.25) {$g$};
		\node [style=none] (1) at (9, 3.5) {};
		\node [style=none] (2) at (8.5, 3.5) {};
		\node [style=map] (3) at (6, 2.25) {$\bar g$};
		\node [style=Z] (4) at (8, 4.25) {};
		\node [style=X] (5) at (5.75, 4.25) {};
		\node [style=none] (6) at (6.75, 4.75) {};
		\node [style=none] (7) at (6.25, 4.75) {};
		\node [style=map] (8) at (8, 3.5) {$v$};
		\node [style=map] (9) at (5.5, 3.25) {$\bar v$};
		\node [style=none] (10) at (9, 4.75) {};
		\node [style=none] (11) at (8.5, 4.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (1.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw [in=-90, out=105] (3) to (7.center);
		\draw [in=-90, out=30, looseness=0.75] (3) to (6.center);
		\draw [in=-15, out=75, looseness=1.25] (3) to (9);
		\draw [bend right, looseness=0.75] (9) to (3);
		\draw [bend left=45] (9) to (5);
		\draw [in=180, out=60, looseness=0.75] (9) to (4);
		\draw [in=120, out=0, looseness=0.50] (5) to (8);
		\draw [bend left=15] (8) to (0);
		\draw [in=-150, out=135, looseness=1.25] (0) to (8);
		\draw [bend right] (8) to (4);
		\draw (2.center) to (11.center);
		\draw (1.center) to (10.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (3.75, 2.25) {$g$};
		\node [style=none] (1) at (4.75, 4.25) {};
		\node [style=none] (2) at (4, 4.25) {};
		\node [style=map] (3) at (2, 2.25) {$\bar g$};
		\node [style=Z] (4) at (3.5, 3.75) {};
		\node [style=X] (5) at (1.75, 3.75) {};
		\node [style=none] (6) at (4.75, 4.25) {};
		\node [style=none] (7) at (4, 4.25) {};
		\node [style=none] (8) at (3, 4.25) {};
		\node [style=none] (9) at (2.25, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (1.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw [in=-15, out=75, looseness=1.25] (0) to (4);
		\draw [in=-135, out=150, looseness=1.50] (3) to (5);
		\draw [in=-90, out=105] (3) to (9.center);
		\draw [in=-90, out=30, looseness=0.75] (3) to (8.center);
		\draw [in=-165, out=75] (3) to (4);
		\draw [in=-15, out=150, looseness=1.25] (0) to (5);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\end{proof}




\begin{theorem}[Essential uniqueness of relational purification]~\\
\label{them:dilation}
 $\CPM(\Aff\Lag\Rel_k) \cong \Aff\Co\Isot\Rel_k$
\end{theorem}


\begin{proof}

Because both categories are compact closed, it suffices to exhibit a functorial bijection between the states of both categories.
Consider the map $\CPM(\Aff\Lag\Rel_k) \cong \Aff\Co\Isot\Rel_k$, sending:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (3.75, 2.25) {$f$};
		\node [style=none] (1) at (4.75, 4.25) {};
		\node [style=none] (2) at (4, 4.25) {};
		\node [style=map] (3) at (2, 2.25) {$\bar f$};
		\node [style=Z] (4) at (3.5, 3.75) {};
		\node [style=X] (5) at (1.75, 3.75) {};
		\node [style=none] (6) at (4.75, 4.25) {};
		\node [style=none] (7) at (4, 4.25) {};
		\node [style=none] (8) at (3, 4.25) {};
		\node [style=none] (9) at (2.25, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (1.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw [in=-15, out=75, looseness=1.25] (0) to (4);
		\draw [in=-135, out=150, looseness=1.50] (3) to (5);
		\draw [in=-90, out=105] (3) to (9.center);
		\draw [in=-90, out=30, looseness=0.75] (3) to (8.center);
		\draw [in=-165, out=75] (3) to (4);
		\draw [in=-15, out=150, looseness=1.25] (0) to (5);
	\end{pgfonlayer}
\end{tikzpicture}
\mapsto
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (122) at (69.25, 2.25) {$f$};
		\node [style=none] (123) at (70, 4.25) {};
		\node [style=none] (124) at (69, 4.25) {};
		\node [style=Z] (125) at (69.5, 3.5) {};
		\node [style=Z] (126) at (68.5, 3.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (123.center) to (122);
		\draw [in=-90, out=120] (122) to (124.center);
		\draw [in=-90, out=75] (122) to (125);
		\draw [in=-90, out=135] (122) to (126);
	\end{pgfonlayer}
\end{tikzpicture}
$$
By Proposition \ref{prop:uniqueness}, this mapping is a full functor. For faithfulness, take maps $\hat f$ and $\hat g$ sent to the same affine coisotropic relation with dilations $(m,f:0\to n+ m)$ and  $(\ell,g:0\to n+ \ell )$ where without loss of generality $m\geq \ell$.
Then there is a unitary  $u:m\to m$  and isometry $v:\ell\to m$, which perform Gaussian elimination on the ancillary systems of $f$ and $g$ so that:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (110) at (64.25, 2.25) {$f$};
		\node [style=none] (111) at (65, 4.25) {};
		\node [style=none] (112) at (64, 4.25) {};
		\node [style=map] (113) at (64.25, 3.25) {$u$};
		\node [style=none] (114) at (64.5, 4.25) {};
		\node [style=none] (115) at (63.5, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (111.center) to (110);
		\draw [in=-90, out=120] (110) to (112.center);
		\draw [in=-75, out=75] (110) to (113);
		\draw [in=-90, out=60] (113) to (114.center);
		\draw [in=-135, out=150, looseness=1.25] (110) to (113);
		\draw [in=105, out=-90] (115.center) to (113);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (116) at (66.75, 2.25) {$g$};
		\node [style=none] (117) at (67.5, 4.25) {};
		\node [style=none] (118) at (66.5, 4.25) {};
		\node [style=map] (119) at (66.75, 3.25) {$v$};
		\node [style=none] (120) at (67, 4.25) {};
		\node [style=none] (121) at (66, 4.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (117.center) to (116);
		\draw [in=-90, out=120] (116) to (118.center);
		\draw [in=-75, out=75] (116) to (119);
		\draw [in=-90, out=60] (119) to (120.center);
		\draw [in=-135, out=150, looseness=1.25] (116) to (119);
		\draw [in=105, out=-90] (121.center) to (119);
	\end{pgfonlayer}
\end{tikzpicture}
$$

So that, as before, they are both dilations of $\hat f = \hat g$.
\end{proof}

\begin{corollary}
\label{cor:stabcode}
For odd prime $p$, $\Aff\Co\Isot\Rel_{\F_p}\cong \CPM(\Aff\Lag\Rel_{\F_p})\cong \CPM(\Stab_p)$.  That is, adding the discard relation to $\Aff\Lag\Rel_{\F_p}$ gives a semantics for {\bf mixed stabilizer circuits/stabilizer codes}, graphically:
$$
\left\llbracket \
\begin{tikzpicture}[yscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (0.25, 0) {};
		\node [ground] (1) at (0.25, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (2) at (4, 0) {};
		\node [style=Z] (3) at (4.5, 0) {};
		\node [style=none] (4) at (4, -1) {};
		\node [style=none] (5) at (4.5, -1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (4.center) to (2);
		\draw (3) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\left\{ 
\left(
\begin{pmatrix}
z\\x
\end{pmatrix},
*
\right)
:\forall z,x \in \F_p
\right\}
$$
\end{corollary}



This is conceptually very close to the result of \cite{huot} where they show that the affine completion of isometries between finite dimensional Hilbert spaces, which freely adds a discard map, yields completely positive trace-preserving maps.  And even more similar, to the more refined result of   \cite{disc}, where they show that various fragments of the ZX-calculus can be augmented with quantum discarding by freely adding discarding. 

Although in our case the quantum discarding is interpreted as the literal {\bf discard relation} of the corresponding stabilizers, therefore our semantics still lives within affine relations.








It was already known that stabilizer codes are in bijection with  affine isotropic subspaces, for example \cite[\S A]{gross}.  Indeed affine coisotropic subspaces are in bijection with affine isotropic subspace by  taking the symplectic complement of the linear component of the affine subspace. However, as noted in Remark  \ref{rem:xdisc}, $\Aff\Isot\Rel_{\F_p} \not \cong \Aff\Co\Isot\Rel_{\F_p}$, so their compositions as affine relations are different. The interpretation of the doubled zero postselection as the quantum discard map is not sound with respect to relational composition.   


This formalizes the relationship between mixed stabilizer circuits and stabilizer tableaux with not-necessarily-full rank in  a compositional way.  It is standard, and indeed very useful to regard the augmented symplectic basis $L+a$ of an affine isotropic subspace as the stabilizer tableau.  In order to compose these tableaux, one must take the symplectic complement of both spaces, and then compute  their relational composition.  Then the stabilizer tableau for this composite is obtained by taking the symplectic complement once again.



We can add mixed states to Spekkens' toy model in the same way:

\begin{corollary}
$\Aff\Co\Isot\Rel_{\F_2}\cong \CPM(\Aff\Lag\Rel_{\F_2})$ is Spekkens' toy model with mixed states.
\end{corollary}

Just as Spekkens' toy model is an epistemic restricted toy theory of quantum circuits; by dualizing things, we also have that $\Aff\Co\Isot\Rel_{\F_p}$ is an empistemically restricted toy theory of quantum circuits; albeit the epistemic restriction is going in the wrong direction.


{\em Absolutely remarkably}, and seemingly out of nowhere, the quopit stabilizer codes with trivial affine phase (no Pauli gates) can be expressed, modulo invertible phase, in terms of an iterated $\CPM$ construction with respect to the orthogonal complement at the inner level, and the complex conjugation at the outer level:
\begin{corollary}
Given a prime $p$ and $k=\F_p$ or $k=\mathbb{Q}$
$$\Isot\Rel_{k}\cong\Co\Isot\Rel_{k}\cong \CPM(\CPM(\LinRel_{k},(-)^\perp),\bar{(-)})$$
\end{corollary}
The astounding symmetry involved here begs the question if iterating the $\CPM$ construction more times yields anything physically interesting. Perhaps the work of \cite{CPMho} can shed some light on this question. 

In order to add measurement and state preparation in the symplectic setting, we split the projectors for the $Z$ and $X$-bases:

\begin{definition}
The $X$ and $Z$ projectors are defined as follows in $\Aff\Co\Isot\Rel_{\F_p}$:
$$
p_X:=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (0) at (0.5, -0.75) {};
		\node [style=none] (2) at (0.25, 0) {};
		\node [style=none] (4) at (1.25, 0.5) {};
		\node [style=Z] (5) at (0.75, 0) {};
		\node [style=Z] (6) at (1.75, 0) {};
		\node [style=Z] (7) at (1.5, -0.75) {};
		\node [style=none] (8) at (0.75, 0) {};
		\node [style=none] (9) at (1.25, 0) {};
		\node [style=none] (10) at (1.75, 0) {};
		\node [style=none] (11) at (0.5, -1.5) {};
		\node [style=none] (13) at (1.5, -1.5) {};
		\node [style=none] (14) at (0.25, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (7) to (9.center);
		\draw (7) to (13.center);
		\draw [in=60, out=-90] (10.center) to (7);
		\draw [in=60, out=-90] (8.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw (0) to (11.center);
		\draw (9.center) to (4.center);
		\draw (2.center) to (14.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (4) at (1, 0.5) {};
		\node [style=Z] (5) at (0.25, 0) {};
		\node [style=none] (9) at (1, -1.25) {};
		\node [style=none] (11) at (0.25, -1.25) {};
		\node [style=none] (14) at (0.25, 0.5) {};
		\node [style=Z] (15) at (0.25, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (9.center) to (4.center);
		\draw (14.center) to (5);
		\draw (11.center) to (15);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{.5cm}
p_Z:=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (0.5, -0.75) {};
		\node [style=none] (2) at (0.25, 0) {};
		\node [style=none] (4) at (1.25, 0.5) {};
		\node [style=Z] (5) at (0.75, 0) {};
		\node [style=Z] (6) at (1.75, 0) {};
		\node [style=X] (7) at (1.5, -0.75) {};
		\node [style=none] (8) at (0.75, 0) {};
		\node [style=none] (9) at (1.25, 0) {};
		\node [style=none] (10) at (1.75, 0) {};
		\node [style=none] (11) at (0.5, -1.5) {};
		\node [style=none] (13) at (1.5, -1.5) {};
		\node [style=none] (14) at (0.25, 0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (7) to (9.center);
		\draw (7) to (13.center);
		\draw [in=60, out=-90] (10.center) to (7);
		\draw [in=60, out=-90] (8.center) to (0);
		\draw [in=-90, out=120] (0) to (2.center);
		\draw (0) to (11.center);
		\draw (9.center) to (4.center);
		\draw (2.center) to (14.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}[scale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (4) at (1, 0.5) {};
		\node [style=Z] (5) at (0.25, 0) {};
		\node [style=none] (9) at (1, -1.25) {};
		\node [style=none] (11) at (0.25, -1.25) {};
		\node [style=none] (14) at (0.25, 0.5) {};
		\node [style=Z] (15) at (0.25, -0.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (9.center) to (4.center);
		\draw (14.center) to (5);
		\draw (11.center) to (15);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{definition}


The $X$ projector discards and then codiscards the $Z$-gradient: cutting the $Z$ gradient in two so that no information is preserved, while acting trivially on the $X$ gradient.  Dually for the $Z$ projector. 

We will split only one of these projectors for simplicity:

\begin{definition}
Let $\Aff\Co\Isot\Rel_k^M$ denote the two-coloured prop generated by splitting $p_Z$ in $\Aff\Co\Isot\Rel_k$; that is the ${\sf Split}_{\{p_Z^{\otimes n}, 1_n | n \in \N \}}(\Aff\Co\Isot\Rel_k)$.


Let $Q=(1_1,1_1)$ denote the original object and $C=(1_1,p_Z)$ the object obtained by splitting $p_Z$.
\end{definition}

We could have instead split $p_X$, or split both $p_X$ and $p_Z$; however, all three of these multicoloured props are equivalent.  This equivalence is witnessed via the Fourier transform. Indeed this suffices to split all nonzero projectors up to isomorphism because all projectors of the same dimension are isomorphic as affine coisotropic subspaces.  Therefore we can construct a nonzero projector of each possible dimension by composition with $p_X$ and affine symplectomorphisms.  
It is important to remark that the choice of projectors which are split effects the code-distance, because code-distance is basis dependent, and not invariant under equivalence.
We chose not to split the zero projector for the same reason why we did not chose to have it as an object in $\Aff\Rel_k$: for ease of notation.

\begin{remark}
The object $Q$ can be interpreted as a quantum channel and the object $C$ as a classical channel. Or equivalently, $C^{\otimes n}$ is interpreted as the space of logical qubits and  $Q^{\otimes m}$  as the space of physical qubits.
\end{remark}

This category has a nice presentation;  adding the affine relations to  $\Aff\Co\Isot\Rel_k$ obtained by cutting /splitting the $Z$ projector in two:


\begin{theorem}
The full subcategory of $\Aff\Co\Isot\Rel_k^M$ generated by tensor powers of $C$ is isomorphic to $\Aff\Rel_k$.
Therefore $\Aff\Co\Isot\Rel_k^M$ is isomorphic to adding the following linear relations to the image of $\Aff\Co\Isot\Rel_k^M\to \Aff\Co\Isot\Rel_k$ in the way which makes this into a two-coloured prop:
$$
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24, 0.5) {};
		\node [style=Z] (4) at (24.75, 0) {};
		\node [style=none] (5) at (24, 0) {};
		\node [style=none] (6) at (24.75, 0.5) {};
		\node [style=none] (7) at (24, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (3.center);
		\draw (6.center) to (4);
		\draw [style=red] (7.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
\hspace*{.5cm}\text{and}\hspace*{.5cm}
\begin{tikzpicture}[scale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24, 0.5) {};
		\node [style=Z] (4) at (24.75, 0) {};
		\node [style=none] (5) at (24, 0) {};
		\node [style=none] (6) at (24.75, 0.5) {};
		\node [style=none] (7) at (24, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (3.center);
		\draw (6.center) to (4);
		\draw [style=red] (7.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\end{theorem}

We draw the classical wire in red to indicate the type, (although the colour is just syntactic sugar).

 The classical state ``lives'' on a single wire and the stabilizer state ``lives'' on the doubled wires.
Because of this, the  aforementioned circuits are interpreted in terms of state preparation (which we denote by the box labelled ``$a\mapsto|a\rangle$'') and measurement in the $Z$-basis:

$$
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node[style=map,fill=white] at (0,0) {$ a \mapsto |a \rangle$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (.1,0) to (.1,-1);
		\draw (-.1,0) to (-.1,-1);
		\draw (0,1) to (0,0);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket 
=
\begin{tikzpicture}[xscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24, 0.5) {};
		\node [style=Z] (4) at (24.75, 0) {};
		\node [style=none] (5) at (24, 0) {};
		\node [style=none] (6) at (24.75, 0.5) {};
		\node [style=none] (7) at (24, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (3.center);
		\draw (6.center) to (4);
		\draw [style=red] (7.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}\ ,\hspace*{1cm}
\left\llbracket \
\begin{circuitikz}
\node[meter] (meter) at (0,0) {};
\draw (.1,.5) to (.1,1);
\draw (-.1,.5) to (-.1,1);
\draw (0,-1) to (0,-.5);
\end{circuitikz} \ 
\right\rrbracket 
=
\begin{tikzpicture}[scale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24, 0.5) {};
		\node [style=Z] (4) at (24.75, 0) {};
		\node [style=none] (5) at (24, 0) {};
		\node [style=none] (6) at (24.75, 0.5) {};
		\node [style=none] (7) at (24, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (3.center);
		\draw (6.center) to (4);
		\draw [style=red] (7.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$


For example, given any classical dit $x \in \F_p$, to prepare the state $|x\rangle$ is to take the composite:

$$
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node[style=map,fill=white] at (0,0) {$ a \mapsto |a \rangle$};
		\node at (0,-1.2) {$x$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (.1,0) to (.1,-1);
		\draw (-.1,0) to (-.1,-1);
		\draw (0,1) to (0,0);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket 
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.25, 0.75) {};
		\node [style=Z] (1) at (0.5, 0) {};
		\node [style=none] (3) at (0.5, 0.75) {};
		\node [style=X] (4) at (1.25, -0.75) {$x$};
		\node [style=none] (5) at (1.25, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (3.center) to (1);
		\draw [style=red] (4) to (5.center);
		\draw (5.center) to (0.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (1.25, 0.5) {};
		\node [style=Z] (1) at (0.5, 0) {};
		\node [style=none] (2) at (1.25, 0) {};
		\node [style=none] (3) at (0.5, 0.5) {};
		\node [style=X] (4) at (1.25, 0) {$x$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2.center) to (0.center);
		\draw (3.center) to (1);
	\end{pgfonlayer}
\end{tikzpicture}
=
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (23, 2) {};
		\node [style=none] (1) at (23, 3) {};
		\node [style=none] (2) at (23, 1.75) {$|x\rangle$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (1.center);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket 
$$

The state preparation and discarding in the $Z$-basis are obtained by composition of these morphisms with the Fourier transform; yielding morphisms which discard the $X$ wire instead of the $Z$ wire:

$$
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node[meter] (meter) at (0,0) {};
		\node[style=map,fill=white] at (0,-1) {$\mathcal{F}^\dag$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (.1,.5) to (.1,1);
		\draw (-.1,.5) to (-.1,1);
		\draw (0,-2) to (0,-.5);
	\end{pgfonlayer} 
\end{tikzpicture}\
\right\rrbracket 
=
\begin{tikzpicture}[yscale=-1]
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24, 0.5) {};
		\node [style=Z] (4) at (24.75, 0) {};
		\node [style=none] (5) at (24, 0) {};
		\node [style=none] (6) at (24.75, 0.5) {};
		\node [style=none] (7) at (24, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (3.center);
		\draw (6.center) to (4);
		\draw [style=red] (7.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}\ ,
\hspace*{.8cm}
\left\llbracket \
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node[style=map,fill=white] at (0,0) {$ a \mapsto \mathcal{F}|a \rangle$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (.1,0) to (.1,-1);
		\draw (-.1,0) to (-.1,-1);
		\draw (0,1) to (0,0);
	\end{pgfonlayer}
\end{tikzpicture}\
\right\rrbracket 
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (3) at (24, 0.5) {};
		\node [style=Z] (4) at (24.75, 0) {};
		\node [style=none] (5) at (24, 0) {};
		\node [style=none] (6) at (24.75, 0.5) {};
		\node [style=none] (7) at (24, -0.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (5.center) to (3.center);
		\draw (6.center) to (4);
		\draw [style=red] (7.center) to (5.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\begin{remark}
Recall that in Lemma \ref{lem:strongcomp}, we used the Hopf rule to show that preparing $X$-basis and then measuring in the $Z$-basis preserves no information.  In the symplectic picture, this result becomes purely topological:

$$
\left\llbracket\
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node[meter] (meter) at (0,0) {};
		\node[style=map,fill=white] at (0,-1.1) {$\mathcal{F}^\dag$};
		\node[style=map,fill=white] at (0,-2) {$ a \mapsto |a \rangle$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (.1,.5) to (.1,1);
		\draw (-.1,.5) to (-.1,1);
		\draw (0,-.5) to (0,-2);
		\draw (.1,-2) to (.1,-3);
		\draw (-.1,-2) to (-.1,-3);
	\end{pgfonlayer} 
\end{tikzpicture}\
\right\rrbracket
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (59, 6.25) {};
		\node [style=none] (1) at (59, 7) {};
		\node [style=Z] (2) at (59.5, 7) {};
		\node [style=none] (3) at (59.5, 6.25) {};
		\node [style=none] (4) at (59, 7.5) {};
		\node [style=none] (5) at (59.5, 5.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (0);
		\draw (3.center) to (2);
		\draw [style=red] (1.center) to (4.center);
		\draw [style=red] (5.center) to (3.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (219) at (59, 6.25) {};
		\node [style=none] (220) at (59, 6.75) {};
		\node [style=Z] (221) at (59, 5.75) {};
		\node [style=none] (222) at (59, 5.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw[style=red]  (220.center) to (219);
		\draw[style=red]  (222.center) to (221);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{remark}


For this reason, we can prove the correctness of the quantum teleportation algorithm using only spider fusion (compare to the graphical proofs given in \cite{abramsky,pqp}):


\begin{example}
\label{ex:teleportation}
Given any prime $p$, the following string diagram in $\Aff\Co\Isot\Rel_{\F_p}^M$ depicts the quopit quantum teleportation protocol where Alice on the left teleports a qudit to Bob, on the right. They share an EPR pair (on the bottom of the diagram)  and two classical dits (drawn in red).  


$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (569) at (366.75, 1.75) {};
		\node [style=none] (570) at (367.25, 3.25) {};
		\node [style=none] (571) at (366.25, 3.25) {};
		\node [style=none] (572) at (365.75, 1.75) {};
		\node [style=Z] (573) at (367.25, 4.75) {};
		\node [style=Z] (574) at (365.75, 4.75) {};
		\node [style=none] (575) at (369.5, 3.75) {};
		\node [style=none] (576) at (370.25, 3.75) {};
		\node [style=none] (577) at (369.5, 9) {};
		\node [style=none] (578) at (370.25, 9) {};
		\node [style=Z] (579) at (365.75, 3.25) {};
		\node [style=X] (580) at (366.25, 3.75) {};
		\node [style=Z] (581) at (367.25, 3.75) {};
		\node [style=X] (582) at (366.75, 3.25) {};
		\node [style=none] (583) at (366.25, 4.75) {};
		\node [style=none] (584) at (366.75, 4.75) {};
		\node [style=X] (585) at (367.5, 2.25) {};
		\node [style=Z] (586) at (369.25, 2.25) {};
		\node [style=Z] (587) at (369.5, 7.75) {};
		\node [style=X] (588) at (370.25, 7.75) {};
		\node [style=X] (589) at (369.5, 8.5) {};
		\node [style=Z] (590) at (370.25, 8.5) {};
		\node [style=Z] (591) at (368.25, 6.75) {};
		\node [style=Z] (592) at (368.75, 6.75) {};
		\node [style=none] (593) at (369.25, 6.75) {};
		\node [style=none] (594) at (367.75, 6.75) {};
		\node [style=none] (595) at (366.75, 9) {};
		\node [style=none] (596) at (368.5, 1.75) {};
		\node [style=none] (597) at (365.75, 9) {Alice};
		\node [style=none] (598) at (367.5, 9) {Bob};
		\node [style=none] (599) at (365.25, 4.75) {};
		\node [style=none] (600) at (370.75, 4.75) {};
		\node [style=none] (601) at (365.25, 6.75) {};
		\node [style=none] (602) at (370.75, 6.75) {};
		\node [style=none] (603) at (363.25, 6.75) {Phase correction};
		\node [style=none] (604) at (363.25, 4.75) {Measurement};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (580) to (579);
		\draw (582) to (581);
		\draw (570.center) to (581);
		\draw (581) to (573);
		\draw (572.center) to (579);
		\draw (579) to (574);
		\draw (571.center) to (580);
		\draw (569.center) to (582);
		\draw (582) to (584.center);
		\draw (580) to (583.center);
		\draw [in=0, out=-90, looseness=0.75] (575.center) to (585);
		\draw [in=-90, out=165, looseness=0.50] (585) to (571.center);
		\draw [in=165, out=-90, looseness=0.50] (570.center) to (586);
		\draw [in=-90, out=30] (586) to (576.center);
		\draw (590) to (588);
		\draw (589) to (587);
		\draw (575.center) to (587);
		\draw (589) to (577.center);
		\draw (578.center) to (590);
		\draw (588) to (576.center);
		\draw [in=-150, out=90, looseness=0.75] (591) to (590);
		\draw [in=-150, out=90] (592) to (587);
		\draw [color=red, in=-90, out=90, looseness=0.50] (584.center) to (593.center);
		\draw [color=red, in=-90, out=90] (583.center) to (594.center);
		\draw [in=210, out=90, looseness=0.75] (594.center) to (589);
		\draw [in=-150, out=90] (593.center) to (588);
		\draw [style=dotted, in=270, out=90] (596.center) to (595.center);
		\draw [style=dotted] (600.center) to (599.center);
		\draw [style=dotted] (602.center) to (601.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (301) at (81.75, 1.5) {};
		\node [style=none] (302) at (81.25, 3) {};
		\node [style=none] (303) at (80.75, 1.5) {};
		\node [style=none] (304) at (84.5, 3) {};
		\node [style=none] (305) at (85, 3) {};
		\node [style=none] (306) at (84.5, 8.5) {};
		\node [style=none] (307) at (85, 8.5) {};
		\node [style=X] (308) at (81.25, 4.5) {};
		\node [style=X] (309) at (82.75, 1.75) {};
		\node [style=Z] (310) at (83.75, 1.75) {};
		\node [style=X] (311) at (85, 7.25) {};
		\node [style=X] (312) at (84.5, 7.25) {};
		\node [style=Z] (313) at (83, 5) {};
		\node [style=X] (314) at (82, 4.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (302.center) to (308);
		\draw [in=15, out=-90, looseness=0.75] (304.center) to (309);
		\draw [in=-90, out=165, looseness=0.50] (309) to (302.center);
		\draw [in=-90, out=15, looseness=0.75] (310) to (305.center);
		\draw (312) to (306.center);
		\draw (311) to (305.center);
		\draw (311) to (307.center);
		\draw (304.center) to (312);
		\draw [in=90, out=-120] (308) to (303.center);
		\draw [color=red, in=225, out=90, looseness=0.75] (308) to (312);
		\draw [in=225, out=120, looseness=0.50, color=red] (314) to (311);
		\draw [in=15, out=-165] (313) to (314);
		\draw [in=270, out=90] (301.center) to (314);
		\draw [in=-60, out=135, looseness=0.75] (310) to (313);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (166) at (42.5, 1.5) {};
		\node [style=none] (167) at (42, 1.5) {};
		\node [style=none] (168) at (43.5, 8.5) {};
		\node [style=none] (169) at (44, 8.5) {};
		\node [style=X] (170) at (42, 4.5) {};
		\node [style=X] (171) at (42.5, 3.5) {};
		\node [style=X] (172) at (44, 6.25) {};
		\node [style=X] (173) at (43.5, 7.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-120, out=90, looseness=0.75] (166.center) to (171);
		\draw [in=270, out=60] (173) to (168.center);
		\draw [in=270, out=60, looseness=0.75] (172) to (169.center);
		\draw [color=red, bend left=15, looseness=0.50] (171) to (172);
		\draw [in=90, out=-120, looseness=0.50] (170) to (167.center);
		\draw [bend right=15, looseness=0.50] (171) to (172);
		\draw [bend left=15, looseness=0.50] (173) to (170);
		\draw [color=red, bend left=15, looseness=0.50] (170) to (173);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (174) at (45.5, 1.5) {};
		\node [style=none] (175) at (45, 1.5) {};
		\node [style=none] (176) at (45, 8.5) {};
		\node [style=none] (177) at (45.5, 8.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (177.center) to (174.center);
		\draw (175.center) to (176.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

\end{example}

Because $\Aff\Co\Isot\Rel_{\F_p}^M$ is a subcategory of relations, composable maps are ordered by subspace inclusion (ie, it is poset-enriched). Moreover, since all possible outcomes are equally likely we can identify when the measurement statistics of one process arise from the marginalization of the measurement statistics of another process:



TODO TALK ABOUT WIGNER FUNCTION


\begin{remark}
Take two quopit stabilizer circuits with state preparations and measurement $f,g$ interpreted as parallel maps in  $\Aff\Co\Isot\Rel_{\F_p}^M$.
Then $f$ is a coarse-graining of $g$ when $f \subset g$ is a (strict)  affine subspace.
\end{remark}

\begin{example}
For an extreme example, the identity circuit on a classical wire is contained within  the circuit obtained by preparing in the $Z$-basis and measuring in the $X$-basis:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (220) at (59, 6.75) {};
		\node [style=none] (222) at (59, 5.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (220.center) to (222);
	\end{pgfonlayer}
\end{tikzpicture}
\subset
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (219) at (59, 6.25) {};
		\node [style=none] (220) at (59, 6.75) {};
		\node [style=Z] (221) at (59, 5.75) {};
		\node [style=none] (222) at (59, 5.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (220.center) to (219);
		\draw [style=red] (222.center) to (221);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (59, 6.25) {};
		\node [style=none] (1) at (59, 7) {};
		\node [style=Z] (2) at (59.5, 7) {};
		\node [style=none] (3) at (59.5, 6.25) {};
		\node [style=none] (4) at (59, 7.75) {};
		\node [style=none] (5) at (59.5, 5.5) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (0);
		\draw (3.center) to (2);
		\draw [style=red] (5.center) to (3.center);
		\draw [style=red] (1.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

This is because, given any input state, the circuit on the right hand side can produce any output state; however, the identity circuit forces the inputs to be the same as the outputs.
\end{example}


\begin{example}
Similarly, the identity on a quantum wire is a coarse graining of the decoherence map:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (261) at (69.25, 6.75) {};
		\node [style=none] (263) at (69.25, 5.25) {};
		\node [style=none] (264) at (69.75, 6.75) {};
		\node [style=none] (265) at (69.75, 5.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (265.center) to (264.center);
		\draw (263.center) to (261.center);
	\end{pgfonlayer}
\end{tikzpicture}
\subset
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (0) at (69.25, 6.25) {};
		\node [style=none] (1) at (69.25, 6.75) {};
		\node [style=Z] (2) at (69.25, 5.75) {};
		\node [style=none] (3) at (69.25, 5.25) {};
		\node [style=none] (4) at (69.75, 6.75) {};
		\node [style=none] (5) at (69.75, 5.25) {};
		\node [style=none] (6) at (69.75, 6.25) {};
		\node [style=none] (7) at (69.75, 5.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1.center) to (0);
		\draw (3.center) to (2);
		\draw [style=red] (7.center) to (6.center);
		\draw (5.center) to (7.center);
		\draw (6.center) to (4.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{example}

This two coloured prop also has a semantics in terms of electrical circuits, when changing the field from $\F_p$ to the field of fractions of real polynomials $\R(x)$.  It gives a well-structured semantics for a large fragment (although not all) of the impedance calculus \cite{impedence}:

\begin{remark}
\label{rem:electrical}
$\Aff\Co\Isot\Rel_{\R(x)}^M$ is a semantics for the fragment of the impedance calculus generated by resistors, inductors, capacitors, controlled and uncontrolled voltage/current sources.
\end{remark}

This can be verified by factoring the generators in \cite{impedence} into the appropriate form. DO THIS!!!!!


\section{Error correction}
\label{sec:qec}

%Recall the observation from Corollary \ref{cor:stabcode} that nonempty states in $\Aff\Co\Isot\Rel_{\F_p}$ correspond to stabilizer codes. Moreover an affine coisotropic subspace of $\F_p^{2n}$ with dimension $m$  interpreted as a state in $\CPM(\Stab_p)$ encodes $m-n$ logical qubits in $n$ physical qubits.  In the literature, these are the $[n,m-n]$ odd prime dimensional qudit stabilizer codes \cite{????}.  In this section we show how to model error correction protocols within this framework.  Starting with stabilizer codes and then extending this interpretation to topological stabilizer codes by looking at the quantized Weinstein category.

Quantum channels are inherently noisy, and it is an active area of study to protect quantum channels against errors.  Quantum error detection/correction protocols are often performed using stabilizer circuits, which is amenable to the symplectic formalism.  We will the categorical semantics for stabilier codes to describe quantum error correction protocols. 
In this section, we show how to implement quantum error correction protocols for stabilizer codes (see \cite{gottesman}) using the string diagrams we developed in the previous section.   This generalizes the graphical $\F_2$-linear subspace semantics of qubit CSS codes in \cite{grok} to quopit stabilizer codes as well as qubit CSS codes plus Weyl operators.


Fix an odd prime $p$.
Consider an affine coisotropic subspace $S=L+a \subseteq \F_p^{2n}$ where $L$ has dimension $n+k$.  Then the associated projector on $n$-qudits is called a $[n,k]$-stabilizer code, as it encodes $k$ logical qudits into $n$ physical qudits. 
The relationship between logical and physical qubits can be understood in terms of pictures.
Fix a unitary purification $U$ of $S$:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (249) at (105.1, 3.25) {$S$};
		\node [style=none] (250) at (104.85, 4) {};
		\node [style=none] (251) at (105.35, 4) {};
		\node [style=none] (256) at (104.85, 4.25) {$n$};
		\node [style=none] (257) at (105.35, 4.25) {$n$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (249) to (250.center);
		\draw [in=-90, out=60] (249) to (251.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (249) at (105.1, 3.25) {$U$};
		\node [style=none] (250) at (104.85, 4) {};
		\node [style=none] (251) at (105.35, 4) {};
		\node [style=none] (252) at (103.85, 2) {};
		\node [style=none] (253) at (105.6, 2) {};
		\node [style=Z] (254) at (103.85, 2) {};
		\node [style=none] (255) at (106.35, 1.55) {$n-k$};
		\node [style=none] (256) at (104.85, 4.25) {$n$};
		\node [style=none] (257) at (105.35, 4.25) {$n$};
		\node [style=X] (258) at (106.35, 2) {};
		\node [style=Z] (259) at (104.6, 2) {};
		\node [style=none] (260) at (105.6, 1.5) {$k$};
		\node [style=none] (261) at (103.75, 1.5) {$k$};
		\node [style=none] (262) at (104.6, 1.5) {$n-k$};
		\node [style=Z] (263) at (105.6, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (249) to (250.center);
		\draw [in=-90, out=60] (249) to (251.center);
		\draw [in=-60, out=90] (253.center) to (249);
		\draw [in=90, out=-150] (249) to (252.center);
		\draw [in=-30, out=90] (258) to (249);
		\draw [in=90, out=-120] (249) to (259);
	\end{pgfonlayer}
\end{tikzpicture}
$$
The Lagrangian dilation of $S$, the {\bf encoder}, embeds $k$ logical qudits into $n$ physical qudits:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (249) at (105.1, 3.25) {$U$};
		\node [style=none] (250) at (104.85, 4) {};
		\node [style=none] (251) at (105.35, 4) {};
		\node [style=none] (252) at (103.85, 1.75) {};
		\node [style=none] (253) at (105.6, 1.75) {};
		\node [style=none] (255) at (106.35, 1.55) {$n-k$};
		\node [style=none] (256) at (104.85, 4.25) {$n$};
		\node [style=none] (257) at (105.35, 4.25) {$n$};
		\node [style=X] (258) at (106.35, 2) {};
		\node [style=Z] (259) at (104.6, 2) {};
		\node [style=none] (260) at (105.6, 1.25) {$k$};
		\node [style=none] (262) at (104.6, 1.5) {$n-k$};
		\node [style=none] (265) at (103.85, 1.25) {$k$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (249) to (250.center);
		\draw [in=-90, out=60] (249) to (251.center);
		\draw [in=-60, out=90] (253.center) to (249);
		\draw [in=90, out=-150] (249) to (252.center);
		\draw [in=-30, out=90] (258) to (249);
		\draw [in=90, out=-120] (249) to (259);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Splitting this projector fixes a basis $\{b_1,\ldots, b_{n-k}\}$ for $L^\omega$, where the elements of the basis are pairwise orthogonal with respect to the symplectic form.  That is to say, they commute, which fixes the possible measurement outcomes:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (266) at (108.7, 3.25) {$U$};
		\node [style=none] (267) at (108.45, 4) {};
		\node [style=none] (268) at (108.95, 4) {};
		\node [style=none] (269) at (107.45, 2) {};
		\node [style=none] (270) at (109.2, 2) {};
		\node [style=Z] (271) at (107.45, 2) {};
		\node [style=none] (272) at (109.95, 1.05) {$n-k$};
		\node [style=none] (273) at (108.45, 4.25) {$n$};
		\node [style=none] (274) at (108.95, 4.25) {$n$};
		\node [style=Z] (276) at (108.2, 2) {};
		\node [style=none] (277) at (109.2, 1.5) {$k$};
		\node [style=none] (278) at (107.35, 1.5) {$k$};
		\node [style=none] (279) at (108.2, 1.5) {$n-k$};
		\node [style=none] (280) at (109.95, 1.5) {};
		\node [style=none] (281) at (109.95, 2) {};
		\node [style=Z] (282) at (109.2, 2) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=120] (266) to (267.center);
		\draw [in=-90, out=60] (266) to (268.center);
		\draw [in=-60, out=90] (270.center) to (266);
		\draw [in=90, out=-150] (266) to (269.center);
		\draw [in=90, out=-120] (266) to (276);
		\draw [in=-30, out=90] (281.center) to (266);
		\draw [style=red] (280.center) to (281.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Suppose that Alice encodes a state and sends it to Bob on a noisy quantum channel with Pauli error $W(e)$.  To detect the error apply the non-destructive measurement with respect to our chosen basis on the last $n-k$ wires in the $Z$-basis conjugated by $U$:
\begin{align*}
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (0) at (95.75, 2.75) {$U$};
		\node [style=none] (1) at (94.75, 1.25) {};
		\node [style=none] (2) at (96, 1.25) {};
		\node [style=X] (3) at (96.5, 1.5) {};
		\node [style=Z] (4) at (95.25, 1.5) {};
		\node [style=none] (5) at (95.5, 6) {};
		\node [style=none] (6) at (96, 6) {};
		\node [style=none] (7) at (97.5, 6) {};
		\node [style=none] (8) at (98, 6) {};
		\node [style=Z] (9) at (96.5, 6.25) {};
		\node [style=X] (10) at (96, 6) {};
		\node [style=Z] (11) at (96.5, 5.5) {};
		\node [style=none] (12) at (96.75, 8) {};
		\node [style=none] (13) at (96.75, 8) {};
		\node [style=Z] (14) at (98, 6) {};
		\node [style=X] (15) at (98.5, 6.25) {};
		\node [style=X] (16) at (98.5, 5.5) {};
		\node [style=none] (17) at (96.75, 8) {};
		\node [style=none] (18) at (96.75, 8) {};
		\node [style=Z] (19) at (96.5, 7) {};
		\node [style=none] (20) at (98.5, 9) {};
		\node [style=none] (21) at (98.5, 7) {};
		\node [style=map] (22) at (96.25, 3.75) {$W(e)$};
		\node [style=map] (23) at (96.75, 4.75) {$U^\dag$};
		\node [style=map] (24) at (96.75, 8) {$U$};
		\node [style=none] (25) at (95.75, 9) {};
		\node [style=none] (26) at (96.25, 9) {};
		\node [style=none] (27) at (97.25, 9) {};
		\node [style=none] (28) at (97.75, 9) {};
		\node [style=none] (29) at (94.25, 9) {};
		\node [style=none] (30) at (97, 1) {};
		\node [style=none] (31) at (98.75, 7) {};
		\node [style=none] (32) at (94.25, 7) {};
		\node [style=none] (33) at (98.75, 1.5) {};
		\node [style=none] (34) at (94.5, 1.5) {};
		\node [style=none] (35) at (93, 7.25) {Syndrome};
		\node [style=none] (36) at (93.25, 1.5) {Encoding};
		\node [style=none] (37) at (93.75, 2.75) {Alice};
		\node [style=none] (38) at (97.25, 2.75) {Bob};
		\node [style=none] (39) at (98.75, 3.75) {};
		\node [style=none] (40) at (94.25, 3.75) {};
		\node [style=none] (41) at (93.5, 3.75) {Error};
		\node [style=none] (42) at (93, 6.75) {measurement};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-60, out=90, looseness=0.75] (2.center) to (0);
		\draw [in=90, out=-165] (0) to (1.center);
		\draw [in=-30, out=90] (3) to (0);
		\draw [in=90, out=-135] (0) to (4);
		\draw (9) to (10);
		\draw (11) to (9);
		\draw [in=-150, out=90] (5.center) to (13.center);
		\draw [in=-120, out=90, looseness=1.25] (10) to (12.center);
		\draw [in=-60, out=90, looseness=0.75] (7.center) to (18.center);
		\draw [in=90, out=-30, looseness=0.75] (17.center) to (14);
		\draw (14) to (15);
		\draw (15) to (16);
		\draw [style=red] (21.center) to (20.center);
		\draw (9) to (19);
		\draw (15) to (21.center);
		\draw [in=270, out=75, looseness=0.75] (0) to (22);
		\draw [in=-105, out=90, looseness=0.50] (22) to (23);
		\draw [in=-90, out=150] (23) to (5.center);
		\draw [in=135, out=-90] (6.center) to (23);
		\draw [in=-90, out=60] (23) to (7.center);
		\draw [in=30, out=-90, looseness=0.75] (8.center) to (23);
		\draw [in=-90, out=135] (24) to (25.center);
		\draw [in=-90, out=105] (24) to (26.center);
		\draw [in=-90, out=75] (24) to (27.center);
		\draw [in=-90, out=45] (24) to (28.center);
		\draw [style=dotted, in=270, out=90] (30.center) to (29.center);
		\draw [style=dotted] (32.center) to (31.center);
		\draw [style=dotted] (34.center) to (33.center);
		\draw [style=dotted] (40.center) to (39.center);
	\end{pgfonlayer}
\end{tikzpicture}
&=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (43) at (100.25, -39.25) {};
		\node [style=none] (44) at (101.25, -39.25) {};
		\node [style=X] (45) at (101.75, -39) {};
		\node [style=Z] (46) at (100.75, -39) {};
		\node [style=none] (47) at (100, -36) {};
		\node [style=none] (48) at (100.5, -36) {};
		\node [style=none] (49) at (101.5, -36) {};
		\node [style=none] (50) at (102, -36) {};
		\node [style=Z] (51) at (101, -35.75) {};
		\node [style=X] (52) at (100.5, -36) {};
		\node [style=Z] (53) at (101, -36.5) {};
		\node [style=none] (54) at (101, -34) {};
		\node [style=none] (55) at (101, -34) {};
		\node [style=Z] (56) at (102, -36) {};
		\node [style=X] (57) at (102.5, -35.75) {};
		\node [style=X] (58) at (102.5, -36.5) {};
		\node [style=none] (59) at (101, -34) {};
		\node [style=none] (60) at (101, -34) {};
		\node [style=Z] (61) at (101, -35) {};
		\node [style=none] (62) at (102.5, -33) {};
		\node [style=none] (63) at (102.5, -35) {};
		\node [style=map] (64) at (101, -37.75) {$U;W(e);U^\dag$};
		\node [style=map] (65) at (101, -34) {$U$};
		\node [style=none] (66) at (100.25, -33) {};
		\node [style=none] (67) at (100.75, -33) {};
		\node [style=none] (68) at (101.25, -33) {};
		\node [style=none] (69) at (101.75, -33) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (51) to (52);
		\draw (53) to (51);
		\draw [in=-150, out=90] (47.center) to (55.center);
		\draw [in=-120, out=90, looseness=1.25] (52) to (54.center);
		\draw [in=-60, out=90, looseness=0.75] (49.center) to (60.center);
		\draw [in=90, out=-30, looseness=0.75] (59.center) to (56);
		\draw (56) to (57);
		\draw (57) to (58);
		\draw [style=red] (63.center) to (62.center);
		\draw (51) to (61);
		\draw (57) to (63.center);
		\draw [in=-90, out=135] (65) to (66.center);
		\draw [in=-90, out=105] (65) to (67.center);
		\draw [in=-90, out=75] (65) to (68.center);
		\draw [in=-90, out=45] (65) to (69.center);
		\draw [in=-135, out=90] (43.center) to (64);
		\draw [in=90, out=-105] (64) to (46);
		\draw [in=-75, out=90] (44.center) to (64);
		\draw [in=-45, out=90] (45) to (64);
		\draw [in=135, out=-90] (47.center) to (64);
		\draw [in=-90, out=105] (64) to (52);
		\draw [in=75, out=-90] (49.center) to (64);
		\draw [in=-90, out=45] (64) to (56);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (70) at (103.5, -37.75) {};
		\node [style=none] (71) at (105, -37.75) {};
		\node [style=X] (72) at (105.5, -37.5) {};
		\node [style=Z] (73) at (104, -37.5) {};
		\node [style=none] (74) at (103.5, -36) {};
		\node [style=none] (75) at (104, -36) {};
		\node [style=none] (76) at (105, -36) {};
		\node [style=none] (77) at (105.5, -36) {};
		\node [style=Z] (78) at (104.5, -35.75) {};
		\node [style=X] (79) at (104, -36) {};
		\node [style=Z] (80) at (104.5, -36.5) {};
		\node [style=none] (81) at (104.5, -34) {};
		\node [style=none] (82) at (104.5, -34) {};
		\node [style=Z] (83) at (105.5, -36) {};
		\node [style=X] (84) at (106, -35.75) {};
		\node [style=X] (85) at (106, -36.5) {};
		\node [style=none] (86) at (104.5, -34) {};
		\node [style=none] (87) at (104.5, -34) {};
		\node [style=Z] (88) at (104.5, -35) {};
		\node [style=none] (89) at (106, -33) {};
		\node [style=none] (90) at (106, -35) {};
		\node [style=map] (91) at (104.5, -34) {$U$};
		\node [style=none] (92) at (103.75, -33) {};
		\node [style=none] (93) at (104.25, -33) {};
		\node [style=none] (94) at (104.75, -33) {};
		\node [style=none] (95) at (105.25, -33) {};
		\node [style=X] (96) at (103.5, -36.75) {$a$};
		\node [style=X] (97) at (104, -36.75) {$b$};
		\node [style=X] (98) at (105, -36.75) {$c$};
		\node [style=X] (99) at (105.5, -36.75) {$d$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (78) to (79);
		\draw (80) to (78);
		\draw [in=-150, out=90] (74.center) to (82.center);
		\draw [in=-120, out=90, looseness=1.25] (79) to (81.center);
		\draw [in=-60, out=90, looseness=0.75] (76.center) to (87.center);
		\draw [in=90, out=-30, looseness=0.75] (86.center) to (83);
		\draw (83) to (84);
		\draw (84) to (85);
		\draw [style=red] (90.center) to (89.center);
		\draw (78) to (88);
		\draw (84) to (90.center);
		\draw [in=-90, out=135] (91) to (92.center);
		\draw [in=-90, out=105] (91) to (93.center);
		\draw [in=-90, out=75] (91) to (94.center);
		\draw [in=-90, out=45] (91) to (95.center);
		\draw (70.center) to (96);
		\draw (96) to (74.center);
		\draw (79) to (97);
		\draw (97) to (73);
		\draw (71.center) to (98);
		\draw (98) to (76.center);
		\draw (83) to (99);
		\draw (99) to (72);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (100) at (107, -37.75) {};
		\node [style=none] (101) at (108.5, -37.75) {};
		\node [style=X] (102) at (109, -37.5) {};
		\node [style=Z] (103) at (107.5, -37.5) {};
		\node [style=none] (104) at (107, -36.5) {};
		\node [style=none] (105) at (107.5, -36.5) {};
		\node [style=none] (106) at (108.5, -36.5) {};
		\node [style=none] (107) at (109, -36.5) {};
		\node [style=Z] (108) at (108, -36.25) {};
		\node [style=X] (109) at (107.5, -36.5) {};
		\node [style=Z] (110) at (108, -37) {};
		\node [style=none] (111) at (108, -34) {};
		\node [style=none] (112) at (108, -34) {};
		\node [style=Z] (113) at (109, -36.5) {};
		\node [style=X] (114) at (109.5, -36.25) {};
		\node [style=X] (115) at (109.5, -37) {};
		\node [style=none] (116) at (108, -34) {};
		\node [style=none] (117) at (108, -34) {};
		\node [style=Z] (118) at (108, -35.5) {};
		\node [style=none] (119) at (109.5, -33) {};
		\node [style=none] (120) at (109.5, -35) {};
		\node [style=map] (121) at (108, -34) {$U$};
		\node [style=none] (122) at (107.25, -33) {};
		\node [style=none] (123) at (107.75, -33) {};
		\node [style=none] (124) at (108.25, -33) {};
		\node [style=none] (125) at (108.75, -33) {};
		\node [style=X] (126) at (107, -35.5) {$a$};
		\node [style=X] (127) at (107.5, -35.5) {$b$};
		\node [style=X] (128) at (108.5, -35.5) {$c$};
		\node [style=X] (129) at (109, -35.5) {$d$};
		\node [style=X] (130) at (109.5, -35.5) {$d$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (108) to (109);
		\draw (110) to (108);
		\draw (113) to (114);
		\draw (114) to (115);
		\draw [style=red] (120.center) to (119.center);
		\draw (108) to (118);
		\draw (114) to (120.center);
		\draw [in=-90, out=135] (121) to (122.center);
		\draw [in=-90, out=105] (121) to (123.center);
		\draw [in=-90, out=75] (121) to (124.center);
		\draw [in=-90, out=45] (121) to (125.center);
		\draw (100.center) to (104.center);
		\draw (104.center) to (126);
		\draw [in=225, out=90] (126) to (121);
		\draw [in=90, out=-120] (121) to (127);
		\draw (127) to (109);
		\draw (109) to (103);
		\draw (101.center) to (106.center);
		\draw (102) to (113);
		\draw (113) to (129);
		\draw [in=90, out=-45] (121) to (129);
		\draw [in=300, out=90] (128) to (121);
		\draw (106.center) to (128);
	\end{pgfonlayer}
\end{tikzpicture}\\
&=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (131) at (298, -36.5) {};
		\node [style=Z] (132) at (297, -36.5) {};
		\node [style=none] (133) at (296.5, -36.75) {};
		\node [style=none] (134) at (297.5, -36.75) {};
		\node [style=none] (135) at (297.25, -34) {};
		\node [style=none] (136) at (297.25, -34) {};
		\node [style=none] (137) at (297.25, -34) {};
		\node [style=none] (138) at (297.25, -34) {};
		\node [style=none] (139) at (298.5, -33) {};
		\node [style=none] (140) at (298.5, -35) {};
		\node [style=map] (141) at (297.25, -34) {$U$};
		\node [style=none] (142) at (296.5, -33) {};
		\node [style=none] (143) at (297, -33) {};
		\node [style=none] (144) at (297.5, -33) {};
		\node [style=none] (145) at (298, -33) {};
		\node [style=X] (146) at (296.5, -35.5) {$a$};
		\node [style=X] (147) at (297, -35.5) {$b$};
		\node [style=X] (148) at (297.5, -35.5) {$c$};
		\node [style=X] (149) at (298, -35.5) {$d$};
		\node [style=X] (150) at (298.5, -34.75) {$d$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (140.center) to (139.center);
		\draw [in=-90, out=135] (141) to (142.center);
		\draw [in=-90, out=105] (141) to (143.center);
		\draw [in=-90, out=75] (141) to (144.center);
		\draw [in=-90, out=45] (141) to (145.center);
		\draw (133.center) to (146);
		\draw [in=225, out=90] (146) to (141);
		\draw [in=90, out=-120] (141) to (147);
		\draw [in=90, out=-45] (141) to (149);
		\draw [in=300, out=90] (148) to (141);
		\draw (134.center) to (148);
		\draw (132) to (147);
		\draw (149) to (131);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (456) at (347, -36.5) {};
		\node [style=Z] (457) at (346, -36.5) {};
		\node [style=none] (458) at (345.5, -36.5) {};
		\node [style=none] (459) at (346.5, -36.5) {};
		\node [style=none] (460) at (346.25, -34) {};
		\node [style=none] (461) at (346.25, -34) {};
		\node [style=none] (462) at (346.25, -34) {};
		\node [style=none] (463) at (346.25, -34) {};
		\node [style=none] (464) at (347.5, -33) {};
		\node [style=none] (465) at (347.5, -34.25) {};
		\node [style=map] (466) at (346.25, -34) {$U$};
		\node [style=none] (467) at (345.5, -33) {};
		\node [style=none] (468) at (346, -33) {};
		\node [style=none] (469) at (346.5, -33) {};
		\node [style=none] (470) at (347, -33) {};
		\node [style=X] (471) at (347.5, -34.25) {$d$};
		\node [style=map] (472) at (346.25, -35) {$U;W(e);U^\dag$};
		\node [style=none] (473) at (345.5, -37) {};
		\node [style=none] (474) at (346.5, -37) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (465.center) to (464.center);
		\draw [in=-90, out=135] (466) to (467.center);
		\draw [in=-90, out=105] (466) to (468.center);
		\draw [in=-90, out=75] (466) to (469.center);
		\draw [in=-90, out=45] (466) to (470.center);
		\draw [in=-75, out=90] (459.center) to (472);
		\draw [in=90, out=-135] (472) to (458.center);
		\draw [in=-105, out=90] (457) to (472);
		\draw [in=90, out=-45] (472) to (456);
		\draw (472) to (466);
		\draw (473.center) to (458.center);
		\draw (474.center) to (459.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (170) at (304.75, -36.75) {};
		\node [style=none] (171) at (305.75, -36.75) {};
		\node [style=X] (172) at (306.25, -36.5) {};
		\node [style=Z] (173) at (305.25, -36.5) {};
		\node [style=none] (174) at (304.75, -36.5) {};
		\node [style=none] (175) at (305.75, -36.5) {};
		\node [style=none] (176) at (305.5, -34) {};
		\node [style=none] (177) at (305.5, -34) {};
		\node [style=none] (178) at (305.5, -34) {};
		\node [style=none] (179) at (305.5, -34) {};
		\node [style=none] (180) at (306.75, -33) {};
		\node [style=none] (181) at (306.75, -34.5) {};
		\node [style=map] (182) at (305.5, -34) {$W(e)$};
		\node [style=none] (183) at (304.75, -33) {};
		\node [style=none] (184) at (305.25, -33) {};
		\node [style=none] (185) at (305.75, -33) {};
		\node [style=none] (186) at (306.25, -33) {};
		\node [style=X] (187) at (306.75, -34.5) {$d$};
		\node [style=map] (188) at (305.5, -35) {$U$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (181.center) to (180.center);
		\draw [in=-90, out=135] (182) to (183.center);
		\draw [in=-90, out=105] (182) to (184.center);
		\draw [in=-90, out=75] (182) to (185.center);
		\draw [in=-90, out=45] (182) to (186.center);
		\draw (170.center) to (174.center);
		\draw (171.center) to (175.center);
		\draw [in=-75, out=90] (175.center) to (188);
		\draw [in=90, out=-135] (188) to (174.center);
		\draw [in=-105, out=90] (173) to (188);
		\draw [in=90, out=-45] (188) to (172);
		\draw (188) to (182);
	\end{pgfonlayer}
\end{tikzpicture}
\end{align*}
Where $W((a,b),(c,d)) = U;W(e);U^\dag$.

The tuple $d \in \F_p^{n-k}$ is called the {\bf syndrome}. The syndrome measures the displacement of the basis elements $b_i$ by errors.
An error $W(e)$ is {\bf undetectable} if and only if the syndrome is the zero vector; this is because $e$ commutes with everything in $L+a$ meaning that $e \in L^\omega+a$.  In particular, the trivial error is undetectable; so undetectable errors are indistinguishable from having no errors at all.

To correct errors, we construct am operation classically controlled from the syndrome register.
Given any syndrome measurement $d\in \F_p^{n-k}$, pick an error $W(e)$ which one wishes to correct, where additionally, the trivial syndrome corrects nothing.  This determines a function $f:\F_p^{n-k}\to\F_p^{2n}$ sending $d\mapsto e$.


If $f$ is an affine transformation, then we can construct the classically controlled error correction operation $c_f$ so that given a syndrome $d$, it applies the operation $W(-f(d))$ to $n$ qudits.  This restriction requiring the function to affine comes from the fact that within the model we have constructed, only affine classical processing is allowed. Finally, we perform $U^\dag$ and then discard the ancillary qudits. The final error correction protocol is as follows:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=map] (475) at (351.75, 3) {$U$};
		\node [style=none] (476) at (350.75, 1.5) {};
		\node [style=none] (477) at (352, 1.5) {};
		\node [style=X] (478) at (352.5, 1.75) {};
		\node [style=Z] (479) at (351.25, 1.75) {};
		\node [style=none] (481) at (353, 6.25) {};
		\node [style=none] (483) at (354.25, 6.25) {};
		\node [style=Z] (484) at (353.5, 6.5) {};
		\node [style=X] (485) at (353, 6.25) {};
		\node [style=Z] (486) at (353.5, 5.75) {};
		\node [style=none] (487) at (353.5, 8.25) {};
		\node [style=none] (488) at (353.5, 8.25) {};
		\node [style=Z] (489) at (354.25, 6.25) {};
		\node [style=X] (490) at (354.75, 6.5) {};
		\node [style=X] (491) at (354.75, 5.75) {};
		\node [style=none] (492) at (353.5, 8.25) {};
		\node [style=none] (493) at (353.5, 8.25) {};
		\node [style=Z] (494) at (353.5, 7.25) {};
		\node [style=none] (495) at (354.5, 9) {};
		\node [style=none] (496) at (354.75, 7.25) {};
		\node [style=map] (497) at (352.75, 4) {$W(e)$};
		\node [style=map] (498) at (353.5, 5) {$U^\dag$};
		\node [style=map] (499) at (353.5, 8.25) {$U$};
		\node [style=none] (500) at (350.25, 13.25) {};
		\node [style=none] (501) at (353, 1.5) {};
		\node [style=none] (502) at (355.25, 7.25) {};
		\node [style=none] (503) at (350, 7.25) {};
		\node [style=none] (504) at (355.25, 1.75) {};
		\node [style=none] (505) at (350, 1.75) {};
		\node [style=none] (506) at (348.75, 7.5) {Syndrome};
		\node [style=none] (507) at (349, 1.75) {Encoding};
		\node [style=none] (508) at (349.5, 3) {Alice};
		\node [style=none] (509) at (353.75, 3) {Bob};
		\node [style=none] (510) at (355.25, 4) {};
		\node [style=none] (511) at (350, 4) {};
		\node [style=none] (512) at (349.25, 4) {Error};
		\node [style=none] (513) at (348.75, 7) {measurement};
		\node [style=Z] (514) at (353.5, 9) {};
		\node [style=map] (515) at (353.5, 10.25) {$c_f$};
		\node [style=none] (516) at (355.25, 10.25) {};
		\node [style=none] (517) at (350, 10.25) {};
		\node [style=none] (518) at (348.5, 10.25) {Error correction};
		\node [style=Z] (519) at (354.75, 8) {};
		\node [style=none] (520) at (355, 13.25) {};
		\node [style=map] (521) at (353.5, 11.75) {$U^\dag$};
		\node [style=none] (522) at (355.25, 11.75) {};
		\node [style=none] (523) at (350, 11.75) {};
		\node [style=none] (524) at (348.75, 11.75) {Decoding};
		\node [style=Z] (525) at (354.25, 12.75) {};
		\node [style=Z] (526) at (353.25, 12.75) {};
		\node [style=none] (527) at (353.75, 12.75) {};
		\node [style=none] (528) at (352.75, 12.75) {};
		\node [style=none] (529) at (352.75, 13.25) {};
		\node [style=none] (530) at (353.75, 13.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-60, out=90, looseness=0.75] (477.center) to (475);
		\draw [in=90, out=-165] (475) to (476.center);
		\draw [in=-30, out=90] (478) to (475);
		\draw [in=90, out=-135] (475) to (479);
		\draw (484) to (485);
		\draw (486) to (484);
		\draw [in=-120, out=90, looseness=1.25] (485) to (487.center);
		\draw [in=90, out=-30, looseness=0.75] (492.center) to (489);
		\draw (489) to (490);
		\draw (490) to (491);
		\draw (484) to (494);
		\draw (490) to (496.center);
		\draw [in=-90, out=90] (475) to (497);
		\draw [in=-90, out=90] (497) to (498);
		\draw [in=135, out=-90] (481.center) to (498);
		\draw [in=30, out=-90, looseness=0.75] (483.center) to (498);
		\draw [style=dotted, in=270, out=90] (501.center) to (500.center);
		\draw [style=dotted] (503.center) to (502.center);
		\draw [style=dotted] (505.center) to (504.center);
		\draw [style=dotted] (511.center) to (510.center);
		\draw [in=-165, out=150] (499) to (515);
		\draw [in=30, out=-30, looseness=1.25] (515) to (499);
		\draw [bend right=45] (499) to (515);
		\draw [bend right=45, looseness=0.75] (515) to (499);
		\draw [in=-15, out=90, looseness=0.75] (495.center) to (515);
		\draw [in=-105, out=90, looseness=0.75] (514) to (515);
		\draw [style=dotted] (517.center) to (516.center);
		\draw [style=red, in=-90, out=120] (519) to (495.center);
		\draw [style=red, in=-90, out=60, looseness=0.25] (519) to (520.center);
		\draw [style=dotted] (523.center) to (522.center);
		\draw [in=-90, out=60] (521) to (527.center);
		\draw [in=-90, out=45] (521) to (525);
		\draw [in=-90, out=120] (521) to (526);
		\draw [in=-90, out=135, looseness=0.75] (521) to (528.center);
		\draw (528.center) to (529.center);
		\draw (527.center) to (530.center);
		\draw [bend right=60, looseness=1.50] (515) to (521);
		\draw [bend right=60, looseness=1.50] (521) to (515);
		\draw [bend left, looseness=1.25] (515) to (521);
		\draw [bend left, looseness=1.25] (521) to (515);
		\draw [style=red] (496.center) to (519);
		\draw [bend right, looseness=0.75] (498) to (499);
		\draw [bend right=60] (499) to (498);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (605) at (371.75, 6.25) {};
		\node [style=none] (606) at (372.75, 6.25) {};
		\node [style=X] (607) at (373.25, 6.5) {};
		\node [style=Z] (608) at (372.25, 6.5) {};
		\node [style=map] (609) at (372.5, 7.75) {$U$};
		\node [style=X] (610) at (373.75, 9.25) {$d$};
		\node [style=map] (611) at (372.5, 8.5) {$W(e)$};
		\node [style=none] (612) at (372.5, 10.25) {};
		\node [style=none] (613) at (372.5, 10.25) {};
		\node [style=none] (614) at (372.5, 10.25) {};
		\node [style=none] (615) at (372.5, 10.25) {};
		\node [style=none] (616) at (373.75, 9.25) {};
		\node [style=Z] (617) at (372.5, 9.25) {};
		\node [style=map] (618) at (372.5, 10.25) {$c_f$};
		\node [style=X] (619) at (373.75, 11.25) {$d$};
		\node [style=none] (620) at (373.75, 13.75) {};
		\node [style=map] (621) at (372.5, 12.25) {$U^\dag$};
		\node [style=Z] (622) at (373.25, 13.25) {};
		\node [style=Z] (623) at (372.25, 13.25) {};
		\node [style=none] (624) at (372.75, 13.25) {};
		\node [style=none] (625) at (371.75, 13.25) {};
		\node [style=none] (626) at (371.75, 13.75) {};
		\node [style=none] (627) at (372.75, 13.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-30] (609) to (607);
		\draw [in=-60, out=90] (606.center) to (609);
		\draw [in=-120, out=90] (608) to (609);
		\draw [in=-150, out=90] (605.center) to (609);
		\draw (609) to (611);
		\draw [bend left=60, looseness=1.50] (611) to (612.center);
		\draw [in=-30, out=30, looseness=1.50] (611) to (615.center);
		\draw [in=60, out=-60, looseness=1.25] (614.center) to (611);
		\draw [in=-120, out=120, looseness=1.25] (611) to (613.center);
		\draw [in=-15, out=90] (616.center) to (618);
		\draw (617) to (618);
		\draw [style=red] (619) to (620.center);
		\draw [in=-90, out=60] (621) to (624.center);
		\draw [in=-90, out=45] (621) to (622);
		\draw [in=-90, out=120] (621) to (623);
		\draw [in=-90, out=135, looseness=0.75] (621) to (625.center);
		\draw (625.center) to (626.center);
		\draw (624.center) to (627.center);
		\draw [bend right] (621) to (618);
		\draw [bend right] (618) to (621);
		\draw [bend right=60, looseness=1.25] (621) to (618);
		\draw [bend right=60, looseness=1.25] (618) to (621);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (425) at (339.5, 6) {};
		\node [style=none] (426) at (340.5, 6) {};
		\node [style=X] (427) at (341, 6.25) {};
		\node [style=Z] (428) at (340, 6.25) {};
		\node [style=map] (429) at (340.25, 7.5) {$U$};
		\node [style=map] (430) at (340.25, 8.25) {$W(e)$};
		\node [style=map] (431) at (340.25, 9) {$W(-f(d))$};
		\node [style=X] (432) at (341.5, 9.5) {$d$};
		\node [style=none] (433) at (341.5, 11.25) {};
		\node [style=map] (434) at (340.25, 9.75) {$U^\dag$};
		\node [style=Z] (435) at (341, 10.75) {};
		\node [style=Z] (436) at (340, 10.75) {};
		\node [style=none] (437) at (340.5, 10.75) {};
		\node [style=none] (438) at (339.5, 10.75) {};
		\node [style=none] (439) at (339.5, 11.25) {};
		\node [style=none] (440) at (340.5, 11.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-30] (429) to (427);
		\draw [in=-60, out=90] (426.center) to (429);
		\draw [in=-120, out=90] (428) to (429);
		\draw [in=-150, out=90] (425.center) to (429);
		\draw (429) to (430);
		\draw (430) to (431);
		\draw [style=red] (432) to (433.center);
		\draw [in=-90, out=60] (434) to (437.center);
		\draw [in=-90, out=45] (434) to (435);
		\draw [in=-90, out=120] (434) to (436);
		\draw [in=-90, out=135, looseness=0.75] (434) to (438.center);
		\draw (438.center) to (439.center);
		\draw (437.center) to (440.center);
		\draw (431) to (434);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (554) at (359.25, 6.5) {};
		\node [style=none] (555) at (360.25, 6.5) {};
		\node [style=X] (556) at (360.75, 6.75) {};
		\node [style=Z] (557) at (359.75, 6.75) {};
		\node [style=map] (558) at (360, 8) {$U$};
		\node [style=map] (559) at (360, 8.75) {$W(e-f(d))$};
		\node [style=X] (560) at (361.25, 9.5) {$d$};
		\node [style=none] (561) at (361.25, 11) {};
		\node [style=map] (562) at (360, 9.5) {$U^\dag$};
		\node [style=Z] (563) at (360.75, 10.5) {};
		\node [style=Z] (564) at (359.75, 10.5) {};
		\node [style=none] (565) at (360.25, 10.5) {};
		\node [style=none] (566) at (359.25, 10.5) {};
		\node [style=none] (567) at (359.25, 11) {};
		\node [style=none] (568) at (360.25, 11) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-30] (558) to (556);
		\draw [in=-60, out=90] (555.center) to (558);
		\draw [in=-120, out=90] (557) to (558);
		\draw [in=-150, out=90] (554.center) to (558);
		\draw (558) to (559);
		\draw [style=red] (560) to (561.center);
		\draw [in=-90, out=60] (562) to (565.center);
		\draw [in=-90, out=45] (562) to (563);
		\draw [in=-90, out=120] (562) to (564);
		\draw [in=-90, out=135, looseness=0.75] (562) to (566.center);
		\draw (566.center) to (567.center);
		\draw (565.center) to (568.center);
		\draw (559) to (562);
	\end{pgfonlayer}
\end{tikzpicture}
$$


So that if $e=f(d)$ then this reduces to the identity channel:

$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1079) at (162.5, 6.5) {};
		\node [style=none] (1080) at (164, 6.5) {};
		\node [style=X] (1081) at (164.5, 6.75) {};
		\node [style=Z] (1082) at (163, 6.75) {};
		\node [style=map] (1083) at (163.5, 8) {$U$};
		\node [style=map] (1088) at (163.5, 8.75) {$W(e-f(d))$};
		\node [style=X] (1089) at (165.25, 8.75) {$d$};
		\node [style=none] (1090) at (165.25, 11) {};
		\node [style=map] (1103) at (163.5, 9.5) {$U^\dag$};
		\node [style=Z] (1104) at (164.5, 10.5) {};
		\node [style=Z] (1105) at (163, 10.5) {};
		\node [style=none] (1106) at (164, 10.5) {};
		\node [style=none] (1107) at (162.5, 10.5) {};
		\node [style=none] (1108) at (162.5, 11) {};
		\node [style=none] (1109) at (164, 11) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-30] (1083) to (1081);
		\draw [in=-60, out=90] (1080.center) to (1083);
		\draw [in=-120, out=90] (1082) to (1083);
		\draw [in=-150, out=90] (1079.center) to (1083);
		\draw (1083) to (1088);
		\draw [style=red] (1089) to (1090.center);
		\draw [in=-90, out=60] (1103) to (1106.center);
		\draw [in=-90, out=45] (1103) to (1104);
		\draw [in=-90, out=120] (1103) to (1105);
		\draw [in=-90, out=135, looseness=0.75] (1103) to (1107.center);
		\draw (1107.center) to (1108.center);
		\draw (1106.center) to (1109.center);
		\draw (1088) to (1103);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1110) at (166.25, 6.5) {};
		\node [style=none] (1111) at (167.75, 6.5) {};
		\node [style=X] (1112) at (168.25, 6.75) {};
		\node [style=Z] (1113) at (166.75, 6.75) {};
		\node [style=map] (1114) at (167.25, 8) {$U$};
		\node [style=X] (1116) at (169, 8.75) {$d$};
		\node [style=none] (1117) at (169, 10.25) {};
		\node [style=map] (1118) at (167.25, 8.75) {$U^\dag$};
		\node [style=Z] (1119) at (168.25, 9.75) {};
		\node [style=Z] (1120) at (166.75, 9.75) {};
		\node [style=none] (1121) at (167.75, 9.75) {};
		\node [style=none] (1122) at (166.25, 9.75) {};
		\node [style=none] (1123) at (166.25, 10.25) {};
		\node [style=none] (1124) at (167.75, 10.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=90, out=-30] (1114) to (1112);
		\draw [in=-60, out=90] (1111.center) to (1114);
		\draw [in=-120, out=90] (1113) to (1114);
		\draw [in=-150, out=90] (1110.center) to (1114);
		\draw [style=red] (1116) to (1117.center);
		\draw [in=-90, out=60] (1118) to (1121.center);
		\draw [in=-90, out=45] (1118) to (1119);
		\draw [in=-90, out=120] (1118) to (1120);
		\draw [in=-90, out=135, looseness=0.75] (1118) to (1122.center);
		\draw (1122.center) to (1123.center);
		\draw (1121.center) to (1124.center);
		\draw (1114) to (1118);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1124) at (170, 6.5) {};
		\node [style=none] (1125) at (171.5, 6.5) {};
		\node [style=X] (1126) at (172, 6.75) {};
		\node [style=Z] (1127) at (170.5, 6.75) {};
		\node [style=X] (1129) at (172.75, 8.75) {$d$};
		\node [style=none] (1130) at (172.75, 10.25) {};
		\node [style=Z] (1132) at (172, 9.75) {};
		\node [style=Z] (1133) at (170.5, 9.75) {};
		\node [style=none] (1134) at (171.5, 10.25) {};
		\node [style=none] (1135) at (170, 10.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (1129) to (1130.center);
		\draw (1126) to (1132);
		\draw (1125.center) to (1134.center);
		\draw (1124.center) to (1135.center);
		\draw (1127) to (1133);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1136) at (174.5, 6.5) {};
		\node [style=none] (1137) at (175.25, 6.5) {};
		\node [style=X] (1140) at (176, 8.75) {$d$};
		\node [style=none] (1141) at (176, 10.25) {};
		\node [style=none] (1144) at (175.25, 10.25) {};
		\node [style=none] (1145) at (174.5, 10.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (1140) to (1141.center);
		\draw (1137.center) to (1144.center);
		\draw (1136.center) to (1145.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

%Because the encoder is an affine symplectomorphism,  it an affine transformation ${\sf enc}: \F_p^{2k}\to \F_p^{2n}$.  Given a logical Weyl operator $W(z,x)$ on $k$ qudits the corresponding physical operator is $W({\sf enc}(z,x))$ on $n$ qudits.  One may wish to apply logical operations to the physically encoded state before the decoding proceedure.


All of the things we have discussed in the section also works for qubits when the stabilizer code has trivial phases linear: ie, it is a CSS code, possibly with Weyl operators.  Indeed qubit CSS codes are very common in the literature.  We use the threefold qubit repetition code (see \cite[\S 10.1.1]{nielsen}) as an example:
\begin{example}
\label{ex:rep}
Consider the Linear subspace:
$$
S = \{ ((z_1,z_2,z_3),(x_1,x_2,x_3)) : x_1=x_2=x_3 \} \subseteq \F_2^{6}
$$
Which can be written in the form of a circuit:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (853) at (88.75, 2) {};
		\node [style=none] (854) at (89.25, 2) {};
		\node [style=none] (855) at (89.75, 2) {};
		\node [style=none] (856) at (86.75, 2) {};
		\node [style=none] (857) at (87.25, 2) {};
		\node [style=none] (858) at (87.75, 2) {};
		\node [style=map] (859) at (88.25, 0.75) {$S$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=105] (859) to (858.center);
		\draw [in=135, out=-90, looseness=0.75] (857.center) to (859);
		\draw [in=-90, out=150, looseness=0.75] (859) to (856.center);
		\draw [in=75, out=-90] (853.center) to (859);
		\draw [in=-90, out=45, looseness=0.75] (859) to (854.center);
		\draw [in=30, out=-90, looseness=0.75] (855.center) to (859);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=Z] (1149) at (180.25, 1) {};
		\node [style=none] (1156) at (177.75, 1) {};
		\node [style=none] (1157) at (178.25, 1) {};
		\node [style=none] (1158) at (178.75, 1) {};
		\node [style=none] (1163) at (179.75, 2) {};
		\node [style=none] (1164) at (180.25, 2) {};
		\node [style=none] (1165) at (180.75, 2) {};
		\node [style=none] (1166) at (177.75, 2) {};
		\node [style=none] (1167) at (178.25, 2) {};
		\node [style=none] (1168) at (178.75, 2) {};
		\node [style=Z] (1169) at (177.75, 1) {};
		\node [style=Z] (1170) at (178.25, 1) {};
		\node [style=Z] (1171) at (178.75, 1) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=30] (1149) to (1165.center);
		\draw (1164.center) to (1149);
		\draw [in=-90, out=150] (1149) to (1163.center);
		\draw (1171) to (1168.center);
		\draw (1170) to (1167.center);
		\draw (1169) to (1166.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (3, 0) {};
		\node [style=none] (1) at (3.5, 0) {};
		\node [style=none] (2) at (4, 0) {};
		\node [style=Z] (3) at (3, 0.5) {};
		\node [style=Z] (4) at (3, 1) {};
		\node [style=X] (5) at (3.5, 0.75) {};
		\node [style=X] (6) at (4, 1.5) {};
		\node [style=X] (7) at (4, 0) {};
		\node [style=X] (8) at (3.5, 0) {};
		\node [style=Z] (9) at (3, 0) {};
		\node [style=none] (10) at (1, 0) {};
		\node [style=none] (11) at (1.5, 0) {};
		\node [style=none] (12) at (2, 0) {};
		\node [style=Z] (17) at (1.5, 0.75) {};
		\node [style=X] (18) at (1, 0.5) {};
		\node [style=X] (19) at (1, 1) {};
		\node [style=Z] (20) at (2, 1.5) {};
		\node [style=none] (21) at (3, 2) {};
		\node [style=none] (22) at (3.5, 2) {};
		\node [style=none] (23) at (4, 2) {};
		\node [style=none] (24) at (1, 2) {};
		\node [style=none] (25) at (1.5, 2) {};
		\node [style=none] (26) at (2, 2) {};
		\node [style=Z] (27) at (1, 0) {};
		\node [style=Z] (28) at (1.5, 0) {};
		\node [style=Z] (29) at (2, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (3);
		\draw (1.center) to (5);
		\draw (2.center) to (6);
		\draw (3) to (5);
		\draw (6) to (4);
		\draw (3) to (4);
		\draw (19) to (20);
		\draw (18) to (17);
		\draw (17) to (11.center);
		\draw (10.center) to (18);
		\draw (18) to (19);
		\draw (12.center) to (20);
		\draw (6) to (23.center);
		\draw (22.center) to (5);
		\draw (4) to (21.center);
		\draw (20) to (26.center);
		\draw (25.center) to (17);
		\draw (19) to (24.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
$S$ is coisotropic because:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (853) at (88.75, 2) {};
		\node [style=none] (854) at (89.25, 2) {};
		\node [style=none] (855) at (89.75, 2) {};
		\node [style=none] (856) at (86.75, 2) {};
		\node [style=none] (857) at (87.25, 2) {};
		\node [style=none] (858) at (87.75, 2) {};
		\node [style=map] (859) at (88.25, 0.75) {$S$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=105] (859) to (858.center);
		\draw [in=135, out=-90, looseness=0.75] (857.center) to (859);
		\draw [in=-90, out=150, looseness=0.75] (859) to (856.center);
		\draw [in=75, out=-90] (853.center) to (859);
		\draw [in=-90, out=45, looseness=0.75] (859) to (854.center);
		\draw [in=30, out=-90, looseness=0.75] (855.center) to (859);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (0) at (3, 0) {};
		\node [style=none] (1) at (3.5, 0) {};
		\node [style=none] (2) at (4, 0) {};
		\node [style=Z] (3) at (3, 0.5) {};
		\node [style=Z] (4) at (3, 1) {};
		\node [style=X] (5) at (3.5, 0.75) {};
		\node [style=X] (6) at (4, 1.5) {};
		\node [style=X] (7) at (4, 0) {};
		\node [style=X] (8) at (3.5, 0) {};
		\node [style=Z] (9) at (3, 0) {};
		\node [style=none] (10) at (1, 0) {};
		\node [style=none] (11) at (1.5, 0) {};
		\node [style=none] (12) at (2, 0) {};
		\node [style=Z] (17) at (1.5, 0.75) {};
		\node [style=X] (18) at (1, 0.5) {};
		\node [style=X] (19) at (1, 1) {};
		\node [style=Z] (20) at (2, 1.5) {};
		\node [style=none] (21) at (3, 2) {};
		\node [style=none] (22) at (3.5, 2) {};
		\node [style=none] (23) at (4, 2) {};
		\node [style=none] (24) at (1, 2) {};
		\node [style=none] (25) at (1.5, 2) {};
		\node [style=none] (26) at (2, 2) {};
		\node [style=Z] (27) at (1, 0) {};
		\node [style=Z] (28) at (1.5, 0) {};
		\node [style=Z] (29) at (2, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (0.center) to (3);
		\draw (1.center) to (5);
		\draw (2.center) to (6);
		\draw (3) to (5);
		\draw (6) to (4);
		\draw (3) to (4);
		\draw (19) to (20);
		\draw (18) to (17);
		\draw (17) to (11.center);
		\draw (10.center) to (18);
		\draw (18) to (19);
		\draw (12.center) to (20);
		\draw (6) to (23.center);
		\draw (22.center) to (5);
		\draw (4) to (21.center);
		\draw (20) to (26.center);
		\draw (25.center) to (17);
		\draw (19) to (24.center);
	\end{pgfonlayer}
\end{tikzpicture}
\supseteq
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (934) at (102, 0) {};
		\node [style=none] (935) at (102.5, 0) {};
		\node [style=none] (936) at (103, 0) {};
		\node [style=Z] (937) at (102, 0.5) {};
		\node [style=Z] (938) at (102, 1) {};
		\node [style=X] (939) at (102.5, 0.75) {};
		\node [style=X] (940) at (103, 1.5) {};
		\node [style=X] (941) at (103, 0) {};
		\node [style=X] (942) at (102.5, 0) {};
		\node [style=none] (943) at (100.25, 0) {};
		\node [style=none] (944) at (100.75, 0) {};
		\node [style=none] (945) at (101.25, 0) {};
		\node [style=Z] (946) at (100.75, 0.75) {};
		\node [style=X] (947) at (100.25, 0.5) {};
		\node [style=X] (948) at (100.25, 1) {};
		\node [style=Z] (949) at (101.25, 1.5) {};
		\node [style=none] (950) at (102, 2) {};
		\node [style=none] (951) at (102.5, 2) {};
		\node [style=none] (952) at (103, 2) {};
		\node [style=none] (953) at (100.25, 2) {};
		\node [style=none] (954) at (100.75, 2) {};
		\node [style=none] (955) at (101.25, 2) {};
		\node [style=Z] (956) at (100.75, 0) {};
		\node [style=Z] (957) at (101.25, 0) {};
		\node [style=X] (958) at (100.25, 0) {};
		\node [style=X] (959) at (102, 0) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (934.center) to (937);
		\draw (935.center) to (939);
		\draw (936.center) to (940);
		\draw (937) to (939);
		\draw (940) to (938);
		\draw (937) to (938);
		\draw (948) to (949);
		\draw (947) to (946);
		\draw (946) to (944.center);
		\draw (943.center) to (947);
		\draw (947) to (948);
		\draw (945.center) to (949);
		\draw (940) to (952.center);
		\draw (951.center) to (939);
		\draw (938) to (950.center);
		\draw (949) to (955.center);
		\draw (954.center) to (946);
		\draw (948) to (953.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (862) at (92, 0) {};
		\node [style=none] (863) at (92.5, 0) {};
		\node [style=none] (864) at (93, 0) {};
		\node [style=Z] (865) at (92, 0.5) {};
		\node [style=Z] (866) at (92, 1) {};
		\node [style=X] (867) at (92.5, 0.75) {};
		\node [style=X] (868) at (93, 1.5) {};
		\node [style=X] (869) at (93, 0) {};
		\node [style=X] (870) at (92.5, 0) {};
		\node [style=none] (872) at (93.75, 0) {};
		\node [style=none] (873) at (94.25, 0) {};
		\node [style=none] (874) at (94.75, 0) {};
		\node [style=Z] (875) at (94.25, 0.75) {};
		\node [style=X] (876) at (93.75, 0.5) {};
		\node [style=X] (877) at (93.75, 1) {};
		\node [style=Z] (878) at (94.75, 1.5) {};
		\node [style=none] (879) at (92, 2) {};
		\node [style=none] (880) at (92.5, 2) {};
		\node [style=none] (881) at (93, 2) {};
		\node [style=none] (882) at (93.75, 2) {};
		\node [style=none] (883) at (94.25, 2) {};
		\node [style=none] (884) at (94.75, 2) {};
		\node [style=Z] (886) at (94.25, 0) {};
		\node [style=Z] (887) at (94.75, 0) {};
		\node [style=X] (888) at (93.75, 0) {};
		\node [style=X] (889) at (92, 0) {};
		\node [style=s] (890) at (92, 2) {};
		\node [style=s] (891) at (92.5, 2) {};
		\node [style=s] (892) at (93, 2) {};
		\node [style=none] (893) at (93.75, 3.75) {};
		\node [style=none] (894) at (94.25, 3.75) {};
		\node [style=none] (895) at (94.75, 3.75) {};
		\node [style=none] (896) at (92, 3.75) {};
		\node [style=none] (897) at (92.5, 3.75) {};
		\node [style=none] (898) at (93, 3.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (862.center) to (865);
		\draw (863.center) to (867);
		\draw (864.center) to (868);
		\draw (865) to (867);
		\draw (868) to (866);
		\draw (865) to (866);
		\draw (877) to (878);
		\draw (876) to (875);
		\draw (875) to (873.center);
		\draw (872.center) to (876);
		\draw (876) to (877);
		\draw (874.center) to (878);
		\draw (868) to (881.center);
		\draw (880.center) to (867);
		\draw (866) to (879.center);
		\draw (878) to (884.center);
		\draw (883.center) to (875);
		\draw (877) to (882.center);
		\draw [in=270, out=90] (892) to (895.center);
		\draw [in=270, out=90] (891) to (894.center);
		\draw [in=270, out=90] (890) to (893.center);
		\draw [in=270, out=90] (882.center) to (896.center);
		\draw [in=90, out=-90] (897.center) to (883.center);
		\draw [in=270, out=90] (884.center) to (898.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (853) at (88.75, 2) {};
		\node [style=none] (854) at (89.25, 2) {};
		\node [style=none] (855) at (89.75, 2) {};
		\node [style=none] (856) at (86.75, 2) {};
		\node [style=none] (857) at (87.25, 2) {};
		\node [style=none] (858) at (87.75, 2) {};
		\node [style=map] (859) at (88.25, 0.75) {$S^\omega$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=-90, out=105] (859) to (858.center);
		\draw [in=135, out=-90, looseness=0.75] (857.center) to (859);
		\draw [in=-90, out=150, looseness=0.75] (859) to (856.center);
		\draw [in=75, out=-90] (853.center) to (859);
		\draw [in=-90, out=45, looseness=0.75] (859) to (854.center);
		\draw [in=30, out=-90, looseness=0.75] (855.center) to (859);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Chopping off the maximally mixed state gives us an encoding map:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (2085) at (279.75, -3.25) {};
		\node [style=none] (2086) at (280.25, -3) {};
		\node [style=none] (2087) at (280.75, -3) {};
		\node [style=Z] (2088) at (279.75, -2.5) {};
		\node [style=Z] (2089) at (279.75, -2) {};
		\node [style=X] (2090) at (280.25, -2.25) {};
		\node [style=X] (2091) at (280.75, -1.5) {};
		\node [style=X] (2092) at (280.75, -3) {};
		\node [style=X] (2093) at (280.25, -3) {};
		\node [style=none] (2094) at (277.75, -3.25) {};
		\node [style=none] (2095) at (278.25, -3) {};
		\node [style=none] (2096) at (278.75, -3) {};
		\node [style=Z] (2097) at (278.25, -2.25) {};
		\node [style=X] (2098) at (277.75, -2.5) {};
		\node [style=X] (2099) at (277.75, -2) {};
		\node [style=Z] (2100) at (278.75, -1.5) {};
		\node [style=none] (2101) at (279.75, -1) {};
		\node [style=none] (2102) at (280.25, -1) {};
		\node [style=none] (2103) at (280.75, -1) {};
		\node [style=none] (2104) at (277.75, -1) {};
		\node [style=none] (2105) at (278.25, -1) {};
		\node [style=none] (2106) at (278.75, -1) {};
		\node [style=Z] (2107) at (278.25, -3) {};
		\node [style=Z] (2108) at (278.75, -3) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2085.center) to (2088);
		\draw (2086.center) to (2090);
		\draw (2087.center) to (2091);
		\draw (2088) to (2090);
		\draw (2091) to (2089);
		\draw (2088) to (2089);
		\draw (2099) to (2100);
		\draw (2098) to (2097);
		\draw (2097) to (2095.center);
		\draw (2094.center) to (2098);
		\draw (2098) to (2099);
		\draw (2096.center) to (2100);
		\draw (2091) to (2103.center);
		\draw (2102.center) to (2090);
		\draw (2089) to (2101.center);
		\draw (2100) to (2106.center);
		\draw (2105.center) to (2097);
		\draw (2099) to (2104.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Also, we will chose to measure in the $Z$-basis:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (2109) at (283.75, -6.25) {};
		\node [style=none] (2110) at (284.25, -6.5) {};
		\node [style=none] (2111) at (284.75, -6.5) {};
		\node [style=Z] (2112) at (283.75, -5.75) {};
		\node [style=Z] (2113) at (283.75, -5.25) {};
		\node [style=X] (2114) at (284.25, -5.5) {};
		\node [style=X] (2115) at (284.75, -4.75) {};
		\node [style=none] (2116) at (281.75, -6.25) {};
		\node [style=none] (2117) at (282.25, -6.25) {};
		\node [style=none] (2118) at (282.75, -6.25) {};
		\node [style=Z] (2119) at (282.25, -5.5) {};
		\node [style=X] (2120) at (281.75, -5.75) {};
		\node [style=X] (2121) at (281.75, -5.25) {};
		\node [style=Z] (2122) at (282.75, -4.75) {};
		\node [style=none] (2123) at (283.75, -4.25) {};
		\node [style=none] (2124) at (284.25, -4.25) {};
		\node [style=none] (2125) at (284.75, -4.25) {};
		\node [style=none] (2126) at (281.75, -4.25) {};
		\node [style=none] (2127) at (282.25, -4.25) {};
		\node [style=none] (2128) at (282.75, -4.25) {};
		\node [style=Z] (2129) at (282.25, -6.25) {};
		\node [style=Z] (2130) at (282.75, -6.25) {};
		\node [style=Z] (2131) at (283.75, -6.25) {};
		\node [style=Z] (2132) at (281.75, -6.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2109.center) to (2112);
		\draw (2110.center) to (2114);
		\draw (2111.center) to (2115);
		\draw (2112) to (2114);
		\draw (2115) to (2113);
		\draw (2112) to (2113);
		\draw (2121) to (2122);
		\draw (2120) to (2119);
		\draw (2119) to (2117.center);
		\draw (2116.center) to (2120);
		\draw (2120) to (2121);
		\draw (2118.center) to (2122);
		\draw (2115) to (2125.center);
		\draw (2124.center) to (2114);
		\draw (2113) to (2123.center);
		\draw (2122) to (2128.center);
		\draw (2127.center) to (2119);
		\draw (2121) to (2126.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Suppose there is a Pauli error $W((a,b,c),(d,e,f))$, then we have the following error detection circuit:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1843) at (254.5, -25.5) {};
		\node [style=none] (1844) at (255, -25.25) {};
		\node [style=none] (1845) at (255.5, -25.25) {};
		\node [style=Z] (1846) at (254.5, -24.75) {};
		\node [style=Z] (1847) at (254.5, -24.25) {};
		\node [style=X] (1848) at (255, -24.5) {};
		\node [style=X] (1849) at (255.5, -23.75) {};
		\node [style=X] (1850) at (255.5, -25.25) {};
		\node [style=X] (1851) at (255, -25.25) {};
		\node [style=none] (1852) at (252.75, -25.5) {};
		\node [style=none] (1853) at (253.25, -25.25) {};
		\node [style=none] (1854) at (253.75, -25.25) {};
		\node [style=Z] (1855) at (253.25, -24.5) {};
		\node [style=X] (1856) at (252.75, -24.75) {};
		\node [style=X] (1857) at (252.75, -24.25) {};
		\node [style=Z] (1858) at (253.75, -23.75) {};
		\node [style=none] (1859) at (254.5, -23.75) {};
		\node [style=none] (1860) at (255, -23.75) {};
		\node [style=none] (1861) at (255.5, -23.75) {};
		\node [style=none] (1862) at (252.75, -23.75) {};
		\node [style=none] (1863) at (253.25, -23.75) {};
		\node [style=none] (1864) at (253.75, -23.75) {};
		\node [style=Z] (1865) at (253.25, -25.25) {};
		\node [style=Z] (1866) at (253.75, -25.25) {};
		\node [style=none] (1867) at (258, -20.75) {};
		\node [style=none] (1868) at (258.5, -20.75) {};
		\node [style=none] (1869) at (259, -20.75) {};
		\node [style=none] (1870) at (255.5, -20.75) {};
		\node [style=none] (1871) at (256, -20.75) {};
		\node [style=none] (1872) at (256.5, -20.75) {};
		\node [style=X] (1873) at (254.5, -22) {$a$};
		\node [style=X] (1874) at (255, -22) {$b$};
		\node [style=X] (1875) at (255.5, -22) {$c$};
		\node [style=X] (1876) at (256.5, -22) {$d$};
		\node [style=X] (1877) at (257, -22) {$e$};
		\node [style=X] (1878) at (257.5, -22) {$f$};
		\node [style=none] (1879) at (258, -20.75) {};
		\node [style=none] (1880) at (258.5, -20.75) {};
		\node [style=none] (1881) at (259, -20.75) {};
		\node [style=none] (1882) at (255.5, -20.75) {};
		\node [style=none] (1883) at (256, -20.75) {};
		\node [style=none] (1884) at (256.5, -20.75) {};
		\node [style=Z] (1885) at (258, -18.5) {};
		\node [style=Z] (1886) at (258, -18) {};
		\node [style=X] (1887) at (258.5, -18.25) {};
		\node [style=X] (1888) at (259, -17.5) {};
		\node [style=Z] (1889) at (256, -18.25) {};
		\node [style=X] (1890) at (255.5, -18.5) {};
		\node [style=X] (1891) at (255.5, -18) {};
		\node [style=Z] (1892) at (256.5, -17.5) {};
		\node [style=none] (1893) at (258, -16.25) {};
		\node [style=none] (1894) at (258.5, -16.25) {};
		\node [style=none] (1895) at (259, -16.25) {};
		\node [style=none] (1896) at (255.5, -16.25) {};
		\node [style=none] (1897) at (256, -16.25) {};
		\node [style=none] (1898) at (256.5, -16.25) {};
		\node [style=Z] (1899) at (258, -19.75) {};
		\node [style=Z] (1900) at (258, -20.25) {};
		\node [style=X] (1901) at (258.5, -20) {};
		\node [style=X] (1902) at (259, -20.75) {};
		\node [style=Z] (1903) at (256, -20) {};
		\node [style=X] (1904) at (255.5, -19.75) {};
		\node [style=X] (1905) at (255.5, -20.25) {};
		\node [style=Z] (1906) at (256.5, -20.75) {};
		\node [style=none] (1907) at (258, -20.75) {};
		\node [style=none] (1908) at (258.5, -20.75) {};
		\node [style=none] (1909) at (259, -20.75) {};
		\node [style=none] (1910) at (255.5, -20.75) {};
		\node [style=none] (1911) at (256, -20.75) {};
		\node [style=none] (1912) at (256.5, -20.75) {};
		\node [style=X] (1913) at (259.5, -18.5) {};
		\node [style=X] (1914) at (260, -18.75) {};
		\node [style=Z] (1915) at (257, -18.25) {};
		\node [style=Z] (1916) at (257.5, -18.5) {};
		\node [style=Z] (1917) at (257, -19.75) {};
		\node [style=Z] (1918) at (257.5, -19.75) {};
		\node [style=X] (1919) at (259.5, -19.75) {};
		\node [style=X] (1920) at (260, -19.75) {};
		\node [style=Z] (1921) at (257, -17.25) {};
		\node [style=Z] (1922) at (257.5, -17.25) {};
		\node [style=none] (1923) at (259.5, -17.25) {};
		\node [style=none] (1924) at (260, -17.25) {};
		\node [style=Z] (1925) at (258.5, -19) {};
		\node [style=Z] (1926) at (259, -19.25) {};
		\node [style=X] (1927) at (256, -18.75) {};
		\node [style=X] (1928) at (256.5, -19) {};
		\node [style=none] (1929) at (260, -16.25) {};
		\node [style=none] (1930) at (260.5, -16.25) {};
		\node [style=none] (1931) at (254, -16.25) {};
		\node [style=none] (1932) at (256.75, -25.5) {};
		\node [style=none] (1933) at (253.5, -20.75) {Alice};
		\node [style=none] (1934) at (257.75, -23.25) {Bob};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1843.center) to (1846);
		\draw (1844.center) to (1848);
		\draw (1845.center) to (1849);
		\draw (1846) to (1848);
		\draw (1849) to (1847);
		\draw (1846) to (1847);
		\draw (1857) to (1858);
		\draw (1856) to (1855);
		\draw (1855) to (1853.center);
		\draw (1852.center) to (1856);
		\draw (1856) to (1857);
		\draw (1854.center) to (1858);
		\draw (1860.center) to (1848);
		\draw (1847) to (1859.center);
		\draw (1863.center) to (1855);
		\draw (1857) to (1862.center);
		\draw [in=-135, out=90, looseness=1.25] (1862.center) to (1873);
		\draw [in=45, out=-90] (1870.center) to (1873);
		\draw [in=-135, out=90, looseness=1.25] (1863.center) to (1874);
		\draw [in=270, out=45] (1874) to (1871.center);
		\draw [in=45, out=-90] (1872.center) to (1875);
		\draw [in=90, out=-135, looseness=1.25] (1875) to (1864.center);
		\draw [in=45, out=-90] (1867.center) to (1876);
		\draw [in=90, out=-135, looseness=1.25] (1876) to (1859.center);
		\draw [in=-135, out=90, looseness=1.25] (1860.center) to (1877);
		\draw [in=270, out=45] (1877) to (1868.center);
		\draw [in=45, out=-90] (1869.center) to (1878);
		\draw [in=90, out=-135, looseness=1.25] (1878) to (1861.center);
		\draw (1885) to (1887);
		\draw (1888) to (1886);
		\draw (1885) to (1886);
		\draw (1891) to (1892);
		\draw (1890) to (1889);
		\draw (1890) to (1891);
		\draw (1888) to (1895.center);
		\draw (1894.center) to (1887);
		\draw (1886) to (1893.center);
		\draw (1892) to (1898.center);
		\draw (1897.center) to (1889);
		\draw (1891) to (1896.center);
		\draw (1899) to (1901);
		\draw (1902) to (1900);
		\draw (1899) to (1900);
		\draw (1905) to (1906);
		\draw (1904) to (1903);
		\draw (1904) to (1905);
		\draw (1908.center) to (1901);
		\draw (1900) to (1907.center);
		\draw (1911.center) to (1903);
		\draw (1905) to (1910.center);
		\draw (1899) to (1885);
		\draw (1918) to (1916);
		\draw (1916) to (1922);
		\draw (1921) to (1915);
		\draw (1915) to (1917);
		\draw (1919) to (1913);
		\draw (1914) to (1920);
		\draw (1913) to (1923.center);
		\draw (1914) to (1924.center);
		\draw (1906) to (1928);
		\draw (1928) to (1892);
		\draw (1927) to (1889);
		\draw (1903) to (1927);
		\draw (1904) to (1890);
		\draw (1925) to (1901);
		\draw (1888) to (1926);
		\draw (1926) to (1902);
		\draw (1925) to (1887);
		\draw (1928) to (1916);
		\draw (1927) to (1915);
		\draw (1925) to (1913);
		\draw (1926) to (1914);
		\draw [style=red, in=270, out=90] (1923.center) to (1929.center);
		\draw [style=red, in=270, out=90] (1924.center) to (1930.center);
		\draw [style=dotted, in=90, out=-90, looseness=1.25] (1931.center) to (1932.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1265) at (192.5, -21.25) {};
		\node [style=none] (1266) at (193, -21) {};
		\node [style=none] (1267) at (193.5, -21) {};
		\node [style=Z] (1268) at (192.5, -20.5) {};
		\node [style=Z] (1269) at (192.5, -20) {};
		\node [style=X] (1270) at (193, -20.25) {};
		\node [style=X] (1271) at (193.5, -19.5) {};
		\node [style=X] (1272) at (193.5, -21) {};
		\node [style=X] (1273) at (193, -21) {};
		\node [style=none] (1274) at (190.5, -21.25) {};
		\node [style=none] (1275) at (191, -21) {};
		\node [style=none] (1276) at (191.5, -21) {};
		\node [style=Z] (1277) at (191, -20.25) {};
		\node [style=X] (1278) at (190.5, -20.5) {};
		\node [style=X] (1279) at (190.5, -20) {};
		\node [style=Z] (1280) at (191.5, -19.5) {};
		\node [style=Z] (1281) at (191, -21) {};
		\node [style=Z] (1282) at (191.5, -21) {};
		\node [style=none] (1283) at (192.5, -18) {};
		\node [style=none] (1284) at (193, -18) {};
		\node [style=none] (1285) at (193.5, -18) {};
		\node [style=none] (1286) at (190.5, -18) {};
		\node [style=none] (1287) at (191, -18) {};
		\node [style=none] (1288) at (191.5, -18) {};
		\node [style=X] (1289) at (193, -18.75) {$e$};
		\node [style=X] (1290) at (193.5, -18.75) {$f$};
		\node [style=X] (1291) at (192.5, -18.75) {$d$};
		\node [style=X] (1294) at (194.5, -18.75) {$e+d$};
		\node [style=X] (1295) at (195.5, -18.75) {$f+d$};
		\node [style=X] (1296) at (190.5, -18.75) {$a$};
		\node [style=X] (1297) at (191, -18.75) {$b$};
		\node [style=X] (1298) at (191.5, -18.75) {$c$};
		\node [style=none] (1299) at (194.5, -18) {};
		\node [style=none] (1300) at (195.5, -18) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1265.center) to (1268);
		\draw (1266.center) to (1270);
		\draw (1267.center) to (1271);
		\draw (1268) to (1270);
		\draw (1271) to (1269);
		\draw (1268) to (1269);
		\draw (1279) to (1280);
		\draw (1278) to (1277);
		\draw (1277) to (1275.center);
		\draw (1274.center) to (1278);
		\draw (1278) to (1279);
		\draw (1276.center) to (1280);
		\draw (1277) to (1287.center);
		\draw (1280) to (1288.center);
		\draw (1269) to (1291);
		\draw (1291) to (1283.center);
		\draw (1284.center) to (1289);
		\draw (1289) to (1270);
		\draw (1271) to (1290);
		\draw (1290) to (1285.center);
		\draw (1279) to (1296);
		\draw (1296) to (1286.center);
		\draw [style=red] (1294) to (1299.center);
		\draw [style=red] (1295) to (1300.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Suppose we want to correct for single Pauli $X$ errors, then we find that:
\begin{itemize}
\item Pauli $X$ error $(d,e,f) = (1,0,0)$ yields syndrome $(e+d,f+d) = (1,1)$
\item Pauli $X$ error $(d,e,f) = (0,1,0)$ yields syndrome $(e+d,f+d) = (1,0)$
\item Pauli $X$ error$(d,e,f) = (0,0,1)$ yields syndrome $(e+d,f+d) = (0,1)$
\item Pauli $X$ error $(d,e,f) = (0,0,0)$ yields syndrome $(e+d,f+d) = (0,0)$
\end{itemize}
Therefore, we want to apply the correction $(s,t) \mapsto (s t, s (t+1),(s+1) t)$. The error correction protocol then has the following form:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (2375) at (319, -25.5) {};
		\node [style=none] (2376) at (319.5, -25.25) {};
		\node [style=none] (2377) at (320, -25.25) {};
		\node [style=Z] (2378) at (319, -24.75) {};
		\node [style=Z] (2379) at (319, -24.25) {};
		\node [style=X] (2380) at (319.5, -24.5) {};
		\node [style=X] (2381) at (320, -23.75) {};
		\node [style=X] (2382) at (320, -25.25) {};
		\node [style=X] (2383) at (319.5, -25.25) {};
		\node [style=none] (2384) at (316.5, -25.5) {};
		\node [style=none] (2385) at (317, -25.25) {};
		\node [style=none] (2386) at (317.5, -25.25) {};
		\node [style=Z] (2387) at (317, -24.5) {};
		\node [style=X] (2388) at (316.5, -24.75) {};
		\node [style=X] (2389) at (316.5, -24.25) {};
		\node [style=Z] (2390) at (317.5, -23.75) {};
		\node [style=none] (2391) at (319, -23.75) {};
		\node [style=none] (2392) at (319.5, -23.75) {};
		\node [style=none] (2393) at (320, -23.75) {};
		\node [style=none] (2394) at (316.5, -23.75) {};
		\node [style=none] (2395) at (317, -23.75) {};
		\node [style=none] (2396) at (317.5, -23.75) {};
		\node [style=Z] (2397) at (317, -25.25) {};
		\node [style=Z] (2398) at (317.5, -25.25) {};
		\node [style=none] (2399) at (321.75, -20.75) {};
		\node [style=none] (2400) at (322.25, -20.75) {};
		\node [style=none] (2401) at (322.75, -20.75) {};
		\node [style=none] (2402) at (319.25, -20.75) {};
		\node [style=none] (2403) at (319.75, -20.75) {};
		\node [style=none] (2404) at (320.25, -20.75) {};
		\node [style=X] (2405) at (318, -22) {$a$};
		\node [style=X] (2406) at (318.5, -22) {$b$};
		\node [style=X] (2407) at (319, -22) {$c$};
		\node [style=X] (2408) at (320.5, -22) {$d$};
		\node [style=X] (2409) at (321.25, -22) {$e$};
		\node [style=X] (2410) at (321.75, -22) {$f$};
		\node [style=none] (2411) at (321.75, -20.75) {};
		\node [style=none] (2412) at (322.25, -20.75) {};
		\node [style=none] (2413) at (322.75, -20.75) {};
		\node [style=none] (2414) at (319.25, -20.75) {};
		\node [style=none] (2415) at (319.75, -20.75) {};
		\node [style=none] (2416) at (320.25, -20.75) {};
		\node [style=Z] (2417) at (321.75, -18.5) {};
		\node [style=Z] (2418) at (321.75, -18) {};
		\node [style=X] (2419) at (322.25, -18.25) {};
		\node [style=X] (2420) at (322.75, -17.5) {};
		\node [style=Z] (2421) at (319.75, -18.25) {};
		\node [style=X] (2422) at (319.25, -18.5) {};
		\node [style=X] (2423) at (319.25, -18) {};
		\node [style=Z] (2424) at (320.25, -17.5) {};
		\node [style=none] (2425) at (321.75, -11.5) {};
		\node [style=none] (2426) at (322.25, -11.75) {};
		\node [style=none] (2427) at (322.75, -11.75) {};
		\node [style=none] (2428) at (319.25, -11.5) {};
		\node [style=none] (2429) at (319.75, -11.75) {};
		\node [style=none] (2430) at (320.25, -11.75) {};
		\node [style=Z] (2431) at (321.75, -19.75) {};
		\node [style=Z] (2432) at (321.75, -20.25) {};
		\node [style=X] (2433) at (322.25, -20) {};
		\node [style=X] (2434) at (322.75, -20.75) {};
		\node [style=Z] (2435) at (319.75, -20) {};
		\node [style=X] (2436) at (319.25, -19.75) {};
		\node [style=X] (2437) at (319.25, -20.25) {};
		\node [style=Z] (2438) at (320.25, -20.75) {};
		\node [style=none] (2439) at (321.75, -20.75) {};
		\node [style=none] (2440) at (322.25, -20.75) {};
		\node [style=none] (2441) at (322.75, -20.75) {};
		\node [style=none] (2442) at (319.25, -20.75) {};
		\node [style=none] (2443) at (319.75, -20.75) {};
		\node [style=none] (2444) at (320.25, -20.75) {};
		\node [style=X] (2445) at (324.25, -17.75) {};
		\node [style=X] (2446) at (324.75, -18) {};
		\node [style=Z] (2447) at (320.75, -18.25) {};
		\node [style=Z] (2448) at (321.25, -18.5) {};
		\node [style=Z] (2449) at (320.75, -19.25) {};
		\node [style=Z] (2450) at (321.25, -19.25) {};
		\node [style=X] (2451) at (324.25, -19.25) {};
		\node [style=X] (2452) at (324.75, -19.25) {};
		\node [style=Z] (2453) at (320.75, -17.25) {};
		\node [style=Z] (2454) at (321.25, -17.25) {};
		\node [style=none] (2455) at (324.25, -17.25) {};
		\node [style=none] (2456) at (324.75, -17.25) {};
		\node [style=Z] (2457) at (322.25, -18.75) {};
		\node [style=Z] (2458) at (322.75, -19) {};
		\node [style=X] (2459) at (319.75, -18.75) {};
		\node [style=X] (2460) at (320.25, -19) {};
		\node [style=none] (2461) at (324.75, -16.75) {};
		\node [style=none] (2462) at (317.75, -16.75) {};
		\node [style=none] (2463) at (320.75, -25.5) {};
		\node [style=none] (2464) at (317.5, -20.75) {Alice};
		\node [style=none] (2465) at (324, -21) {Bob};
		\node [style=Z] (2466) at (324.25, -16.75) {};
		\node [style=Z] (2467) at (324.75, -16.75) {};
		\node [style=X] (2468) at (322.75, -13.75) {};
		\node [style=X] (2469) at (322.25, -14) {};
		\node [style=X] (2470) at (321.75, -14.25) {};
		\node [style=none] (2471) at (323.25, -15) {};
		\node [style=none] (2472) at (325.75, -11.5) {};
		\node [style=none] (2473) at (326.25, -11.5) {};
		\node [style=none] (2474) at (317.75, -11.5) {};
		\node [style=andin] (2475) at (325, -14.75) {};
		\node [style=Z] (2476) at (321.75, -12.25) {};
		\node [style=Z] (2477) at (321.75, -12.75) {};
		\node [style=X] (2478) at (322.25, -12.5) {};
		\node [style=X] (2479) at (322.75, -13.25) {};
		\node [style=Z] (2480) at (319.75, -12.5) {};
		\node [style=X] (2481) at (319.25, -12.25) {};
		\node [style=X] (2482) at (319.25, -12.75) {};
		\node [style=Z] (2483) at (320.25, -13.25) {};
		\node [style=Z] (2484) at (319.75, -11.75) {};
		\node [style=Z] (2485) at (322.25, -11.75) {};
		\node [style=Z] (2486) at (322.75, -11.75) {};
		\node [style=Z] (2487) at (320.25, -11.75) {};
		\node [style=none] (2488) at (324, -14.75) {};
		\node [style=andin] (2489) at (323.25, -15) {};
		\node [style=none] (2490) at (325, -14.75) {};
		\node [style=andin] (2491) at (324, -14.75) {};
		\node [style=X] (2492) at (324.25, -15.5) {$1$};
		\node [style=X] (2493) at (324.75, -15.5) {$1$};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (2375.center) to (2378);
		\draw (2376.center) to (2380);
		\draw (2377.center) to (2381);
		\draw (2378) to (2380);
		\draw (2381) to (2379);
		\draw (2378) to (2379);
		\draw (2389) to (2390);
		\draw (2388) to (2387);
		\draw (2387) to (2385.center);
		\draw (2384.center) to (2388);
		\draw (2388) to (2389);
		\draw (2386.center) to (2390);
		\draw (2392.center) to (2380);
		\draw (2379) to (2391.center);
		\draw (2395.center) to (2387);
		\draw (2389) to (2394.center);
		\draw [in=-135, out=90, looseness=1.25] (2394.center) to (2405);
		\draw [in=45, out=-90] (2402.center) to (2405);
		\draw [in=-135, out=90, looseness=1.25] (2395.center) to (2406);
		\draw [in=270, out=45] (2406) to (2403.center);
		\draw [in=45, out=-90] (2404.center) to (2407);
		\draw [in=90, out=-135, looseness=1.25] (2407) to (2396.center);
		\draw [in=45, out=-90] (2399.center) to (2408);
		\draw [in=90, out=-135, looseness=1.25] (2408) to (2391.center);
		\draw [in=-135, out=90, looseness=1.25] (2392.center) to (2409);
		\draw [in=270, out=45] (2409) to (2400.center);
		\draw [in=45, out=-90] (2401.center) to (2410);
		\draw [in=90, out=-135, looseness=1.25] (2410) to (2393.center);
		\draw (2417) to (2419);
		\draw (2420) to (2418);
		\draw (2417) to (2418);
		\draw (2423) to (2424);
		\draw (2422) to (2421);
		\draw (2422) to (2423);
		\draw (2420) to (2427.center);
		\draw (2426.center) to (2419);
		\draw (2418) to (2425.center);
		\draw (2424) to (2430.center);
		\draw (2429.center) to (2421);
		\draw (2423) to (2428.center);
		\draw (2431) to (2433);
		\draw (2434) to (2432);
		\draw (2431) to (2432);
		\draw (2437) to (2438);
		\draw (2436) to (2435);
		\draw (2436) to (2437);
		\draw (2440.center) to (2433);
		\draw (2432) to (2439.center);
		\draw (2443.center) to (2435);
		\draw (2437) to (2442.center);
		\draw (2431) to (2417);
		\draw (2450) to (2448);
		\draw (2448) to (2454);
		\draw (2453) to (2447);
		\draw (2447) to (2449);
		\draw (2451) to (2445);
		\draw (2446) to (2452);
		\draw (2445) to (2455.center);
		\draw (2446) to (2456.center);
		\draw (2438) to (2460);
		\draw (2460) to (2424);
		\draw (2459) to (2421);
		\draw (2435) to (2459);
		\draw (2436) to (2422);
		\draw (2457) to (2433);
		\draw (2420) to (2458);
		\draw (2458) to (2434);
		\draw (2457) to (2419);
		\draw (2460) to (2448);
		\draw (2459) to (2447);
		\draw (2457) to (2445);
		\draw (2458) to (2446);
		\draw [style=red] (2456.center) to (2461.center);
		\draw [style=dotted, in=90, out=-90, looseness=1.25] (2462.center) to (2463.center);
		\draw (2425.center) to (2470);
		\draw [style=red, in=-60, out=135] (2467) to (2471.center);
		\draw [style=red, in=-105, out=165] (2466) to (2471.center);
		\draw [style=red, in=90, out=-45] (2470) to (2471.center);
		\draw [style=red, in=-90, out=45] (2466) to (2472.center);
		\draw [style=red, in=270, out=15, looseness=0.75] (2467) to (2473.center);
		\draw (2476) to (2478);
		\draw (2479) to (2477);
		\draw (2482) to (2483);
		\draw (2481) to (2480);
		\draw [style=red] (2455.center) to (2466);
		\draw [style=dotted] (2462.center) to (2474.center);
		\draw [style=red, in=-135, out=135] (2466) to (2488.center);
		\draw [style=red, in=-90, out=90] (2467) to (2492);
		\draw [style=red, in=-45, out=90] (2492) to (2488.center);
		\draw [style=red, in=-105, out=90] (2466) to (2493);
		\draw [style=red, in=-135, out=90] (2493) to (2490.center);
		\draw [style=red, in=45, out=-30] (2490.center) to (2467);
		\draw [style=red, in=-30, out=90] (2490.center) to (2468);
		\draw [style=red, in=-30, out=90] (2488.center) to (2469);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1741) at (242.5, -21.25) {};
		\node [style=none] (1742) at (243, -21) {};
		\node [style=none] (1743) at (243.5, -21) {};
		\node [style=Z] (1744) at (242.5, -20.5) {};
		\node [style=Z] (1745) at (242.5, -20) {};
		\node [style=X] (1746) at (243, -20.25) {};
		\node [style=X] (1747) at (243.5, -19.5) {};
		\node [style=X] (1748) at (243.5, -21) {};
		\node [style=X] (1749) at (243, -21) {};
		\node [style=none] (1750) at (240.5, -21.25) {};
		\node [style=none] (1751) at (241, -21) {};
		\node [style=none] (1752) at (241.5, -21) {};
		\node [style=Z] (1753) at (241, -20.25) {};
		\node [style=X] (1754) at (240.5, -20.5) {};
		\node [style=X] (1755) at (240.5, -20) {};
		\node [style=Z] (1756) at (241.5, -19.5) {};
		\node [style=Z] (1757) at (241, -21) {};
		\node [style=Z] (1758) at (241.5, -21) {};
		\node [style=none] (1759) at (242.5, -18) {};
		\node [style=none] (1760) at (243, -18) {};
		\node [style=none] (1761) at (243.5, -18) {};
		\node [style=none] (1762) at (240.5, -18) {};
		\node [style=none] (1763) at (241, -18) {};
		\node [style=none] (1764) at (241.5, -18) {};
		\node [style=X] (1765) at (243, -18.75) {$g$};
		\node [style=X] (1766) at (243.5, -18.75) {$g$};
		\node [style=X] (1767) at (242.5, -18.75) {$g$};
		\node [style=X] (1768) at (244.5, -17.5) {$e+d$};
		\node [style=X] (1769) at (245.5, -17.5) {$f+d$};
		\node [style=X] (1770) at (240.5, -18.75) {$a$};
		\node [style=X] (1771) at (241, -18.75) {$b$};
		\node [style=X] (1772) at (241.5, -18.75) {$c$};
		\node [style=none] (1773) at (244.5, -16.25) {};
		\node [style=none] (1774) at (245.5, -16.25) {};
		\node [style=Z] (1775) at (242.5, -17) {};
		\node [style=Z] (1776) at (242.5, -17.5) {};
		\node [style=X] (1777) at (243, -17.25) {};
		\node [style=X] (1778) at (243.5, -18) {};
		\node [style=Z] (1779) at (241, -17.25) {};
		\node [style=X] (1780) at (240.5, -17) {};
		\node [style=X] (1781) at (240.5, -17.5) {};
		\node [style=Z] (1782) at (241.5, -18) {};
		\node [style=Z] (1789) at (241, -16.5) {};
		\node [style=Z] (1790) at (241.5, -16.5) {};
		\node [style=Z] (1791) at (243, -16.5) {};
		\node [style=Z] (1792) at (243.5, -16.5) {};
		\node [style=none] (1793) at (242.5, -16.25) {};
		\node [style=none] (1794) at (240.5, -16.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1741.center) to (1744);
		\draw (1742.center) to (1746);
		\draw (1743.center) to (1747);
		\draw (1744) to (1746);
		\draw (1747) to (1745);
		\draw (1744) to (1745);
		\draw (1755) to (1756);
		\draw (1754) to (1753);
		\draw (1753) to (1751.center);
		\draw (1750.center) to (1754);
		\draw (1754) to (1755);
		\draw (1752.center) to (1756);
		\draw (1753) to (1763.center);
		\draw (1756) to (1764.center);
		\draw (1745) to (1767);
		\draw (1767) to (1759.center);
		\draw (1760.center) to (1765);
		\draw (1765) to (1746);
		\draw (1747) to (1766);
		\draw (1766) to (1761.center);
		\draw (1755) to (1770);
		\draw (1770) to (1762.center);
		\draw [style=red] (1768) to (1773.center);
		\draw [style=red] (1769) to (1774.center);
		\draw (1775) to (1777);
		\draw (1778) to (1776);
		\draw (1775) to (1776);
		\draw (1781) to (1782);
		\draw (1780) to (1779);
		\draw (1780) to (1781);
		\draw (1780) to (1794.center);
		\draw (1763.center) to (1789);
		\draw (1790) to (1782);
		\draw (1775) to (1793.center);
		\draw (1791) to (1777);
		\draw (1778) to (1792);
		\draw (1777) to (1760.center);
		\draw (1759.center) to (1776);
		\draw (1781) to (1762.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
Where 
$$
g:=d+(e+d)(f+d) = e+(e+d)(f+d+1) =f+(e+d+1)(f+d) = de+ef+fd
\mod 2$$
If no more than one of $d,e,f$ is $1$ then $g=0$.  If furthermore $a=b=c=0$, then:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1741) at (242.5, -21.25) {};
		\node [style=none] (1742) at (243, -21) {};
		\node [style=none] (1743) at (243.5, -21) {};
		\node [style=Z] (1744) at (242.5, -20.5) {};
		\node [style=Z] (1745) at (242.5, -20) {};
		\node [style=X] (1746) at (243, -20.25) {};
		\node [style=X] (1747) at (243.5, -19.5) {};
		\node [style=X] (1748) at (243.5, -21) {};
		\node [style=X] (1749) at (243, -21) {};
		\node [style=none] (1750) at (240.5, -21.25) {};
		\node [style=none] (1751) at (241, -21) {};
		\node [style=none] (1752) at (241.5, -21) {};
		\node [style=Z] (1753) at (241, -20.25) {};
		\node [style=X] (1754) at (240.5, -20.5) {};
		\node [style=X] (1755) at (240.5, -20) {};
		\node [style=Z] (1756) at (241.5, -19.5) {};
		\node [style=Z] (1757) at (241, -21) {};
		\node [style=Z] (1758) at (241.5, -21) {};
		\node [style=none] (1759) at (242.5, -18) {};
		\node [style=none] (1760) at (243, -18) {};
		\node [style=none] (1761) at (243.5, -18) {};
		\node [style=none] (1762) at (240.5, -18) {};
		\node [style=none] (1763) at (241, -18) {};
		\node [style=none] (1764) at (241.5, -18) {};
		\node [style=X] (1765) at (243, -18.75) {$g$};
		\node [style=X] (1766) at (243.5, -18.75) {$g$};
		\node [style=X] (1767) at (242.5, -18.75) {$g$};
		\node [style=X] (1768) at (244.5, -17.5) {$e+d$};
		\node [style=X] (1769) at (245.5, -17.5) {$f+d$};
		\node [style=X] (1770) at (240.5, -18.75) {$a$};
		\node [style=X] (1771) at (241, -18.75) {$b$};
		\node [style=X] (1772) at (241.5, -18.75) {$c$};
		\node [style=none] (1773) at (244.5, -16.25) {};
		\node [style=none] (1774) at (245.5, -16.25) {};
		\node [style=Z] (1775) at (242.5, -17) {};
		\node [style=Z] (1776) at (242.5, -17.5) {};
		\node [style=X] (1777) at (243, -17.25) {};
		\node [style=X] (1778) at (243.5, -18) {};
		\node [style=Z] (1779) at (241, -17.25) {};
		\node [style=X] (1780) at (240.5, -17) {};
		\node [style=X] (1781) at (240.5, -17.5) {};
		\node [style=Z] (1782) at (241.5, -18) {};
		\node [style=Z] (1789) at (241, -16.5) {};
		\node [style=Z] (1790) at (241.5, -16.5) {};
		\node [style=Z] (1791) at (243, -16.5) {};
		\node [style=Z] (1792) at (243.5, -16.5) {};
		\node [style=none] (1793) at (242.5, -16.25) {};
		\node [style=none] (1794) at (240.5, -16.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1741.center) to (1744);
		\draw (1742.center) to (1746);
		\draw (1743.center) to (1747);
		\draw (1744) to (1746);
		\draw (1747) to (1745);
		\draw (1744) to (1745);
		\draw (1755) to (1756);
		\draw (1754) to (1753);
		\draw (1753) to (1751.center);
		\draw (1750.center) to (1754);
		\draw (1754) to (1755);
		\draw (1752.center) to (1756);
		\draw (1753) to (1763.center);
		\draw (1756) to (1764.center);
		\draw (1745) to (1767);
		\draw (1767) to (1759.center);
		\draw (1760.center) to (1765);
		\draw (1765) to (1746);
		\draw (1747) to (1766);
		\draw (1766) to (1761.center);
		\draw (1755) to (1770);
		\draw (1770) to (1762.center);
		\draw [style=red] (1768) to (1773.center);
		\draw [style=red] (1769) to (1774.center);
		\draw (1775) to (1777);
		\draw (1778) to (1776);
		\draw (1775) to (1776);
		\draw (1781) to (1782);
		\draw (1780) to (1779);
		\draw (1780) to (1781);
		\draw (1780) to (1794.center);
		\draw (1763.center) to (1789);
		\draw (1790) to (1782);
		\draw (1775) to (1793.center);
		\draw (1791) to (1777);
		\draw (1778) to (1792);
		\draw (1777) to (1760.center);
		\draw (1759.center) to (1776);
		\draw (1781) to (1762.center);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1795) at (248.5, -21.25) {};
		\node [style=none] (1796) at (249, -21) {};
		\node [style=none] (1797) at (249.5, -21) {};
		\node [style=Z] (1798) at (248.5, -20.5) {};
		\node [style=Z] (1799) at (248.5, -20) {};
		\node [style=X] (1800) at (249, -20.25) {};
		\node [style=X] (1801) at (249.5, -19.5) {};
		\node [style=X] (1802) at (249.5, -21) {};
		\node [style=X] (1803) at (249, -21) {};
		\node [style=none] (1804) at (246.5, -21.25) {};
		\node [style=none] (1805) at (247, -21) {};
		\node [style=none] (1806) at (247.5, -21) {};
		\node [style=Z] (1807) at (247, -20.25) {};
		\node [style=X] (1808) at (246.5, -20.5) {};
		\node [style=X] (1809) at (246.5, -20) {};
		\node [style=Z] (1810) at (247.5, -19.5) {};
		\node [style=Z] (1811) at (247, -21) {};
		\node [style=Z] (1812) at (247.5, -21) {};
		\node [style=none] (1813) at (248.5, -18) {};
		\node [style=none] (1814) at (249, -18) {};
		\node [style=none] (1815) at (249.5, -18) {};
		\node [style=none] (1816) at (246.5, -18) {};
		\node [style=none] (1817) at (247, -18) {};
		\node [style=none] (1818) at (247.5, -18) {};
		\node [style=X] (1822) at (250.5, -17.5) {$e+d$};
		\node [style=X] (1823) at (251.5, -17.5) {$f+d$};
		\node [style=none] (1827) at (250.5, -16.25) {};
		\node [style=none] (1828) at (251.5, -16.25) {};
		\node [style=Z] (1829) at (248.5, -17) {};
		\node [style=Z] (1830) at (248.5, -17.5) {};
		\node [style=X] (1831) at (249, -17.25) {};
		\node [style=X] (1832) at (249.5, -18) {};
		\node [style=Z] (1833) at (247, -17.25) {};
		\node [style=X] (1834) at (246.5, -17) {};
		\node [style=X] (1835) at (246.5, -17.5) {};
		\node [style=Z] (1836) at (247.5, -18) {};
		\node [style=Z] (1837) at (247, -16.5) {};
		\node [style=Z] (1838) at (247.5, -16.5) {};
		\node [style=Z] (1839) at (249, -16.5) {};
		\node [style=Z] (1840) at (249.5, -16.5) {};
		\node [style=none] (1841) at (248.5, -16.25) {};
		\node [style=none] (1842) at (246.5, -16.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw (1795.center) to (1798);
		\draw (1796.center) to (1800);
		\draw (1797.center) to (1801);
		\draw (1798) to (1800);
		\draw (1801) to (1799);
		\draw (1798) to (1799);
		\draw (1809) to (1810);
		\draw (1808) to (1807);
		\draw (1807) to (1805.center);
		\draw (1804.center) to (1808);
		\draw (1808) to (1809);
		\draw (1806.center) to (1810);
		\draw (1807) to (1817.center);
		\draw (1810) to (1818.center);
		\draw [style=red] (1822) to (1827.center);
		\draw [style=red] (1823) to (1828.center);
		\draw (1829) to (1831);
		\draw (1832) to (1830);
		\draw (1829) to (1830);
		\draw (1835) to (1836);
		\draw (1834) to (1833);
		\draw (1834) to (1835);
		\draw (1834) to (1842.center);
		\draw (1817.center) to (1837);
		\draw (1838) to (1836);
		\draw (1829) to (1841.center);
		\draw (1839) to (1831);
		\draw (1832) to (1840);
		\draw (1831) to (1814.center);
		\draw (1813.center) to (1830);
		\draw (1835) to (1816.center);
		\draw (1809) to (1816.center);
		\draw (1800) to (1814.center);
		\draw (1799) to (1813.center);
		\draw (1801) to (1832);
	\end{pgfonlayer}
\end{tikzpicture}
=
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=none] (1795) at (248.5, -21.25) {};
		\node [style=none] (1804) at (248, -21.25) {};
		\node [style=X] (1822) at (249.5, -17.5) {$e+d$};
		\node [style=X] (1823) at (250.5, -17.5) {$f+d$};
		\node [style=none] (1827) at (249.5, -16.25) {};
		\node [style=none] (1828) at (250.5, -16.25) {};
		\node [style=none] (1841) at (248.5, -16.25) {};
		\node [style=none] (1842) at (248, -16.25) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [style=red] (1822) to (1827.center);
		\draw [style=red] (1823) to (1828.center);
		\draw (1804.center) to (1842.center);
		\draw (1841.center) to (1795.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$
\end{example}


\section{Discussion}
\label{sec:conclagrel}
It is important to note that the controlled operation we applied for the error correction step requires nonlinear classical processing power, and therefore the diagram we drew doesn't ``live'' within the calculus we have constructed throughout this paper. 

Indeed, in this example, we have secretly been working in the pushout:

$$\ZXA/\sim \leftarrow \Aff\Rel_{\F_2} \rightarrow \Aff\Co\Isot\Rel_{\F_2}^M$$


Where $\ZXA/\sim$ is the prop of Boolean {\em relations} which we presented by taking a quotient of the prop $\ZXA$.
Where moreover  $\Aff\Rel_{\F_2}\to \ZXA/\sim$ sends linear subspaces to subsets; and  $\Aff\Rel_{\F_2} \to \Aff\Co\Isot\Rel_{\F_2}^M$  sends 
$$(n\xrightarrow{f} m) \mapsto (C^{\otimes n}\xrightarrow{(p_Z^{\otimes n}, f, p_Z^{\otimes m})} C^{\otimes n})$$

So that we can regard the {\em classical wires} as being subsets rather than affine subspaces.
We can afford to do this because of the presentation of $\ZXA/\sim$ in the previous chapter. However, this is not very satisfying, because we only have a presentation for qubit nonlinear post-processing; and the symplectic formalism only gives a semantics for quantum circuits without phase-shift gates, as discussed in Corollary \ref{cor:nophase}.   This gives more motivation to actually work out a presentation for the quopit version of $\ZXA/\sim$ where there is no such subtlely.


This also begs the following question.  If quopit stabilizer circuits correspond to affine coisotropic subspaces of symplectic vector spaces, is there a succinct characterization of the structure of the subsets of  $\F_p^{2n}$ obtained by applying nonlinear classical processing to stabilizer states?
The nonlinear processing imposes equations which mean that the subset is no longer affine, for example consider the following stabilizer state which is measured, the measurement outcomes are multiplied and then a phase correction is performed using this value:
$$
\begin{tikzpicture}
	\begin{pgfonlayer}{nodelayer}
		\node [style=X] (358) at (248.5, 10.5) {};
		\node [style=Z] (359) at (249.75, 10.5) {};
		\node [style=none] (360) at (248.75, 11) {};
		\node [style=none] (362) at (248.25, 11) {};
		\node [style=none] (363) at (249.5, 11) {};
		\node [style=none] (365) at (250, 11) {};
		\node [style=X] (369) at (247.5, 10.5) {};
		\node [style=Z] (370) at (250.75, 10.5) {};
		\node [style=none] (371) at (247.75, 11) {};
		\node [style=none] (372) at (247.25, 11) {};
		\node [style=none] (373) at (250.5, 11) {};
		\node [style=none] (374) at (251, 11) {};
		\node [style=Z] (375) at (248.75, 11) {};
		\node [style=Z] (376) at (247.75, 11) {};
		\node [style=none] (377) at (251, 11) {};
		\node [style=none] (378) at (250, 11) {};
		\node [style=mult] (37wer9) at (250.75, 12) {};
		\node [style=none] (379) at (250.75, 12) {};
		\node [style=X] (380) at (250, 13) {};
		\node [style=Z] (381) at (247.75, 12) {};
		\node [style=X] (382) at (250, 12) {};
		\node [style=Z] (383) at (247.75, 13) {};
		\node [style=Z] (384) at (248.5, 12) {};
		\node [style=none] (385) at (250, 13.75) {};
		\node [style=none] (386) at (247.75, 13.75) {};
	\end{pgfonlayer}
	\begin{pgfonlayer}{edgelayer}
		\draw [in=45, out=-90] (360.center) to (358);
		\draw [in=135, out=-90] (362.center) to (358);
		\draw [in=45, out=-90] (365.center) to (359);
		\draw [in=135, out=-90] (363.center) to (359);
		\draw [in=45, out=-90] (371.center) to (369);
		\draw [in=135, out=-90] (372.center) to (369);
		\draw [in=45, out=-90] (374.center) to (370);
		\draw [in=135, out=-90] (373.center) to (370);
		\draw [style=red, in=-120, out=90] (378.center) to (379);
		\draw [style=red, in=-15, out=90, looseness=0.75] (379) to (380);
		\draw [style=red, in=90, out=-60] (379) to (377.center);
		\draw [in=225, out=90] (372.center) to (381);
		\draw [in=90, out=-45] (381) to (362.center);
		\draw [in=-45, out=90] (373.center) to (382);
		\draw [in=90, out=-135] (382) to (363.center);
		\draw (383) to (381);
		\draw [in=-15, out=90, looseness=1.25] (384) to (383);
		\draw (382) to (380);
		\draw (383) to (386.center);
		\draw (380) to (385.center);
	\end{pgfonlayer}
\end{tikzpicture}
$$

This mixed quantum state is stabilized by Weyl operators of the form:
$$\{W(z,x_1+x_2+x_1\cdot x_2)\ |\ \forall z,x_1,x_2\in \F_p\}$$
However, the stabilizers do {\em not} correspond to an affine subspace of $\F_p^2$ because of the nonlinear factor $x_1\cdot x_2$.



We can't construct circuits stabilized by Weyl operators corresponding to arbitrary {\em subsets} of $\F_p^{2n}$; for example, we can't copy the $Z$ and $X$ variables, because they can not be simultaneously measured.


Similarly, we can't produce the qudit generalization of the gate which multiplies standard basis elements in $\FHilb$, as we did with the $\AND$ gate in $\ZXA$.  This is because we can only multiply the {\em classical} outcomes.


What is the structure of this intermediate notion of subspace?
 To the knowledge of the author, this question has not yet been addressed, presumably, because classical processing and stabilizer codes are usually presented on different footings, as opposed to both being regarded themeselves as subspaces.

 

We have not given an undoubled completeness proof for $\Aff\Co\Isot\Rel_k$, although the completeness of the quopit stabilizer ZX-calculus \cite{booth} gives a completness result for $\Aff\Co\Isot\Rel_{\F_p}$. The subsequent paper of \cite{poor} which establishes a unique ``AP-normal form'' for quopit circuits greatly simplifies this presentation.  A completness result for arbitrary fields should closely follow their techniques.

Even though completeness for the quopit stabilizer fragment of the ZX-calculus is known, there is motivation for generalizing their result.
Because everything we have developed in this chapter works for all fields, rather than just odd prime fields; this begs the question if this semantics could be used for continuous variable quantum mechanics/quantum photontics, by working over fields with characteristic 0; so that a complete axiomatization of $\Aff\Lag\Rel_k$ would yield continous variable analogues of the ZX-calculus.

 For example, in \cite[Theorem 2]{gross} Gross proves how  Gaussian states on the Hilbert space $\ell^2(\R^n)$ are in bijection with the affine Lagrangian subspaces of the symplectic vector space $\C^{2n}$ given by complex valued graph states, acted on by real valued Weyl operators. 
Gaussian states are the analogue of stabilizer states for continuous variables, allowing for coherent control.
However,  $\Aff\Lag\Rel_{\C}$ contains not only these Gaussian states, but also the dirac deltas for the position and momentum observables, providing a path towards exploring continuous variable ZX-calculi.

These   dirac deltas are ``nonphysical'' in the sense that they can not be interpreted as states in $\Hilb$; which is one way to see why $\Hilb$ not compact closed.  However, they are often used  to perform calculation, as they capture the behaviour of Gaussian quantum mechanics in the limit.  For example, squeezed states are used for continuous variable quantum teleportation \cite{Milburn1999}. 

Nonstandard analysis has been used to try to solve the problem of dirac deltas not existing in $\Hilb$/the lack of compact closure in infinite dimensions \cite{Gogioso2017}; however, this approach is considerably more powerful, as well as complicated.  The symplectic approach could potentially provide a simpler path towards expanding categorical quantum mechanics towards continous variables.

\nocite{kirch}

This question of a continuous variable ZX-calculus is closely related to the question of finding a graphical calculus for passive linear electrical circuits with current and voltage sources.  In \cite{amolak}, they give a complete set of equations for the electrical circuits generated by ideal junctions and resistors.  The normal form which they use involves a modified pivoting rule which avoids rewriting the resistances to be negative.  Indeed, one can regard the normal form of this paper as a variation of the AP-normal form of \cite{poor}.  So finding a presentation for affine Lagrangian relations would be very close to adding capacitors, inductors and current and voltage sources to the presentation of \cite{amolak}; however, not every affine Lagrangian relation over $\R(x)$ can be interpreted as an electrical circuit, so one would have to take extra care to answer this question.

The connection of the ZX-calculus to electrical circuits is fascinating and poses many questions.  For example, using the technique developed in \cite{control} and applied to electrical circuits \cite{network}, $\Aff\Co\Isot\Rel_{\F_p(s)}$ apparently gives a notion of stabilizer codes with discrete-time evolution.  What is the physical interpretation of this?

%
%There is also a practical motivation for providing this graphical calculus.  Just as increasing the characteristic of the prime field increases the quopit dimension; if one transitions to working in $\Aff\Co\Isot\Rel_k$ where $k$ has characteristic 0, it appears that this will give a semantics for continous variable quantum mechanics.
%
%
%For example, given a linear subspace of $\R^n$; then $\ell^2(\R^n)$ has the structure of a countably infinite Hilbert space; the dirac deltas being picked out by the indicator functions on the elements of $\R^n$. 
%
%Such a Hilbert space is the natural semantics for Guassian quantum mechanics; where a state is determined not by a finite set of stabilizers, but rather, by a probability distribution over $\R^{2n}$.  Such a probabilty distribution has the propery 
%
%
%
%
% interpretatble in  $\Aff\Co\Isot\Rel_\C$, following the 
%
%

