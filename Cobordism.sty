\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{Cobordism}[2011/03/01]

\RequirePackage{amsmath}
\RequirePackage{calc}
\RequirePackage{tikz}
\usetikzlibrary{positioning,arrows.meta,calc,cd,decorations.markings,fit,shapes.geometric}

\usepackage{forarray}
\usepackage{pgfkeys}
\usepackage{etoolbox}

\newcommand\ignore[1]{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Variables, Variable Commands, and Styles
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Variables %%%
\newlength{\cobordismscale}
\newlength{\cobordismhalfendwidth}
\newlength{\cobordismhalfendheight}
\newlength{\cobordismendwidth}

%%% New Variables %%%
\newlength{\cobheight}		% Height of a pair of pants
\newlength{\cobwidth}		% Width of a cylinder
\newlength{\cobgap}			% Gap between adjacent cylinders
\newlength{\cupheight}		% Height of a cup or cap
\newlength{\ellipseheight}	% Height of a boundary ellipse
\newcommand{\ellipsewidth}{\cobwidth}
\newlength{\cobordismlinewidth}	% Width of line used to draw cobordisms
\newlength{\coboffset}		% cobwidth + cobgap; the horizontal offset between adjacent cylinders
\newlength{\obscurewidth}
\setlength{\obscurewidth}{4pt}
\newlength{\inseamheight}
\newlength{\selectwidth}
\setlength{\selectwidth}{1pt}
\newlength{\dashlength}
\setlength{\dashlength}{2pt}
\newlength{\toff}
\setlength{\toff}{0.2cm}
\newlength{\boff}
\setlength{\boff}{0.3cm}

%%% Variable Commands %%%
\newcommand{\scalecobordisms}[1]
{
	\pgfmathsetmacro{\cobordismscale}{max(#1, 0.75)} % used to scale arrow tips
	\setlength{\cobordismhalfendwidth}{0.25cm}
	\setlength{\cobordismhalfendheight}{0.125cm}
	\setlength{\cobordismendwidth}{2\cobordismhalfendwidth}
	\setlength{\cobordismlinewidth}{0.4pt}
	\setlength{\cobgap}{0.3cm}
	\setlength{\cobwidth}{0.5cm}
	\setlength{\cupheight}{0.4cm}
	\setlength{\cobheight}{0.8cm}
	\setlength{\ellipseheight}{0.18cm}
	\setlength{\dashlength}{2pt}
	\setlength{\cobordismhalfendwidth}{#1\cobordismhalfendwidth}
	\setlength{\cobordismhalfendheight}{#1\cobordismhalfendheight}
	\setlength{\cobordismendwidth}{#1\cobordismendwidth}
	\setlength{\cobgap}{#1\cobgap}
	\setlength{\cobwidth}{#1\cobwidth}
	\setlength{\cupheight}{#1\cupheight}
	\setlength{\cobheight}{#1\cobheight}
	\setlength{\ellipseheight}{#1\ellipseheight}
	\setlength{\coboffset}{\cobwidth+\cobgap}
	\setlength{\inseamheight}{0.25\cobheight}
	\setlength{\dashlength}{#1\dashlength}
}
\newcommand{\stringscalecobordisms}[1]
{
	\scalecobordisms{#1}
	\setlength{\ellipseheight}{0.18cm}
}

% Set the cobordism length parameters.
\scalecobordisms{1}

%%% Styles %%%
% Sets the "cob" style to be used on paths connecting the basic cobordism features.
\tikzset{cob/.style={in=90, out = 270, line width=\cobordismlinewidth,
	postaction={draw,transform canvas = {xshift= 0.5\cobwidth}},
	postaction={draw,transform canvas = {xshift=-0.5\cobwidth}}
}}

% This scope is used for the internal strings inside a cobordism
% in the internal string diagram notation. It doubles the line
% so that a 3d effect is generated. This also means overcrossings
% and undercrossings can be handled.
\tikzset{internal string scope/.style={every path/.style=
	{
		draw=white,
		double distance=\cobordismlinewidth,
		line width=0.5\obscurewidth,
		double=red
	}, every node/.style=
	{
		text=red
	}}}

% This is the standalone (non-scope) version of "internal string", suitable for use in an individual path.
\tikzset{internal string/.style={draw=white, double distance=\cobordismlinewidth, line width=0.5\obscurewidth, double=red}}
\tikzset{backing string/.style={draw=white, double distance=\cobordismlinewidth, line width=0.5\obscurewidth, double=white}}
\newcommand\colouredstring[1]{\tikzset{knot/only when rendering/.style={draw=white, double distance=\cobordismlinewidth, line width=0.5\obscurewidth, double=#1}}}
\def\colouredstringstyle#1{{draw=white, double distance=1pt, line width=0.5pt, double=#1}}

% This is a trick of Andrew Stacey, from the "z-level in TikZ" question on
% TeX stackexchange. It allows you to access layers from a style.
% You just add eg. on layer=foreground to your style
\pgfkeys{%
  /tikz/on layer/.code={
    \pgfonlayer{#1}\begingroup
    \aftergroup\endpgfonlayer
    \aftergroup\endgroup
  },
  /tikz/node on layer/.code={
    \gdef\node@@on@layer{%
      \setbox\tikz@tempbox=\hbox\bgroup\pgfonlayer{#1}\unhbox\tikz@tempbox\endpgfonlayer\egroup}
    \aftergroup\node@on@layer
  },
  /tikz/end node on layer/.code={
      \endpgfonlayer\endgroup\endgroup
  }
}
\def\node@on@layer{\aftergroup\node@@on@layer}

% A "morphism label" style for labeling the morphisms in an internal string
% diagram picture (puts a circle around them). To place them in the foreground,
% use the \begin{pgfonlayer}{foreground} environment.
\tikzset{OLDmorphismlabel/.style={
	shape=circle,
	line width=\cobordismlinewidth,
	fill=white,
	inner sep=0.02cm,
	font=\tiny,
	node on layer=foreground}}
\tikzset{tiny label/.style={
        shape=circle,
        text=red,
        draw=red,
        line width=\cobordismlinewidth,
        fill=white,
        inner sep=0.0cm,
        minimum width=0.25cm,
        font=\tiny,
        node on layer=foreground}}
\tikzset{sq tiny label/.style={
				        shape=rounded rectangle,
				        text=red,
				        draw=red,
				        line width=\cobordismlinewidth,
				        fill=white,
				        inner sep=0.0cm,
				        minimum width=0.25cm,
								minimum height=0.25cm,
				        font=\tiny,
				        node on layer=foreground}}
\tikzset{small label/.style={
	shape=circle,
	text=red,
	draw=red,
	line width=\cobordismlinewidth,
	fill=white,
	inner sep=0.00cm,
	minimum width=0.42cm,
	font=\small,
	node on layer=foreground}}

% Compact way to specify a path should have an arrow
\tikzset{arrow data/.style 2 args={
      decoration={
         markings,
         mark=at position #1 with \arrow{#2}},
         postaction=decorate}
}

% This style curves with the path. It's for use with \arrow{->}.
% The every path/.style={} is there to cancel any previous styles (eg. double effect)
\tikzset{along path/.style={every path/.style={}, sloped, allow upside down}}

% This is the forwards arrow that we'll be using.
\newcommand{\arrownode}[1][red]{\ensuremath{\begin{tikzpicture}[baseline=0pt, #1]\def\obscurewidth{0pt}\draw [double=none] (-3pt,-3pt) to [out=0, in=-125, looseness=1] (0,0) to [out=-55, in=180, looseness=1] (3pt,-3pt);\end{tikzpicture}}}

\tikzset{arrow style/.style={scale=1, sloped, rotate=-90}}

% This is the reverse arrow that we'll be using.
\newcommand{\myreversearrow}{\tikz \draw[<-] (0,0) -- +(.1,0);}

% What is this? Please comment!
\tikzset{cobleft/.style={in=90, out = 270, line width=\cobordismlinewidth,
	postaction={draw,transform canvas = {xshift=-0.5\cobwidth}}
}}
\tikzset{cobright/.style={in=90, out = 270, line width=\cobordismlinewidth,
	postaction={draw,transform canvas = {xshift=0.5\cobwidth}}
}}

% This curvein style puts white halos around the lines, improving the 3d effect
\tikzset{nomorepreactions/.code=\let\tikz@preactions\pgfutil@empty}
\tikzset{curvein/.style={every path/.style={preaction={nomorepreactions,draw,white,shorten >=0pt,shorten <=0pt,line width=\obscurewidth}}, color=red}}

% What is this? Please comment!
\tikzset{right output/.style={transform canvas = {xshift=-0.5\cobwidth - 0.5\cobgap, yshift=-0.5\cobheight}}}

%% These set the styles for the curves on and in and behind the cobordisms.  The colors are the default colors, but other colors can be obtained just by adding a color indicator in the code after the curveon command.
\tikzset{curveon/.style={line width=1.0\cobordismlinewidth, color=\curveoncolor, curve color=red}}

% What is this? Please comment!
\tikzset{curveb/.style={line width=1.5\cobordismlinewidth, color=\curveoncolor, densely dotted}}
\tikzset{curveref/.style={color=\curverefcolor, curve color=\curverefcolor}}

% Sets the colors for strings.
\newcommand{\curveoncolor}{red}
\newcommand{\curveincolor}{red}
\newcommand{\curverefcolor}{black!25!white}

% The colors for morphisms between TQFTs
\newcommand{\innermorphismcolor}{blue!20!white}
\newcommand{\outermorphismcolor}{blue!30!white}

% Macro to draw a box around a boundary ellipse
\newcommand\selectellipse[2]{\begin{pgfonlayer}{selectionbox}
    \draw [#2] ([xshift=\selectwidth, yshift=\selectwidth] #1.west |- #1.north) rectangle ([xshift=-\selectwidth, yshift=-\selectwidth] #1.east |- #1.south);
    \end{pgfonlayer}}

% Custom boolean keys
\newif\ifinvisible\pgfkeys{/tikz/invisible/.is if=invisible}
\newif\ifbotinvisible\pgfkeys{/tikz/botinvisible/.is if=botinvisible}
\newif\ifblue\pgfkeys{/tikz/blue/.is if=blue}
\newif\ifwhiteskirt\pgfkeys{/tikz/whiteskirt/.is if=whiteskirt}
\newif\ifbot\pgfkeys{/tikz/bot/.is if=bot}
\newif\iftop\pgfkeys{/tikz/top/.is if=top}
\newif\ifwide\pgfkeys{/tikz/wide/.is if=wide}
\newif\ifwider\pgfkeys{/tikz/wider/.is if=wider}
\newif\ifverywide\pgfkeys{/tikz/verywide/.is if=verywide}
\newif\ifveryverywide\pgfkeys{/tikz/veryverywide/.is if=veryverywide}
\newif\ifveryveryverywide\pgfkeys{/tikz/veryveryverywide/.is if=veryveryverywide}
\newif\ifveryveryveryverywide\pgfkeys{/tikz/veryveryveryverywide/.is if=veryveryveryverywide}
\newif\ifslightlytall\pgfkeys{/tikz/slightlytall/.is if=slightlytall}
\newif\iftall\pgfkeys{/tikz/tall/.is if=tall}
\newif\ifverytall\pgfkeys{/tikz/verytall/.is if=verytall}
\newif\ifveryverytall\pgfkeys{/tikz/veryverytall/.is if=veryverytall}
\newif\ifveryveryverytall\pgfkeys{/tikz/veryveryverytall/.is if=veryveryverytall}
\newif\iflowercob\pgfkeys{/tikz/lowercob/.is if=lowercob}
\newif\ifselect\pgfkeys{/tikz/select/.is if=select}
\newif\ifobscured\pgfkeys{/tikz/obscured/.is if=obscured}
\pgfkeys{/tikz/span/.initial=1}
\newcommand{\morphismspan}{\pgfkeysvalueof{/tikz/span}}
\pgfkeys{/tikz/dot/.initial=white}
\newcommand{\morphismcolour}{\pgfkeysvalueof{/tikz/dot}}
\newif\ifautonomous\pgfkeys{/tikz/autonomous/.is if=autonomous}
\newif\ifup\pgfkeys{/tikz/up/.is if=up}
\newif\ifdown\pgfkeys{/tikz/down/.is if=down}
\newif\ifunoriented\pgfkeys{/tikz/unoriented/.is if=unoriented}
\tikzset{lowercob=true}

% Key to specify that a shape should be drawn double height. Only used for the Cylinder shape at the moment.
\newif\ifdoubleheight\pgfkeys{/tikz/doubleheight/.is if=doubleheight}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End Variables, Variable Commands, and Styles
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% The following Shapes are defined: ... but this is out of date now.
%
%	Shape:				  Description:
% Cobordism Top End		The top boundary of a cobordism.
% Cobordism Bottom End		The bottom or middle boundary circle of a cobordism
% Cobordism Top End 3D		Like Top End, but with 3d style for internal strings
% Cobordism Bottom End 3D	Like Bottom End, but with 3d style for internal strings
% Cobordism Cap			The Cap cobordism
% Cobordism Cup			The Cup cobordism, with an internal boundary circle
% Cobordism Cup Top		The Cup cobordism, with a top boundary circle
% Cobordism Pants			The Pants cobordism (no boundary circles)
% Cobordism Super Pants	The Pants cobordism, with inherited 3d bottom nodes
% Cobordism Copants		An upside-down Pants cobordism
% Cobordism Super Copants	An upside-down Pants cobordism, with inherited 3d belt node
% Cobordism Cylinder		A cylinder, just two vertical lines, no top or bottom.
% Cobordism Super Cylinder 	A cylinder with inherited 3d bottom node
% Cobordism Copairing		The bent cylinder with 0 inputs and 2 outputs
% Cobordism Braid A		A pair of braided cylinders, left-over-right
% Cobordism Super Braid A	Like Braid A, but with inherited 3d bottom nodes.
% Cobordism Braid B		A pair of braided cylinders, right-over-left
% Cobordism Super Braid B	Like Braid B, but with inherited 3d bottom nodes
% Cobordism Left Swish		The cylinder, with the top to the left of the bottom
% Cobordism Super Left Swish	Like Left Swish, but with inherited 3d bottom nodes
% Cobordism Right Swish	The cylinder, with the top to the right of the bottom
% Cobordism Super Right Swish	Like Right Swish, but with inherited 3d bottom nodes
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Set keys for scaling parts of cobordisms
\tikzset{belt scale/.initial=1}
\tikzset{left leg scale/.initial=1}
\tikzset{right leg scale/.initial=1}
\tikzset{height scale/.initial=1}
\tikzset{top scale/.initial=1}
\tikzset{bottom scale/.initial=1}
\tikzset{curve color/.initial=black}
\tikzset{select color/.initial=black}

% Set layers for 3D effects
\pgfdeclarelayer{bottom}
\pgfdeclarelayer{background}
\pgfdeclarelayer{internal}
\pgfdeclarelayer{foreground}
\pgfdeclarelayer{label}
\pgfdeclarelayer{cobordism}
\pgfdeclarelayer{top}
\pgfdeclarelayer{selectionbox}
\pgfsetlayers{bottom,background,main,internal,foreground,label,cobordism,top,selectionbox}

% Macros giving the various basic shape pieces, and the corresponding code for use in defining the anchors.  If you change a basic shape, you must also change the corresponding anchor command.

\newcommand{\topofellipse}{
	\pgfpathmoveto{\pgfpoint{0.5\cobwidth}{0cm}}
	\pgfpathcurveto{\pgfpoint{0.5\cobwidth}{0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\bottomofellipse}{
\pgfpathmoveto{\pgfpoint{0.5\cobwidth}{0cm}}
\pgfpathcurveto{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\topofellipseanchor}{
{\pgfpoint{0.5\cobwidth}{0cm}}{\pgfpoint{0.5\cobwidth}{0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\bottomofellipseanchor}{
{\pgfpoint{0.5\cobwidth}{0cm}}{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\ellipselineanchor}{
	{\pgfpoint{-0.5\cobwidth}{0cm}}
	{\pgfpoint{0.5\cobwidth}{0cm}}
}

\newcommand{\newellipselineanchor}{
	{\pgfpoint{-0.5*\storedwidth}{0cm}}
	{\pgfpoint{0.5*\storedwidth}{0cm}}
}

%\newcommand{\pantsrightlinestart}{
%	\pgfpathlineto
%		{\pgfpoint{0.5*\beltwidth}{0.5*\localheight}}
%}
%\newcommand{\pantsrightmovestart}{
%	\pgfpathmoveto
%		{\pgfpoint{0.5*\beltwidth}{0.5*\localheight}}
%}
%\newcommand{\pantsrightcurve}{
%	\pgfpathcurveto
%		{\pgfpoint{0.5*\beltwidth}{0pt}}
%		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{0pt}}
%		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{-0.5*\localheight}}
%}

\newcommand{\pantsrightlinestart}{
	\pgfpathlineto
		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{-0.5*\localheight}}
}
\newcommand{\pantsrightmovestart}{
	\pgfpathmoveto
		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{-0.5*\localheight}}
}
\newcommand{\pantsrightcurve}{
	\pgfpathcurveto
		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{0pt}}
		{\pgfpoint{0.5*\beltwidth}{0pt}}
		{\pgfpoint{0.5*\beltwidth}{0.5*\localheight}}
}

\newcommand{\pantsright}{
	\pantsrightmovestart
	\pantsrightcurve
}

\newcommand{\pantsleftmovestart}{
	\pgfpathmoveto
		{\pgfpoint{-0.5*\beltwidth}{0.5*\localheight}}
}
\newcommand{\pantsleftlinestart}{
	\pgfpathmoveto
		{\pgfpoint{-0.5*\beltwidth}{0.5*\localheight}}
}
\newcommand{\pantsleftcurve}{
	\pgfpathcurveto
		{\pgfpoint{-0.5*\beltwidth}{0pt}}
		{\pgfpoint{-0.5\cobgap - 0.5*\rightlegwidth - 0.5*\leftlegwidth - 0.5*\extrawidth}{0pt}}
		{\pgfpoint{-0.5\cobgap - 0.5*\rightlegwidth - 0.5*\leftlegwidth - 0.5*\extrawidth}{-0.5*\localheight}}
}
\newcommand{\pantsleft}{
	\pantsleftmovestart
	\pantsleftcurve
}

\newcommand{\pantsinseammovestart}{
	\pgfpathmoveto
		{\pgfpoint{-0.5*\rightlegwidth + 0.5*\leftlegwidth - 0.5\cobgap - 0.5*\extrawidth}{-0.5*\localheight}}
}

\newcommand{\pantsinseamlinestart}{
	\pgfpathlineto
		{\pgfpoint{-0.5*\rightlegwidth + 0.5*\leftlegwidth - 0.5\cobgap - 0.5*\extrawidth}{-0.5*\localheight}}
}

\newcommand{\pantsinseamcurve}{
	\pgfpatharc{180}{0}{0.5\cobgap + 0.5*\extrawidth
							and \inseamheight + 0*\extrawidth}
}

\newcommand{\pantsinseam}{
	\pantsinseammovestart
	\pantsinseamcurve
}

\newcommand\copantsrightmovestart{
	\pgfpathmoveto
		{\pgfpoint{0.5*\beltwidth}{-0.5*\localheight}}
}
\newcommand\copantsrightlinestart{
	\pgfpathmoveto
		{\pgfpoint{0.5*\beltwidth}{-0.5*\localheight}}
}
\newcommand\copantsrightcurve{
	\pgfpathcurveto
		{\pgfpoint{0.5*\beltwidth}{0pt}}
		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{0pt}}
		{\pgfpoint{0.5\cobgap + 0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5*\extrawidth}{0.5*\localheight}}
}
\newcommand{\copantsright}{
	\copantsrightmovestart
	\copantsrightcurve
}

\newcommand\copantsleftmovestart{
	\pgfpathmoveto
		{\pgfpoint{-0.5\cobgap - 0.5*\rightlegwidth - 0.5*\leftlegwidth - 0.5*\extrawidth}{0.5*\localheight}}
}
\newcommand\copantsleftlinestart{
	\pgfpathlineto
		{\pgfpoint{-0.5\cobgap - 0.5*\rightlegwidth - 0.5*\leftlegwidth - 0.5*\extrawidth}{0.5*\localheight}}
}
\newcommand\copantsleftcurve{
	\pgfpathcurveto
		{\pgfpoint{-0.5\cobgap - 0.5*\rightlegwidth - 0.5*\leftlegwidth - 0.5*\extrawidth}{0pt}}
		{\pgfpoint{-0.5*\beltwidth}{0pt}}
		{\pgfpoint{-0.5*\beltwidth}{-0.5*\localheight}}
}
\newcommand{\copantsleft}{
	\copantsleftmovestart
	\copantsleftcurve
}

\newcommand\copantsinseammovestart{
	\pgfpathmoveto
		{\pgfpoint{-0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5\cobgap + 0.5*\extrawidth}{0.5*\localheight}}
}
\newcommand\copantsinseamlinestart{
	\pgfpathlineto
		{\pgfpoint{-0.5*\rightlegwidth + 0.5*\leftlegwidth + 0.5\cobgap + 0.5*\extrawidth}{0.5*\localheight}}
}
\newcommand\copantsinseamcurve{
	\pgfpatharc{360}{180}{0.5\cobgap + 0.5*\extrawidth and \inseamheight}
}

\newcommand{\copantsinseam}{
	\copantsinseammovestart
	\copantsinseamcurve
}

\newcommand{\pantsrightanchor}{
		{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
			{\pgfpoint{0.5\cobwidth}{\shouldertwo}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{\shoulderone}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight}}
}

\newcommand{\pantsleftanchor}{
			{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			{\pgfpoint{-0.5\cobwidth}{\shouldertwo}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{\shoulderone}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight}}
}

\newcommand{\pantsinseamanchor}{
	{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
	{\pgfpoint{0.5\cobgap}{-0.5\cobheight+0.333\cobheight}}{\pgfpoint{-0.5\cobgap}{-0.5\cobheight+0.333\cobheight}}{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
}

\newcommand{\copantsrightanchor}{
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
			{\pgfpoint{0.5\cobwidth}{0pt}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0pt}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight}}
}

\newcommand{\copantsleftanchor}{
		{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		{\pgfpoint{-0.5\cobwidth}{0pt}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0pt}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
}

\newcommand{\copantsinseamanchor}{
		{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		{\pgfpoint{0.5\cobgap}{0.5\cobheight-0.333\cobheight}}{\pgfpoint{-0.5\cobgap}{0.5\cobheight-0.333\cobheight}}{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
}

\newcommand{\cuppath}{
		\pgfpathmoveto
			{\pgfpoint{0.5\cobwidth}{0cm}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{-1.33\cupheight}}
			{\pgfpoint{-0.5\cobwidth}{-1.33\cupheight}}
			{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\cappath}{
	\pgfpathmoveto
		{\pgfpoint{0.5\cobwidth}{0cm}}
	\pgfpathcurveto
		{\pgfpoint{0.5\cobwidth}{1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\cuppathanchor}{
		{\pgfpoint{0.5\cobwidth}{0cm}}
		{\pgfpoint{0.5\cobwidth}{-1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{-1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\cappathanchor}{
		{\pgfpoint{0.5\cobwidth}{0cm}}
		{\pgfpoint{0.5\cobwidth}{1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{0cm}}
}

\newcommand{\copairingout}{
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
}
\newcommand{\copairingin}{
		\pgfpathmoveto{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
		{\pgfpoint{0.5\cobgap}{0.5\cobheight-0.66\cobgap}}
		{\pgfpoint{-0.5\cobgap}{0.5\cobheight-0.66\cobgap}}
		{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
}

\newcommand{\copairingoutanchor}{
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
}
\newcommand{\copairinginanchor}{
		{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		{\pgfpoint{0.5\cobgap}{0.5\cobheight-0.66\cobgap}}
		{\pgfpoint{-0.5\cobgap}{0.5\cobheight-0.66\cobgap}}
		{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
}

\newcommand{\pairingoutanchor}{
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight+1.33\cobwidth+.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5\cobheight+1.33\cobwidth+.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5\cobheight}}
}
\newcommand{\pairinginanchor}{
		{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
		{\pgfpoint{0.5\cobgap}{-0.5\cobheight+0.66\cobgap}}
		{\pgfpoint{-0.5\cobgap}{-0.5\cobheight+0.66\cobgap}}
		{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
}

% The lefta, leftb, righta and rightb commands draw
% the four major curves used to form a braid. They
% are given in left-to-right order, as they are
% encountered at the bottom of the braid.
\newcommand\pgflefta
{
	\pgfpathmoveto
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth}{0.5\cobheight}}
	\pgfpathcurveto
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth}{0.2\cobheight}}
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth}{0}}
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth}{-0.5\cobheight}}
}
\newcommand\pgfleftb
{
	\pgfpathmoveto
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth}{-0.5\cobheight}}
	\pgfpathcurveto
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth}{-0.2\cobheight}}
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth}{0}}
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth}{0.5\cobheight}}
}
\newcommand\pgfrighta
{
	\pgfpathmoveto
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth}{0.5\cobheight}}
	\pgfpathcurveto
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth}{0}}
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth}{-0.2\cobheight}}
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth}{-0.5\cobheight}}
}
\newcommand\pgfrightb
{
	\pgfpathmoveto
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth}{-0.5\cobheight}}
	\pgfpathcurveto
		{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth}{0}}
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth}{0.2\cobheight}}
		{\pgfpoint{-0.5\cobgap-0.5*\extrawidth}{0.5\cobheight}}
}

% The lefta, leftb, righta and rightb commands draw
% the four major curves used to form a braid. They
% are given in left-to-right order, as they are
% encountered at the bottom of the braid.
\newcommand\pgfleftaanchor
{
		{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		{\pgfpoint{0.5\cobgap}{0.2\cobheight}}
		{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5\cobheight}}
}
\newcommand\pgfleftbanchor
{
		{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		{\pgfpoint{-0.5\cobgap}{-0.2\cobheight}}
		{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight}}
}
\newcommand\pgfrightaanchor
{
		{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
		{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		{\pgfpoint{0.5\cobgap}{-0.2\cobheight}}
		{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
}
\newcommand\pgfrightbanchor
{
		{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
		{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		{\pgfpoint{-0.5\cobgap}{0.2\cobheight}}
		{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
}

% Marcos for the positions

\newcommand*\east{0}
\newcommand*\ese{.125}
\newcommand*\se{.25}
\newcommand*\sse{.375}
\newcommand*\south{.5}
\newcommand*\ssw{.625}
\newcommand*\sw{.75}
\newcommand*\wsw{.875}
\newcommand*\west{1}

%\newcommand*\east{0}
\newcommand*\ene{.125}
\newcommand*\northeast{.25}
\newcommand*\nne{.375}
\newcommand*\north{.5}
\newcommand*\nnw{.625}
\newcommand*\nw{.75}
\newcommand*\wnw{.875}
%\newcommand*\west{1}

\newcommand*\rght{0}
\newcommand*\rrm{.125}
\newcommand*\rghtm{.25}
\newcommand*\mrm{.375}
\newcommand*\mddle{.5}
\newcommand*\mlm{.625}
\newcommand*\lm{.75}
\newcommand*\llm{.875}
\newcommand*\lft{1}

\newcommand*\belt{0}
\newcommand*\bbm{.125}
\newcommand*\bm{.25}
\newcommand*\mbm{.375}
%\newcommand*\mddle{.5}
\newcommand*\mgm{.625}
\newcommand*\gm{.75}
\newcommand*\ggm{.875}
\newcommand*\leg{1}

\newcommand*\leftthird{0.33}
\newcommand*\rightthird{.67}
\newcommand*\leftquarter{0.25}
\newcommand*\rightquarter{0.75}

%%%%%%%

\pgfdeclareshape{Cobordism Top End}
{
	\savedanchor\centerpoint
	{
		\pgf@x=.5\wd\pgfnodeparttextbox%
		\pgf@y=.5\ht\pgfnodeparttextbox%
		\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\anchor{east}	{\expandafter \pgfpointcurveattime \expandafter \east 	\bottomofellipseanchor}
	\anchor{ese} 	{\expandafter \pgfpointcurveattime \expandafter \ese 	\bottomofellipseanchor}
	\anchor{se} 	{\expandafter \pgfpointcurveattime \expandafter \se 	\bottomofellipseanchor}
	\anchor{sse}	{\expandafter \pgfpointcurveattime \expandafter \sse 	\bottomofellipseanchor}
	\anchor{south}	{\expandafter \pgfpointcurveattime \expandafter \south 	\bottomofellipseanchor}
	\anchor{ssw}  	{\expandafter \pgfpointcurveattime \expandafter \ssw	\bottomofellipseanchor}
	\anchor{sw}   	{\expandafter \pgfpointcurveattime \expandafter \sw 	\bottomofellipseanchor}
	\anchor{wsw}  	{\expandafter \pgfpointcurveattime \expandafter \wsw 	\bottomofellipseanchor}
	\anchor{west} 	{\expandafter \pgfpointcurveattime \expandafter \west 	\bottomofellipseanchor}

	\anchor{east}	{\expandafter \pgfpointcurveattime \expandafter \east 	\topofellipseanchor}
	\anchor{ene}	{\expandafter \pgfpointcurveattime \expandafter \ene 	\topofellipseanchor}
	\anchor{ne}	{\expandafter \pgfpointcurveattime \expandafter \northeast \topofellipseanchor}
	\anchor{nne}	{\expandafter \pgfpointcurveattime \expandafter \nne 	\topofellipseanchor}
	\anchor{north}	{\expandafter \pgfpointcurveattime \expandafter \north 	\topofellipseanchor}
	\anchor{nnw}	{\expandafter \pgfpointcurveattime \expandafter \nnw	\topofellipseanchor}
	\anchor{nw}	{\expandafter \pgfpointcurveattime \expandafter \nw 	\topofellipseanchor}
	\anchor{wnw}	{\expandafter \pgfpointcurveattime \expandafter \wnw 	\topofellipseanchor}
	\anchor{west}	{\expandafter \pgfpointcurveattime \expandafter \west 	\topofellipseanchor}

	\anchor{in-llc}	{\expandafter \pgfpointlineattime \expandafter \ese 	\ellipselineanchor}
	\anchor{in-lc}	{\expandafter \pgfpointlineattime \expandafter \se 	\ellipselineanchor}
	\anchor{in-clc}	{\expandafter \pgfpointlineattime \expandafter \sse 	\ellipselineanchor}
	\anchor{in-center}{\expandafter \pgfpointlineattime \expandafter \south \ellipselineanchor}
	\anchor{in-crc}	{\expandafter \pgfpointlineattime \expandafter \ssw	\ellipselineanchor}
	\anchor{in-rc}	{\expandafter \pgfpointlineattime \expandafter \sw 	\ellipselineanchor}
	\anchor{in-rrc}	{\expandafter \pgfpointlineattime \expandafter \wsw 	\ellipselineanchor}

	\anchor{in-leftthird}{\expandafter \pgfpointlineattime \expandafter \leftthird \ellipselineanchor}
	\anchor{in-rightthird}{\expandafter \pgfpointlineattime \expandafter \rightthird \ellipselineanchor}
	\anchor{in-leftquarter}{\expandafter \pgfpointlineattime \expandafter \leftquarter \ellipselineanchor}
	\anchor{in-rightquarter}{\expandafter \pgfpointlineattime \expandafter \rightquarter \ellipselineanchor}


	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}
			\bottomofellipse
		\pgfusepath{stroke}

			\topofellipse
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Top End 3D}
{
	\savedanchor\centerpoint
	{
		\pgf@x=.5\wd\pgfnodeparttextbox
		\pgf@y=.5\ht\pgfnodeparttextbox
		\advance\pgf@y by -.5\dp\pgfnodeparttextbox
	}
	\saveddimen\storedwidth
	{
		\pgf@x = \cobwidth
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

%	\anchor{east}	{\expandafter \pgfpointcurveattime \expandafter \east 	\bottomofellipseanchor}
	\anchor{ese} 	{\expandafter \pgfpointcurveattime \expandafter \ese 	\bottomofellipseanchor}
	\anchor{se} 	{\expandafter \pgfpointcurveattime \expandafter \se 	\bottomofellipseanchor}
	\anchor{sse}	{\expandafter \pgfpointcurveattime \expandafter \sse 	\bottomofellipseanchor}
	\anchor{south}	{\expandafter \pgfpointcurveattime \expandafter \south 	\bottomofellipseanchor}
	\anchor{ssw}  	{\expandafter \pgfpointcurveattime \expandafter \ssw	\bottomofellipseanchor}
	\anchor{sw}   	{\expandafter \pgfpointcurveattime \expandafter \sw 	\bottomofellipseanchor}
	\anchor{wsw}  	{\expandafter \pgfpointcurveattime \expandafter \wsw 	\bottomofellipseanchor}
%	\anchor{west} 	{\expandafter \pgfpointcurveattime \expandafter \west 	\bottomofellipseanchor}

%	\anchor{east}	{\expandafter \pgfpointcurveattime \expandafter \east 	\topofellipseanchor}
	\anchor{ene}	{\expandafter \pgfpointcurveattime \expandafter \ene 	\topofellipseanchor}
	\anchor{ne}	{\expandafter \pgfpointcurveattime \expandafter \northeast \topofellipseanchor}
	\anchor{nne}	{\expandafter \pgfpointcurveattime \expandafter \nne 	\topofellipseanchor}
	\anchor{north}	{\expandafter \pgfpointcurveattime \expandafter \north 	\topofellipseanchor}
	\anchor{nnw}	{\expandafter \pgfpointcurveattime \expandafter \nnw	\topofellipseanchor}
	\anchor{nw}	{\expandafter \pgfpointcurveattime \expandafter \nw 	\topofellipseanchor}
	\anchor{wnw}	{\expandafter \pgfpointcurveattime \expandafter \wnw 	\topofellipseanchor}
%	\anchor{west}	{\expandafter \pgfpointcurveattime \expandafter \west 	\topofellipseanchor}

	\anchor{west}	{\expandafter \pgfpointlineattime \expandafter \west 	\newellipselineanchor}
	\anchor{east}	{\expandafter \pgfpointlineattime \expandafter \east 	\newellipselineanchor}
	\anchor{in-llc}	{\expandafter \pgfpointlineattime \expandafter \ese 	\newellipselineanchor}
	\anchor{in-lc}	{\expandafter \pgfpointlineattime \expandafter \se 	\newellipselineanchor}
	\anchor{in-clc}	{\expandafter \pgfpointlineattime \expandafter \sse 	\newellipselineanchor}
	\anchor{in-center}{\expandafter \pgfpointlineattime \expandafter \south \newellipselineanchor}
	\anchor{in-crc}	{\expandafter \pgfpointlineattime \expandafter \ssw	\newellipselineanchor}
	\anchor{in-rc}	{\expandafter \pgfpointlineattime \expandafter \sw 	\newellipselineanchor}
	\anchor{in-rrc}	{\expandafter \pgfpointlineattime \expandafter \wsw 	\newellipselineanchor}

	\anchor{in-leftthird}{\expandafter \pgfpointlineattime \expandafter \leftthird \newellipselineanchor}
	\anchor{in-rightthird}{\expandafter \pgfpointlineattime \expandafter \rightthird \newellipselineanchor}
	\anchor{in-leftquarter}{\expandafter \pgfpointlineattime \expandafter \leftquarter \newellipselineanchor}
	\anchor{in-rightquarter}{\expandafter \pgfpointlineattime \expandafter \rightquarter \newellipselineanchor}


	\backgroundpath
	{
		% Draw optional blue background
		\ifblue
			\begin{pgfonlayer}{background}
			\bottomofellipse
			\pgfsetfillcolor{\outermorphismcolor}
			\pgfusepath{fill}
			\topofellipse
			\pgfsetfillcolor{\outermorphismcolor}
			\pgfusepath{fill}
			\end{pgfonlayer}
		\fi

		% Draw solid part on background layer
		\begin{pgfonlayer}{background}
			\topofellipse
			\pgfusepath{stroke}
		\end{pgfonlayer}

		% Draw obscuring part
		\begin{pgfonlayer}{foreground}
			\begin{pgfscope}
				% Clip to make sure obscuring curve is within bordism boundaries
				\pgfpathmoveto{\pgfpoint{-0.5\ellipsewidth}{0}}
				\pgfpathlineto{\pgfpoint{-0.5\ellipsewidth}{-1.5*\obscurewidth}}
				\pgfpathlineto{\pgfpoint{0.5\ellipsewidth}{-1.5*\obscurewidth}}
				\pgfpathlineto{\pgfpoint{0.5\ellipsewidth}{0}}
				\pgfusepath{clip}

				\ifblue
					\pgfsetstrokecolor{\outermorphismcolor}
				\else
					\pgfsetstrokecolor{white}
				\fi
				\pgfsetlinewidth{\obscurewidth}
				\pgfpathmoveto{\pgfpoint{0cm}{-0.5\ellipseheight}}
				\pgfpatharc{270}{200}{0.5\cobwidth and 0.5\ellipseheight}
				\pgfpathmoveto{\pgfpoint{0cm}{-0.5\ellipseheight}}
				\pgfpatharc{270}{340}{0.5\cobwidth and 0.5\ellipseheight}
				\pgfusepath{stroke}
			\end{pgfscope}
			\pgfsetlinewidth{\cobordismlinewidth}
			\pgfsetstrokecolor{black}
			\bottomofellipse
			\pgfusepath{stroke}

		\end{pgfonlayer}

	}
}

\pgfdeclareshape{Cobordism Box}
{
	\savedanchor\centerpoint
	{
		\pgf@x=.5\wd\pgfnodeparttextbox
		\pgf@y=.5\ht\pgfnodeparttextbox
		\advance\pgf@y by -.5\dp\pgfnodeparttextbox
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\backgroundpath
	{
		\begin{pgfonlayer}{foreground}
			\pgfsetlinewidth{\cobordismlinewidth}
			\pgfsetstrokecolor{black}
			\pgfsetdash{ {1pt}{2pt}{1pt}{2pt} }{0pt}
			\pgfpathmoveto{\pgfpoint{0.5\cobwidth+0.3\cobgap}{0.8\ellipseheight}}
			\pgfpathlineto{\pgfpoint{ 0.5\cobwidth+0.3\cobgap}{-0.8\ellipseheight}}
			\pgfpathlineto{\pgfpoint{-0.5\cobwidth-0.3\cobgap}{-0.8\ellipseheight}}
			\pgfpathlineto{\pgfpoint{-0.5\cobwidth-0.3\cobgap}{ 0.8\ellipseheight}}
			\pgfpathlineto{\pgfpoint{ 0.5\cobwidth+0.3\cobgap}{ 0.8\ellipseheight}}
			\pgfusepath{stroke}
		\end{pgfonlayer}
	}
}

\pgfdeclareshape{Cobordism Blue Cylinder}
{
	\savedanchor\centerpoint
	{
         \pgf@x=0pt
         \pgf@y=0pt
     }
    \anchor{top}
    {
        \pgf@x=0pt
        \pgf@y=0.5\cobheight
    }
    \anchor{bottom}
    {
        \pgf@x=0pt
        \pgf@y=0pt
        \advance\pgf@y by -0.5\cobheight
    }
    \anchor{bot}
    {
        \pgf@x=0pt
        \pgf@y=0pt
        \advance\pgf@y by -0.5\cobheight
    }
	\anchor{center}{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Draw blue foreground section, no stroke
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
        \pgfpathlineto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5\cobheight-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
        \pgfpathlineto{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto{\pgfpoint{0.5\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting bottom half of upper ellipse
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
		\pgfpathlineto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5\cobheight-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		\pgfpathlineto{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
		\pgfusepath{stroke}

        % Add solid top end, if the user has requested it.
        \iftop
		% First draw fill, no stroke
			\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{0.5*\cobheight+0.666*\ellipseheight}}{\pgfpoint{0.5\cobwidth}{0.5*\cobheight+0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
			\pgfpathcurveto{\pgfpoint{0.5\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			\pgfsetfillcolor{\innermorphismcolor}
			\pgfusepath{fill, stroke}
        \fi

		% Finally, draw bottom dotted ellipse of cylinder.
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{-0.5*\cobheight + 0.666*\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5*\cobheight + 0.666*\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Morphism Cylinder}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
   	\anchor{top}
   	{
       	\pgf@x=0pt
        \pgf@y=0.5\cobheight
   	}
	\anchor{bottom}
   	{
       	\pgf@x=0pt
        \pgf@y=0pt
       	\advance\pgf@y by -0.5\cobheight
   	}
   	\anchor{bot}
   	{
       	\pgf@x=0pt
       	\pgf@y=0pt
       	\advance\pgf@y by -0.5\cobheight
   	}
	\anchor{center}{\centerpoint}
	\saveddimen\localheight
	{
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
       	\setlength{\pgf@x}{\heightscale\cobheight}
	}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Draw blue foreground section, no stroke
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfpathlineto
			{\pgfpoint{-0.5\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0cm}}
        \pgfpathlineto
        	{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting bottom half of upper ellipse
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfpathlineto
			{\pgfpoint{-0.5\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0cm}}
		\pgfpathlineto
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
		\pgfusepath{stroke}

		\begin{pgfscope}
		% Now do the same, but make it a clipping path to clip edge of bolder F line.
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfpathlineto
			{\pgfpoint{-0.5\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0cm}}
		\pgfpathlineto
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
		\pgfusepath{clip}

		% Now draw a thicker line where the F is to indicate "functor being applied".
		\pgfsetlinewidth{8\cobordismlinewidth}
		\pgfpathmoveto
			{\pgfpoint{-0.6\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.6\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.6\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.6\cobwidth}{0cm}}
		\pgfusepath{stroke}
		\pgfsetlinewidth{\cobordismlinewidth}
		\end{pgfscope}

		% Draw two sides of cylinder
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0}}
		\pgfpathlineto
			{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight}}
		\pgfusepath{stroke}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobwidth}{0}}
		\pgfpathlineto
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight}}
		\pgfusepath{stroke}

        % Add solid top end, if the user has requested it.
        \iftop
			% First draw fill, no stroke
			\pgfpathmoveto
				{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
			\pgfpathcurveto
				{\pgfpoint{-0.5\cobwidth}{0.5*\localheight+0.666*\ellipseheight}}
				{\pgfpoint{0.5\cobwidth}{0.5*\localheight+0.666\ellipseheight}}
				{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
			\pgfpathcurveto
				{\pgfpoint{0.5\cobwidth}{0.5*\localheight - 0.666*\ellipseheight}}
				{\pgfpoint{-0.5\cobwidth}{0.5*\localheight - 0.666*\ellipseheight}}
				{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
			\pgfsetfillcolor{\innermorphismcolor}
			\pgfusepath{fill, stroke}
        \fi

        % Add bottom end 3d node to bottom, using a local coordinate environment.
   		\begin{pgfscope}
	        \ifbot
		        \centerpoint
	        	{
	            	\pgftransformyshift{-0.5*\localheight}
		            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottom}{}
	        	}
	        \fi
		\end{pgfscope}


	}
}

\pgfdeclareshape{Cobordism Reverse Morphism Cylinder}
{
	\savedanchor\centerpoint
	{
         \pgf@x=0pt
         \pgf@y=0pt
     }
	\saveddimen\localheight
	{
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
       	\setlength{\pgf@x}{\heightscale\cobheight}
	}
    \anchor{top}
    {
        \pgf@x=0pt
		\pgf@y=0.5\dimexpr\localheight\relax
    }
    \anchor{bottom}
    {
        \pgf@x=0pt
        \pgf@y=-0.5\dimexpr\localheight\relax
    }
    \anchor{bot}
    {
        \pgf@x=0pt
        \pgf@y=-0.5\dimexpr\localheight\relax
    }
	\anchor{center}{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Draw blue foreground section
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
         \pgfpathlineto{\pgfpoint{-0.5\cobwidth}{0}}
		\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{0cm}}
         \pgfpathlineto{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		 \pgfpathcurveto{\pgfpoint{0.5\cobwidth}{-0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{-0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill, stroke}

		% Now stroke it, omitting bottom half of upper ellipse
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
         \pgfpathlineto{\pgfpoint{-0.5\cobwidth}{0}}
		\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{0cm}}
         \pgfpathlCineto{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		\pgfusepath{stroke}

		% Draw upper white part of cylinder
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{0}}
		 \pgfpathlineto{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
		\pgfusepath{stroke}


		\pgfpathmoveto{\pgfpoint{0.5\cobwidth}{0}}
		 \pgfpathlineto{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
		\pgfusepath{stroke}

        % Add solid top end, if the user has requested it.
        \iftop%
			\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			\pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{0.5*\cobheight+0.666*\ellipseheight}}{\pgfpoint{0.5\cobwidth}{0.5*\cobheight+0.666\ellipseheight}}{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
		 	\pgfpathcurveto{\pgfpoint{0.5\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			\pgfusepath{stroke}
        \fi%

		% Finally, draw bottom dotted upper half of ellipse of cylinder.
		\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
	     \pgfpathcurveto{\pgfpoint{-0.5\cobwidth}{-0.5*\cobheight + 0.666*\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5*\cobheight + 0.666*\ellipseheight}}{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
     	\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Bottom End}
{
	\savedanchor\centerpoint
	{
		\pgf@x=.5\wd\pgfnodeparttextbox%
		\pgf@y=.5\ht\pgfnodeparttextbox%
		\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\anchor{east}{\expandafter \pgfpointcurveattime \expandafter \east \bottomofellipseanchor}
	\anchor{ese}{\expandafter \pgfpointcurveattime \expandafter \ese \bottomofellipseanchor}
	\anchor{se}{\expandafter \pgfpointcurveattime \expandafter \se \bottomofellipseanchor}
	\anchor{sse}{\expandafter \pgfpointcurveattime \expandafter \sse \bottomofellipseanchor}
	\anchor{south}{\expandafter \pgfpointcurveattime \expandafter \south \bottomofellipseanchor}
	\anchor{ssw}{\expandafter \pgfpointcurveattime \expandafter \ssw\bottomofellipseanchor}
	\anchor{sw}{\expandafter \pgfpointcurveattime \expandafter \sw \bottomofellipseanchor}
	\anchor{wsw}{\expandafter \pgfpointcurveattime \expandafter \wsw \bottomofellipseanchor}
	\anchor{west}{\expandafter \pgfpointcurveattime \expandafter \west \bottomofellipseanchor}

	\anchor{east}{\expandafter \pgfpointcurveattime \expandafter \east \topofellipseanchor}
	\anchor{ene}{\expandafter \pgfpointcurveattime \expandafter \ene \topofellipseanchor}
	\anchor{ne}{\expandafter \pgfpointcurveattime \expandafter \northeast \topofellipseanchor}
	\anchor{nne}{\expandafter \pgfpointcurveattime \expandafter \nne \topofellipseanchor}
	\anchor{north}{\expandafter \pgfpointcurveattime \expandafter \north \topofellipseanchor}
	\anchor{nnw}{\expandafter \pgfpointcurveattime \expandafter \nnw\topofellipseanchor}
	\anchor{nw}{\expandafter \pgfpointcurveattime \expandafter \nw \topofellipseanchor}
	\anchor{wnw}{\expandafter \pgfpointcurveattime \expandafter \wnw \topofellipseanchor}
	\anchor{west}{\expandafter \pgfpointcurveattime \expandafter \west \topofellipseanchor}

	\anchor{in-llc}{\expandafter \pgfpointlineattime \expandafter \ese \ellipselineanchor}
	\anchor{in-lc}{\expandafter \pgfpointlineattime \expandafter \se \ellipselineanchor}
	\anchor{in-clc}{\expandafter \pgfpointlineattime \expandafter \sse \ellipselineanchor}
	\anchor{in-center}{\expandafter \pgfpointlineattime \expandafter \south \ellipselineanchor}
	\anchor{in-crc}{\expandafter \pgfpointlineattime \expandafter \ssw\ellipselineanchor}
	\anchor{in-rc}{\expandafter \pgfpointlineattime \expandafter \sw \ellipselineanchor}
	\anchor{in-rrc}{\expandafter \pgfpointlineattime \expandafter \wsw \ellipselineanchor}
	\anchor{in-leftthird}{\expandafter \pgfpointlineattime \expandafter \leftthird \ellipselineanchor}
	\anchor{in-rightthird}{\expandafter \pgfpointlineattime \expandafter \rightthird \ellipselineanchor}
	\anchor{in-leftquarter}{\expandafter \pgfpointlineattime \expandafter \leftquarter \ellipselineanchor}
	\anchor{in-rightquarter}{\expandafter \pgfpointlineattime \expandafter \rightquarter \ellipselineanchor}

	\anchorborder{\centerpoint}
	\backgroundpath
	{
		\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}

		\pgfsetlinewidth{\cobordismlinewidth}
		\bottomofellipse
		\pgfusepath{stroke}

		\pgfsetdash{ {\dashlength}{\dashlength}{\dashlength}{\dashlength} }{0pt}
		\topofellipse
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Bottom End 3D}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\storedwidth
	{
		\pgf@x = \cobwidth
	}
	\anchor{center}{\centerpoint}

%	\anchor{east}{\expandafter \pgfpointcurveattime \expandafter \east \bottomofellipseanchor}
	\anchor{ese}{\expandafter \pgfpointcurveattime \expandafter \ese \bottomofellipseanchor}
	\anchor{se}{\expandafter \pgfpointcurveattime \expandafter \se \bottomofellipseanchor}
	\anchor{sse}{\expandafter \pgfpointcurveattime \expandafter \sse \bottomofellipseanchor}
	\anchor{south}{\expandafter \pgfpointcurveattime \expandafter \south \bottomofellipseanchor}
	\anchor{ssw}{\expandafter \pgfpointcurveattime \expandafter \ssw\bottomofellipseanchor}
	\anchor{sw}{\expandafter \pgfpointcurveattime \expandafter \sw \bottomofellipseanchor}
	\anchor{wsw}{\expandafter \pgfpointcurveattime \expandafter \wsw \bottomofellipseanchor}
%	\anchor{west}{\expandafter \pgfpointcurveattime \expandafter \west \bottomofellipseanchor}

%	\anchor{east}{\expandafter \pgfpointcurveattime \expandafter \east \topofellipseanchor}
	\anchor{ene}{\expandafter \pgfpointcurveattime \expandafter \ene \topofellipseanchor}
	\anchor{ne}{\expandafter \pgfpointcurveattime \expandafter \northeast \topofellipseanchor}
	\anchor{nne}{\expandafter \pgfpointcurveattime \expandafter \nne \topofellipseanchor}
	\anchor{north}{\expandafter \pgfpointcurveattime \expandafter \north \topofellipseanchor}
	\anchor{nnw}{\expandafter \pgfpointcurveattime \expandafter \nnw\topofellipseanchor}
	\anchor{nw}{\expandafter \pgfpointcurveattime \expandafter \nw \topofellipseanchor}
	\anchor{wnw}{\expandafter \pgfpointcurveattime \expandafter \wnw \topofellipseanchor}
%	\anchor{west}{\expandafter \pgfpointcurveattime \expandafter \west \topofellipseanchor}

	\anchor{east}	{\expandafter \pgfpointlineattime \expandafter \east 	\newellipselineanchor}
	\anchor{west}	{\expandafter \pgfpointlineattime \expandafter \west 	\newellipselineanchor}
	\anchor{in-llc}{\expandafter \pgfpointlineattime \expandafter \ese \newellipselineanchor}
	\anchor{in-lc}{\expandafter \pgfpointlineattime \expandafter \se \newellipselineanchor}
	\anchor{in-clc}{\expandafter \pgfpointlineattime \expandafter \sse \newellipselineanchor}
	\anchor{in-center}{\expandafter \pgfpointlineattime \expandafter \south \newellipselineanchor}
	\anchor{in-crc}{\expandafter \pgfpointlineattime \expandafter \ssw\newellipselineanchor}
	\anchor{in-rc}{\expandafter \pgfpointlineattime \expandafter \sw \newellipselineanchor}
	\anchor{in-rrc}{\expandafter \pgfpointlineattime \expandafter \wsw \newellipselineanchor}
	\anchor{in-leftthird}{\expandafter \pgfpointlineattime \expandafter \leftthird \newellipselineanchor}
	\anchor{in-rightthird}{\expandafter \pgfpointlineattime \expandafter \rightthird \newellipselineanchor}
	\anchor{in-leftquarter}{\expandafter \pgfpointlineattime \expandafter \leftquarter \newellipselineanchor}
	\anchor{in-rightquarter}{\expandafter \pgfpointlineattime \expandafter \rightquarter \newellipselineanchor}


	\anchorborder{\centerpoint}
	\backgroundpath
	{

		% Draw dotted part on background layer
		\ifinvisible
			\begin{pgfonlayer}{bottom}
		\else
			\begin{pgfonlayer}{background}
		\fi

		\begin{pgfscope}
			\pgfsetdash{ {\dashlength}{\dashlength}{\dashlength}{\dashlength} }{0pt}
		\ifinvisible
			\pgfsetstrokecolor{white}
		\else
			\ifbotinvisible
				\pgfsetstrokecolor{white}
			\else
				\pgfsetstrokecolor{black}
			\fi
		\fi
			\topofellipse
			\pgfusepath{stroke}
			\end{pgfscope}
		\end{pgfonlayer}

		\ifblue
			\pgfsetfillcolor{\outermorphismcolor}
			\bottomofellipse
			\pgfusepath{fill}
		\fi

		% Draw front part on foreground layer
		\ifinvisible
			\begin{pgfonlayer}{bottom}
		\else
			\begin{pgfonlayer}{foreground}
		\fi
			\begin{pgfscope}

				% Clip to make sure obscuring curve is within bordism boundaries
				\pgfpathmoveto{\pgfpoint{-0.5\ellipsewidth}{0}}
				\pgfpathlineto{\pgfpoint{-0.5\ellipsewidth}{-1.5*\obscurewidth}}
				\pgfpathlineto{\pgfpoint{0.5\ellipsewidth}{-1.5*\obscurewidth}}
				\pgfpathlineto{\pgfpoint{0.5\ellipsewidth}{0}}
				\pgfusepath{clip}

				\ifwhiteskirt
					\pgfsetlinewidth{\obscurewidth}
					\pgfpathmoveto{\pgfpoint{0cm}{-0.5\ellipseheight}}
					\pgfsetstrokecolor{white}
					\pgfpatharc{270}{200}{0.5\cobwidth and 0.5\ellipseheight}
					\pgfpathmoveto{\pgfpoint{0cm}{-0.5\ellipseheight}}
					\pgfpatharc{270}{340}{0.5\cobwidth and 0.5\ellipseheight}
					\pgfusepath{stroke}
				\fi

				\ifwhiteskirt
					\bottomofellipse
					\pgfusepath{clip}
				\fi

				\pgfsetlinewidth{\obscurewidth}
				\pgfpathmoveto{\pgfpoint{0cm}{-0.5\ellipseheight}}
				\ifblue
					\pgfsetstrokecolor{\outermorphismcolor}
				\else
					\pgfsetstrokecolor{white}
				\fi
				\pgfpatharc{270}{200}{0.5\cobwidth and 0.5\ellipseheight}
				\pgfpathmoveto{\pgfpoint{0cm}{-0.5\ellipseheight}}
				\pgfpatharc{270}{340}{0.5\cobwidth and 0.5\ellipseheight}
				\pgfusepath{stroke}
			\end{pgfscope}
		\ifinvisible
			\pgfsetstrokecolor{white}
		\else
			\ifbotinvisible
				\pgfsetstrokecolor{white}
			\else
				\pgfsetstrokecolor{black}
			\fi
		\fi
			\bottomofellipse
			\pgfusepath{stroke}
		\end{pgfonlayer}

	}
}

\pgfdeclareshape{Cobordism Cap}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchor{east}
	{
		\pgf@x=0.5\cobwidth
		\pgf@y=0pt
	}
	\anchor{west}
	{
		\pgf@x=-0.5\cobwidth
		\pgf@y=0pt
	}
	\anchor{north}
	{
		\pgf@x=0pt
		\pgf@y=0.5\cobheight
	}
	\anchor{south}
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
    \anchor{midpoint}
	{
		\pgf@x=0pt
        \pgf@y=0pt
		\advance\pgf@y by .4\cupheight%
	}

\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \cappathanchor}
\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \cappathanchor}
\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \cappathanchor}
\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \cappathanchor}
\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \cappathanchor}
\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\cappathanchor}
\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \cappathanchor}
\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \cappathanchor}
\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \cappathanchor}

	\anchorborder{\centerpoint}
	\backgroundpath
	{
		\ifinvisible
			\begin{pgfscope}
				\pgfsetstrokecolor{white}
				\pgfsetlinewidth{\cobordismlinewidth}
				\cappath
				\pgfusepath{stroke}
        		\centerpoint
					{\pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-center}{}}
			\end{pgfscope}
		\else
			\ifblue
				\begin{pgfonlayer}{background}
					\cappath
					\pgfsetfillcolor{\outermorphismcolor}
					\pgfusepath{fill}
				\end{pgfonlayer}
			\fi

			\begin{pgfonlayer}{cobordism}
				\pgfsetlinewidth{\cobordismlinewidth}
				\cappath
				\pgfusepath{stroke}
			\end{pgfonlayer}

			\ifbot
        		\centerpoint
					{\pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-center}{}}
			\fi
		\fi
	}
}

\pgfdeclareshape{Cobordism Blue SuperCap}
{
	\savedanchor\centerpoint
	{
    	\pgf@x=0pt
  		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
		{\pgfpoint{-0.5\cobwidth}{0cm}}
		% bottom half of bottom ellipse.
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0cm}}
		% cap part
		\pgfpathcurveto
		{\pgfpoint{0.5\cobwidth}{1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{0cm}}

		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill, stroke}

		% Now draw dotted half of ellipse
		\pgfpathmoveto
		{\pgfpoint{-0.5\cobwidth}{0cm}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0cm}}
		\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Cup} {
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\shapeheight
	{
		\pgf@x = \cupheight
		\iftall
			\pgf@x = 1.5\cupheight
		\fi
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
		\pgf@x=\heightscale\pgf@x
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchor{east}
	{
		\pgf@x=0.5\cobwidth
		\pgf@y=0pt
	}
	\anchor{north}
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{south}
	{
		\pgf@x=0pt
		\pgf@y=-\shapeheight
	}
	\anchor{end}
	{
		\pgf@x=0.5\cobwidth
		\pgf@y=-\shapeheight%
	}
	\anchor{west}
	{
		\pgf@x=-0.5\cobwidth
		\pgf@y=0pt
	}
    % added by Bruce, geometric middle sometimes needed for string diagrams
    \anchor{midpoint}
	{
		\pgf@x=0pt
        \pgf@y=0pt
		\advance\pgf@y by -.6\cupheight%
	}
	\savedanchor{\upperrightcorner}
	{
		\pgf@y=.\ht\pgfnodeparttextbox % height of the box
		\pgf@x=.\wd\pgfnodeparttextbox % width of the box
		\setlength{\pgf@xa}{\pgfshapeminwidth}
		\ifdim\pgf@x<.5\pgf@xa
			\pgf@x=.5\pgf@xa
		\fi
	}
	\anchor{text} % Makes sure that text is centered on the shape's origin
	{
		\upperrightcorner
		\pgf@x=-\pgf@x
		\pgf@y=-\pgf@y
	}
	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \cuppathanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \cuppathanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \cuppathanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \cuppathanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \cuppathanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\cuppathanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \cuppathanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \cuppathanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \cuppathanchor}

	\anchorborder{\centerpoint}
	\backgroundpath
	{
		\ifinvisible
			\begin{pgfscope}
				\pgfsetstrokecolor{white}
				\pgfsetlinewidth{\cobordismlinewidth}
				%\cuppath
				\pgfpathmoveto
					{\pgfpoint{0.5\cobwidth}{0cm}}
				\pgfpathcurveto
					{\pgfpoint{0.5\cobwidth}{-1.33*\shapeheight}}
					{\pgfpoint{-0.5\cobwidth}{-1.33*\shapeheight}}
					{\pgfpoint{-0.5\cobwidth}{0cm}}

				\pgfusepath{stroke}
				\iftop
					\centerpoint
					{
            			\pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-center}{}
            		}
				\fi
			\end{pgfscope}
		\else

			\ifblue
				\pgfpathmoveto
					{\pgfpoint{0.5\cobwidth}{0cm}}
				\pgfpathcurveto
					{\pgfpoint{0.5\cobwidth}{-1.33*\shapeheight}}
					{\pgfpoint{-0.5\cobwidth}{-1.33*\shapeheight}}
					{\pgfpoint{-0.5\cobwidth}{0cm}}
				\pgfsetfillcolor{\outermorphismcolor}
				\pgfusepath{fill}
			\fi

			\iftop
				\centerpoint
				{
            		\pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-center}{}
            	}
			\fi

			\begin{pgfonlayer}{cobordism}
				\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
				\pgfsetlinewidth{\cobordismlinewidth}
				\pgfpathmoveto
					{\pgfpoint{0.5\cobwidth}{0cm}}
				\pgfpathcurveto
					{\pgfpoint{0.5\cobwidth}{-1.33*\shapeheight}}
					{\pgfpoint{-0.5\cobwidth}{-1.33*\shapeheight}}
					{\pgfpoint{-0.5\cobwidth}{0cm}}
				\pgfusepath{stroke}
			\end{pgfonlayer}
		\fi
 	}
}


\pgfdeclareshape{Cobordism Blue SuperCup}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% First fill it, no stroke
		\pgfpathmoveto
		{\pgfpoint{0.5\cobwidth}{0cm}}
		% cup part
		\pgfpathcurveto
		{\pgfpoint{0.5\cobwidth}{-1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{-1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{0cm}}
		% bottom half of upper ellipse.
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0cm}}

		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting bottom half of ellipse
		% First fill it, no stroke
		\pgfpathmoveto
		{\pgfpoint{0.5\cobwidth}{0cm}}
		% cup part
		\pgfpathcurveto
		{\pgfpoint{0.5\cobwidth}{-1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{-1.33\cupheight}}
		{\pgfpoint{-0.5\cobwidth}{0cm}}

		\pgfusepath{stroke}

		% Add solid top end, if the user has requested it.
        \iftop%
			% First draw fill, no stroke
			\pgfpathmoveto{\pgfpoint{-0.5\cobwidth}{0cm}}
			% bottom half of upper ellipse.
			\pgfpathcurveto
				{\pgfpoint{-0.5\cobwidth}{-0.666*\ellipseheight}}
				{\pgfpoint{0.5\cobwidth}{-0.666\ellipseheight}}
				{\pgfpoint{0.5\cobwidth}{0cm}}
			% top half of upper ellipse.
			\pgfpathcurveto
				{\pgfpoint{0.5\cobwidth}{0.666*\ellipseheight}}
				{\pgfpoint{-0.5\cobwidth}{0.666\ellipseheight}}
				{\pgfpoint{-0.5\cobwidth}{0cm}}

			\pgfsetfillcolor{\innermorphismcolor}
			\pgfusepath{fill, stroke}
        \fi%
	}
}

% Vertical positions for the helper points for drawing the
% 'shoulders' of the pants and copants cobordisms.
\newlength{\shoulderone}
\newlength{\shouldertwo}
\setlength{\shoulderone}{-0.05\cobheight}
\setlength{\shouldertwo}{0.05\cobheight}

\pgfdeclareshape{Cobordism Pants}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
		\ifwide
			\pgf@x = 0.5\cobgap
			\advance\pgf@x by 0.5\cobwidth
		\fi
		\ifwider
			\pgf@x = 0.75\cobgap
			\advance\pgf@x by 0.75\cobwidth
		\fi
		\ifverywide
			\pgf@x = \cobgap
			\advance\pgf@x by \cobwidth
		\fi
		\ifveryverywide
			\pgf@x = 1.25\cobgap
			\advance\pgf@x by 1.25\cobwidth
		\fi
		\ifveryveryverywide
			\pgf@x = 1.5\cobgap
			\advance\pgf@x by 1.5\cobwidth
		\fi
		\ifveryveryveryverywide
			\pgf@x = 2\cobgap
			\advance\pgf@x by 2\cobwidth
		\fi
	}
	\saveddimen\localheight
	{
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
       	\setlength{\pgf@x}{\heightscale\cobheight}
	}
	\saveddimen\leftlegwidth
	{
		\pgfkeysgetvalue{/tikz/left leg scale}{\leftlegscale}
       	\setlength{\pgf@x}{\leftlegscale\cobwidth}
	}
	\saveddimen\rightlegwidth
	{
		\pgfkeysgetvalue{/tikz/right leg scale}{\rightlegscale}
       	\setlength{\pgf@x}{\rightlegscale\cobwidth}
	}
	\saveddimen\beltwidth
	{
		\pgfkeysgetvalue{/tikz/belt scale}{\beltscale}
       	\setlength{\pgf@x}{\beltscale\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{belt}
	{
		\pgf@x=0pt
		\pgf@y=0.5\dimexpr\localheight\relax
	}
	\anchor{belt east}
	{
		\pgf@x=0.5\cobwidth
		\pgf@y=0.5\dimexpr\localheight\relax
	}
	\anchor{belt west}
	{
 		\pgf@x=-0.5\cobwidth
		\pgf@y=0.5\dimexpr\localheight\relax
	}
	\anchor{belt north}
	{
		\pgf@y=0.6\dimexpr\localheight\relax
	}
	\anchor{belt south}
	{
		\pgf@y=0.4\dimexpr\localheight\relax
	}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\dimexpr\rightlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = -0.5\dimexpr\localheight\relax
	}
	\anchor{leftleg east}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobgap
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{leftleg west}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -1.0\dimexpr\leftlegwidth\relax
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{leftleg south}
	{
		\pgf@x=-1.0\cobwidth
		\pgf@y=-0.6\dimexpr\localheight\relax
	}
	\anchor{leftleg north}
	{
		\pgf@x=-1.0\cobwidth
		\pgf@y=-0.4\dimexpr\localheight\relax
	}

	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = -0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg west}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobgap
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg east}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 1.0\dimexpr\leftlegwidth\relax
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg south}
	{
		\pgf@x=1.0\cobwidth
		\pgf@y=-0.6\dimexpr\localheight\relax
	}
	\anchor{rightleg north}
	{
		\pgf@x=1.0\cobwidth
		\pgf@y=-0.4\dimexpr\localheight\relax
	}

	\anchor{seam right}{\expandafter \pgfpointcurveattime \expandafter \rght \pantsinseamanchor}
	\anchor{seam rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pantsinseamanchor}
	\anchor{seam rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pantsinseamanchor}
	\anchor{seam mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pantsinseamanchor}
	\anchor{seam middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pantsinseamanchor}
	\anchor{seam mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pantsinseamanchor}
	\anchor{seam lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pantsinseamanchor}
	\anchor{seam llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pantsinseamanchor}
	\anchor{seam left}{\expandafter \pgfpointcurveattime \expandafter \lft \pantsinseamanchor}

	\anchor{right belt}{\expandafter \pgfpointcurveattime \expandafter \belt \pantsrightanchor}
	\anchor{right bbm}{\expandafter \pgfpointcurveattime \expandafter \bbm \pantsrightanchor}
	\anchor{right bm}{\expandafter \pgfpointcurveattime \expandafter \bm \pantsrightanchor}
	\anchor{right mbm}{\expandafter \pgfpointcurveattime \expandafter \mbm \pantsrightanchor}
	\anchor{right middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pantsrightanchor}
	\anchor{right mgm}{\expandafter \pgfpointcurveattime \expandafter \mgm\pantsrightanchor}
	\anchor{right gm}{\expandafter \pgfpointcurveattime \expandafter \gm \pantsrightanchor}
	\anchor{right ggm}{\expandafter \pgfpointcurveattime \expandafter \ggm \pantsrightanchor}
	\anchor{right leg}{\expandafter \pgfpointcurveattime \expandafter \leg \pantsrightanchor}

	\anchor{left belt}{\expandafter \pgfpointcurveattime \expandafter \belt \pantsleftanchor}
	\anchor{left bbm}{\expandafter \pgfpointcurveattime \expandafter \bbm \pantsleftanchor}
	\anchor{left bm}{\expandafter \pgfpointcurveattime \expandafter \bm \pantsleftanchor}
	\anchor{left mbm}{\expandafter \pgfpointcurveattime \expandafter \mbm \pantsleftanchor}
	\anchor{left middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pantsleftanchor}
	\anchor{left mgm}{\expandafter \pgfpointcurveattime \expandafter \mgm\pantsleftanchor}
	\anchor{left gm}{\expandafter \pgfpointcurveattime \expandafter \gm \pantsleftanchor}
	\anchor{left ggm}{\expandafter \pgfpointcurveattime \expandafter \ggm \pantsleftanchor}
	\anchor{left leg}{\expandafter \pgfpointcurveattime \expandafter \leg \pantsleftanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Possibly draw blue background
		\ifblue
			\begin{pgfonlayer}{background}
			\pantsleftlinestart
			\pantsleftcurve
			\pantsinseamlinestart
			\pantsinseamcurve
			\pantsrightlinestart
			\pantsrightcurve
			\pgfsetfillcolor{\outermorphismcolor}
			\pgfusepath{fill}
			\end{pgfonlayer}
		\fi

		\begin{pgfonlayer}{cobordism}

		% Right-hand-side curve
		\pantsright
		\ifinvisible
			% Do nothing
		\else
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pgfusepath{stroke}
		\fi

		% Left-hand-side curve
		\pantsleft
		\ifinvisible
			% Do nothing
		\else
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pgfusepath{stroke}
		\fi

		% Crotch
		\pantsinseam
		\ifinvisible
			% Do nothing
		\else
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pgfusepath{stroke}
		\fi

		\end{pgfonlayer}

        % Possibly draw top boundary circles
        \iftop
        	\begin{pgfscope}
        	\setlength{\cobwidth}{\beltwidth}
	        \centerpoint
        	{
            	\pgftransformyshift{0.5*\localheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-belt}{}
        	}
        	\end{pgfscope}
        \fi

		% Possibly draw bottom boundary circles
		\ifbot
			\begin{pgfscope}
            \centerpoint
            {
                \pgftransformyshift{-0.5*\localheight}
				\pgftransformxshift{-0.5*\rightlegwidth}
				\pgftransformxshift{-0.5\cobgap}
				\pgftransformxshift{-0.5*\extrawidth}
				\setlength{\cobwidth}{\leftlegwidth}
                \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-leftleg}{}
            }
            \centerpoint
            {
                \pgftransformyshift{-0.5*\localheight}
				\pgftransformxshift{0.5*\leftlegwidth}
				\pgftransformxshift{0.5\cobgap}
				\pgftransformxshift{0.5*\extrawidth}
				\setlength{\cobwidth}{\rightlegwidth}
                \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-rightleg}{}
            }
            \end{pgfscope}
        \fi

        % Possibly draw selection box
        \ifselect
        	\begin{pgfonlayer}{selectionbox}
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/select color}}
        	\pgfpathmoveto{\pgfpoint{-0.5*\leftlegwidth-0.5*\rightlegwidth-0.5*\cobgap-0.5*\extrawidth-\selectwidth}{-0.5*\localheight-0.5*\ellipseheight-\selectwidth}}
        	\pgfpathlineto{\pgfpoint{-0.5*\leftlegwidth-0.5*\rightlegwidth-0.5*\cobgap-0.5*\extrawidth-\selectwidth}{0.5*\localheight+0.5*\ellipseheight+\selectwidth}}
        	\pgfpathlineto{\pgfpoint{0.5*\leftlegwidth+0.5*\rightlegwidth+0.5*\cobgap+0.5*\extrawidth+\selectwidth}{0.5*\localheight+0.5*\ellipseheight+\selectwidth}}
        	\pgfpathlineto{\pgfpoint{0.5*\leftlegwidth+0.5*\rightlegwidth+0.5*\cobgap+0.5*\extrawidth+\selectwidth}{-0.5*\localheight-0.5*\ellipseheight-\selectwidth}}
        	\pgfpathlineto{\pgfpoint{-0.5*\leftlegwidth-0.5*\rightlegwidth-0.5*\cobgap-0.5*\extrawidth-\selectwidth}{-0.5*\localheight-0.5*\ellipseheight-\selectwidth}}
        	\pgfusepath{stroke}
        	\end{pgfonlayer}
        \fi
	}
}

\pgfdeclareshape{Cobordism Blue Super Pants}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{belt}
	{
		\pgf@x=0pt
		\pgf@y=0.5\cobheight
	}
	\anchor{leftleg}
	{
		\pgf@x=-0.5\cobgap
		\advance\pgf@x by -0.5\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x=0.5\cobgap
		\advance\pgf@x by 0.5\cobwidth
		\pgf@y=-0.5\cobheight
	}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% First just draw a filled shape, no stroke.
		% Right-hand-side curve
		\pgfpathmoveto
			{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{\shouldertwo}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{\shoulderone}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight}}
		% Right lower ellipse
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
		% inseam
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight+0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight+0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		% Left lower ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight}}
		% Left-hand-side curve
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{\shoulderone}}
			{\pgfpoint{-0.5\cobwidth}{\shouldertwo}}
			{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
		% Bottom part of Top ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}

		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now draw a stroke, omitting the bottom part of top ellipse.
		% Right-hand-side curve
		\pgfpathmoveto
			{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{\shouldertwo}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{\shoulderone}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight}}
		% Right lower ellipse
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
		% inseam
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight+0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight+0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		% Left lower ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight}}
		% Left-hand-side curve
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{\shoulderone}}
			{\pgfpoint{-0.5\cobwidth}{\shouldertwo}}
			{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
		\pgfusepath{stroke}


        % Draw solid top end, if user requested, else dotted.
        \iftop
			% Draw filled top section
			\pgfpathmoveto
				{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			\pgfpathcurveto
				{\pgfpoint{-0.5\cobwidth}{0.5\cobheight + 0.666\ellipseheight}}
				{\pgfpoint{0.5\cobwidth}{0.5\cobheight + 0.666\ellipseheight}}
				{\pgfpoint{0.5\cobwidth}{0.5\cobheight}}
			\pgfpathcurveto
				{\pgfpoint{0.5\cobwidth}{0.5\cobheight - 0.666\ellipseheight}}
				{\pgfpoint{-0.5\cobwidth}{0.5\cobheight - 0.666\ellipseheight}}
				{\pgfpoint{-0.5\cobwidth}{0.5\cobheight}}
			\pgfsetfillcolor{\innermorphismcolor}
			\pgfusepath{fill, stroke}
        \fi

		% Bottom right dotted ellipse
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{-0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
		\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}

		% Bottom left dotted ellipse
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Blue Super Copants}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{belt}
	{
		\pgf@x=0pt
		\pgf@y=-0.5\cobheight
	}
	\anchor{leftleg}
	{
		\pgf@x=-0.5\cobgap
		\advance\pgf@x by -0.5\cobwidth
		\pgf@y=0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x=0.5\cobgap
		\advance\pgf@x by 0.5\cobwidth
		\pgf@y=0.5\cobheight
	}
	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% First draw filled in section, no stroke.
		% Right-hand-side curve
		\pgfpathmoveto
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{\shoulderone}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{\shouldertwo}}
			{\pgfpoint{0.5\cobgap + \cobwidth}{0.5\cobheight}}
		% Bottom half of right upper ellipse
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		% inseam
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{0.5\cobheight-0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight-0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
		% Bottom half of left upper ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{0.5\cobheight}}
		% Left-hand-side curve
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{\shouldertwo}}
			{\pgfpoint{-0.5\cobwidth}{\shoulderone}}
			{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		% Bottom part of bottom ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}

		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now draw the stroked outline, omitting upper elllipses.
		% Right-hand-side curve
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{\shouldertwo}}
			{\pgfpoint{0.5\cobwidth}{\shoulderone}}
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		% Bottom part of bottom ellipse
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		% Left-hand-side curve
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{\shoulderone}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{\shouldertwo}}
			{\pgfpoint{-0.5\cobgap - \cobwidth}{0.5\cobheight}}
		\pgfusepath{stroke}

		% inseam
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{0.5\cobheight-0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight-0.333\cobheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
		\pgfusepath{stroke}

        % Draw solid top ends, if user requested, else nothing.
        \iftop%
        {%
		% Draw filled top sections.
		\pgfpathmoveto
			{\pgfpoint{-\cobwidth-0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-\cobwidth-0.5\cobgap}{0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-\cobwidth-0.5\cobgap}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{-\cobwidth - 0.5\cobgap}{0.5\cobheight}}
		\pgfsetfillcolor{\innermorphismcolor}
		\pgfusepath{fill, stroke}

		\pgfpathmoveto
			{\pgfpoint{\cobwidth+0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{\cobwidth+0.5\cobgap}{0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{\cobwidth+0.5\cobgap}{0.5\cobheight - 0.666\ellipseheight}}
			{\pgfpoint{\cobwidth + 0.5\cobgap}{0.5\cobheight}}
		\pgfsetfillcolor{\innermorphismcolor}
		\pgfusepath{fill, stroke}
        }%
        \else%
        {%
        }
        \fi%

		% Bottom dotted ellipse
		\pgfpathmoveto
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{-0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight + 0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{-0.5\cobheight}}
		\pgfsetdash{{2pt}{2pt}{2pt}{2pt}}{0pt}
		\pgfusepath{stroke}
	}
}


\pgfdeclareshape{Cobordism Copants}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
		\ifwide
			\pgf@x = 0.5\cobgap
			\advance\pgf@x by 0.5\cobwidth
		\fi
		\ifverywide
			\pgf@x = \cobgap
			\advance\pgf@x by \cobwidth
		\fi
		\ifveryverywide
			\pgf@x = 1.25\cobgap
			\advance\pgf@x by 1.25\cobwidth
		\fi
	}
	\saveddimen\leftlegwidth
	{
		\pgfkeysgetvalue{/tikz/left leg scale}{\leftlegscale}
	       	\setlength{\pgf@x}{\leftlegscale\cobwidth}
	}
	\saveddimen\rightlegwidth
	{
		\pgfkeysgetvalue{/tikz/right leg scale}{\rightlegscale}
	       	\setlength{\pgf@x}{\rightlegscale\cobwidth}
	}
	\saveddimen\beltwidth
	{
		\pgfkeysgetvalue{/tikz/belt scale}{\beltscale}
	       	\setlength{\pgf@x}{\beltscale\cobwidth}
	}
	\saveddimen\localheight
	{
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
	       	\setlength{\pgf@x}{\heightscale\cobheight}
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{belt}
	{
		\pgf@x=0pt
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{belt east}
	{
		\pgf@x=0.5\dimexpr\beltwidth\relax
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{belt west}
	{
 		\pgf@x=-0.5\dimexpr\beltwidth\relax
		\pgf@y=-0.5\dimexpr\localheight\relax
	}
	\anchor{belt south}
	{
		\pgf@y=-0.6\dimexpr\localheight\relax
	}
	\anchor{belt north}
	{
		\pgf@y=-0.4\dimexpr\localheight\relax
	}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\dimexpr\rightlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0.5\dimexpr\localheight\relax
	}
	\anchor{leftleg east}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\dimexpr\rightlegwidth\relax
%		\pgf@x = -0.5\cobgap - 0.5*\extrawidth - 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y = 0.5\dimexpr\localheight\relax
	}
	\anchor{leftleg north}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
%		\pgf@x = -0.5\cobgap - 0.5*\extrawidth - 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y = 0.6\dimexpr\localheight\relax
	}
	\anchor{leftleg south}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
%		\pgf@x = -0.5\cobgap - 0.5*\extrawidth - 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y = 0.4\dimexpr\localheight\relax
	}
	\anchor{leftleg west}
	{
		\pgf@x=0pt
		\advance\pgf@x by -0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\dimexpr\rightlegwidth\relax
		\pgf@y= 0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg west}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\dimexpr\rightlegwidth\relax
%		\pgf@x = 0.5\cobgap + 0.5*\extrawidth - 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y=0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg east}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\dimexpr\rightlegwidth\relax
%		\pgf@x = +0.5\cobgap + 0.5*\extrawidth + 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y = 0.5\dimexpr\localheight\relax
	}
	\anchor{rightleg north}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
%		\pgf@x = +0.5\cobgap + 0.5*\extrawidth + 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y = 0.6\dimexpr\localheight\relax
	}
	\anchor{rightleg south}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
%		\pgf@x = +0.5\cobgap + 0.5*\extrawidth + 0.5*\rightlegwidth + 0.5*\leftlegwidth
		\pgf@y = 0.4\dimexpr\localheight\relax
	}
	\anchor{south east}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\dimexpr\rightlegwidth\relax
		\pgf@y = -0.5\dimexpr\localheight\relax
	}
	\anchor{north east}
	{
		\pgf@x=0pt
		\advance\pgf@x by 0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\dimexpr\rightlegwidth\relax
		\pgf@y = 0.5\dimexpr\localheight\relax
	}
	\anchor{south west}
	{
		\pgf@x=0pt
		\advance\pgf@x by -0.5\dimexpr\leftlegwidth\relax
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\dimexpr\rightlegwidth\relax
		\pgf@y = -0.5\dimexpr\localheight\relax
	}

	\anchor{seam right}{\expandafter \pgfpointcurveattime \expandafter \rght \copantsinseamanchor}
	\anchor{seam rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \copantsinseamanchor}
	\anchor{seam rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \copantsinseamanchor}
	\anchor{seam mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \copantsinseamanchor}
	\anchor{seam middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \copantsinseamanchor}
	\anchor{seam mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\copantsinseamanchor}
	\anchor{seam lm}{\expandafter \pgfpointcurveattime \expandafter \lm \copantsinseamanchor}
	\anchor{seam llm}{\expandafter \pgfpointcurveattime \expandafter \llm \copantsinseamanchor}
	\anchor{seam left}{\expandafter \pgfpointcurveattime \expandafter \lft \copantsinseamanchor}

	\anchor{right belt}{\expandafter \pgfpointcurveattime \expandafter \belt \copantsrightanchor}
	\anchor{right bbm}{\expandafter \pgfpointcurveattime \expandafter \bbm \copantsrightanchor}
	\anchor{right bm}{\expandafter \pgfpointcurveattime \expandafter \bm \copantsrightanchor}
	\anchor{right mbm}{\expandafter \pgfpointcurveattime \expandafter \mbm \copantsrightanchor}
	\anchor{right middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \copantsrightanchor}
	\anchor{right mgm}{\expandafter \pgfpointcurveattime \expandafter \mgm\copantsrightanchor}
	\anchor{right gm}{\expandafter \pgfpointcurveattime \expandafter \gm \copantsrightanchor}
	\anchor{right ggm}{\expandafter \pgfpointcurveattime \expandafter \ggm \copantsrightanchor}
	\anchor{right leg}{\expandafter \pgfpointcurveattime \expandafter \leg \copantsrightanchor}

	\anchor{left belt}{\expandafter \pgfpointcurveattime \expandafter \belt \copantsleftanchor}
	\anchor{left bbm}{\expandafter \pgfpointcurveattime \expandafter \bbm \copantsleftanchor}
	\anchor{left bm}{\expandafter \pgfpointcurveattime \expandafter \bm \copantsleftanchor}
	\anchor{left mbm}{\expandafter \pgfpointcurveattime \expandafter \mbm \copantsleftanchor}
	\anchor{left middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \copantsleftanchor}
	\anchor{left mgm}{\expandafter \pgfpointcurveattime \expandafter \mgm\copantsleftanchor}
	\anchor{left gm}{\expandafter \pgfpointcurveattime \expandafter \gm \copantsleftanchor}
	\anchor{left ggm}{\expandafter \pgfpointcurveattime \expandafter \ggm \copantsleftanchor}
	\anchor{left leg}{\expandafter \pgfpointcurveattime \expandafter \leg \copantsleftanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Possibly draw blue background
		\ifblue
			\begin{pgfonlayer}{background}
			\copantsrightlinestart
			\copantsrightcurve
			\copantsinseamlinestart
			\copantsinseamcurve
			\copantsleftlinestart
			\copantsleftcurve
			\pgfsetfillcolor{\outermorphismcolor}
			\pgfusepath{fill}
			\end{pgfonlayer}
		\fi

		\begin{pgfonlayer}{top}
		\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}

		\ifinvisible
		\else
			% Right-hand-side curve
			\copantsright
			\pgfusepath{stroke}
			% Left-hand-side curve
			\copantsleft
			\pgfusepath{stroke}
			% Crotch
			\copantsinseam
			\pgfusepath{stroke}
		\fi

		\end{pgfonlayer}

        % Possibly draw bottom boundary circles
        \ifbot
        	\begin{pgfscope}
        	\setlength{\cobwidth}{\beltwidth}
	        \centerpoint
        	{
            	\pgftransformyshift{-0.5*\localheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-belt}{}
        	}
        	\end{pgfscope}
        \fi

		% Possibly draw top boundary circles
		\iftop
			\begin{pgfscope}
            \centerpoint
            {
                \pgftransformyshift{0.5*\localheight}
				\pgftransformxshift{-0.5*\rightlegwidth}
				\pgftransformxshift{-0.5\cobgap}
				\pgftransformxshift{-0.5*\extrawidth}
				\setlength{\cobwidth}{\leftlegwidth}
                \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-leftleg}{}
            }
            \centerpoint
            {
                \pgftransformyshift{0.5*\localheight}
				\pgftransformxshift{0.5*\leftlegwidth}
				\pgftransformxshift{0.5\cobgap}
				\pgftransformxshift{0.5*\extrawidth}
				\setlength{\cobwidth}{\rightlegwidth}
                \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-rightleg}{}
            }
            \end{pgfscope}
        \fi

        % Possibly draw selection box
        \ifselect
        	\begin{pgfonlayer}{selectionbox}
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/select color}}
        	\pgfpathmoveto{\pgfpoint{-0.5*\leftlegwidth-0.5*\rightlegwidth-0.5*\cobgap-0.5*\extrawidth-\selectwidth}{-0.5*\localheight-0.5*\ellipseheight-\selectwidth}}
        	\pgfpathlineto{\pgfpoint{-0.5*\leftlegwidth-0.5*\rightlegwidth-0.5*\cobgap-0.5*\extrawidth-\selectwidth}{0.5*\localheight+0.5*\ellipseheight+\selectwidth}}
        	\pgfpathlineto{\pgfpoint{0.5*\leftlegwidth+0.5*\rightlegwidth+0.5*\cobgap+0.5*\extrawidth+\selectwidth}{0.5*\localheight+0.5*\ellipseheight+\selectwidth}}
        	\pgfpathlineto{\pgfpoint{0.5*\leftlegwidth+0.5*\rightlegwidth+0.5*\cobgap+0.5*\extrawidth+\selectwidth}{-0.5*\localheight-0.5*\ellipseheight-\selectwidth}}
        	\pgfpathlineto{\pgfpoint{-0.5*\leftlegwidth-0.5*\rightlegwidth-0.5*\cobgap-0.5*\extrawidth-\selectwidth}{-0.5*\localheight-0.5*\ellipseheight-\selectwidth}}
        	\pgfusepath{stroke}
        	\end{pgfonlayer}
        \fi
	}
}

% Cylinder node. Useful to have explicitly.
\pgfdeclareshape{Cobordism Cylinder}
{
   	\savedanchor\centerpoint
   	{
		\pgf@x=0pt
		\pgf@y=0pt
   	}
   	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
   	\anchorborder{\centerpoint}
	\saveddimen\shapeheight
	{
		\pgf@x = 0.5\cobheight
		\ifslightlytall
			\pgf@x = 0.75\cobheight
		\fi
		\iftall
			\pgf@x = \cobheight
		\fi
		\ifverytall
			\pgf@x = 1.5\cobheight
		\fi
		\ifveryverytall
			\pgf@x = 2\cobheight
		\fi
		\ifveryveryverytall
			\pgf@x = 2.5\cobheight
		\fi
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
		\pgf@x=\heightscale\pgf@x
	}
	\saveddimen\topwidth
	{
		\pgfkeysgetvalue{/tikz/top scale}{\topscale}
       	\setlength{\pgf@x}{\topscale\cobwidth}
	}
	\saveddimen\botwidth
	{
		\pgfkeysgetvalue{/tikz/bottom scale}{\botscale}
       	\setlength{\pgf@x}{\botscale\cobwidth}
	}
   	\anchor{top}
   	{
	    	\pgf@x=0pt
       		\pgf@y=\shapeheight
   	}
   	\anchor{north}
   	{
	    	\pgf@x=0pt
       		\pgf@y=\shapeheight
   	}
   	\anchor{bottom}
   	{
	       	\pgf@x=0pt
	       	\pgf@y=-\shapeheight
   	}
   	\anchor{south}
   	{
	       	\pgf@x=0pt
	       	\pgf@y=-\shapeheight
   	}
   	\anchor{west}
   	{
   		\pgf@x=-0.5\cobwidth
   		\pgf@y=0pt
   	}
   	\anchor{east}
   	{
   		\pgf@x=0.5\cobwidth
   		\pgf@y=0pt
   	}
   	\anchor{bot}
   	{
	       	\pgf@x=0pt
	       	\pgf@y=-\shapeheight
   	}
	\backgroundpath
	{
		% Possibly draw blue background
		\ifblue
			\begin{pgfonlayer}{background}
		        \centerpoint
				\pgfpathmoveto
					{\pgfpoint{0.5*\topwidth}{\shapeheight}}
				\pgfpathcurveto
					{\pgfpoint{0.5*\topwidth}{0pt}}
					{\pgfpoint{0.5*\botwidth}{0pt}}
					{\pgfpoint{0.5*\botwidth}{-\shapeheight}}
				\pgfpathlineto
					{\pgfpoint{-0.5*\topwidth}{-\shapeheight}}
				\pgfpathcurveto
					{\pgfpoint{-0.5*\botwidth}{0pt}}
					{\pgfpoint{-0.5*\topwidth}{0pt}}
					{\pgfpoint{-0.5*\botwidth}{\shapeheight}}
				\pgfsetfillcolor{\outermorphismcolor}
				\pgfusepath{fill}
			\end{pgfonlayer}
		\fi

		\begin{pgfonlayer}{cobordism}
	        %\centerpoint
			\pgfpathmoveto
				{\pgfpoint{0.5*\topwidth}{\shapeheight}}
			\pgfpathcurveto
				{\pgfpoint{0.5*\topwidth}{0pt}}
				{\pgfpoint{0.5*\botwidth}{0pt}}
				{\pgfpoint{0.5*\botwidth}{-\shapeheight}}
			\pgfpathmoveto
				{\pgfpoint{-0.5*\topwidth}{\shapeheight}}
			\pgfpathcurveto
				{\pgfpoint{-0.5*\topwidth}{0pt}}
				{\pgfpoint{-0.5*\botwidth}{0pt}}
				{\pgfpoint{-0.5*\botwidth}{-\shapeheight}}
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pgfusepath{stroke}
		\end{pgfonlayer}

        % Add bottom end 3d node to bottom, using a local coordinate environment.
   		\begin{pgfscope}
	        \ifbot
		        \centerpoint
	        	{
        			\setlength\cobwidth\botwidth
	            	\pgftransformyshift{-\shapeheight}
		            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottom}{}
	        	}
	        \fi
	        \iftop
	           	\centerpoint
	            {
        			\setlength\cobwidth\topwidth
	               	\pgftransformyshift{\shapeheight}
	                \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-top}{}
	           	}
	        \fi
		\end{pgfscope}
	}
}

\pgfdeclareshape{Cobordism Blue Super Cylinder}
{
    \savedanchor\centerpoint
    {
		\pgf@x=0pt
		\pgf@y=0pt
    }
    \anchor{center}{\centerpoint}
    \anchorborder{\centerpoint}
	\saveddimen\localheight
	{
		\pgfkeysgetvalue{/tikz/height scale}{\heightscale}
       	\setlength{\pgf@x}{\heightscale\cobheight}
	}
    \anchor{top}
    {
        \pgf@x=0pt
  		\pgf@y=0.5\dimexpr\localheight\relax
    }
    \anchor{bottom}
    {
        \pgf@x=0pt
  		\pgf@y=-0.5\dimexpr\localheight\relax
    }
    \anchor{bot}
    {
        \pgf@x=0pt
  		\pgf@y=-0.5\dimexpr\localheight\relax
    }
	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% First fill a cylinder, don't stroke
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
        \pgfpathlineto{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight -0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight}}
        \pgfpathlineto{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight -0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting lower half of upper ellipse
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
        \pgfpathlineto{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight -0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight}}
        \pgfpathlineto{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
		\pgfusepath{stroke}

        % Add top end, if the user has requested it.
        \iftop%
        {%
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight -0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobwidth}{0.5*\localheight+0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight+0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobwidth}{0.5*\localheight}}
		\pgfsetfillcolor{\innermorphismcolor}
		\pgfusepath{fill, stroke}
        }%
        \else%
        {%
            % Do nothing
        }
        \fi%

		% Finally, draw dotted upper section of lower ellipse
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobwidth}{-0.5*\localheight+0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight+0.666\ellipseheight}}
			{\pgfpoint{0.5\cobwidth}{-0.5*\localheight}}
		\pgfsetdash{{2pt}{2pt}{2pt}{2pt}}{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Pairing}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
		% \pgf@x = 0pt
		% \ifwide
		% 	\pgf@x = 0.5\cobgap
		% 	\advance\pgf@x by 0.5\cobwidth
		% \fi
		% \ifverywide
		% 	\pgf@x = \cobgap
		% 	\advance\pgf@x by \cobwidth
		% \fi
		% \ifveryverywide
		% 	\pgf@x = 1.25\cobgap
		% 	\advance\pgf@x by 1.25\cobwidth
		% \fi
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = -0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y=-0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-\cobwidth-0.5*\extrawidth}{-0.5\cobheight}}
		\pgfpatharc{180}{0}{0.5\cobgap+\cobwidth+0.5*\extrawidth and 0.5\cobgap+\cobwidth+0.5*\extrawidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth}{-0.5\cobheight}}
		\pgfpatharc{180}{0}{0.5\cobgap+0.5*\extrawidth and 0.5\cobgap+0.5*\extrawidth}

		\pgfusepath{stroke}

		% Possibly draw the circles at the bottom
		\ifbot
	        % Add bottom end 3d node to left leg, using a local coordinate environment.
        	\centerpoint
	        {
            	\pgftransformxshift{-0.5\cobwidth}
	            \pgftransformxshift{-0.5\cobgap}
	            \pgftransformxshift{-0.5*\extrawidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-leftleg}{}
        	}
	        % Add bottom end 3d node to right leg, using a local coordinate environment.
        	\centerpoint
	        {
            	\pgftransformxshift{0.5\cobwidth}
	            \pgftransformxshift{0.5\cobgap}
	            \pgftransformxshift{0.5*\extrawidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-rightleg}{}
        	}
		\fi
	}
}

\pgfdeclareshape{Cobordism Copairing}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
		% \pgf@x = 0pt
		% \ifwide
		% 	\pgf@x = 0.5\cobgap
		% 	\advance\pgf@x by 0.5\cobwidth
		% \fi
		% \ifverywide
		% 	\pgf@x = \cobgap
		% 	\advance\pgf@x by \cobwidth
		% \fi
		% \ifveryverywide
		% 	\pgf@x = 1.25\cobgap
		% 	\advance\pgf@x by 1.25\cobwidth
		% \fi
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \copairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \copairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \copairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \copairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \copairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\copairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \copairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \copairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \copairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \copairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \copairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \copairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \copairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \copairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\copairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \copairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \copairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \copairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\begin{pgfonlayer}{top}
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth+0.5*\extrawidth}{0.5\cobheight}}
		\pgfpatharc{0}{-180}{0.5\cobgap+\cobwidth+0.5*\extrawidth and 0.5\cobgap+\cobwidth+0.5*\extrawidth}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth}{0.5\cobheight}}
		\pgfpatharc{0}{-180}{0.5\cobgap+0.5*\extrawidth and 0.5\cobgap+0.5*\extrawidth}

		\pgfusepath{stroke}
		\end{pgfonlayer}

		% Possibly draw the circles at the bottom
		\iftop
	        % Add bottom end 3d node to left leg, using a local coordinate environment.
        	\centerpoint
	        {
            	\pgftransformxshift{-0.5\cobwidth}
	            \pgftransformxshift{-0.5\cobgap}
	            \pgftransformxshift{-0.5*\extrawidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-leftleg}{}
        	}
	        % Add bottom end 3d node to right leg, using a local coordinate environment.
        	\centerpoint
	        {
            	\pgftransformxshift{0.5\cobwidth}
	            \pgftransformxshift{0.5\cobgap}
	            \pgftransformxshift{0.5*\extrawidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-rightleg}{}
        	}
		\fi
	}
	% \backgroundpath
	% {
	% 	\pgfsetlinewidth{\cobordismlinewidth}
	% 	\copairingin
	% 	\copairingout
	% 	\pgfusepath{stroke}
        %
	% 	\iftop
	% 	\fi
	% }
}

\pgfdeclareshape{Cobordism Blue Super Pairing}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
		%\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x=-0.5\cobgap
		\advance\pgf@x by -0.5\cobwidth
		\pgf@y=0pt
	}
	\anchor{rightleg}
	{
		\pgf@x=0.5\cobgap
		\advance\pgf@x by 0.5\cobwidth
		\pgf@y=0pt
	}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{1.33\cobwidth+.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{1.33\cobwidth+.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{0.66\cobgap}}
			{\pgfpoint{0.5\cobgap}{0.66\cobgap}}
			{\pgfpoint{0.5\cobgap}{0}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill, stroke}

		% Now draw the dotted upper halves of the lower ellipses
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0}}
		\pgfsetdash{{2pt}{2pt}{2pt}{2pt}}{0pt}
		\pgfusepath{stroke}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap + \cobwidth}{0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0}}
		\pgfsetdash{{2pt}{2pt}{2pt}{2pt}}{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Blue Super Copairing}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
		%\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x=-0.5\cobgap
		\advance\pgf@x by -0.5\cobwidth
		\pgf@y=0pt
	}
	\anchor{rightleg}
	{
		\pgf@x=0.5\cobgap
		\advance\pgf@x by 0.5\cobwidth
		\pgf@y=0pt
	}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% First fill it (don't stroke it)
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{-0.66\cobgap}}
			{\pgfpoint{0.5\cobgap}{-0.66\cobgap}}
			{\pgfpoint{0.5\cobgap}{0}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting the lower halves of the upper ellipses
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-1.33\cobwidth-.66\cobgap}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		\pgfusepath{stroke}

		\pgfmoveto
			{\pgfpoint{-0.5\cobgap}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{-0.66\cobgap}}
			{\pgfpoint{0.5\cobgap}{-0.66\cobgap}}
			{\pgfpoint{0.5\cobgap}{0}}
		\pgfusepath{stroke}

	`	% Fill in top ends, if user has requested it.
        \iftop%
        {%
		\pgfmoveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap - \cobwidth}{-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.666\ellipseheight}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
		\pgfsetfillcolor{\innermorphismcolor}
		\pgfusepath{fill,stroke}
        }%
        \else%
        {%
            % Do nothing
        }
        \fi%
	}
}

% The Type-A braid, with the bottom right--top left cobordism obscured
\pgfdeclareshape{Cobordism Braid}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
		\ifwide
			\pgf@x = 0.5\cobgap
			\advance\pgf@x by 0.5\cobwidth
		\fi
		\ifverywide
			\pgf@x = \cobgap
			\advance\pgf@x by \cobwidth
		\fi
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{topleft}
	{
		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\pgf@y=0.5\cobheight
	}
	\anchor{topright}
	{
		\pgf@x=0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\pgf@y=0.5\cobheight
	}
	\anchor{bottomleft}
	{
		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobgap
		\pgf@y=-0.5\cobheight
	}
	\anchor{bottomright}
	{
		\pgf@x=0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\pgf@y=-0.5\cobheight
	}

	\anchor{top-topleft}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfleftaanchor}
	\anchor{top-ttmleft}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfleftaanchor}
	\anchor{top-tmleft}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfleftaanchor}
	\anchor{top-mtmleft}{\expandafter \pgfpointcurveattime \expandafter \mrm \pgfleftaanchor}
	\anchor{top-middleleft}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfleftaanchor}
	\anchor{top-mbmleft}{\expandafter \pgfpointcurveattime \expandafter \mlm\pgfleftaanchor}
	\anchor{top-bmleft}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfleftaanchor}
	\anchor{top-bbmleft}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfleftaanchor}
	\anchor{top-bottomleft}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfleftaanchor}

	\anchor{top-topright}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfleftbanchor}
	\anchor{top-ttmright}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfleftbanchor}
	\anchor{top-tmright}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfleftbanchor}
	\anchor{top-mtmright}{\expandafter \pgfpointcurveattime \expandafter \mlm \pgfleftbanchor}
	\anchor{top-middleright}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfleftbanchor}
	\anchor{top-mbmright}{\expandafter \pgfpointcurveattime \expandafter \mrm\pgfleftbanchor}
	\anchor{top-bmright}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfleftbanchor}
	\anchor{top-bbmright}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfleftbanchor}
	\anchor{top-bottomright}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfleftbanchor}

	\anchor{bot-topleft}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfrightaanchor}
	\anchor{bot-ttmleft}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfrightaanchor}
	\anchor{bot-tmleft}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfrightaanchor}
	\anchor{bot-mtmleft}{\expandafter \pgfpointcurveattime \expandafter \mrm \pgfrightaanchor}
	\anchor{bot-middleleft}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfrightaanchor}
	\anchor{bot-mbmleft}{\expandafter \pgfpointcurveattime \expandafter \mlm\pgfrightaanchor}
	\anchor{bot-bmleft}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfrightaanchor}
	\anchor{bot-bbmleft}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfrightaanchor}
	\anchor{bot-bottomleft}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfrightaanchor}

	\anchor{bot-topright}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfrightbanchor}
	\anchor{bot-ttmright}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfrightbanchor}
	\anchor{bot-tmright}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfrightbanchor}
	\anchor{bot-mtmright}{\expandafter \pgfpointcurveattime \expandafter \mlm \pgfrightbanchor}
	\anchor{bot-middleright}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfrightbanchor}
	\anchor{bot-mbmright}{\expandafter \pgfpointcurveattime \expandafter \mrm\pgfrightbanchor}
	\anchor{bot-bmright}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfrightbanchor}
	\anchor{bot-bbmright}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfrightbanchor}
	\anchor{bot-bottomright}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfrightbanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Possible draw the top boundary circles
        \iftop
			\pgf@x=-0.5\cobwidth
			\advance\pgf@x by -0.5\cobgap
			\pgf@y=0.5\cobheight
        	\centerpoint
	        {
            	\pgftransformxshift{-0.5\cobgap}
	            \pgftransformxshift{-0.5\cobwidth}
	            \pgftransformxshift{-0.5*\extrawidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-topleft}{}
        	}
	        \centerpoint
        	{
            	\pgftransformxshift{0.5\cobgap}
	            \pgftransformxshift{0.5\cobwidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgftransformxshift{0.5*\extrawidth}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-topright}{}
        	}
        \fi

		% Draw the unobscured part of the lower cobordism
		\begin{pgfonlayer}{cobordism}

			\pgfrighta
			\pgfrightb
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
%			\pgfsetdash{{1pt}{0pt}}{1pt}	% Visible line
			\pgfusepath{stroke}

			\pgflefta
			\pgfleftb
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
%			\pgfsetdash{{1pt}{0pt}}{1pt}	% Visible line
			\pgfusepath{stroke}

		\end{pgfonlayer}

		\ifbot
			\pgf@x=-0.5\cobwidth
			\advance\pgf@x by -0.5\cobgap
			\pgf@y=-0.5\cobheight
        	\centerpoint
	        {
            	\pgftransformxshift{-0.5\cobgap}
	            \pgftransformxshift{-0.5\cobwidth}
	            \pgftransformxshift{-0.5*\extrawidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottomleft}{}
        	}
	        \centerpoint
        	{
            	\pgftransformxshift{0.5\cobgap}
	            \pgftransformxshift{0.5\cobwidth}
	            \pgftransformxshift{0.5*\extrawidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottomright}{}
        	}
        \fi

	}
}

% Blue Type-A braid, with the bottom right--top left cobordism obscured, and bottom ellipses
\pgfdeclareshape{Cobordism Blue Super Braid A}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{topleft}
	{
		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y=0.5\cobheight
	}
	\anchor{topright}
	{
		\pgf@x=0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y=0.5\cobheight
	}
	\anchor{bottomleft}
	{
		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y=-0.5\cobheight
	}
	\anchor{bottomright}
	{
		\pgf@x=0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y=-0.5\cobheight
	}


	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% First fill in the top left to bottom right cylinder (no stroke)
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{0.2\cobheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{-0.2\cobheight}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{0.5\cobheight}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}


		% Fill in the top right to bottom left cylinder (no stroke)
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap}{0.2\cobheight}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{0}}
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap}{-0.2\cobheight}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0}}
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now do all the stroking stuff.
		% A mask for the central section which obscures the cobordism below
		\newcommand\centersection
		{
			\pgflefta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
			\pgfleftb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		}

		% A mask for everything outside the central section
		\newcommand\outsidecentersection
		{
			\pgflefta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
			\pgfleftb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		}

		% Draw the obscured part of the lower cobordism
		\begin{pgfscope}
			% Clip to the inside section
			\centersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			% But only do it if obscured=true, else don't obscure.
			\ifobscured
				\pgfsetdash{{2pt}{2pt}}{1pt}	% Visible line
			\fi
			\pgfrighta
			\pgfrightb
			\pgfusepath{stroke}
		\end{pgfscope}

		% Draw the unobscured part of the lower cobordism
		\begin{pgfscope}
			% Clip to the outside section
			\outsidecentersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			\pgfsetdash{{1pt}{0pt}}{1pt}	% Visible line
			\pgfrighta
			\pgfrightb
			\pgfusepath{stroke}
		\end{pgfscope}

		% Draw the unobscured cobordism
		\pgflefta
		\pgfleftb
		\pgfusepath{stroke}


		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y=-0.5\cobheight

        % Add lower ellipse curve to bottom left
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}

		\pgfusepath{stroke}

        % Add lower upper ellipse curve to bottom right
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5*\cobheight - 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}

		\pgfusepath{stroke}


        % Add dashed upper ellipse curve to bottom left
		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-\cobwidth}{-0.5*\cobheight + 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5*\cobheight + 0.666*\ellipseheight}}
			{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}

     	\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}

        % Add dashed upper ellipse curve to bottom right
		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5*\cobheight + 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5*\cobheight + 0.666*\ellipseheight}}
			{\pgfpoint{0.5\cobgap}{-0.5\cobheight}}

     	\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}

	}
}


% The Type-B braid, with the bottom left--top right cobordism obscured
\pgfdeclareshape{Cobordism Braid B}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
		\ifwide
			\pgf@x = 0.5\cobgap
			\advance\pgf@x by 0.5\cobwidth
		\fi
		\ifverywide
			\pgf@x = \cobgap
			\advance\pgf@x by \cobwidth
		\fi
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{topleft}
	{
		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\pgf@y=0.5\cobheight
	}
	\anchor{topright}
	{
		\pgf@x=0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\pgf@y=0.5\cobheight
	}
	\anchor{bottomleft}
	{
		\pgf@x=-0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\advance\pgf@x by -0.5\dimexpr\extrawidth\relax
		\pgf@y=-0.5\cobheight
	}
	\anchor{bottomright}
	{
		\pgf@x=0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\advance\pgf@x by 0.5\dimexpr\extrawidth\relax
		\pgf@y=-0.5\cobheight
	}

	\anchor{bot-topleft}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfleftaanchor}
	\anchor{bot-ttmleft}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfleftaanchor}
	\anchor{bot-tmleft}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfleftaanchor}
	\anchor{bot-mtmleft}{\expandafter \pgfpointcurveattime \expandafter \mrm \pgfleftaanchor}
	\anchor{bot-middleleft}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfleftaanchor}
	\anchor{bot-mbmleft}{\expandafter \pgfpointcurveattime \expandafter \mlm\pgfleftaanchor}
	\anchor{bot-bmleft}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfleftaanchor}
	\anchor{bot-bbmleft}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfleftaanchor}
	\anchor{bot-bottomleft}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfleftaanchor}

	\anchor{bot-topright}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfleftbanchor}
	\anchor{bot-ttmright}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfleftbanchor}
	\anchor{bot-tmright}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfleftbanchor}
	\anchor{bot-mtmright}{\expandafter \pgfpointcurveattime \expandafter \mlm \pgfleftbanchor}
	\anchor{bot-middleright}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfleftbanchor}
	\anchor{bot-mbmright}{\expandafter \pgfpointcurveattime \expandafter \mrm\pgfleftbanchor}
	\anchor{bot-bmright}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfleftbanchor}
	\anchor{bot-bbmright}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfleftbanchor}
	\anchor{bot-bottomright}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfleftbanchor}

	\anchor{top-topleft}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfrightaanchor}
	\anchor{top-ttmleft}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfrightaanchor}
	\anchor{top-tmleft}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfrightaanchor}
	\anchor{top-mtmleft}{\expandafter \pgfpointcurveattime \expandafter \mrm \pgfrightaanchor}
	\anchor{top-middleleft}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfrightaanchor}
	\anchor{top-mbmleft}{\expandafter \pgfpointcurveattime \expandafter \mlm\pgfrightaanchor}
	\anchor{top-bmleft}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfrightaanchor}
	\anchor{top-bbmleft}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfrightaanchor}
	\anchor{top-bottomleft}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfrightaanchor}

	\anchor{top-topright}{\expandafter \pgfpointcurveattime \expandafter \lft \pgfrightbanchor}
	\anchor{top-ttmright}{\expandafter \pgfpointcurveattime \expandafter \llm \pgfrightbanchor}
	\anchor{top-tmright}{\expandafter \pgfpointcurveattime \expandafter \lm \pgfrightbanchor}
	\anchor{top-mtmright}{\expandafter \pgfpointcurveattime \expandafter \mlm \pgfrightbanchor}
	\anchor{top-middleright}{\expandafter \pgfpointcurveattime \expandafter \mddle \pgfrightbanchor}
	\anchor{top-mbmright}{\expandafter \pgfpointcurveattime \expandafter \mrm\pgfrightbanchor}
	\anchor{top-bmright}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pgfrightbanchor}
	\anchor{top-bbmright}{\expandafter \pgfpointcurveattime \expandafter \rrm \pgfrightbanchor}
	\anchor{top-bottomright}{\expandafter \pgfpointcurveattime \expandafter \rght \pgfrightbanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% Possibly draw the top boundary circles
        \iftop
			\pgf@x=-0.5\cobwidth
			\advance\pgf@x by -0.5\cobgap
			\pgf@y=0.5\cobheight
        	\centerpoint
	        {
            	\pgftransformxshift{-0.5\cobgap}
	            \pgftransformxshift{-0.5\cobwidth}
				\pgftransformxshift{-0.5*\extrawidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-topleft}{}
        	}
	        \centerpoint
        	{
            	\pgftransformxshift{0.5\cobgap}
	            \pgftransformxshift{0.5\cobwidth}
				\pgftransformxshift{0.5*\extrawidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-topright}{}
        	}
        \fi

		% A mask for the central section which obscures the cobordism below
		\newcommand\centersection
		{
			\pgfrighta
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth+0.5\cobordismlinewidth}{-0.5\cobheight}}
			\pgfrightb
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth-0.5\cobordismlinewidth}{0.5\cobheight}}
		}

		% A mask for everything outside the central section
		\newcommand\outsidecentersection
		{
			\pgfrighta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth-0.5\cobordismlinewidth}{-0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-\cobwidth-0.5\cobordismlinewidth}{0.5\cobheight}}
			\pgfrightb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth+0.5\cobordismlinewidth}{0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap+0.5*\extrawidth+\cobwidth+0.5\cobordismlinewidth}{-0.5\cobheight}}
		}

		% Draw the obscured part of the lower cobordism
		\iflowercob
		\begin{pgfscope}
			% Clip to the inside section
			\centersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			% But only do it if obscured=true, else don't obscure.
			\ifobscured
				\pgfsetdash{{2pt}{2pt}}{1pt}	% Visible line
			\fi
			\pgflefta
			\pgfleftb
			\pgfusepath{stroke}
		\end{pgfscope}
		\fi

		% Draw the unobscured part of the lower cobordism
		\begin{pgfonlayer}{cobordism}
		\begin{pgfscope}
			% Clip to the outside section
			\outsidecentersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			\pgfsetdash{{1pt}{0pt}}{1pt}	% Visible line
			\pgflefta
			\pgfleftb
			\pgfusepath{stroke}
		\end{pgfscope}

		% Draw the unobscured cobordism
			\pgfrighta
			\pgfrightb
			\pgfusepath{stroke}
		\end{pgfonlayer}

		\ifbot
			\pgf@x=-0.5\cobwidth
			\advance\pgf@x by -0.5\cobgap
			\pgf@y=-0.5\cobheight
        	\centerpoint
	        {
            	\pgftransformxshift{-0.5\cobgap}
	            \pgftransformxshift{-0.5\cobwidth}
				\pgftransformxshift{-0.5*\extrawidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottomleft}{}
        	}
	        \centerpoint
        	{
            	\pgftransformxshift{0.5\cobgap}
	            \pgftransformxshift{0.5\cobwidth}
				\pgftransformxshift{0.5*\extrawidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottomright}{}
        	}
        \fi

	}
}

\pgfdeclareshape{Cobordism Left Swish}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
		%\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{top}
	{
		\pgf@x=-0.25\cobgap
		\advance\pgf@x by -0.25\cobwidth
		\pgf@y=0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x=0.25\cobgap
		\advance\pgf@x by 0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\anchor{bot}
	{
		\pgf@x=0.25\cobgap
		\advance\pgf@x by 0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\backgroundpath
	{
		\begin{pgfonlayer}{cobordism}

		\pgfsetlinewidth{\cobordismlinewidth}
		\pgfpathmoveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{\shoulderone}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		\pgfusepath{stroke}
		\pgfpathmoveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{\shoulderone}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		\pgfusepath{stroke}

		\end{pgfonlayer}

		\ifbot
	        % Add bottom end 3d node to bottom, using a local coordinate environment.
        	\centerpoint
        	{
            	\pgftransformxshift{0.25\cobgap}
	            \pgftransformxshift{0.25\cobwidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottom}{}
        	}
		\fi

		\iftop
	        % Add bottom end 3d node to bottom, using a local coordinate environment.
        	\centerpoint
        	{
            	\pgftransformxshift{-0.25\cobgap}
	            \pgftransformxshift{-0.25\cobwidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-top}{}
        	}
		\fi
	}
}

\pgfdeclareshape{Cobordism Blue Super Left Swish}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{top}
	{
		\pgf@x=-0.25\cobgap
		\advance\pgf@x by -0.25\cobwidth
		\pgf@y=0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x=0.25\cobgap
		\advance\pgf@x by 0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\anchor{bot}
	{
		\pgf@x=0.25\cobgap
		\advance\pgf@x by 0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}
		\pgfpathmoveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{0.5\cobheight}}
		% First fill it, no stroke.
		% Right curve
		\pgfpathcurveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{\shoulderone}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		% Bottom half of bottom ellipse
		\pgfpathcurveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		% Left curve
		\pgfpathcurveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{\shoulderone}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{0.5\cobheight}}
		% Bottom half of top ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{0.5\cobheight}}
 		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting bottom half of upper ellipse.
		\pgfpathmoveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{0.5\cobheight}}
		% Right curve
		\pgfpathcurveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{\shoulderone}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		% Bottom half of bottom ellipse
		\pgfpathcurveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		% Left curve
		\pgfpathcurveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{\shoulderone}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{0.5\cobheight}}
		\pgfusepath{stroke}

		% Now draw the dotted upper half of the bottom ellipse
		\pgfpathmoveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{-0.5\cobheight+0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight+0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{-0.5\cobheight}}
     	\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Blue Super Right Swish}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\anchor{top}
	{
		\pgf@x=0.25\cobgap
		\advance\pgf@x by 0.25\cobwidth
		\pgf@y=0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x=-0.25\cobgap
		\advance\pgf@x by -0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\anchor{bot}
	{
		\pgf@x=-0.25\cobgap
		\advance\pgf@x by -0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}
		\pgfpathmoveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{0.5\cobheight}}
		% First fill it, no stroke.
		% Right curve
		\pgfpathcurveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{\shoulderone}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight}}
		% Bottom half of bottom ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight}}
		% Left curve
		\pgfpathcurveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{\shoulderone}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{0.5\cobheight}}
		% Bottom half of top ellipse
		\pgfpathcurveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{0.5\cobheight}}
 		\pgfsetfillcolor{\outermorphismcolor}
		\pgfusepath{fill}

		% Now stroke it, omitting bottom half of upper ellipse.
	\pgfpathmoveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{0.5\cobheight}}
		% Right curve
		\pgfpathcurveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{\shoulderone}}
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight}}
		% Bottom half of bottom ellipse
		\pgfpathcurveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight-0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight}}
		% Left curve
		\pgfpathcurveto
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{\shoulderone}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{\shouldertwo}}
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{0.5\cobheight}}
		\pgfusepath{stroke}

		% Now draw the dotted upper half of the bottom ellipse
		\pgfpathmoveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight+0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight+0.666*\ellipseheight}}
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight}}
     	\pgfsetdash{ {2pt}{2pt}{2pt}{2pt} }{0pt}
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism Right Swish}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
		%\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{top}
	{
		\pgf@x=0.25\cobgap
		\advance\pgf@x by 0.25\cobwidth
		\pgf@y=0.5\cobheight
	}
	\anchor{bot}
	{
		\pgf@x=-0.25\cobgap
		\advance\pgf@x by -0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x=-0.25\cobgap
		\advance\pgf@x by -0.25\cobwidth
		\pgf@y=-0.5\cobheight
	}
	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\iftop
	        % Add bottom end 3d node to bottom, using a local coordinate environment.
        	\centerpoint
        	{
            	\pgftransformxshift{0.25\cobgap}
	            \pgftransformxshift{0.25\cobwidth}
            	\pgftransformyshift{0.5\cobheight}
	            \pgfnode{Cobordism Top End 3D}{center}{}{\tikz@fig@name-top}{}
        	}
		\fi

		\begin{pgfonlayer}{cobordism}

		\pgfpathmoveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.25\cobwidth+0.25\cobgap}{\shouldertwo}} % first support point
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{\shoulderone}} % second support point
			{\pgfpoint{-0.75\cobwidth-0.25\cobgap}{-0.5\cobheight}} % end point
		\pgfusepath{stroke}
		\pgfpathmoveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.75\cobwidth+0.25\cobgap}{\shouldertwo}} % first support point
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{\shoulderone}} % second support point
			{\pgfpoint{0.25\cobwidth-0.25\cobgap}{-0.5\cobheight}} % end point
		\pgfusepath{stroke}

		\end{pgfonlayer}

		\ifbot
	        % Add bottom end 3d node to bottom, using a local coordinate environment.
        	\centerpoint
        	{
            	\pgftransformxshift{-0.25\cobgap}
	            \pgftransformxshift{-0.25\cobwidth}
            	\pgftransformyshift{-0.5\cobheight}
	            \pgfnode{Cobordism Bottom End 3D}{center}{}{\tikz@fig@name-bottom}{}
        	}
		\fi
	}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% End Shapes
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand\tikzbraidregionA
{
        (0.5\cobgap,0.5\cobheight)
                   .. controls (0.5\cobgap,0.2\cobheight)
                   and (-0.5\cobgap-\cobwidth,0)
                   .. (-0.5\cobgap-\cobwidth,-0.5\cobheight)
                   -- (-0.5\cobgap,-0.5\cobheight)
                   .. controls (-0.5\cobgap,-0.2\cobheight)
                   and (0.5\cobgap+\cobwidth,0)
                   .. (0.5\cobgap+\cobwidth,0.5\cobheight)
                   -- (0.5\cobgap,0.5\cobheight)
}

\newcommand\tikzbraidregionB
{
        (-0.5\cobgap,0.5\cobheight)
                   .. controls (-0.5\cobgap,0.2\cobheight)
                   and (0.5\cobgap+\cobwidth,0)
                   .. (0.5\cobgap+\cobwidth,-0.5\cobheight)
                   -- (0.5\cobgap,-0.5\cobheight)
                   .. controls (0.5\cobgap,-0.2\cobheight)
                   and (-0.5\cobgap-\cobwidth,0)
                   .. (-0.5\cobgap-\cobwidth,0.5\cobheight)
                   -- (-0.5\cobgap,0.5\cobheight)
}

% Draw a partially-obscured path within a BraidA shape.
% The first argument is the coordinate of the centre of
% the braid, and the second is the path drawing
% instructions in TikZ.
\newcommand\obscureA[2]
{
        % Clip to the obscured region, and draw the curve
        % in a scope with dashes enabled
        \begin{scope}[dash pattern=on 2pt off 2pt]
                \clip [shift={(#1)}]
                \tikzbraidregionA;
                #2;
        \end{scope}

        % Clip to outside the obscured region, and draw the
        % curve in a scope without dashes
        \begin{scope}
		\clip (current bounding box.south west)
			rectangle
			(current bounding box.north east)
                       [shift={(#1)}]
                       \tikzbraidregionA;
                #2;
        \end{scope}
}

% Draw a partially-obscured path within a BraidA shape.
% The first argument is the coordinate of the centre of
% the braid, and the second is the path command TikZ.
\newcommand\obscureB[2]
{
        % Clip to the obscured region, and draw the curve
        % in a scope with dashes enabled
        \begin{scope}[dash pattern=on 2pt off 2pt]
                \clip [shift={(#1)}]
                \tikzbraidregionB;
                #2;
        \end{scope}

        % Clip to outside the obscured region, and draw the
        % curve in a scope without dashes
        \begin{scope}
                \clip (current bounding box.south west)
                       -- (current bounding box.south east)
                       -- (current bounding box.north east)
                       -- (current bounding box.north west)
                       -- (current bounding box.south west)
                       [shift={(#1)}]
                       \tikzbraidregionB;
                #2;
        \end{scope}
}

% Expands bounding box by the argument both at the top and bottom
\newcommand\expandboundingbox[1]
{
	\useasboundingbox
		([yshift=-#1]current bounding box.south west)
			rectangle
		([yshift=#1]current bounding box.north east)
}


% %%% Add some new anchors to the rectangle object
% seems broken
% \def\pgfaddtoshape#1#2{%
%   \begingroup
%   \def\shape@name{#1}%
%   \let\anchor\pgf@sh@anchor
%   #2%
%   \endgroup
% }
% \pgfaddtoshape{rectangle}{%
%   \anchor{west south west}{%
%     \pgf@process{\northeast}%
%     \pgf@ya=.5\pgf@y%
%     \pgf@process{\southwest}%
%     \pgf@y=1.5\pgf@y%
%     \advance\pgf@y by \pgf@ya%
%     \pgf@y=.5\pgf@y%
%   }%
%   \anchor{west north west}{%
%     \pgf@process{\northeast}%
%     \pgf@ya=1.5\pgf@y%
%     \pgf@process{\southwest}%
%     \pgf@y=.5\pgf@y%
%     \advance\pgf@y by \pgf@ya%
%     \pgf@y=.5\pgf@y%
%   }%
%   \anchor{east north east}{%
%     \pgf@process{\southwest}%
%     \pgf@ya=.5\pgf@y%
%     \pgf@process{\northeast}%
%     \pgf@y=1.5\pgf@y%
%     \advance\pgf@y by \pgf@ya%
%     \pgf@y=.5\pgf@y%
%   }%
%   \anchor{east south east}{%
%     \pgf@process{\southwest}%
%     \pgf@ya=1.5\pgf@y%
%     \pgf@process{\northeast}%
%     \pgf@y=.5\pgf@y%
%     \advance\pgf@y by \pgf@ya%
%     \pgf@y=.5\pgf@y%
%   }%
%   \anchor{north north west}{%
%     \pgf@process{\southwest}%
%     \pgf@xa=1.5\pgf@x%
%     \pgf@process{\northeast}%
%     \pgf@x=.5\pgf@x%
%     \advance\pgf@x by \pgf@xa%
%     \pgf@x=.5\pgf@x%
%   }%
%   \anchor{north north east}{%
%     \pgf@process{\southwest}%
%     \pgf@xa=.5\pgf@x%
%     \pgf@process{\northeast}%
%     \pgf@x=1.5\pgf@x%
%     \advance\pgf@x by \pgf@xa%
%     \pgf@x=.5\pgf@x%
%   }%
%   \anchor{south south west}{%
%     \pgf@process{\northeast}%
%     \pgf@xa=.5\pgf@x%
%     \pgf@process{\southwest}%
%     \pgf@x=1.5\pgf@x%
%     \advance\pgf@x by \pgf@xa%
%     \pgf@x=.5\pgf@x%
%   }%
%   \anchor{south south east}{%
%     \pgf@process{\northeast}%
%     \pgf@xa=1.5\pgf@x%
%     \pgf@process{\southwest}%
%     \pgf@x=.5\pgf@x%
%     \advance\pgf@x by \pgf@xa%
%     \pgf@x=.5\pgf@x%
%   }%
% }
% \newcommand{\anchorlet}[2]{%
%     \global\expandafter
%     \let\csname pgf@anchor@\shape@name @#1\expandafter\endcsname
%     \csname pgf@anchor@\shape@name @#2\endcsname
% }
% \pgfaddtoshape{rectangle}{%
%   \anchorlet{se}{south east}%
%   \anchorlet{sw}{south west}%
%   \anchorlet{ne}{north east}%
%   \anchorlet{nw}{north west}%
%   \anchorlet{wsw}{west south west}%
%   \anchorlet{wnw}{west north west}%
%   \anchorlet{ene}{east north east}%
%   \anchorlet{ese}{east south east}%
%   \anchorlet{nnw}{north north west}%
%   \anchorlet{nne}{north north east}%
%   \anchorlet{ssw}{south south west}%
%   \anchorlet{sse}{south south east}%
% }




%%%%%%%%%%%%%%%%%%%
% Shape Shortcuts %
%%%%%%%%%%%%%%%%%%%
\tikzset{Top/.style={Cobordism Top End}} % A shortcut for the "Cobordism Top End" shape.
\tikzset{Bot/.style={Cobordism Bottom End}} % A shortcut for the "Cobordism Bottom End" shape.
\tikzset{Top3D/.style={Cobordism Top End 3D}} % A shortcut for the "Cobordism Top End" shape.
\tikzset{Bot3D/.style={Cobordism Bottom End 3D}} % A shortcut for the "Cobordism Bottom End 3D" shape.
\tikzset{Pants/.style={Cobordism Pants}} % A shortcut for the "Cobordism Pants" shape.
\tikzset{Copants/.style={Cobordism Copants}} % A shortcut for the "Cobordism Copants" shape.
\tikzset{PantsInseam/.style={Cobordism PantsInseam}} % A shortcut for the "Cobordism Pants" shape.
\tikzset{CopantsInseam/.style={Cobordism CopantsInseam}} % A shortcut for the "Cobordism Copants" shape.
\tikzset{PantsLeft/.style={Cobordism PantsLeft}} % A shortcut for the "Cobordism Pants" shape.
\tikzset{CopantsLeft/.style={Cobordism CopantsLeft}} % A shortcut for the "Cobordism Copants" shape.
\tikzset{PantsRight/.style={Cobordism PantsRight}} % A shortcut for the "Cobordism Pants" shape.
\tikzset{CopantsRight/.style={Cobordism CopantsRight}} % A shortcut for the "Cobordism Copants" shape.
\tikzset{Cap/.style={Cobordism Cap}} % A shortcut for the "Cobordism Cap" shape.
\tikzset{Cup/.style={Cobordism Cup}} % A shortcut for the "Cobordism Cup" shape.
\tikzset{CupTop/.style={Cobordism Cup Top}} % A shortcut for the "Cobordism Cup Top" shape.
\tikzset{Copairing/.style={Cobordism Copairing}} % A shortcut for the "Cobordism Cup Top" shape.
\tikzset{Pairing/.style={Cobordism Pairing}} % A shortcut for the "Cobordism Cup Top" shape.
\tikzset{BraidA/.style={Cobordism Braid}} % A shortcut for the braiding
\tikzset{BraidB/.style={Cobordism Braid}} % A shortcut for the braiding
\tikzset{SwishL/.style={Cobordism Left Swish}} % A shortcut for the type B braiding
\tikzset{SwishR/.style={Cobordism Right Swish}} % A shortcut for the type B braiding
\tikzset{CopairingOut/.style={Cobordism CopairingOut}}
\tikzset{CopairingIn/.style={Cobordism CopairingIn}}
\tikzset{Cyl/.style={Cobordism Cylinder}} % The node name "cylinder" is already taken by TikZ.
\tikzset{SuperCup/.style={Cobordism SuperCup}}
\tikzset{SuperCap/.style={Cobordism SuperCap}}
\tikzset{SuperPants/.style={Cobordism Super Pants}}
\tikzset{SuperCopants/.style={Cobordism Super Copants}}
\tikzset{SuperSwishL/.style={Cobordism Super Left Swish}}
\tikzset{SuperSwishR/.style={Cobordism Super Right Swish}}
\tikzset{SuperBraidA/.style={Cobordism Super Braid A}}
\tikzset{SuperBraidB/.style={Cobordism Super Braid B}}
\tikzset{SuperCyl/.style={Cobordism Super Cylinder}}
\tikzset{SuperPairing/.style={Cobordism Super Pairing}}
\tikzset{SuperCopairing/.style={Cobordism Super Copairing}}
\tikzset{Box/.style={Cobordism Box}}


\tikzset{BlueSuperCup/.style={Cobordism Blue SuperCup}}
\tikzset{BlueSuperCap/.style={Cobordism Blue SuperCap}}
\tikzset{BlueSuperPants/.style={Cobordism Blue Super Pants}}
\tikzset{BlueSuperCopants/.style={Cobordism Blue Super Copants}}
\tikzset{MorphismCyl/.style={Cobordism Morphism Cylinder}}
\tikzset{ReverseMorphismCyl/.style={Cobordism Reverse Morphism Cylinder}}
\tikzset{BlueCyl/.style={Cobordism Blue Cylinder}}
\tikzset{BlueSuperSwishL/.style={Cobordism Blue Super Left Swish}}
\tikzset{BlueSuperSwishR/.style={Cobordism Blue Super Right Swish}}
\tikzset{BlueSuperBraidA/.style={Cobordism Blue Super Braid A}}
\tikzset{BlueSuperPairing/.style={Cobordism Blue Super Pairing}}
\tikzset{BlueSuperCopairing/.style={Cobordism Blue Super Copairing}}
\tikzset{BlueSuperCyl/.style={Cobordism Blue Super Cylinder}}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Shortcuts to draw certain cobordisms %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Stores a drawing in a box, ready to be invoked later.
% The code is executed at the time the command is stored.
% The syntax is
% 	\producebox{nameofdiagram}{code for diagram}
% and then you write
%	\nameofdiagram
% to invoke it at a later time.
% \newcommand\producebox[2]
% {
%         \expandafter\newsavebox\expandafter{\csname savebox#1\endcsname}
%         \expandafter\sbox\expandafter{\csname savebox#1\endcsname}{#2}
%         \expandafter\newcommand
%                 \expandafter{\csname #1\endcsname}
%                 {\expandafter\usebox{\csname savebox#1\endcsname}}
% }
%
% \producebox{tikzcup}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%         \node (A)[Cup] at (0,0) {};
%         \node [Top] at (A.center) {};
% \end{tikzpicture}
% \end{aligned}}}
%
% \producebox{tikzcap}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%         \node [Cap] at (0,0) {};
%         \node [Bot] at (0,0) {};
% \end{tikzpicture}\end{aligned}}}
%
% \producebox{tikzpants}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%         \node (A)[Pants] at (0,0) {};
%         \node [Top] at (A.belt) {};
%         \node [Bot] at (A.leftleg) {};
%         \node [Bot] at (A.rightleg) {};
% \end{tikzpicture}\end{aligned}}}
%
% \producebox{tikzcopants}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%         \node (A)[Copants] at (0,0) {};
%         \node [Bot] at (A.belt) {};
%         \node [Top] at (A.leftleg) {};
%         \node [Top] at (A.rightleg) {};
% \end{tikzpicture}\end{aligned}}}
%
% \producebox{tikzcopairing}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%         \node (A)[Copairing] at (0,0) {};
%         \node [Top] at (A.leftleg) {};
%         \node [Top] at (A.rightleg) {};
% \end{tikzpicture}\end{aligned}}}
%
% \producebox{tikzcylinder}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%         \node (A)[Bot] at (0,0) {};
%         \node (B)[Top] at (0,\cobheight) {};
%         \path [cob] (A) -- (B);
% \end{tikzpicture}\end{aligned}}}
%
% \producebox{tikzcylinderdoubleheight}{\ensuremath{\begin{aligned}
% \begin{tikzpicture}
%     \node (A)[Bot] at (0,0) {};
%     \node (B)[Top] at (0,2\cobheight) {};
%     \path [cob] (A) -- (B);
% \end{tikzpicture}\end{aligned}}}
%
% \producebox{tikzverytinypants}{{\ensuremath{\hspace{-0.6pt}\raisebox{-2.0pt}{\begin{tikzpicture}[baseline={(current bounding box.south)}]
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.26}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Pants, top, bot] at (0,0) {};
% 		\useasboundingbox (-\cobwidth-0.5*\cobgap,-0.5\cobheight) rectangle (\cobwidth+0.5*\cobgap,0.5\cobheight);
% 	\end{scope}\end{tikzpicture}}\hspace{-0.6pt}}}}
%
% \producebox{tikzverytinycopants}{{\ensuremath{\hspace{-0.6pt}\raisebox{-2.0pt}{\begin{tikzpicture}[baseline={(current bounding box.south)}]
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.26}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Copants, bot, top] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}\hspace{-0.6pt}}}}
%
% \producebox{tikzverytinycap}{{\ensuremath{\hspace{-0.6pt}\raisebox{-2.1pt}{\begin{tikzpicture}[baseline={(current bounding box.south)}]
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.3}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Cap, bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}\hspace{-0.6pt}}}}
%
% \producebox{tikztinypants}{\ensuremath{\smash{\raisebox{-3pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.35}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Pants, top, bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}}
%
% \producebox{tikztinycyl}{\ensuremath{\raisebox{-3pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.35}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Cyl, top, bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikztinypantscopants}{\ensuremath{\smash{\raisebox{-3pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.2}
% 		\setlength\obscurewidth{0pt}
% 		\node (A) [Pants, top, bot, anchor=leftleg] at (0,0) {};
% 		\node [Copants, bot, anchor=leftleg] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}}
%
% \producebox{tikztinycopants}{\ensuremath{\smash{\raisebox{-3pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.35}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Copants, top, bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}}
%
% \producebox{tikztinycup}{\ensuremath{\smash{\raisebox{-5pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.7}
% 		\setlength\obscurewidth{0pt}
% 		\node [Cup] at (0,0) {};
% 		\node [Top] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}}
%
% \producebox{tikzverytinycup}{\ensuremath{\raisebox{-3.5pt}{\begin{tikzpicture}[baseline={(current bounding box.south)}]
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.3}
% 		\setlength\obscurewidth{0pt}
% 		\node [Cup] at (0,0) {};
% 		\node [Top] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikztinycap}{\smash{\ensuremath{\raisebox{-3pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.7}
% 		\setlength\obscurewidth{0pt}
% 		\node [Cap] at (0,0) {};
% 		\node [Bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}}
%
% \producebox{tikztinybraidb}{\smash{\ensuremath{\raisebox{-2pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.4}
% 		\setlength\obscurewidth{0pt}
% 		\node [BraidB, top, bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}}
%
% \producebox{tikztinycopairing}{\ensuremath{\raisebox{-6pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.5}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Copairing] at (0,0) {};
% 		\node [Top] at (A.leftleg) {};
% 		\node [Top] at (A.rightleg) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikztinypairing}{\ensuremath{\raisebox{-2.5pt}{\begin{tikzpicture}
% 	\begin{scope}
% 		\scalecobordisms{0.5}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Pairing] at (0,0) {};
% 		\node [Bot] at (A.leftleg) {};
% 		\node [Bot] at (A.rightleg) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikztinysphere}{\ensuremath{\smash{\raisebox{-5.5pt}{$\begin{tikzpicture}
% 	\begin{scope}
% 		\scalecobordisms{0.5}
% 		\setlength\cobwidth{1.3\cobwidth}
% 		\node (1) [Cup] at (0,0) {};
% 		\node (2) [Cap, bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}$}}}}
%
% \producebox{tikzminipants}{\ensuremath{\raisebox{-1pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.2}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Pants] at (0,0) {};
% 		\node [Top] at (A.belt) {};
% 		\node [Bot] at (A.leftleg) {};
% 		\node [Bot] at (A.rightleg) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikzminicopants}{\ensuremath{\raisebox{-1pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.2}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Copants] at (0,0) {};
% 		\node [Top] at (A.leftleg) {};
% 		\node [Top] at (A.rightleg) {};
% 		\node [Bot] at (A.belt) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikzminicup}{\ensuremath{\raisebox{-1.5pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.35}
% 		\setlength\obscurewidth{0pt}
% 		\node [Cup] at (0,0) {};
% 		\node [Top] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikzminicap}{\ensuremath{\raisebox{-0.5pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.35}
% 		\setlength\obscurewidth{0pt}
% 		\node [Cap] at (0,0) {};
% 		\node [Bot] at (0,0) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikzminicopairing}{\ensuremath{\raisebox{-2pt}{\begin{tikzpicture}
% 	\begin{scope}[every path/.style={-}]
% 		\scalecobordisms{0.25}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Copairing] at (0,0) {};
% 		\node [Top] at (A.leftleg) {};
% 		\node [Top] at (A.rightleg) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% \producebox{tikzminipairing}{\ensuremath{\raisebox{-0.5pt}{\begin{tikzpicture}
% 	\begin{scope}
% 		\scalecobordisms{0.15}
% 		\setlength\obscurewidth{0pt}
% 		\node (A)[Pants] at (0,0) {};
% 		\node [Bot] at (A.leftleg) {};
% 		\node [Bot] at (A.rightleg) {};
% 		\node [Cap] at (A.belt) {};
% 	\end{scope}
% \end{tikzpicture}}}}
%
% % Draw three stacked pairs of pants, useful for drawing the associator pentagon.
% % Usage example: \tikzalphastack{1}{3}
% \newcommand\tikzalphastack[2]{\ensuremath{\vc{
% \begin{tikzpicture}
% 	\node (A) [Pants] at (0,0) {};
% 	\node [Bot] at (A.leftleg) {};
% 	\node [Bot] at (A.rightleg) {};
% 	\node [Top] at (A.belt) {};
%
% 	% Draw the pants
% 	\node (A)[Pants] at (#1\cobgap+#1\cobwidth-1.5\cobgap-1.5\cobwidth,-\cobheight) {};
% 	\node [Bot] at (A.leftleg) {};
% 	\node [Bot] at (A.rightleg) {};
% 	\node (A)[Pants] at (#2\cobgap+#2\cobwidth-2\cobgap-2\cobwidth,-2\cobheight) {};
% 	\node [Bot] at (A.leftleg) {};
% 	\node [Bot] at (A.rightleg) {};
%
% 	% Draw the first-level swish
% 	\ifnum #1=1
% 		\node (A)[SwishL] at (0.75\cobwidth+0.75\cobgap,-\cobheight) {};
% 		\node [Bot] at (A.bot) {};
% 	\else
% 		\node (A)[SwishR] at (-0.75\cobwidth-0.75\cobgap,-\cobheight) {};
% 		\node [Bot] at (A.bot) {};
% 	\fi
%
% 	% Draw the rightmost second-level swish
% 	\ifnum #2<3
% 		\node (A)[SwishL] at (1.25\cobwidth+1.25\cobgap,-2\cobheight) {};
% 		\node [Bot] at (A.bot) {};
% 	\fi
%
% 	% Draw the leftmost second-level swish
% 	\ifnum #2>1
% 		\node (A)[SwishR] at (-1.25\cobwidth-1.25\cobgap,-2\cobheight) {};
% 		\node [Bot] at (A.bot) {};
% 	\fi
%
% 	% Draw the middle second-level swish
% 	\ifnum #2=1
% 		\node (A)[SwishL] at (0.25\cobwidth+0.25\cobgap,-2\cobheight) {};
% 		\node [Bot] at (A.bot) {};
% 	\fi
% 	\ifnum #2=3
% 		\node (A)[SwishR] at (-0.25\cobwidth-0.25\cobgap,-2\cobheight) {};
% 		\node [Bot] at (A.bot) {};
% 	\fi
% \end{tikzpicture}}}}

%%%%%%%

%% These commands are just for drawing certain curves independently and should not be considered core functions.

\pgfdeclareshape{Cobordism PantsInseam}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x=0pt
	}
	\saveddimen\beltwidth
	{
		\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\localheight
	{
		\setlength{\pgf@x}{\cobheight}
	}
	\saveddimen\rightlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\leftlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\begin{pgfonlayer}{top}
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pgfsetlinewidth{\cobordismlinewidth}
			\pantsinseam
			\pgfusepath{stroke}
		\end{pgfonlayer}
	}
}

\pgfdeclareshape{Cobordism PantsLeft}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x=0pt
	}
	\saveddimen\beltwidth
	{
		\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\localheight
	{
		\setlength{\pgf@x}{\cobheight}
	}
	\saveddimen\rightlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\leftlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\begin{pgfonlayer}{top}
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pantsleft
			\pgfusepath{stroke}
		\end{pgfonlayer}
	}
}

\pgfdeclareshape{Cobordism PantsRight}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x=0pt
	}
	\saveddimen\beltwidth
	{
		\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\localheight
	{
		\setlength{\pgf@x}{\cobheight}
	}
	\saveddimen\rightlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\leftlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\begin{pgfonlayer}{top}
			\pgfsetstrokecolor{\pgfkeysvalueof{/tikz/curve color}}
			\pantsright
			\pgfusepath{stroke}
		\end{pgfonlayer}
	}
}

\pgfdeclareshape{Cobordism CopantsInseam}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x=0pt
	}
	\saveddimen\beltwidth
	{
		\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\localheight
	{
		\setlength{\pgf@x}{\cobheight}
	}
	\saveddimen\rightlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\leftlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\copantsinseam
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism CopantsLeft}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x=0pt
	}
	\saveddimen\beltwidth
	{
		\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\localheight
	{
		\setlength{\pgf@x}{\cobheight}
	}
	\saveddimen\rightlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\leftlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\copantsleft
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism CopantsRight}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
	}
	\saveddimen\extrawidth
	{
		\pgf@x=0pt
	}
	\saveddimen\beltwidth
	{
		\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\localheight
	{
		\setlength{\pgf@x}{\cobheight}
	}
	\saveddimen\rightlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\saveddimen\leftlegwidth
	{
       	\setlength{\pgf@x}{\cobwidth}
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\copantsright
		\pgfusepath{stroke}

	}
}

\pgfdeclareshape{Cobordism CopairingOut}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
		%\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}
		\copairingout
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{Cobordism CopairingIn}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt %.5\wd\pgfnodeparttextbox%
		\pgf@y=0pt %.5\ht\pgfnodeparttextbox%
		%\advance\pgf@y by -.5\dp\pgfnodeparttextbox%
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}



	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}
		\copairingin
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{braidlefta}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}
	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}


		% Draw the unobscured cobordism
		\pgflefta
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{braidleftb}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}
		% Draw the unobscured cobordism
		\pgfleftb
		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{braidrighta}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% A mask for the central section which obscures the cobordism below
		\newcommand\centersection
		{
			\pgflefta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
			\pgfleftb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		}

		% A mask for everything outside the central section
		\newcommand\outsidecentersection
		{
			\pgflefta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
			\pgfleftb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		}

		% Draw the obscured part of the lower cobordism
		\begin{pgfscope}
			% Clip to the inside section
			\centersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			\pgfsetdash{{2pt}{2pt}}{1pt}	% Visible line
			\pgfrighta
			\pgfusepath{stroke}
		\end{pgfscope}

		% Draw the unobscured part of the lower cobordism
		\begin{pgfscope}
			% Clip to the outside section
			\outsidecentersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			\pgfsetdash{{1pt}{0pt}}{1pt}	% Visible line
			\pgfrighta
			\pgfusepath{stroke}
		\end{pgfscope}

	}
}

\pgfdeclareshape{braidrightb}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgf@x = 0pt
	}
	\anchor{center}{\centerpoint}
	\anchorborder{\centerpoint}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		% A mask for the central section which obscures the cobordism below
		\newcommand\centersection
		{
			\pgflefta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
			\pgfleftb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
		}

		% A mask for everything outside the central section
		\newcommand\outsidecentersection
		{
			\pgflefta
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap-\cobwidth}{0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap}{0.5\cobheight}}
			\pgfleftb
			\pgfpathlineto
				{\pgfpoint{0.5\cobgap+\cobwidth}{-0.5\cobheight}}
			\pgfpathlineto
				{\pgfpoint{-0.5\cobgap}{-0.5\cobheight}}
		}

		% Draw the obscured part of the lower cobordism
		\begin{pgfscope}
			% Clip to the inside section
			\centersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			\pgfsetdash{{2pt}{2pt}}{1pt}	% Visible line
			\pgfrightb
			\pgfusepath{stroke}
		\end{pgfscope}

		% Draw the unobscured part of the lower cobordism
		\begin{pgfscope}
			% Clip to the outside section
			\outsidecentersection
			\pgfusepath{clip}
			% Draw the top left -- bottom right lines
			\pgfsetdash{{1pt}{0pt}}{1pt}	% Visible line
			\pgfrightb
			\pgfusepath{stroke}
		\end{pgfscope}

	}
}

\pgfdeclareshape{2Dcap}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = -0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = -0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		\pgfpatharc{180}{0}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{90}{150}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto
			  {\pgfpoint{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		  \pgfpatharc{0}{45}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto
			  {\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		  \pgfpatharc{180}{135}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{90}{30}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}
		\fi
	}
}

\pgfdeclareshape{2Dcup}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
		{\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		\pgfpatharc{180}{360}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{270}{210}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto
			  {\pgfpoint{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		  \pgfpatharc{360}{315}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto
			  {\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		  \pgfpatharc{180}{225}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{270}{330}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}
		\fi
	}
}

\pgfdeclareshape{unit}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{top}
	{
	  \pgf@x = 0pt
	  \pgf@y=0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		\pgfpathlineto{\pgfpoint{0}{0.5\cobheight}}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfpoint{0}{0.5\cobgap}}
		  \pgfpathlineto{\pgfpoint{0}{0.4\cobheight+\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfpoint{0}{0.5\cobheight}}
		  \pgfpathlineto{\pgfpoint{0}{0.3\cobheight-\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\pgfpathcircle{\pgfqpoint{0pt}{0pt}}{0.5\cobgap}
		\pgfsetfillcolor{\morphismcolour}

		\pgfusepath{fill,stroke}
	}
}

\pgfdeclareshape{mult}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = -0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = -0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}
	\anchor{top}
	{
	  \pgf@x = 0pt
	  \pgf@y=0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		\pgfpatharc{180}{0}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}

		\pgfpathmoveto{\pgfpoint{0}{0.5\cobgap}}
		\pgfpathlineto{\pgfpoint{0}{0.5\cobheight}}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto
			  {\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		  \pgfpatharc{180}{135}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto
			  {\pgfpoint{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		  \pgfpatharc{0}{45}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfpoint{0}{0.5\cobgap}}
		  \pgfpathlineto{\pgfpoint{0}{0.4\cobheight+\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{90}{150}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{90}{30}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfpoint{0}{0.5\cobheight}}
		  \pgfpathlineto{\pgfpoint{0}{0.3\cobheight-\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\pgfpathcircle{\pgfqpoint{0pt}{0pt}}{0.5\cobgap}
		\pgfsetfillcolor{\morphismcolour}

		\pgfusepath{fill,stroke}
	}
}

\pgfdeclareshape{braid}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{topleftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{toprightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{bottomleftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}
	\anchor{bottomrightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{-0.5\cobheight}}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{-0.5\cobheight}}

		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{counit}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{bottom}
	{
	  \pgf@x=0pt
	  \pgf@y=-0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		\pgfpathlineto{\pgfpoint{0}{-0.5\cobheight}}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfpoint{0}{-0.5\cobheight}}
		  \pgfpathlineto{\pgfpoint{0}{-0.3\cobheight+\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfpoint{0}{-0.5\cobgap}}
		  \pgfpathlineto{\pgfpoint{0}{-0.4\cobheight-\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\pgfpathcircle{\pgfqpoint{0pt}{0pt}}{0.5\cobgap}
		\pgfsetfillcolor{\morphismcolour}

		\pgfusepath{fill,stroke}
	}
}

\pgfdeclareshape{comult}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{bottom}
	{
	  \pgf@x = 0pt
	  \pgf@y=-0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		\pgfpatharc{180}{360}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}

		\pgfpathmoveto{\pgfpoint{0}{-0.5\cobgap}}
		\pgfpathlineto{\pgfpoint{0}{-0.5\cobheight}}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{270}{210}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfqpoint{0pt}{0pt}}
		  \pgfpatharc{270}{330}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfpoint{0}{-0.5\cobheight}}
		  \pgfpathlineto{\pgfpoint{0}{-0.3\cobheight+\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto
			  {\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		  \pgfpatharc{180}{225}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto
			  {\pgfpoint{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		  \pgfpatharc{360}{315}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}
		  \pgfusepath{stroke}

		  \pgfpathmoveto{\pgfpoint{0}{-0.5\cobgap}}
		  \pgfpathlineto{\pgfpoint{0}{-0.4\cobheight-\cobordismscale}}
		  \pgfusepath{stroke}
		\fi

		\pgfpathcircle{\pgfqpoint{0pt}{0pt}}{0.5\cobgap}
		\pgfsetfillcolor{\morphismcolour}

		\pgfusepath{fill,stroke}
	}
}

\pgfdeclareshape{identity}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{top}
	{
	  \pgf@x = 0pt
	  \pgf@y=0.5\cobheight
	}
	\anchor{bottom}
	{
	  \pgf@x = 0pt
	  \pgf@y=-0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto{\pgfpoint{0}{-0.5\cobheight}}
		\pgfpathlineto{\pgfpoint{0}{0.5\cobheight}}

		\pgfusepath{stroke}

		\ifup
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfpoint{0}{-0.5\cobheight}}
		  \pgfpathlineto{\pgfqpoint{0pt}{0pt}}
		  \pgfusepath{stroke}
		\fi

		\ifdown
		  \pgfsetarrowsend{Stealth[length={\cobordismscale mm}]}
		  \pgfpathmoveto{\pgfpoint{0}{0.5\cobheight}}
		  \pgfpathlineto{\pgfqpoint{0pt}{0pt}}
		  \pgfusepath{stroke}
		\fi
	}
}

\pgfdeclareshape{swishl}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{top}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{-0.5\cobheight}}

		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{swishr}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{top}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{-0.5\cobheight}}

		\pgfusepath{stroke}
	}
}

\pgfdeclareshape{twfrobcap}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = -0.5\dimexpr\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = -0.5\dimexpr\cobheight
	}
	\anchor{top}
	{
		\pgf@y = \dimexpr\cobheight+0.25\cobgap
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{0.5*\extrawidth+0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5*\extrawidth+0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{-0.5\cobheight}}

		\pgfpathmoveto
			{\pgfpoint{-0.5*\extrawidth-0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5*\extrawidth-0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{-0.5\cobheight}}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth-0.5*\extrawidth}{0.5\cobheight}}
		\pgfpatharc{180}{0}{0.5\cobwidth+0.5*\extrawidth and 0.5\cobwidth+0.2*\extrawidth}

		\pgfpathmoveto{\pgfpoint{0}{\cobheight+0.2*\extrawidth+0.25\cobgap}}
		\pgfpathlineto{\pgfpoint{0}{\cobheight+0.2*\extrawidth-0.5\cobgap}}

		\pgfusepath{stroke}

		\pgfpathcircle{\pgfpoint{0}{\cobheight+0.2*\extrawidth-0.5\cobgap}}{0.25\cobgap}
		\ifautonomous
		  \pgfsetfillcolor{white}
		  \pgfusepath{fill, stroke}
		\fi
		\pgfpathcircle{\pgfpoint{0}{\cobheight+0.2*\extrawidth+0.25\cobgap}}{0.25\cobgap}
		\pgfsetfillcolor{black}
		\pgfusepath{fill, stroke}
	}
}

\pgfdeclareshape{twfrobcup}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0.5\dimexpr\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0.5\dimexpr\cobheight
	}
	\anchor{bottom}
	{
		\pgf@y = \dimexpr-\cobheight-0.25\cobgap
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{0.5\cobgap+0.5*\extrawidth+0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{-0.5*\extrawidth-0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{-0.5*\extrawidth-0.5\cobwidth}{-0.5\cobheight}}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{0.5\cobheight}}
		\pgfpathcurveto
			{\pgfpoint{-0.5\cobgap-0.5*\extrawidth-0.5\cobwidth}{0.1\cobheight}}
			{\pgfpoint{0.5*\extrawidth+0.5\cobwidth}{-0.1\cobheight}}
			{\pgfpoint{0.5*\extrawidth+0.5\cobwidth}{-0.5\cobheight}}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobwidth-0.5*\extrawidth}{-0.5\cobheight}}
		\pgfpatharc{180}{360}{0.5\cobwidth+0.5*\extrawidth and 0.5\cobwidth+0.2*\extrawidth}

		\pgfpathmoveto{\pgfpoint{0}{-\cobheight-0.25\cobgap}}
		\pgfpathlineto{\pgfpoint{0}{-\cobheight+0.5\cobgap}}

		\pgfusepath{stroke}

		\pgfpathcircle{\pgfpoint{0}{-\cobheight-0.2*\extrawidth-0.25\cobgap}}{0.25\cobgap}
		\ifautonomous
		  \pgfsetfillcolor{white}
		  \pgfusepath{fill, stroke}
		\fi
		\pgfpathcircle{\pgfpoint{0}{-\cobheight-0.2*\extrawidth+0.5\cobgap}}{0.25\cobgap}
		\pgfsetfillcolor{black}
		\pgfusepath{fill, stroke}
	}
}

\pgfdeclareshape{frobcap}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = -0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = -0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by -0.5\cobheight
	}
	\anchor{top}
	{
		\pgf@x = 0pt
		\pgf@y = \dimexpr\cobgap
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
			{\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{-0.5\cobheight-0.2*\extrawidth}}
		\pgfpatharc{180}{0}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}

		\pgfpathmoveto{\pgfpoint{0}{0.5\cobheight-0.5\cobwidth+0.25\cobgap}}
		\pgfpathlineto{\pgfpoint{0}{0.5\cobheight-0.5\cobwidth-0.5\cobgap}}

		\pgfusepath{stroke}

		\pgfpathcircle{\pgfpoint{0}{0.5\cobheight-0.5\cobwidth-0.5\cobgap}}{0.25\cobgap}
		\ifautonomous
		  \pgfsetfillcolor{white}
		  \pgfusepath{fill, stroke}
		\fi
		\pgfpathcircle{\pgfpoint{0}{0.5\cobheight-0.5\cobwidth+0.25\cobgap}}{0.25\cobgap}
		\pgfsetfillcolor{black}
		\pgfusepath{fill, stroke}
	}
}

\pgfdeclareshape{frobcup}
{
	\savedanchor\centerpoint
	{
		\pgf@x=0pt
		\pgf@y=0pt
	}
	\saveddimen\extrawidth
	{
		\pgfmathsetmacro{\extra}{\morphismspan-1}
		\pgf@x = \extra\cobgap
		\advance\pgf@x by \extra\cobwidth
	}
	\anchor{center}{\centerpoint}
	\inheritsavedanchors[from=rectangle]%
	\inheritanchorborder[from=rectangle]%
	\foreach \anchor in {north,north west,north east,west,east,mid,
	  mid west,mid east,base,base west,base east,south,south west,south east}{%
	\inheritanchor[from=rectangle]{\anchor}}%
	\anchorborder{\centerpoint}
	\anchor{leftleg}
	{
		\pgf@x = -0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by -0.5\cobwidth
		\advance\pgf@x by -0.5\cobgap
		\pgf@y = 0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{rightleg}
	{
		\pgf@x = 0.5\dimexpr\extrawidth\relax
		\advance\pgf@x by 0.5\cobwidth
		\advance\pgf@x by 0.5\cobgap
		\pgf@y = 0.2\dimexpr\extrawidth\relax
		\advance\pgf@y by 0.5\cobheight
	}
	\anchor{bottom}
	{
		\pgf@x = 0pt
		\pgf@y = \dimexpr-\cobgap
	}

	\anchor{right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairinginanchor}
	\anchor{rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairinginanchor}
	\anchor{rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairinginanchor}
	\anchor{mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairinginanchor}
	\anchor{middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairinginanchor}
	\anchor{mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairinginanchor}
	\anchor{lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairinginanchor}
	\anchor{llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairinginanchor}
	\anchor{left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairinginanchor}

	\anchor{out-right}{\expandafter \pgfpointcurveattime \expandafter \rght \pairingoutanchor}
	\anchor{out-rrm}{\expandafter \pgfpointcurveattime \expandafter \rrm \pairingoutanchor}
	\anchor{out-rm}{\expandafter \pgfpointcurveattime \expandafter \rghtm \pairingoutanchor}
	\anchor{out-mrm}{\expandafter \pgfpointcurveattime \expandafter \mrm \pairingoutanchor}
	\anchor{out-middle}{\expandafter \pgfpointcurveattime \expandafter \mddle \pairingoutanchor}
	\anchor{out-mlm}{\expandafter \pgfpointcurveattime \expandafter \mlm\pairingoutanchor}
	\anchor{out-lm}{\expandafter \pgfpointcurveattime \expandafter \lm \pairingoutanchor}
	\anchor{out-llm}{\expandafter \pgfpointcurveattime \expandafter \llm \pairingoutanchor}
	\anchor{out-left}{\expandafter \pgfpointcurveattime \expandafter \lft \pairingoutanchor}

	\backgroundpath
	{
		\pgfsetlinewidth{\cobordismlinewidth}

		\pgfpathmoveto
		{\pgfpoint{-0.5\cobgap-0.5\cobwidth-0.5*\extrawidth}{0.5\cobheight+0.2*\extrawidth}}
		\pgfpatharc{180}{360}{0.5\cobgap+0.5\cobwidth+0.5*\extrawidth and 0.5\cobgap+0.5\cobwidth+0.2*\extrawidth}

		\pgfpathmoveto{\pgfpoint{0}{-0.5\cobheight+0.5\cobwidth-0.25\cobgap}}
		\pgfpathlineto{\pgfpoint{0}{-0.5\cobheight+0.5\cobwidth+0.5\cobgap}}

		\pgfusepath{stroke}

		\pgfpathcircle{\pgfpoint{0}{-0.5\cobheight+0.5\cobwidth-0.25\cobgap}}{0.25\cobgap}
		\ifautonomous
		  \pgfsetfillcolor{white}
		  \pgfusepath{fill, stroke}
		\fi
		\pgfpathcircle{\pgfpoint{0}{-0.5\cobheight+0.5\cobwidth+0.5\cobgap}}{0.25\cobgap}
		\pgfsetfillcolor{black}
		\pgfusepath{fill, stroke}
	}
}

\pgfkeys{
  /idstack/.cd,
  label/.initial=id,
  direction/.initial=down,
  orientation/.initial=unoriented,
  anchor/.initial=none
}

\newcommand{\idstack}[2][label=id]{
  \pgfkeys{
    /idstack/.cd,
    #1,
    label/.get=\idslbl,
    direction/.get=\idsdir,
    orientation/.get=\idsor,
    anchor/.get=\idsanch
  }
  \foreach \i in {1,...,#2}{
      \ifnum \i=1
        \ifdefstring{\idsanch}{none}{
          \node[identity, \idsor] (\idslbl\i) {};
        }{
          \ifdefstring{\idsdir}{down}{
            \node[identity, \idsor, anchor=top] (\idslbl\i) at (\idsanch) {};
          }{
            \node[identity, \idsor, anchor=bottom] (\idslbl\i) at (\idsanch) {};
          }
        }
      \else
        \pgfmathtruncatemacro{\p}{\i-1}
          \ifdefstring{\idsdir}{down}{
            \node[identity, \idsor, anchor=top] (\idslbl\i) at (\idslbl\p.bottom) {};
          }{
            \node[identity, \idsor, anchor=bottom] (\idslbl\i) at (\idslbl\p.top) {};
          }
      \fi
  }
}
